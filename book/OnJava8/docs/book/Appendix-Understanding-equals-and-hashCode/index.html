<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Thinking Drafts"><link href=https://wiki.leay.net/book/OnJava8/docs/book/Appendix-Understanding-equals-and-hashCode/ rel=canonical><meta name=author content=hqweay><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content="en, ja"><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>Appendix Understanding equals and hashCode - Hqweay's Wiki</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../../../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105976066-3", "wiki.leay.net")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=indigo> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#equalshashcode tabindex=0 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" aria-label="Hqweay's Wiki" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Hqweay's Wiki </span> <span class=md-header-nav__topic> Appendix Understanding equals and hashCode </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Book </a> </li> <li class=md-tabs__item> <a href=../../../../../doc/ class=md-tabs__link> Doc </a> </li> <li class=md-tabs__item> <a href=../../../../../life/reading/ class=md-tabs__link> Life </a> </li> <li class=md-tabs__item> <a href=../../../../../study/draft/try-wiki/ class=md-tabs__link> Study </a> </li> <li class=md-tabs__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ class=md-tabs__link> Tech </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Hqweay's Wiki </label> <div class=md-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../../../../test/ title=特殊语法 class=md-nav__link> 特殊语法 </a> </li> <li class=md-nav__item> <a href=../../../../../web-page/ title=静态文档导航 class=md-nav__link> 静态文档导航 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1 checked> <label class=md-nav__link for=nav-4-1> OnJava8 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> OnJava8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title="《On Java 8》中文版" class=md-nav__link> 《On Java 8》中文版 </a> </li> <li class=md-nav__item> <a href=../../../CONTRIBUTING/ title=CONTRIBUTING class=md-nav__link> CONTRIBUTING </a> </li> <li class=md-nav__item> <a href=../../../SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4 type=checkbox id=nav-4-1-4 checked> <label class=md-nav__link for=nav-4-1-4> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-1-4> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title=译者的话 class=md-nav__link> 译者的话 </a> </li> <li class=md-nav__item> <a href=../../_coverpage/ title=coverpage class=md-nav__link> coverpage </a> </li> <li class=md-nav__item> <a href=../../sidebar/ title=Sidebar class=md-nav__link> Sidebar </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4 type=checkbox id=nav-4-1-4-4> <label class=md-nav__link for=nav-4-1-4-4> style </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-4> style </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4-1 type=checkbox id=nav-4-1-4-4-1> <label class=md-nav__link for=nav-4-1-4-4-1> Prism master </label> <nav class=md-nav data-md-component=collapsible data-md-level=5> <label class=md-nav__title for=nav-4-1-4-4-1> Prism master </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_style/prism-master/ title=[Prism](http://prismjs.com/) class=md-nav__link> [Prism](http://prismjs.com/) </a> </li> <li class=md-nav__item> <a href=../../_style/prism-master/CHANGELOG/ title="Prism Changelog" class=md-nav__link> Prism Changelog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-5 type=checkbox id=nav-4-1-4-5 checked> <label class=md-nav__link for=nav-4-1-4-5> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-5> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../00-Introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../00-On-Java-8/ title="00 On Java 8" class=md-nav__link> 00 On Java 8 </a> </li> <li class=md-nav__item> <a href=../00-Preface/ title=前言 class=md-nav__link> 前言 </a> </li> <li class=md-nav__item> <a href=../01-What-is-an-Object/ title="第一章 对象的概念" class=md-nav__link> 第一章 对象的概念 </a> </li> <li class=md-nav__item> <a href=../02-Installing-Java-and-the-Book-Examples/ title="02 Installing Java and the Book Examples" class=md-nav__link> 02 Installing Java and the Book Examples </a> </li> <li class=md-nav__item> <a href=../03-Objects-Everywhere/ title="03 Objects Everywhere" class=md-nav__link> 03 Objects Everywhere </a> </li> <li class=md-nav__item> <a href=../04-Operators/ title="04 Operators" class=md-nav__link> 04 Operators </a> </li> <li class=md-nav__item> <a href=../05-Control-Flow/ title="05 Control Flow" class=md-nav__link> 05 Control Flow </a> </li> <li class=md-nav__item> <a href=../06-Housekeeping/ title="06 Housekeeping" class=md-nav__link> 06 Housekeeping </a> </li> <li class=md-nav__item> <a href=../07-Implementation-Hiding/ title="07 Implementation Hiding" class=md-nav__link> 07 Implementation Hiding </a> </li> <li class=md-nav__item> <a href=../08-Reuse/ title="08 Reuse" class=md-nav__link> 08 Reuse </a> </li> <li class=md-nav__item> <a href=../09-Polymorphism/ title="09 Polymorphism" class=md-nav__link> 09 Polymorphism </a> </li> <li class=md-nav__item> <a href=../10-Interfaces/ title="10 Interfaces" class=md-nav__link> 10 Interfaces </a> </li> <li class=md-nav__item> <a href=../11-Inner-Classes/ title="11 Inner Classes" class=md-nav__link> 11 Inner Classes </a> </li> <li class=md-nav__item> <a href=../12-Collections/ title="12 Collections" class=md-nav__link> 12 Collections </a> </li> <li class=md-nav__item> <a href=../13-Functional-Programming/ title="13 Functional Programming" class=md-nav__link> 13 Functional Programming </a> </li> <li class=md-nav__item> <a href=../14-Streams/ title="14 Streams" class=md-nav__link> 14 Streams </a> </li> <li class=md-nav__item> <a href=../15-Exceptions/ title="15 Exceptions" class=md-nav__link> 15 Exceptions </a> </li> <li class=md-nav__item> <a href=../16-Validating-Your-Code/ title="16 Validating Your Code" class=md-nav__link> 16 Validating Your Code </a> </li> <li class=md-nav__item> <a href=../17-Files/ title="17 Files" class=md-nav__link> 17 Files </a> </li> <li class=md-nav__item> <a href=../18-Strings/ title="18 Strings" class=md-nav__link> 18 Strings </a> </li> <li class=md-nav__item> <a href=../19-Type-Information/ title="19 Type Information" class=md-nav__link> 19 Type Information </a> </li> <li class=md-nav__item> <a href=../20-Generics/ title="20 Generics" class=md-nav__link> 20 Generics </a> </li> <li class=md-nav__item> <a href=../21-Arrays/ title="21 Arrays" class=md-nav__link> 21 Arrays </a> </li> <li class=md-nav__item> <a href=../22-Enumerations/ title="22 Enumerations" class=md-nav__link> 22 Enumerations </a> </li> <li class=md-nav__item> <a href=../23-Annotations/ title="23 Annotations" class=md-nav__link> 23 Annotations </a> </li> <li class=md-nav__item> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class=md-nav__link> 24 Concurrent Programming </a> </li> <li class=md-nav__item> <a href=../25-Patterns/ title="25 Patterns" class=md-nav__link> 25 Patterns </a> </li> <li class=md-nav__item> <a href=../Appendix-Becoming-a-Programmer/ title="Appendix Becoming a Programmer" class=md-nav__link> Appendix Becoming a Programmer </a> </li> <li class=md-nav__item> <a href=../Appendix-Benefits-and-Costs-of-Static-Type-Checking/ title="Appendix Benefits and Costs of Static Type Checking" class=md-nav__link> Appendix Benefits and Costs of Static Type Checking </a> </li> <li class=md-nav__item> <a href=../Appendix-Collection-Topics/ title="Appendix Collection Topics" class=md-nav__link> Appendix Collection Topics </a> </li> <li class=md-nav__item> <a href=../Appendix-Data-Compression/ title="Appendix Data Compression" class=md-nav__link> Appendix Data Compression </a> </li> <li class=md-nav__item> <a href=../Appendix-IO-Streams/ title="Appendix IO Streams" class=md-nav__link> Appendix IO Streams </a> </li> <li class=md-nav__item> <a href=../Appendix-Javadoc/ title="Appendix Javadoc" class=md-nav__link> Appendix Javadoc </a> </li> <li class=md-nav__item> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class=md-nav__link> Appendix Low Level Concurrency </a> </li> <li class=md-nav__item> <a href=../Appendix-New-IO/ title="Appendix New IO" class=md-nav__link> Appendix New IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class=md-nav__link> Appendix Object Serialization </a> </li> <li class=md-nav__item> <a href=../Appendix-Passing-and-Returning-Objects/ title="Appendix Passing and Returning Objects" class=md-nav__link> Appendix Passing and Returning Objects </a> </li> <li class=md-nav__item> <a href=../Appendix-Programming-Guidelines/ title="Appendix Programming Guidelines" class=md-nav__link> Appendix Programming Guidelines </a> </li> <li class=md-nav__item> <a href=../Appendix-Standard-IO/ title="Appendix Standard IO" class=md-nav__link> Appendix Standard IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Supplements/ title="Appendix Supplements" class=md-nav__link> Appendix Supplements </a> </li> <li class=md-nav__item> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class=md-nav__link> Appendix The Positive Legacy of C plus plus and Java </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Appendix Understanding equals and hashCode </label> <a href=./ title="Appendix Understanding equals and hashCode" class="md-nav__link md-nav__link--active"> Appendix Understanding equals and hashCode </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#equals class=md-nav__link> equals规范 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 不同子类的相等性 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 哈希和哈希码 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hashcode class=md-nav__link> 理解 hashCode </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 为了速度而散列 </a> </li> <li class=md-nav__item> <a href=#hashcode_1 class=md-nav__link> 重写 hashCode() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hashmap class=md-nav__link> 调优 HashMap </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../GLOSSARY/ title=GLOSSARY class=md-nav__link> GLOSSARY </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Doc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Doc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/ title=About class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> English </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1 type=checkbox id=nav-5-2-1> <label class=md-nav__link for=nav-5-2-1> A Programmers Guide to English </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-1> A Programmers Guide to English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/ title="A Programmer's Guide to English" class=md-nav__link> A Programmer's Guide to English </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-3 type=checkbox id=nav-5-2-1-3> <label class=md-nav__link for=nav-5-2-1-3> Essence </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-3> Essence </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/essence/ title=语言学习的本质浅析 class=md-nav__link> 语言学习的本质浅析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-4 type=checkbox id=nav-5-2-1-4> <label class=md-nav__link for=nav-5-2-1-4> Make a program </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-4> Make a program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/make-a-program/ title=如何构建一个识别英语的程序 class=md-nav__link> 如何构建一个识别英语的程序 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-5 type=checkbox id=nav-5-2-1-5> <label class=md-nav__link for=nav-5-2-1-5> Qa </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-5> Qa </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/ title="常见问题 QA" class=md-nav__link> 常见问题 QA </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/WhyPTE/ title="为什么我选择 PTE 考试" class=md-nav__link> 为什么我选择 PTE 考试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-6 type=checkbox id=nav-5-2-1-6> <label class=md-nav__link for=nav-5-2-1-6> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-6> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/resources/ title=资料、工具推荐和扩展阅读 class=md-nav__link> 资料、工具推荐和扩展阅读 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-7 type=checkbox id=nav-5-2-1-7> <label class=md-nav__link for=nav-5-2-1-7> Training </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-7> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ title=我的训练方法 class=md-nav__link> 我的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/KnowledgeBase/ title=扩充语料库的训练方法 class=md-nav__link> 扩充语料库的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ListeningandSpeaking/ title=发音和听力训练方法 class=md-nav__link> 发音和听力训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/Thinking/ title=英语思维训练 class=md-nav__link> 英语思维训练 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2 type=checkbox id=nav-5-2-2> <label class=md-nav__link for=nav-5-2-2> English level up tips for Chinese </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-2> English level up tips for Chinese </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/ title=English-level-up-tips-for-Chinese class=md-nav__link> English-level-up-tips-for-Chinese </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-3 type=checkbox id=nav-5-2-2-3> <label class=md-nav__link for=nav-5-2-2-3> Part 1 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-3> Part 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/1-understanding/ title=认知篇 class=md-nav__link> 认知篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/2-vocabulary/ title=单词篇 class=md-nav__link> 单词篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/3-listening/ title=听力篇 class=md-nav__link> 听力篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/4-reading/ title=阅读篇 class=md-nav__link> 阅读篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/5-speaking/ title="5 speaking" class=md-nav__link> 5 speaking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-4 type=checkbox id=nav-5-2-2-4> <label class=md-nav__link for=nav-5-2-2-4> Part 2 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-4> Part 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-2/x-misc/ title=扯淡篇 class=md-nav__link> 扯淡篇 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-5 type=checkbox id=nav-5-2-2-5> <label class=md-nav__link for=nav-5-2-2-5> Word list </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-5> Word list </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Go/ title=Go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Java/ title=Java class=md-nav__link> Java </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/JavaScript/ title=JavaScript class=md-nav__link> JavaScript </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/PHP/ title=PHP class=md-nav__link> PHP </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Swift/ title=Swift class=md-nav__link> Swift </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-3 type=checkbox id=nav-5-2-3> <label class=md-nav__link for=nav-5-2-3> Everyone can use english </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-3> Everyone can use english </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/ title=人人都能用英语 class=md-nav__link> 人人都能用英语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter1/ title="第一章 起点" class=md-nav__link> 第一章 起点 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter2/ title="第二章 口语" class=md-nav__link> 第二章 口语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter3/ title="第三章 语音" class=md-nav__link> 第三章 语音 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter4/ title="第四章 朗读" class=md-nav__link> 第四章 朗读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter5/ title="第五章 词典" class=md-nav__link> 第五章 词典 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter6/ title="第六章 语法" class=md-nav__link> 第六章 语法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter7/ title="第七章 精读" class=md-nav__link> 第七章 精读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter8/ title="第八章 叮嘱" class=md-nav__link> 第八章 叮嘱 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/end/ title=后记 class=md-nav__link> 后记 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-1 type=checkbox id=nav-5-3-1> <label class=md-nav__link for=nav-5-3-1> Chinese copywriting guidelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-1> Chinese copywriting guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/CHANGELOG/ title=CHANGELOG class=md-nav__link> CHANGELOG </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.en-US/ title="Chinese Copywriting Guidelines" class=md-nav__link> Chinese Copywriting Guidelines </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-CN/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-HK/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2> <label class=md-nav__link for=nav-5-3-2> Document style guide </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> Document style guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/ title=Index class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2-2 type=checkbox id=nav-5-3-2-2> <label class=md-nav__link for=nav-5-3-2-2> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-3-2-2> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/marks/ title=标点符号 class=md-nav__link> 标点符号 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/number/ title=数值 class=md-nav__link> 数值 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/paragraph/ title=段落 class=md-nav__link> 段落 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/reference/ title=参考链接 class=md-nav__link> 参考链接 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/structure/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/text/ title=文本 class=md-nav__link> 文本 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/title/ title=标题 class=md-nav__link> 标题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Life </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Life </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Reading </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/ title=阅读 class=md-nav__link> 阅读 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-2 type=checkbox id=nav-6-1-2> <label class=md-nav__link for=nav-6-1-2> Mark </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-2> Mark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back-up/ title="2019 暑假备份" class=md-nav__link> 2019 暑假备份 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back/ title=例行收集 class=md-nav__link> 例行收集 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/efficiency-time/ title=效率、时间、鸡汤 class=md-nav__link> 效率、时间、鸡汤 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fiction/ title=小说 class=md-nav__link> 小说 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/films-remark/ title=影评、电影 class=md-nav__link> 影评、电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fo/ title=佛 class=md-nav__link> 佛 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hackers-others/ title=互联网、思维方式 class=md-nav__link> 互联网、思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hooked-media/ title=媒介反思 class=md-nav__link> 媒介反思 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/isaka-kotaro/ title=伊坂幸太郎 class=md-nav__link> 伊坂幸太郎 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/knote/ title=整理 class=md-nav__link> 整理 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/mark-knote/ title=浪费时间 class=md-nav__link> 浪费时间 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/meaning/ title=思维方式 class=md-nav__link> 思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/morimi-tomihiko/ title=森见登美彦的文字好有趣啊! class=md-nav__link> 森见登美彦的文字好有趣啊! </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/murakamo-haruki/ title=村上春树 class=md-nav__link> 村上春树 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/no-fiction/ title=非虚构类 class=md-nav__link> 非虚构类 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/paper/ title=论文式总结 class=md-nav__link> 论文式总结 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/poem/ title=诗歌 class=md-nav__link> 诗歌 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/sence/ title=哲学相关通俗读物 class=md-nav__link> 哲学相关通俗读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/the-little-prince/ title="The Little Prince" class=md-nav__link> The Little Prince </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/universe/ title=物理科普读物 class=md-nav__link> 物理科普读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/utopia/ title=乌托邦小说世界关于书籍的冷幽默 class=md-nav__link> 乌托邦小说世界关于书籍的冷幽默 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/western-politics/ title=政哲 class=md-nav__link> 政哲 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/what-we-talk-about/ title=日本文学 class=md-nav__link> 日本文学 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/wuxia/ title=武侠 class=md-nav__link> 武侠 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/xiao-bo/ title=王小波 class=md-nav__link> 王小波 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-3 type=checkbox id=nav-6-1-3> <label class=md-nav__link for=nav-6-1-3> Note </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-3> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-02-book-JavaScript-DOM/ title="《JavaScript DOM 编程艺术》" class=md-nav__link> 《JavaScript DOM 编程艺术》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-09-coding-javascript-down/ title="尽量把 JavaScript 代码放到 HTML 网页底部" class=md-nav__link> 尽量把 JavaScript 代码放到 HTML 网页底部 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-05-23-HTTP/ title="《HTTP 图解》" class=md-nav__link> 《HTTP 图解》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-06-07-computer/ title=计算机系统基础 class=md-nav__link> 计算机系统基础 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-10-09-JVM/ title="JVM 笔记" class=md-nav__link> JVM 笔记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-11-25-computer/ title=计算机系统概论 class=md-nav__link> 计算机系统概论 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-4 type=checkbox id=nav-6-1-4> <label class=md-nav__link for=nav-6-1-4> Review </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-4> Review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-28-say-something/ title=听你吹牛的闲暇时光 class=md-nav__link> 听你吹牛的闲暇时光 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-29-wuxia/ title="《流星 蝴蝶 剑》简记" class=md-nav__link> 《流星 蝴蝶 剑》简记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-12-30-xiao-bo/ title=波波老师 class=md-nav__link> 波波老师 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-01-17-lai-zi-xin-shi-jie/ title=《来自新世界》 class=md-nav__link> 《来自新世界》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-10-06-October/ title=科普谈起 class=md-nav__link> 科普谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2019-09-07-story/ title=从网络小说谈起。 class=md-nav__link> 从网络小说谈起。 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Watching </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Watching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/watching/2017-08-29-watch-movies-rencently/ title=最近看的几部电影 class=md-nav__link> 最近看的几部电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-10-13-september-movies-record/ title=九月观影记录 class=md-nav__link> 九月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-11-01-October-summary/ title=十月看片与非专业类阅读 class=md-nav__link> 十月看片与非专业类阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-12-01-1112/ title=观影与阅读记录 class=md-nav__link> 观影与阅读记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-01-10-12/ title=最近看片与阅读 class=md-nav__link> 最近看片与阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-02-06-january/ title=一月观影记录 class=md-nav__link> 一月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-08-February/ title=二月至今观影记录 class=md-nav__link> 二月至今观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-31-March/ title=三月观影记录 class=md-nav__link> 三月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-12-26-Smultronst%C3%A4llet/ title=野草莓 class=md-nav__link> 野草莓 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-10-10-October/ title=克服本能就是善良吗？（从十月新番胡扯……） class=md-nav__link> 克服本能就是善良吗？（从十月新番胡扯……） </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-04-bgm/ title=无人声环 class=md-nav__link> 无人声环 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-13-the-end-of-the-world/ title="The End of the Fucking World" class=md-nav__link> The End of the Fucking World </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Study </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Study </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> Draft </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-1> Draft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/draft/try-wiki/ title="一些 Wiki 工具的尝试" class=md-nav__link> 一些 Wiki 工具的尝试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Language </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-2> Language </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/language/%E6%97%A5%E8%AF%AD%E5%85%A5%E9%97%A8/ title=日语入门 class=md-nav__link> 日语入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Tech </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Tech </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-1 type=checkbox id=nav-8-1-1> <label class=md-nav__link for=nav-8-1-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ title=大表哥的电商网页实战体验 class=md-nav__link> 大表哥的电商网页实战体验 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-23-know-nothing/ title=知其然不知其所以然 class=md-nav__link> 知其然不知其所以然 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2018-06-08-responsive/ title=大表哥的响应式设计 class=md-nav__link> 大表哥的响应式设计 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/zh-javascript-info/ title="现代 JavaScript 教程摘录" class=md-nav__link> 现代 JavaScript 教程摘录 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-2 type=checkbox id=nav-8-1-2> <label class=md-nav__link for=nav-8-1-2> Go </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-2> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/go/01/ title=01 class=md-nav__link> 01 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-3 type=checkbox id=nav-8-1-3> <label class=md-nav__link for=nav-8-1-3> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-3> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/java/2017-12-30-Java%20Web/ title="从 url 访问服务器资源讨论 Java Web 中的 Servlet" class=md-nav__link> 从 url 访问服务器资源讨论 Java Web 中的 Servlet </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2018-11-23-ArrayList/ title=ArrayList class=md-nav__link> ArrayList </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-01-31-HashMap/ title=HashMap class=md-nav__link> HashMap </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-01-String/ title="String 分析(栈,堆,字符串常量池)" class=md-nav__link> String 分析(栈,堆,字符串常量池) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-03-String/ title=String、StringBuffer、StingBuilder class=md-nav__link> String、StringBuffer、StingBuilder </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-06-Hashtable/ title=Hashtable class=md-nav__link> Hashtable </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-22-string-pool/ title=字符串常量池到底保存的是字符串对象还是字符串对象的引用? class=md-nav__link> 字符串常量池到底保存的是字符串对象还是字符串对象的引用? </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-23-Java-Thread-pool/ title="Java 线程池" class=md-nav__link> Java 线程池 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-29-Java%20Web/ title="Java Web 启动流程" class=md-nav__link> Java Web 启动流程 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-04-05-AQS-lock/ title="AQS 与 Java 锁的具体实现" class=md-nav__link> AQS 与 Java 锁的具体实现 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-4 type=checkbox id=nav-8-1-4> <label class=md-nav__link for=nav-8-1-4> Projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-4> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/projects/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-5 type=checkbox id=nav-8-1-5> <label class=md-nav__link for=nav-8-1-5> Spring </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-5> Spring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2018-09-01-Spring%20Security/ title="Spring Boot 与 Spring Security" class=md-nav__link> Spring Boot 与 Spring Security </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-03-29-Spring-init/ title="Spring 启动流程与简单源码分析" class=md-nav__link> Spring 启动流程与简单源码分析 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-04-06-Spring-MVC/ title="Spring MVC 简单源码分析" class=md-nav__link> Spring MVC 简单源码分析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Config </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Config </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Git </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/git/2018-02-01-git/ title="Git 的简单使用" class=md-nav__link> Git 的简单使用 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/2019-08-10-git-merge/ title="Git 协作管理项目时不可避免的 merge 操作" class=md-nav__link> Git 协作管理项目时不可避免的 merge 操作 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/submodule/ title=submodule class=md-nav__link> submodule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-2> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2019-12-18-manjaro/ title="Manjaro 个人新装配置" class=md-nav__link> Manjaro 个人新装配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/fontconfig/ title="Arch Emoji fontconfig" class=md-nav__link> Arch Emoji fontconfig </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/softwares/ title=各种工具 class=md-nav__link> 各种工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-3> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/tools/cz-conventional-changelog/ title=cz-conventional-changelog class=md-nav__link> cz-conventional-changelog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-03-31-Generator-SpringBoot-Gradle/ title="MyBatis Generator + Spring Boot + Gradle 配置" class=md-nav__link> MyBatis Generator + Spring Boot + Gradle 配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-25-VS-Code-Python/ title="VS Code 写 Python" class=md-nav__link> VS Code 写 Python </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-26-linux-kawa/ title="在 Linux 上使用 kawa" class=md-nav__link> 在 Linux 上使用 kawa </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-11-25-mysql/ title="【转】在 CentOS 上部署 MySQL 解压版" class=md-nav__link> 【转】在 CentOS 上部署 MySQL 解压版 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-04-03-Redis-lock/ title="Redis 的分布式锁实现" class=md-nav__link> Redis 的分布式锁实现 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-07-28-picGo/ title="Github + picGo ——有图床了" class=md-nav__link> Github + picGo ——有图床了 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-11-18-linux-mount/ title="Linux 挂载分区/磁盘" class=md-nav__link> Linux 挂载分区/磁盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-03-terminal-wifi/ title=把显卡驱动删了后在终端连热点 class=md-nav__link> 把显卡驱动删了后在终端连热点 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-12-css/ title=一个引号引发的惨案 class=md-nav__link> 一个引号引发的惨案 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-electron-vue/ title="用 Vue 写 Electron 的一次问题解决" class=md-nav__link> 用 Vue 写 Electron 的一次问题解决 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-ttrss/ title="部署 TTRSS 遇到的一些有趣的东西" class=md-nav__link> 部署 TTRSS 遇到的一些有趣的东西 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-04-02-hexo-asset-image/ title="hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了" class=md-nav__link> hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Project </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/project/2017-12-21-xiao-zong-jie/ title=做个小小的总结 class=md-nav__link> 做个小小的总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-06-25-tencent-news-spider-py/ title=腾讯新闻爬虫 class=md-nav__link> 腾讯新闻爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-09-13-lite-terminal-home-page/ title=简单的仿终端主页 class=md-nav__link> 简单的仿终端主页 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-01-11-tank/ title=花里胡哨的坦克大战 class=md-nav__link> 花里胡哨的坦克大战 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-02-05-new-year/ title=大年初一（爬取豆瓣条目及吐槽） class=md-nav__link> 大年初一（爬取豆瓣条目及吐槽） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-04-03-blog-project/ title=写博客 class=md-nav__link> 写博客 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-06-17-nodejs/ title="MarkAll 导入豆瓣数据 —— NodeJS 写爬虫" class=md-nav__link> MarkAll 导入豆瓣数据 —— NodeJS 写爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-Autumn-Json/ title="Autumn-From-Spring 自定义 BeanDefinitionReader" class=md-nav__link> Autumn-From-Spring 自定义 BeanDefinitionReader </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-bookmarkdown/ title="Chrome 插件——书签转 MarkDown" class=md-nav__link> Chrome 插件——书签转 MarkDown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-10-then-start/ title=那就开始吧 class=md-nav__link> 那就开始吧 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-16-Writing-is%20the-reward-of-writing-itself/ title=写就是写本身的报酬 class=md-nav__link> 写就是写本身的报酬 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-11-19-change-my-blog/ title=【过时内容】嘿，我转移博客啦！ class=md-nav__link> 【过时内容】嘿，我转移博客啦！ </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-12-08-yao-guai-ji-yu-you-ren-bo/ title=妖怪唧唧与友人波波 class=md-nav__link> 妖怪唧唧与友人波波 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-01-01-ubuntu/ title="折腾 ubuntu 与 win10 共存" class=md-nav__link> 折腾 ubuntu 与 win10 共存 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-02-09-pc-system/ title="黑苹果与 Ubuntu 及 PC 折腾系统" class=md-nav__link> 黑苹果与 Ubuntu 及 PC 折腾系统 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-12-install-Vmware-on-linux/ title="deepin 安装 VMware" class=md-nav__link> deepin 安装 VMware </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-31-SQL/ title="Spring Boot 开发遇到一些 SQL 问题" class=md-nav__link> Spring Boot 开发遇到一些 SQL 问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-jquery-confrim/ title="JQuery-Confrim 的一点问题" class=md-nav__link> JQuery-Confrim 的一点问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-some-plugins/ title="ECharts + PageHelper + Bootstrap Table" class=md-nav__link> ECharts + PageHelper + Bootstrap Table </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-js-in-thymeleaf/ title="Thymeleaf 里使用 JavaScript 时的注意事项" class=md-nav__link> Thymeleaf 里使用 JavaScript 时的注意事项 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-spring-boot-gradle-yml-log4j2/ title="Spring Boot + Gradle + yml 配置 log4j2" class=md-nav__link> Spring Boot + Gradle + yml 配置 log4j2 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-09-softwares/ title="Linux 常用软件" class=md-nav__link> Linux 常用软件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-hexo-image/ title="【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径）" class=md-nav__link> 【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-show/ title=如果给文章提供多种渲染方式 class=md-nav__link> 如果给文章提供多种渲染方式 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-08-30-vue-music/ title="简单的单页应用(Vue CLI2 的简单使用)" class=md-nav__link> 简单的单页应用(Vue CLI2 的简单使用) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-09-23-word-count/ title="WordCount 项目总结" class=md-nav__link> WordCount 项目总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-06-markall-douban-backup/ title=豆瓣标记数据备份插件 class=md-nav__link> 豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-07-markall-douban-backup-yes/ title=【过时】又一个——豆瓣标记数据备份插件 class=md-nav__link> 【过时】又一个——豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-13-blog/ title=从分析本网站的网络请求谈起 class=md-nav__link> 从分析本网站的网络请求谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/draft/ title=Draft class=md-nav__link> Draft </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#equals class=md-nav__link> equals规范 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 不同子类的相等性 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 哈希和哈希码 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#hashcode class=md-nav__link> 理解 hashCode </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 为了速度而散列 </a> </li> <li class=md-nav__item> <a href=#hashcode_1 class=md-nav__link> 重写 hashCode() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#hashmap class=md-nav__link> 调优 HashMap </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hqweay/my-mkdocs/edit/master/docs/book/OnJava8/docs/book/Appendix-Understanding-equals-and-hashCode.md title=编辑此页 class="md-icon md-content__icon">&#xE3C9;</a> <div class=toc> <ul> <li><a href=#equalshashcode>附录:理解equals和hashCode方法</a><ul> <li><a href=#equals>equals规范</a><ul> <li><a href=#_1>不同子类的相等性</a></li> </ul> </li> <li><a href=#_2>哈希和哈希码</a><ul> <li><a href=#hashcode>理解 hashCode</a></li> <li><a href=#_3>为了速度而散列</a></li> <li><a href=#hashcode_1>重写 hashCode()</a></li> </ul> </li> <li><a href=#hashmap>调优 HashMap</a></li> </ul> </li> </ul> </div> <!-- Appendix: Understanding equals() and hashCode() --> <h1 id=equalshashcode>附录:理解equals和hashCode方法<a class=headerlink href=#equalshashcode title="Permanent link">#</a></h1> <p>假设有一个容器使用hash函数，当你创建一个放到这个容器时，你必须定义 <strong>hashCode()</strong> 函数和 <strong>equals()</strong> 函数。这两个函数一起被用于hash容器中的查询操作。</p> <!-- A Canonical equals() --> <h2 id=equals>equals规范<a class=headerlink href=#equals title="Permanent link">#</a></h2> <p>当你创建一个类的时候，它自动继承自 <strong>Objcet</strong> 类。如果你不覆写 <strong>equals()</strong> ，你将会获得 <strong>Objcet</strong> 对象的 <strong>equals()</strong> 函数。默认情况下，这个函数会比较对象的地址。所以只有你在比较同一个对象的时候，你才会获得<strong>true</strong>。默认的情况是"区分度最高的"。</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/DefaultComparison.java</span>
<span class=kd>class</span> <span class=nc>DefaultComparison</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>j</span><span class=p>,</span> <span class=n>k</span><span class=p>;</span>
    <span class=n>DefaultComparison</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>int</span> <span class=n>j</span><span class=p>,</span> <span class=kt>int</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>j</span> <span class=o>=</span> <span class=n>j</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>k</span> <span class=o>=</span> <span class=n>k</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>DefaultComparison</span> 
        <span class=n>a</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultComparison</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>),</span>
        <span class=n>b</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultComparison</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>a</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>a</span> <span class=o>==</span> <span class=n>b</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span> 
<span class=cm>/*</span>
<span class=cm>Output:</span>
<span class=cm>true</span>
<span class=cm>false</span>
<span class=cm>*/</span>
</code></pre></div> 通常你会希望放宽这个限制。一般来说如果两个对象有相同的类型和相同的字段，你会认为这两个对象相等，但也会有一些你不想加入 <strong>equals()</strong> 函数中来比较的字段。这是类型设计的一部分。</p> <p>一个合适的 <strong>equals()</strong>函数必须满足以下五点条件： 1. 反身性：对于任何 <strong>x</strong>， <strong>x.equals(x)</strong> 应该返回 <strong>true</strong>。 2. 对称性：对于任何 <strong>x</strong> 和 <strong>y</strong>， <strong>x.equals(y)</strong> 应该返回 <strong>true</strong>当且仅当 <strong>y.equals(x)</strong> 返回 <strong>true</strong> 。 3. 传递性：对于任何<strong>x</strong>,<strong>y</strong>,还有<strong>z</strong>，如果 <strong>x.equals(y)</strong> 返回 <strong>true</strong> 并且 <strong>y.equals(z)</strong> 返回 <strong>true</strong>，那么 <strong>x.equals(z)</strong> 应该返回 <strong>true</strong>。 4. 一致性：对于任何 <strong>x</strong>和<strong>y</strong>，在对象没有被改变的情况下，多次调用 <strong>x.equals(y)</strong> 应该总是返回 <strong>true</strong> 或者<strong>false</strong>。 5. 对于任何非<strong>null</strong>的<strong>x</strong>，<strong>x.equals(null)</strong>应该返回<strong>false</strong>。</p> <p>下面是满足这些条件的测试，并且判断对象是否和自己相等（我们这里称呼其为<strong>右值</strong>）： 1. 如果<strong>右值</strong>是<strong>null</strong>，那么不相等。 2. 如果<strong>右值</strong>是<strong>this</strong>，那么两个对象相等。 3. 如果<strong>右值</strong>不是同一个类型或者子类，那么两个对象不相等。 4. 如果所有上面的检查通过了，那么你必须决定 <strong>右值</strong> 中的哪些字段是重要的，然后比较这些字段。 Java 7 引入了 <strong>Objects</strong> 类型来帮助这个流程，这样我们能够写出更好的 <strong>equals()</strong> 函数。</p> <p>下面的例子比较了不同类型的 <strong>Equality</strong>类。为了避免重复的代码，我们使用<em>工厂函数设计模</em>式来实现样例。 <strong>EqualityFactory</strong>接口提供<strong>make()</strong>函数来生成一个<strong>Equaity</strong>对象，这样不同的<strong>EqualityFactory</strong>能够生成<strong>Equality</strong>不同的子类。</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/EqualityFactory.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>interface</span> <span class=nc>EqualityFactory</span> <span class=p>{</span>
    <span class=n>Equality</span> <span class=nf>make</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>String</span> <span class=n>s</span><span class=p>,</span> <span class=kt>double</span> <span class=n>d</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> 现在我们来定义 <strong>Equality</strong>，它包含三个字段（所有的字段我们认为在比较中都很重要）和一个 <strong>equals()</strong> 函数用来满足上述的四种检查。构造函数展示了它的类名来保证我们在执行我们想要的测试：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/Equality.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Equality</span> <span class=p>{</span>
    <span class=kd>protected</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
    <span class=kd>protected</span> <span class=n>String</span> <span class=n>s</span><span class=p>;</span>
    <span class=kd>protected</span> <span class=kt>double</span> <span class=n>d</span><span class=p>;</span><span class=kd>public</span> <span class=nf>Equality</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>String</span> <span class=n>s</span><span class=p>,</span> <span class=kt>double</span> <span class=n>d</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>s</span> <span class=o>=</span> <span class=n>s</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>d</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;made &#39;Equality&#39;&quot;</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>rval</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>rval</span> <span class=o>==</span> <span class=k>this</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Equality</span><span class=p>))</span>
            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
        <span class=n>Equality</span> <span class=n>other</span> <span class=o>=</span> <span class=p>(</span><span class=n>Equality</span><span class=p>)</span><span class=n>rval</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>other</span><span class=p>.</span><span class=na>i</span><span class=p>))</span>
            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>other</span><span class=p>.</span><span class=na>s</span><span class=p>))</span>
            <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=n>other</span><span class=p>.</span><span class=na>d</span><span class=p>))</span><span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
            <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
    <span class=p>}</span> 

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>descr</span><span class=p>,</span> <span class=n>String</span> <span class=n>expected</span><span class=p>,</span> <span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;-- Testing %s --%n&quot;</span> <span class=o>+</span> <span class=s>&quot;%s instanceof Equality: %s%n&quot;</span> <span class=o>+</span>
        <span class=s>&quot;Expected %s, got %s%n&quot;</span><span class=p>,</span>
        <span class=n>descr</span><span class=p>,</span> <span class=n>descr</span><span class=p>,</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Equality</span><span class=p>,</span>
        <span class=n>expected</span><span class=p>,</span> <span class=n>equals</span><span class=p>(</span><span class=n>rval</span><span class=p>));</span>
    <span class=p>}</span> 

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>testAll</span><span class=p>(</span><span class=n>EqualityFactory</span> <span class=n>eqf</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Equality</span>
        <span class=n>e</span> <span class=o>=</span> <span class=n>eqf</span><span class=p>.</span><span class=na>make</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&quot;Monty&quot;</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>),</span>
        <span class=n>eq</span> <span class=o>=</span> <span class=n>eqf</span><span class=p>.</span><span class=na>make</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=s>&quot;Monty&quot;</span><span class=p>,</span> <span class=mf>3.14</span><span class=p>),</span>
        <span class=n>neq</span> <span class=o>=</span> <span class=n>eqf</span><span class=p>.</span><span class=na>make</span><span class=p>(</span><span class=mi>99</span><span class=p>,</span> <span class=s>&quot;Bob&quot;</span><span class=p>,</span> <span class=mf>1.618</span><span class=p>);</span>
        <span class=n>e</span><span class=p>.</span><span class=na>test</span><span class=p>(</span><span class=s>&quot;null&quot;</span><span class=p>,</span> <span class=s>&quot;false&quot;</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
        <span class=n>e</span><span class=p>.</span><span class=na>test</span><span class=p>(</span><span class=s>&quot;same object&quot;</span><span class=p>,</span> <span class=s>&quot;true&quot;</span><span class=p>,</span> <span class=n>e</span><span class=p>);</span>
        <span class=n>e</span><span class=p>.</span><span class=na>test</span><span class=p>(</span><span class=s>&quot;different type&quot;</span><span class=p>,</span>
        <span class=s>&quot;false&quot;</span><span class=p>,</span> <span class=n>Integer</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=mi>99</span><span class=p>));</span><span class=n>e</span><span class=p>.</span><span class=na>test</span><span class=p>(</span><span class=s>&quot;same values&quot;</span><span class=p>,</span> <span class=s>&quot;true&quot;</span><span class=p>,</span> <span class=n>eq</span><span class=p>);</span>
        <span class=n>e</span><span class=p>.</span><span class=na>test</span><span class=p>(</span><span class=s>&quot;different values&quot;</span><span class=p>,</span> <span class=s>&quot;false&quot;</span><span class=p>,</span> <span class=n>neq</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>testAll</span><span class=p>(</span> <span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Equality</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>));</span>
    <span class=p>}</span> 

<span class=p>}</span> 
<span class=cm>/*</span>
<span class=cm>Output:</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>-- Testing null --</span>
<span class=cm>null instanceof Equality: false</span>
<span class=cm>Expected false, got false</span>
<span class=cm>-- Testing same object --</span>
<span class=cm>same object instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different type --</span>
<span class=cm>different type instanceof Equality: false</span>
<span class=cm>Expected false, got false-- Testing same values --</span>
<span class=cm>same values instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different values --</span>
<span class=cm>different values instanceof Equality: true</span>
<span class=cm>Expected false, got false</span>
<span class=cm>*/</span>
</code></pre></div> <p><strong>testAll()</strong> 执行了我们期望的所有不同类型对象的比较。它使用工厂创建了<strong>Equality</strong>对象。</p> <p>在 <strong>main()</strong> 里，请注意对 <strong>testAll()</strong> 的调用很简单。因为<strong>EqualityFactory</strong>有着单一的函数，它能够和lambda表达式一起使用来表示<strong>make()</strong>函数。</p> <p>上述的 <strong>equals()</strong> 函数非常繁琐，并且我们能够将其简化成规范的形式，请注意： 1. <strong>instanceof</strong>检查减少了<strong>null</strong>检查的需要。 2. 和<strong>this</strong>的比较是多余的。一个正确书写的 <strong>equals()</strong> 函数能正确地和自己比较。</p> <p>因为 <strong>&amp;&amp;</strong> 是一个短路比较，它会在第一次遇到失败的时候退出并返回<strong>false</strong>。所以，通过使用 <strong>&amp;&amp;</strong> 将检查链接起来，我们可以写出更精简的 <strong>equals()</strong> 函数：</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SuccinctEquality.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SuccinctEquality</span> <span class=kd>extends</span> <span class=n>Equality</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>SuccinctEquality</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>String</span> <span class=n>s</span><span class=p>,</span> <span class=kt>double</span> <span class=n>d</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;made &#39;SuccinctEquality&#39;&quot;</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>SuccinctEquality</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=p>((</span><span class=n>SuccinctEquality</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>i</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=p>((</span><span class=n>SuccinctEquality</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>s</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>d</span><span class=p>,</span> <span class=p>((</span><span class=n>SuccinctEquality</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>d</span><span class=p>);</span>
    <span class=p>}</span> 
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Equality</span><span class=p>.</span><span class=na>testAll</span><span class=p>(</span> <span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=o>-&gt;</span>
        <span class=k>new</span> <span class=n>SuccinctEquality</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>));</span>
    <span class=p>}</span> 

<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>-- Testing null --</span>
<span class=cm>null instanceof Equality: false</span>
<span class=cm>Expected false, got false</span>
<span class=cm>-- Testing same object --</span>
<span class=cm>same object instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different type --</span>
<span class=cm>different type instanceof Equality: false</span>
<span class=cm>Expected false, got false</span>
<span class=cm>-- Testing same values --</span>
<span class=cm>same values instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different values --different values instanceof Equality: true</span>
<span class=cm>Expected false, got false</span>
<span class=cm>*/</span>
</code></pre></div> 对于每个 <strong>SuccinctEquality</strong>，基类构造函数在派生类构造函数前被调用，输出显示我们依然获得了正确的结果，你可以发现短路返回已经发生了，不然的话，<strong>null</strong>测试和“不同类型”的测试会在 <strong>equals()</strong> 函数下面的比较中强制转化的时候抛出异常。 <strong>Objects.equals()</strong> 会在你组合其他类型的时候发挥很大的作用。</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/ComposedEquality.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Part</span> <span class=p>{</span>
    <span class=n>String</span> <span class=n>ss</span><span class=p>;</span>
    <span class=kt>double</span> <span class=n>dd</span><span class=p>;</span>

    <span class=n>Part</span><span class=p>(</span><span class=n>String</span> <span class=n>ss</span><span class=p>,</span> <span class=kt>double</span> <span class=n>dd</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>ss</span> <span class=o>=</span> <span class=n>ss</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>dd</span> <span class=o>=</span> <span class=n>dd</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Part</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>ss</span><span class=p>,</span> <span class=p>((</span><span class=n>Part</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>ss</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>dd</span><span class=p>,</span> <span class=p>((</span><span class=n>Part</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>dd</span><span class=p>);</span>
    <span class=p>}</span> 

<span class=p>}</span> 

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ComposedEquality</span> <span class=kd>extends</span> <span class=n>SuccinctEquality</span> <span class=p>{</span>
    <span class=n>Part</span> <span class=n>part</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>ComposedEquality</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=n>String</span> <span class=n>s</span><span class=p>,</span> <span class=kt>double</span> <span class=n>d</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>
        <span class=n>part</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Part</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;made &#39;ComposedEquality&#39;&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>ComposedEquality</span> <span class=o>&amp;&amp;</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>rval</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>part</span><span class=p>,</span>
        <span class=p>((</span><span class=n>ComposedEquality</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>part</span><span class=p>);</span>

    <span class=p>}</span> 

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Equality</span><span class=p>.</span><span class=na>testAll</span><span class=p>(</span> <span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>)</span> <span class=o>-&gt;</span>
        <span class=k>new</span> <span class=n>ComposedEquality</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>d</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/*</span>
<span class=cm>Output:</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>made &#39;ComposedEquality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>made &#39;ComposedEquality&#39;</span>
<span class=cm>made &#39;Equality&#39;</span>
<span class=cm>made &#39;SuccinctEquality&#39;</span>
<span class=cm>made &#39;ComposedEquality&#39;</span>
<span class=cm>-- Testing null --null instanceof Equality: false</span>
<span class=cm>Expected false, got false</span>
<span class=cm>-- Testing same object --</span>
<span class=cm>same object instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different type --</span>
<span class=cm>different type instanceof Equality: false</span>
<span class=cm>Expected false, got false</span>
<span class=cm>-- Testing same values --</span>
<span class=cm>same values instanceof Equality: true</span>
<span class=cm>Expected true, got true</span>
<span class=cm>-- Testing different values --</span>
<span class=cm>different values instanceof Equality: true</span>
<span class=cm>Expected false, got false</span>
<span class=cm>*/</span>
</code></pre></div> 注意super.equals()这个调用，没有必要重新发明它（因为你不总是有权限访问基类所有的必要字段）</p> <!--Equality Across Subtypes --> <h3 id=_1>不同子类的相等性<a class=headerlink href=#_1 title="Permanent link">#</a></h3> <p>继承意味着两个不同子类的对象当其向上转型的时候可以是相等的。假设你有一个Animal对象的集合。这个集合天然接受<strong>Animal</strong>的子类。在这个例子中是<strong>Dog</strong>和<strong>Pig</strong>。每个<strong>Animal</strong>有一个<strong>name</strong>和<strong>size</strong>，还有唯一的内部<strong>id</strong>数字。</p> <p>我们通过<strong>Objects</strong>类，以规范的形式定义 <strong>equals()</strong>函数和<strong>hashCode()</strong>。但是我们只能在基类<strong>Animal</strong>中定义他们。并且我们在这两个函数中没有包含<strong>id</strong>字段。从<strong>equals()</strong>函数的角度看待，这意味着我们只关心它是否是<strong>Animal</strong>，而不关心是否是<strong>Animal</strong>的某个子类。</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SubtypeEquality.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>Size</span> <span class=p>{</span> <span class=n>SMALL</span><span class=p>,</span> <span class=n>MEDIUM</span><span class=p>,</span> <span class=n>LARGE</span> <span class=p>}</span>
<span class=kd>class</span> <span class=nc>Animal</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>Size</span> <span class=n>size</span><span class=p>;</span>
    <span class=n>Animal</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>Size</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>size</span> <span class=o>=</span> <span class=n>size</span><span class=p>;</span>
    <span class=p>}</span> 
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Animal</span> <span class=o>&amp;&amp;</span>
        <span class=c1>// Objects.equals(id, ((Animal)rval).id) &amp;&amp; // [1]</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=p>((</span><span class=n>Animal</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>name</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
        <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=p>((</span><span class=n>Animal</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>size</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Objects</span><span class=p>.</span><span class=na>hash</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
        <span class=c1>// return Objects.hash(name, size, id); // [2]</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%s[%d]: %s %s %x&quot;</span><span class=p>,</span>
        <span class=n>getClass</span><span class=p>().</span><span class=na>getSimpleName</span><span class=p>(),</span> <span class=n>id</span><span class=p>,</span>
        <span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>,</span> <span class=n>hashCode</span><span class=p>());</span>
    <span class=p>}</span> 
<span class=p>}</span> 

<span class=kd>class</span> <span class=nc>Dog</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=p>{</span>
    <span class=n>Dog</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>Size</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span> 

<span class=kd>class</span> <span class=nc>Pig</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=p>{</span>
    <span class=n>Pig</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>Size</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span> 

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SubtypeEquality</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>Dog</span><span class=p>(</span><span class=s>&quot;Ralph&quot;</span><span class=p>,</span> <span class=n>Size</span><span class=p>.</span><span class=na>MEDIUM</span><span class=p>));</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>Pig</span><span class=p>(</span><span class=s>&quot;Ralph&quot;</span><span class=p>,</span> <span class=n>Size</span><span class=p>.</span><span class=na>MEDIUM</span><span class=p>));</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span> 
<span class=cm>/*</span>
<span class=cm>Output:</span>
<span class=cm>Dog[0]: Ralph MEDIUM a752aeee</span>
<span class=cm>*/</span>
</code></pre></div> 如果我们只考虑类型的话，某些情况下它的确说得通——只从基类的角度看待问题，这是李氏替换原则的基石。这个代码完美符合替换理论因为派生类没有添加任何额外不再基类中的额外函数。派生类只是在表现上不同，而不是在接口上。（当然这不是常态）</p> <p>但是当我们提供了两个有着相同数据的不同的对象类型，然后将他们放置在 <strong>HashSet<animal></strong> 中。只有他们中的一个能存活。这强调了 <strong>equals()</strong> 不是完美的数学理论，而只是机械般的理论。 <strong>hashCode()</strong> 和 <strong>equals()</strong> 必须能够允许类型在hash数据结构中正常工作。例子中 <strong>Dog</strong> 和 <strong>Pig</strong> 会被映射到同 <strong>HashSet</strong> 的同一个桶中。这个时候，<strong>HashSet</strong> 回退到 <strong>equals()</strong> 来区分对象，但是 <strong>equals()</strong> 也认为两个对象是相同的。<strong>HashSet</strong>因为已经有一个相同的对象了，所以没有添加 <strong>Pig</strong>。 我们依然能够通过使得其他字段对象不同来让例子能够正常工作。在这里每个 <strong>Animal</strong> 已经有了一个独一无二的 <strong>id</strong> ，所以你能够取消 <strong>equals()</strong> 函数中的 <strong>[1]</strong> 行注释，或者取消 <strong>hashCode()</strong> 函数中的 <strong>[2]</strong> 行注释。按照规范，你应该同时完成这两个操作，如此能够将所有“不变的”字段包含在两个操作中（“不变”所以 <strong>equals()</strong> 和 <strong>hashCode()</strong> 在哈希数据结构中的排序和取值时，不会生成不同的值。我将“不变的”放在引号中因为你必须计算出是否已经发生变化）。</p> <blockquote> <p><strong>旁注</strong>： 在<strong>hashCode()</strong>中，如果你只能够使用一个字段，使用<strong>Objcets.hashCode()</strong>。如果你使用多个字段，那么使用 <strong>Objects.hash()</strong>。</p> </blockquote> <p>我们也可以通过标准方式，将 <strong>equals()</strong> 定义在子类中（不包含 <strong>id</strong> ）解决这个问题：</p> <p><div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SubtypeEquality2.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Dog2</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=p>{</span>
    <span class=n>Dog2</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>Size</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>super</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Dog2</span> <span class=o>&amp;&amp;</span><span class=kd>super</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>rval</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span> 

<span class=kd>class</span> <span class=nc>Pig2</span> <span class=kd>extends</span> <span class=n>Animal</span> <span class=p>{</span>
    <span class=n>Pig2</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>,</span> <span class=n>Size</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>super</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>size</span><span class=p>);</span>
    <span class=p>}</span> 

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>Pig2</span> <span class=o>&amp;&amp;</span>
        <span class=kd>super</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>rval</span><span class=p>);</span>
    <span class=p>}</span> 
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SubtypeEquality2</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Animal</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>Dog2</span><span class=p>(</span><span class=s>&quot;Ralph&quot;</span><span class=p>,</span> <span class=n>Size</span><span class=p>.</span><span class=na>MEDIUM</span><span class=p>));</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>Pig2</span><span class=p>(</span><span class=s>&quot;Ralph&quot;</span><span class=p>,</span> <span class=n>Size</span><span class=p>.</span><span class=na>MEDIUM</span><span class=p>));</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span> 
<span class=cm>/*</span>
<span class=cm>Output:</span>
<span class=cm>Dog2[0]: Ralph MEDIUM a752aeee</span>
<span class=cm>Pig2[1]: Ralph MEDIUM a752aeee</span>
<span class=cm>*/</span>
</code></pre></div> 注意 <strong>hashCode()</strong> 是独一无二的，但是因为对象不再 <strong>equals()</strong> ，所以两个函数都出现在<strong>HashSet</strong>中。另外，<strong>super.equals()</strong> 意味着我们不需要访问基类的<strong>private</strong>字段。</p> <p>一种说法是Java从<strong>equals()</strong> 和<strong>hashCode()</strong> 的定义中分离了可替代性。我们仍然能够将<strong>Dog</strong>和<strong>Pig</strong>放置在 <strong>Set\&lt;Animal></strong> 中，无论 <strong>equals()</strong> 和 <strong>hashCode()</strong> 是如何定义的，但是对象不会在哈希数据结构中正常工作，除非这些函数能够被合理定义。不幸的是，<strong>equals()</strong> 不总是和 <strong>hashCode()</strong> 一起使用，这在你尝试为了某个特殊类型避免定义它的时候会让问题复杂化。并且这也是为什么遵循规范是有价值的。然而这会变得更加复杂，因为你不总是需要定义其中一个函数。</p> <!-- Hashing and Hash Codes --> <h2 id=_2>哈希和哈希码<a class=headerlink href=#_2 title="Permanent link">#</a></h2> <p>在 <a href>集合</a> 章节中，我们使用预先定义的类作为 HashMap 的键。这些示例之所以有用，是因为预定义的类具有所有必需的连线，以使它们正确地充当键。</p> <p>当创建自己的类作为HashMap的键时，会发生一个常见的陷阱，从而忘记进行必要的接线。例如，考虑一个将Earthhog 对象与 Prediction 对象匹配的天气预报系统。这似乎很简单：使用Groundhog作为键，使用Prediction作为值：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/Groundhog.java</span>
<span class=c1>// Looks plausible, but doesn&#39;t work as a HashMap key</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Groundhog</span> <span class=p>{</span>
    <span class=kd>protected</span> <span class=kt>int</span> <span class=n>number</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>Groundhog</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span> <span class=n>number</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Groundhog #&quot;</span> <span class=o>+</span> <span class=n>number</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/Prediction.java</span>
<span class=c1>// Predicting the weather</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Prediction</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rand</span><span class=p>.</span><span class=na>nextBoolean</span><span class=p>()</span> <span class=o>?</span>
                <span class=s>&quot;Six more weeks of Winter!&quot;</span> <span class=p>:</span> <span class=s>&quot;Early Spring!&quot;</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SpringDetector.java</span>
<span class=c1>// What will the weather be?</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpringDetector</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Groundhog</span><span class=o>&gt;</span>
    <span class=kt>void</span> <span class=nf>detectSpring</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>type</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>Constructor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>ghog</span> <span class=o>=</span>
                    <span class=n>type</span><span class=p>.</span><span class=na>getConstructor</span><span class=p>(</span><span class=kt>int</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
            <span class=n>Map</span><span class=o>&lt;</span><span class=n>Groundhog</span><span class=p>,</span> <span class=n>Prediction</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span>
                    <span class=n>IntStream</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>mapToObj</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=p>{</span>
                                <span class=k>try</span> <span class=p>{</span>
                                    <span class=k>return</span> <span class=n>ghog</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
                                <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                                    <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
                                <span class=p>}</span>
                            <span class=p>})</span>
                            <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toMap</span><span class=p>(</span>
                                    <span class=n>Function</span><span class=p>.</span><span class=na>identity</span><span class=p>(),</span>
                                    <span class=n>gh</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Prediction</span><span class=p>()));</span>
            <span class=n>map</span><span class=p>.</span><span class=na>forEach</span><span class=p>((</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span> <span class=o>-&gt;</span>
                    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>v</span><span class=p>));</span>
            <span class=n>Groundhog</span> <span class=n>gh</span> <span class=o>=</span> <span class=n>ghog</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=s>&quot;Looking up prediction for &quot;</span> <span class=o>+</span> <span class=n>gh</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>map</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>gh</span><span class=p>))</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>map</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>gh</span><span class=p>));</span>
            <span class=k>else</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Key not found: &quot;</span> <span class=o>+</span> <span class=n>gh</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>NoSuchMethodException</span> <span class=o>|</span>
                <span class=n>IllegalAccessException</span> <span class=o>|</span>
                <span class=n>InvocationTargetException</span> <span class=o>|</span>
                <span class=n>InstantiationException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>detectSpring</span><span class=p>(</span><span class=n>Groundhog</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>Groundhog #3: Six more weeks of Winter!</span>
<span class=cm>Groundhog #0: Early Spring!</span>
<span class=cm>Groundhog #8: Six more weeks of Winter!</span>
<span class=cm>Groundhog #6: Early Spring!</span>
<span class=cm>Groundhog #4: Early Spring!</span>
<span class=cm>Groundhog #2: Six more weeks of Winter!</span>
<span class=cm>Groundhog #1: Early Spring!</span>
<span class=cm>Groundhog #9: Early Spring!</span>
<span class=cm>Groundhog #5: Six more weeks of Winter!</span>
<span class=cm>Groundhog #7: Six more weeks of Winter!</span>
<span class=cm>Looking up prediction for Groundhog #3</span>
<span class=cm>Key not found: Groundhog #3</span>
<span class=cm>*/</span>
</code></pre></div> <p>每个 Groundhog 都被赋予了一个常数，因此你可以通过如下的方式在 HashMap 中寻找对应的 Prediction。“给我一个和 Groundhog#3 相关联的 Prediction”。而 Prediction 通过一个随机生成的 boolean 来选择天气。<code>detectSpring()</code> 方法通过反射来实例化 Groundhog 类，或者它的子类。稍后，当我们继承一种新型的“Groundhog ”以解决此处演示的问题时，这将派上用场。</p> <p>这里的 HashMap 被 Groundhog 和其相关联的 Prediction 充满。并且上面展示了 HashMap 里面填充的内容。接下来我们使用填充了常数 3 的 Groundhog 作为 key 用于寻找对应的 Prediction 。（这个键值对肯定在 Map 中）。</p> <p>这看起来十分简单，但是这样做并没有奏效 —— 它无法找到数字3这个键。问题出在Groundhog自动地继承自基类Object，所以这里使用Object的hashCode0方法生成散列码，而它默认是使用对象的地址计算散列码。因此，由Groundhog(3)生成的第一个实例的散列码与由Groundhog(3)生成的第二个实例的散列码是不同的，而我们正是使用后者进行查找的。</p> <p>我们需要恰当的重写hashCode()方法。但是它仍然无法正常运行，除非你同时重写 equals()方法，它也是Object的一部分。HashMap使用equals()判断当前的键是否与表中存在的键相同。</p> <p>这是因为默认的Object.equals()只是比较对象的地址，所以一个Groundhog(3)并不等于另一个Groundhog(3)，因此，如果要使用自己的类作为HashMap的键，必须同时重载hashCode()和equals()，如下所示：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/Groundhog2.java</span>
<span class=c1>// A class that&#39;s used as a key in a HashMap</span>
<span class=c1>// must override hashCode() and equals()</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Groundhog2</span> <span class=kd>extends</span> <span class=n>Groundhog</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=nf>Groundhog2</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span> <span class=kd>super</span><span class=p>(</span><span class=n>n</span><span class=p>);</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>number</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>o</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>Groundhog2</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span>
                        <span class=n>number</span><span class=p>,</span> <span class=p>((</span><span class=n>Groundhog2</span><span class=p>)</span><span class=n>o</span><span class=p>).</span><span class=na>number</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SpringDetector2.java</span>
<span class=c1>// A working key</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpringDetector2</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>SpringDetector</span><span class=p>.</span><span class=na>detectSpring</span><span class=p>(</span><span class=n>Groundhog2</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>Groundhog #0: Six more weeks of Winter!</span>
<span class=cm>Groundhog #1: Early Spring!</span>
<span class=cm>Groundhog #2: Six more weeks of Winter!</span>
<span class=cm>Groundhog #3: Early Spring!</span>
<span class=cm>Groundhog #4: Early Spring!</span>
<span class=cm>Groundhog #5: Six more weeks of Winter!</span>
<span class=cm>Groundhog #6: Early Spring!</span>
<span class=cm>Groundhog #7: Early Spring!</span>
<span class=cm>Groundhog #8: Six more weeks of Winter!</span>
<span class=cm>Groundhog #9: Six more weeks of Winter!</span>
<span class=cm>Looking up prediction for Groundhog #3</span>
<span class=cm>Early Spring!</span>
<span class=cm>*/</span>
</code></pre></div> <p>Groundhog2.hashCode0返回Groundhog的标识数字（编号）作为散列码。在此例中，程序员负责确保不同的Groundhog具有不同的编号。hashCode()并不需要总是能够返回唯一的标识码（稍后你会理解其原因），但是equals() 方法必须严格地判断两个对象是否相同。此处的equals()是判断Groundhog的号码，所以作为HashMap中的键，如果两个Groundhog2对象具有相同的Groundhog编号，程序就出错了。</p> <p>如何定义 equals() 方法在上一节 <a href>equals 规范</a>中提到了。输出表明我们现在的输出是正确的。</p> <h3 id=hashcode>理解 hashCode<a class=headerlink href=#hashcode title="Permanent link">#</a></h3> <p>前面的例子只是正确解决问题的第一步。它只说明，如果不为你的键覆盖hashCode() 和equals() ，那么使用散列的数据结构（HashSet，HashMap，LinkedHashst或LinkedHashMap）就无法正确处理你的键。然而，要很好地解决此问题，你必须了解这些数据结构的内部构造。</p> <p>首先，使用散列的目的在于：想要使用一个对象来查找另一个对象。不过使用TreeMap或者你自己实现的Map也可以达到此目的。与散列实现相反，下面的示例用一对ArrayLists实现了一个Map，与AssociativeArray.java不同，这其中包含了Map接口的完整实现，因此提供了entrySet()方法：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SlowMap.java</span>
<span class=c1>// A Map implemented with ArrayLists</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SlowMap</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>AbstractMap</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>keys</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=kd>private</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>values</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=p>(</span><span class=n>K</span> <span class=n>key</span><span class=p>,</span> <span class=n>V</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span> <span class=c1>// The old value or null</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>keys</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>keys</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
            <span class=n>values</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span>
            <span class=n>values</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>keys</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=n>key</span><span class=p>),</span> <span class=n>value</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>oldValue</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=p>(</span><span class=n>Object</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// key: type Object, not K</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>keys</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>values</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>keys</span><span class=p>.</span><span class=na>indexOf</span><span class=p>(</span><span class=n>key</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=nf>entrySet</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>set</span><span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>K</span><span class=o>&gt;</span> <span class=n>ki</span> <span class=o>=</span> <span class=n>keys</span><span class=p>.</span><span class=na>iterator</span><span class=p>();</span>
        <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>V</span><span class=o>&gt;</span> <span class=n>vi</span> <span class=o>=</span> <span class=n>values</span><span class=p>.</span><span class=na>iterator</span><span class=p>();</span>
        <span class=k>while</span><span class=p>(</span><span class=n>ki</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span>
            <span class=n>set</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=k>new</span> <span class=n>MapEntry</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>ki</span><span class=p>.</span><span class=na>next</span><span class=p>(),</span> <span class=n>vi</span><span class=p>.</span><span class=na>next</span><span class=p>()));</span>
        <span class=k>return</span> <span class=n>set</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>SlowMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>m</span><span class=o>=</span> <span class=k>new</span> <span class=n>SlowMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>m</span><span class=p>.</span><span class=na>putAll</span><span class=p>(</span><span class=n>Countries</span><span class=p>.</span><span class=na>capitals</span><span class=p>(</span><span class=mi>8</span><span class=p>));</span>
        <span class=n>m</span><span class=p>.</span><span class=na>forEach</span><span class=p>((</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span> <span class=o>-&gt;</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&quot;=&quot;</span> <span class=o>+</span> <span class=n>v</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;BENIN&quot;</span><span class=p>));</span>
        <span class=n>m</span><span class=p>.</span><span class=na>entrySet</span><span class=p>().</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>CAMEROON=Yaounde</span>
<span class=cm>ANGOLA=Luanda</span>
<span class=cm>BURKINA FASO=Ouagadougou</span>
<span class=cm>BURUNDI=Bujumbura</span>
<span class=cm>ALGERIA=Algiers</span>
<span class=cm>BENIN=Porto-Novo</span>
<span class=cm>CAPE VERDE=Praia</span>
<span class=cm>BOTSWANA=Gaberone</span>
<span class=cm>Porto-Novo</span>
<span class=cm>CAMEROON=Yaounde</span>
<span class=cm>ANGOLA=Luanda</span>
<span class=cm>BURKINA FASO=Ouagadougou</span>
<span class=cm>BURUNDI=Bujumbura</span>
<span class=cm>ALGERIA=Algiers</span>
<span class=cm>BENIN=Porto-Novo</span>
<span class=cm>CAPE VERDE=Praia</span>
<span class=cm>BOTSWANA=Gaberone</span>
<span class=cm>*/</span>
</code></pre></div> <p>put()方法只是将键与值放入相应的ArrayList。为了与Map接口保持一致，它必须返回旧的键，或者在没有任何旧键的情况下返回null。</p> <p>同样遵循了Map规范，get()会在键不在SlowMap中的时候产生null。如果键存在，它将被用来查找表示它在keys列表中的位置的数值型索引，并且这个数字被用作索引来产生与values列表相关联的值。注意，在get()中key的类型是Object，而不是你所期望的参数化类型K（并且是在AssociativeArrayjava中真正使用的类型），这是将泛型注入到Java语言中的时刻如此之晚所导致的结果-如果泛型是Java语言最初就具备的属性，那么get()就可以执行其参数的类型。</p> <p>Map.entrySet() 方法必须产生一个Map.Entry对象集。但是，Map.Entry是一个接口，用来描述依赖于实现的结构，因此如果你想要创建自己的Map类型，就必须同时定义Map.Entry的实现：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/MapEntry.java</span>
<span class=c1>// A simple Map.Entry for sample Map implementations</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>implements</span> <span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>K</span> <span class=n>key</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>V</span> <span class=n>value</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>MapEntry</span><span class=p>(</span><span class=n>K</span> <span class=n>key</span><span class=p>,</span> <span class=n>V</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>key</span> <span class=o>=</span> <span class=n>key</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>K</span> <span class=nf>getKey</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>key</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>getValue</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>setValue</span><span class=p>(</span><span class=n>V</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>V</span> <span class=n>result</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span>
        <span class=n>value</span> <span class=o>=</span> <span class=n>v</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Objects</span><span class=p>.</span><span class=na>hash</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@SuppressWarnings</span><span class=p>(</span><span class=s>&quot;unchecked&quot;</span><span class=p>)</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>rval</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rval</span> <span class=k>instanceof</span> <span class=n>MapEntry</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>key</span><span class=p>,</span>
                        <span class=p>((</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>getKey</span><span class=p>())</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>value</span><span class=p>,</span>
                        <span class=p>((</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span><span class=p>)</span><span class=n>rval</span><span class=p>).</span><span class=na>getValue</span><span class=p>());</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>key</span> <span class=o>+</span> <span class=s>&quot;=&quot;</span> <span class=o>+</span> <span class=n>value</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>这里 equals 方法的实现遵循了<a href>equals 规范</a>。在 Objects 类中有一个非常熟悉的方法可以帮助创建 hashCode() 方法： Objects.hash()。当你定义含有超过一个属性的对象的 <code>hashCode()</code> 时，你可以使用这个方法。如果你的对象只有一个属性，可以直接使用 <code>Objects.hashCode()</code>。</p> <p>尽管这个解决方案非常简单，并且看起来在SlowMap.main() 的琐碎测试中可以正常工作，但是这并不是一个恰当的实现，因为它创建了键和值的副本。entrySet() 的恰当实现应该在Map中提供视图，而不是副本，并且这个视图允许对原始映射表进行修改（副本就不行）。</p> <h3 id=_3>为了速度而散列<a class=headerlink href=#_3 title="Permanent link">#</a></h3> <p>SlowMap.java 说明了创建一种新的Map并不困难。但是正如它的名称SlowMap所示，它不会很快，所以如果有更好的选择，就应该放弃它。它的问题在于对键的查询，键没有按照任何特定顺序保存，所以只能使用简单的线性查询，而线性查询是最慢的查询方式。</p> <p>散列的价值在于速度：散列使得查询得以快速进行。由于瓶颈位于键的查询速度，因此解决方案之一就是保持键的排序状态，然后使用Collections.binarySearch()进行查询。</p> <p>散列则更进一步，它将键保存在某处，以便能够很快找到。存储一组元素最快的数据结构是数组，所以使用它来表示键的信息（请小心留意，我是说键的信息，而不是键本身）。但是因为数组不能调整容量，因此就有一个问题：我们希望在Map中保存数量不确定的值，但是如果键的数量被数组的容量限制了，该怎么办呢？</p> <p>答案就是：数组并不保存键本身。而是通过键对象生成一个数字，将其作为数组的下标。这个数字就是散列码，由定义在Object中的、且可能由你的类覆盖的hashCode()方法（在计算机科学的术语中称为散列函数）生成。</p> <p>于是查询一个值的过程首先就是计算散列码，然后使用散列码查询数组。如果能够保证没有冲突（如果值的数量是固定的，那么就有可能），那可就有了一个完美的散列函数，但是这种情况只是特例。。通常，冲突由外部链接处理：数组并不直接保存值，而是保存值的 list。然后对 list中的值使用equals()方法进行线性的查询。这部分的查询自然会比较慢，但是，如果散列函数好的话，数组的每个位置就只有较少的值。因此，不是查询整个list，而是快速地跳到数组的某个位置，只对很少的元素进行比较。这便是HashMap会如此快的原因。</p> <p>理解了散列的原理，我们就能够实现一个简单的散列Map了：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/SimpleHashMap.java</span>
<span class=c1>// A demonstration hashed Map</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span>
<span class=kd>class</span> <span class=nc>SimpleHashMap</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=kd>extends</span> <span class=n>AbstractMap</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=c1>// Choose a prime number for the hash table</span>
<span class=c1>// size, to achieve a uniform distribution:</span>
    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>SIZE</span> <span class=o>=</span> <span class=mi>997</span><span class=p>;</span>
    <span class=c1>// You can&#39;t have a physical array of generics,</span>
<span class=c1>// but you can upcast to one:</span>
    <span class=nd>@SuppressWarnings</span><span class=p>(</span><span class=s>&quot;unchecked&quot;</span><span class=p>)</span>
    <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;[]</span> <span class=n>buckets</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>LinkedList</span><span class=o>[</span><span class=n>SIZE</span><span class=o>]</span><span class=p>;</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>put</span><span class=p>(</span><span class=n>K</span> <span class=n>key</span><span class=p>,</span> <span class=n>V</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>V</span> <span class=n>oldValue</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=n>Math</span><span class=p>.</span><span class=na>abs</span><span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=na>hashCode</span><span class=p>())</span> <span class=o>%</span> <span class=n>SIZE</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
            <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>bucket</span> <span class=o>=</span> <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span><span class=p>;</span>
        <span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>pair</span> <span class=o>=</span> <span class=k>new</span> <span class=n>MapEntry</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>);</span>
        <span class=kt>boolean</span> <span class=n>found</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=n>ListIterator</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>it</span> <span class=o>=</span>
                <span class=n>bucket</span><span class=p>.</span><span class=na>listIterator</span><span class=p>();</span>
        <span class=k>while</span><span class=p>(</span><span class=n>it</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>iPair</span> <span class=o>=</span> <span class=n>it</span><span class=p>.</span><span class=na>next</span><span class=p>();</span>
            <span class=k>if</span><span class=p>(</span><span class=n>iPair</span><span class=p>.</span><span class=na>getKey</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>oldValue</span> <span class=o>=</span> <span class=n>iPair</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span>
                <span class=n>it</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>pair</span><span class=p>);</span> <span class=c1>// Replace old with new</span>
                <span class=n>found</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>found</span><span class=p>)</span>
            <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>pair</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>oldValue</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>V</span> <span class=nf>get</span><span class=p>(</span><span class=n>Object</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
        <span class=kt>int</span> <span class=n>index</span> <span class=o>=</span> <span class=n>Math</span><span class=p>.</span><span class=na>abs</span><span class=p>(</span><span class=n>key</span><span class=p>.</span><span class=na>hashCode</span><span class=p>())</span> <span class=o>%</span> <span class=n>SIZE</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>iPair</span> <span class=p>:</span> <span class=n>buckets</span><span class=o>[</span><span class=n>index</span><span class=o>]</span><span class=p>)</span>
            <span class=k>if</span><span class=p>(</span><span class=n>iPair</span><span class=p>.</span><span class=na>getKey</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>key</span><span class=p>))</span>
                <span class=k>return</span> <span class=n>iPair</span><span class=p>.</span><span class=na>getValue</span><span class=p>();</span>
        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=nf>entrySet</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>set</span><span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=k>for</span><span class=p>(</span><span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;&gt;</span> <span class=n>bucket</span> <span class=p>:</span> <span class=n>buckets</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=n>bucket</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
            <span class=k>for</span><span class=p>(</span><span class=n>MapEntry</span><span class=o>&lt;</span><span class=n>K</span><span class=p>,</span> <span class=n>V</span><span class=o>&gt;</span> <span class=n>mpair</span> <span class=p>:</span> <span class=n>bucket</span><span class=p>)</span>
                <span class=n>set</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>mpair</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>set</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>SimpleHashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>m</span> <span class=o>=</span>
                <span class=k>new</span> <span class=n>SimpleHashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>m</span><span class=p>.</span><span class=na>putAll</span><span class=p>(</span><span class=n>Countries</span><span class=p>.</span><span class=na>capitals</span><span class=p>(</span><span class=mi>8</span><span class=p>));</span>
        <span class=n>m</span><span class=p>.</span><span class=na>forEach</span><span class=p>((</span><span class=n>k</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span> <span class=o>-&gt;</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>k</span> <span class=o>+</span> <span class=s>&quot;=&quot;</span> <span class=o>+</span> <span class=n>v</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;BENIN&quot;</span><span class=p>));</span>
        <span class=n>m</span><span class=p>.</span><span class=na>entrySet</span><span class=p>().</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>CAMEROON=Yaounde</span>
<span class=cm>ANGOLA=Luanda</span>
<span class=cm>BURKINA FASO=Ouagadougou</span>
<span class=cm>BURUNDI=Bujumbura</span>
<span class=cm>ALGERIA=Algiers</span>
<span class=cm>BENIN=Porto-Novo</span>
<span class=cm>CAPE VERDE=Praia</span>
<span class=cm>BOTSWANA=Gaberone</span>
<span class=cm>Porto-Novo</span>
<span class=cm>CAMEROON=Yaounde</span>
<span class=cm>ANGOLA=Luanda</span>
<span class=cm>BURKINA FASO=Ouagadougou</span>
<span class=cm>BURUNDI=Bujumbura</span>
<span class=cm>ALGERIA=Algiers</span>
<span class=cm>BENIN=Porto-Novo</span>
<span class=cm>CAPE VERDE=Praia</span>
<span class=cm>BOTSWANA=Gaberone</span>
<span class=cm>*/</span>
</code></pre></div> <p>由于散列表中的“槽位”（slot）通常称为桶位（bucket），因此我们将表示实际散列表的数组命名为bucket，为使散列分布均匀，桶的数量通常使用质数<sup id=fnref:2><a class=footnote-ref href=#fn:2>2</a></sup>。注意，为了能够自动处理冲突，使用了一个LinkedList的数组；每一个新的元素只是直接添加到list尾的某个特定桶位中。即使Java不允许你创建泛型数组，那你也可以创建指向这种数组的引用。这里，向上转型为这种数组是很方便的，这样可以防止在后面的代码中进行额外的转型。</p> <p>对于put() 方法，hashCode() 将针对键而被调用，并且其结果被强制转换为正数。为了使产生的数字适合bucket数组的大小，取模操作符将按照该数组的尺寸取模。如果数组的某个位置是 null，这表示还没有元素被散列至此，所以，为了保存刚散列到该定位的对象，需要创建一个新的LinkedList。一般的过程是，查看当前位置的ist中是否有相同的元素，如果有，则将旧的值赋给oldValue，然后用新的值取代旧的值。标记found用来跟踪是否找到（相同的）旧的键值对，如果没有，则将新的对添加到list的末尾。</p> <p>get()方法按照与put()方法相同的方式计算在buckets数组中的索引（这很重要，因为这样可以保证两个方法可以计算出相同的位置）如果此位置有LinkedList存在，就对其进行查询。</p> <p>注意，这个实现并不意味着对性能进行了调优，它只是想要展示散列映射表执行的各种操作。如果你浏览一下java.util.HashMap的源代码，你就会看到一个调过优的实现。同样，为了简单，SimpleHashMap使用了与SlowMap相同的方式来实现entrySet()，这个方法有些过于简单，不能用于通用的Map。</p> <h3 id=hashcode_1>重写 hashCode()<a class=headerlink href=#hashcode_1 title="Permanent link">#</a></h3> <p>在明白了如何散列之后，编写自己的hashCode()就更有意义了。</p> <p>首先，你无法控制bucket数组的下标值的产生。这个值依赖于具体的HashMap对象的容量，而容量的改变与容器的充满程度和负载因子（本章稍后会介绍这个术语）有关。hashCode()生成的结果，经过处理后成为桶位的下标（在SimpleHashMap中，只是对其取模，模数为bucket数组的大小）。</p> <p>设计hashCode()时最重要的因素就是：无论何时，对同一个对象调用hashCode()都应该生成同样的值。如果在将一个对象用put()添加进HashMap时产生一个hashCode()值，而用get()取出时却产生了另一个hashCode()值，那么就无法重新取得该对象了。所以，如果你的hashCode()方法依赖于对象中易变的数据，用户就要当心了，因为此数据发生变化时，hashCode()就会生成一个不同的散列码，相当于产生了一个不同的键。</p> <p>此外，也不应该使hashCode()依赖于具有唯一性的对象信息，尤其是使用this值，这只能产生很糟糕的hashCode()，因为这样做无法生成一个新的键，使之与put()中原始的键值对中的键相同。这正是SpringDetector.java的问题所在，因为它默认的hashCode0使用的是对象的地址。所以，应该使用对象内有意义的识别信息。</p> <p>下面以String类为例。String有个特点：如果程序中有多个String对象，都包含相同的字符串序列，那么这些String对象都映射到同一块内存区域。所以new String("hello")生成的两个实例，虽然是相互独立的，但是对它们使用hashCode()应该生成同样的结果。通过下面的程序可以看到这种情况：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/StringHashCode.java</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StringHashCode</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span><span class=o>[]</span> <span class=n>hellos</span> <span class=o>=</span> <span class=s>&quot;Hello Hello&quot;</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>hellos</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>.</span><span class=na>hashCode</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>hellos</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>.</span><span class=na>hashCode</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>69609650</span>
<span class=cm>69609650</span>
<span class=cm>*/</span>
</code></pre></div> <p>对于String而言，hashCode() 明显是基于String的内容的。</p> <p>因此，要想使hashCode() 实用，它必须速度快，并且必须有意义。也就是说，它必须基于对象的内容生成散列码。记得吗，散列码不必是独一无二的（应该更关注生成速度，而不是唯一性），但是通过 hashCode() 和 equals() ，必须能够完全确定对象的身份。</p> <p>因为在生成桶的下标前，hashCode()还需要做进一步的处理，所以散列码的生成范围并不重要，只要是int即可。</p> <p>还有另一个影响因素：好的hashCode() 应该产生分布均匀的散列码。如果散列码都集中在一块，那么HashMap或者HashSet在某些区域的负载会很重，这样就不如分布均匀的散列函数快。</p> <p>在Effective Java Programming Language Guide（Addison-Wesley 2001）这本书中，Joshua Bloch为怎样写出一份像样的hashCode()给出了基本的指导： </p> <ol> <li>给int变量result赋予某个非零值常量，例如17。</li> <li>为对象内每个有意义的字段（即每个可以做equals）操作的字段计算出一个int散列码c：</li> </ol> <table> <thead> <tr> <th>字段类型</th> <th>计算公式</th> </tr> </thead> <tbody> <tr> <td>boolean</td> <td>c = (f ? 0 : 1)</td> </tr> <tr> <td>byte , char , short , or int</td> <td>c = (int)f</td> </tr> <tr> <td>long</td> <td>c = (int)(f ^ (f&gt;&gt;&gt;32))</td> </tr> <tr> <td>float</td> <td>c = Float.floatToIntBits(f);</td> </tr> <tr> <td>double</td> <td>long l =Double.doubleToLongBits(f); <br>c = (int)(l ^ (l &gt;&gt;&gt; 32))</td> </tr> <tr> <td>Object , where equals() calls equals() for this field</td> <td>c = f.hashCode()</td> </tr> <tr> <td>Array</td> <td>应用以上规则到每一个元素中</td> </tr> </tbody> </table> <ol> <li>合并计算得到的散列码： <strong>result = 37 * result + c;​</strong></li> <li>返回 result。</li> <li>检查hashCode()最后生成的结果，确保相同的对象有相同的散列码。</li> </ol> <p>下面便是遵循这些指导的一个例子。提示，你没有必要书写像如下的代码 —— 相反，使用 <code>Objects.hash()</code> 去用于散列多字段的对象（如同在本例中的那样），然后使用 <code>Objects.hashCode()</code> 如散列单字段的对象。</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/CountedString.java</span>
<span class=c1>// Creating a good hashCode()</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CountedString</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>created</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>s</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>id</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>CountedString</span><span class=p>(</span><span class=n>String</span> <span class=n>str</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>s</span> <span class=o>=</span> <span class=n>str</span><span class=p>;</span>
        <span class=n>created</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
<span class=c1>// id is the total number of instances</span>
<span class=c1>// of this String used by CountedString:</span>
        <span class=k>for</span><span class=p>(</span><span class=n>String</span> <span class=n>s2</span> <span class=p>:</span> <span class=n>created</span><span class=p>)</span>
            <span class=k>if</span><span class=p>(</span><span class=n>s2</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>s</span><span class=p>))</span>
                <span class=n>id</span><span class=o>++</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;String: &quot;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&quot; id: &quot;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span>
                <span class=s>&quot; hashCode(): &quot;</span> <span class=o>+</span> <span class=n>hashCode</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=p>()</span> <span class=p>{</span>
<span class=c1>// The very simple approach:</span>
<span class=c1>// return s.hashCode() * id;</span>
<span class=c1>// Using Joshua Bloch&#39;s recipe:</span>
        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>17</span><span class=p>;</span>
        <span class=n>result</span> <span class=o>=</span> <span class=mi>37</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span> <span class=n>s</span><span class=p>.</span><span class=na>hashCode</span><span class=p>();</span>
        <span class=n>result</span> <span class=o>=</span> <span class=mi>37</span> <span class=o>*</span> <span class=n>result</span> <span class=o>+</span> <span class=n>id</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>o</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>CountedString</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=p>((</span><span class=n>CountedString</span><span class=p>)</span><span class=n>o</span><span class=p>).</span><span class=na>s</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>id</span><span class=p>,</span> <span class=p>((</span><span class=n>CountedString</span><span class=p>)</span><span class=n>o</span><span class=p>).</span><span class=na>id</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Map</span><span class=o>&lt;</span><span class=n>CountedString</span><span class=p>,</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>CountedString</span><span class=o>[]</span> <span class=n>cs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountedString</span><span class=o>[</span><span class=mi>5</span><span class=o>]</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>cs</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>cs</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CountedString</span><span class=p>(</span><span class=s>&quot;hi&quot;</span><span class=p>);</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>cs</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span> <span class=c1>// Autobox int to Integer</span>
        <span class=p>}</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>map</span><span class=p>);</span>
        <span class=k>for</span><span class=p>(</span><span class=n>CountedString</span> <span class=n>cstring</span> <span class=p>:</span> <span class=n>cs</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Looking up &quot;</span> <span class=o>+</span> <span class=n>cstring</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>map</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>cstring</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>{String: hi id: 4 hashCode(): 146450=3, String: hi id:</span>
<span class=cm>5 hashCode(): 146451=4, String: hi id: 2 hashCode():</span>
<span class=cm>146448=1, String: hi id: 3 hashCode(): 146449=2,</span>
<span class=cm>String: hi id: 1 hashCode(): 146447=0}</span>
<span class=cm>Looking up String: hi id: 1 hashCode(): 146447</span>
<span class=cm>0</span>
<span class=cm>Looking up String: hi id: 2 hashCode(): 146448</span>
<span class=cm>1</span>
<span class=cm>Looking up String: hi id: 3 hashCode(): 146449</span>
<span class=cm>2</span>
<span class=cm>Looking up String: hi id: 4 hashCode(): 146450</span>
<span class=cm>3</span>
<span class=cm>Looking up String: hi id: 5 hashCode(): 146451</span>
<span class=cm>4</span>
<span class=cm>*/</span>
</code></pre></div> <p>CountedString由一个String和一个id组成，此id代表包含相同String的CountedString对象的编号。所有的String都被存储在static ArrayList中，在构造器中通过选代遍历此ArrayList完成对id的计算。</p> <p>hashCode()和equals() 都基于CountedString的这两个字段来生成结果；如果它们只基于String或者只基于id，不同的对象就可能产生相同的值。</p> <p>在main）中，使用相同的String创建了多个CountedString对象。这说明，虽然String相同，但是由于id不同，所以使得它们的散列码并不相同。在程序中，HashMap被打印了出来，因此可以看到它内部是如何存储元素的（以无法辨别的次序），然后单独查询每一个键，以此证明查询机制工作正常。</p> <p>作为第二个示例，请考虑Individual类，它被用作<a href>类型信息</a>中所定义的typeinfo.pet类库的基类。Individual类在那一章中就用到了，而它的定义则放到了本章，因此你可以正确地理解其实现。</p> <p>在这里替换了手工去计算 <code>hashCode()</code>，我们使用了更合适的方式 <code>Objects.hash()</code>：</p> <div class=highlight><pre><span></span><code><span class=c1>// typeinfo/pets/Individual.java</span>
<span class=kn>package</span> <span class=nn>typeinfo.pets</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span>
<span class=nc>Individual</span> <span class=kd>implements</span> <span class=n>Comparable</span><span class=o>&lt;</span><span class=n>Individual</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>long</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=kt>long</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>Individual</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>)</span> <span class=p>{</span> <span class=k>this</span><span class=p>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span> <span class=p>}</span>
    <span class=c1>// &#39;name&#39; is optional:</span>
    <span class=kd>public</span> <span class=nf>Individual</span><span class=p>()</span> <span class=p>{}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>getClass</span><span class=p>().</span><span class=na>getSimpleName</span><span class=p>()</span> <span class=o>+</span>
                <span class=p>(</span><span class=n>name</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&quot;&quot;</span> <span class=p>:</span> <span class=s>&quot; &quot;</span> <span class=o>+</span> <span class=n>name</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>long</span> <span class=nf>id</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>id</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>equals</span><span class=p>(</span><span class=n>Object</span> <span class=n>o</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>o</span> <span class=k>instanceof</span> <span class=n>Individual</span> <span class=o>&amp;&amp;</span>
                <span class=n>Objects</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>id</span><span class=p>,</span> <span class=p>((</span><span class=n>Individual</span><span class=p>)</span><span class=n>o</span><span class=p>).</span><span class=na>id</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>hashCode</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Objects</span><span class=p>.</span><span class=na>hash</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>id</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>compareTo</span><span class=p>(</span><span class=n>Individual</span> <span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// Compare by class name first:</span>
        <span class=n>String</span> <span class=n>first</span> <span class=o>=</span> <span class=n>getClass</span><span class=p>().</span><span class=na>getSimpleName</span><span class=p>();</span>
        <span class=n>String</span> <span class=n>argFirst</span> <span class=o>=</span> <span class=n>arg</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getSimpleName</span><span class=p>();</span>
        <span class=kt>int</span> <span class=n>firstCompare</span> <span class=o>=</span> <span class=n>first</span><span class=p>.</span><span class=na>compareTo</span><span class=p>(</span><span class=n>argFirst</span><span class=p>);</span>
        <span class=k>if</span><span class=p>(</span><span class=n>firstCompare</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
            <span class=k>return</span> <span class=n>firstCompare</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=n>name</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>arg</span><span class=p>.</span><span class=na>name</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=kt>int</span> <span class=n>secondCompare</span> <span class=o>=</span> <span class=n>name</span><span class=p>.</span><span class=na>compareTo</span><span class=p>(</span><span class=n>arg</span><span class=p>.</span><span class=na>name</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>secondCompare</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
                <span class=k>return</span> <span class=n>secondCompare</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>arg</span><span class=p>.</span><span class=na>id</span> <span class=o>&lt;</span> <span class=n>id</span> <span class=o>?</span> <span class=o>-</span><span class=mi>1</span> <span class=p>:</span> <span class=p>(</span><span class=n>arg</span><span class=p>.</span><span class=na>id</span> <span class=o>==</span> <span class=n>id</span> <span class=o>?</span> <span class=mi>0</span> <span class=p>:</span> <span class=mi>1</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>compareTo() 方法有一个比较结构，因此它会产生一个排序序列，排序的规则首先按照实际类型排序，然后如果有名字的话，按照name排序，最后按照创建的顺序排序。下面的示例说明了它是如何工作的：</p> <div class=highlight><pre><span></span><code><span class=c1>// equalshashcode/IndividualTest.java</span>
<span class=kn>import</span> <span class=nn>collections.MapOfList</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>typeinfo.pets.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>IndividualTest</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>Individual</span><span class=o>&gt;</span> <span class=n>pets</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=k>for</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Pet</span><span class=o>&gt;</span> <span class=n>lp</span> <span class=p>:</span>
                <span class=n>MapOfList</span><span class=p>.</span><span class=na>petPeople</span><span class=p>.</span><span class=na>values</span><span class=p>())</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Pet</span> <span class=n>p</span> <span class=p>:</span> <span class=n>lp</span><span class=p>)</span>
                <span class=n>pets</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
        <span class=n>pets</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=cm>/* Output:</span>
<span class=cm>Cat Elsie May</span>
<span class=cm>Cat Pinkola</span>
<span class=cm>Cat Shackleton</span>
<span class=cm>Cat Stanford</span>
<span class=cm>Cymric Molly</span>
<span class=cm>Dog Margrett</span>
<span class=cm>Mutt Spot</span>
<span class=cm>Pug Louie aka Louis Snorkelstein Dupree</span>
<span class=cm>Rat Fizzy</span>
<span class=cm>Rat Freckly</span>
<span class=cm>Rat Fuzzy</span>
<span class=cm>*/</span>
</code></pre></div> <p>由于所有的宠物都有名字，因此它们首先按照类型排序，然后在同类型中按照名字排序。</p> <!-- Tuning a HashMap --> <h2 id=hashmap>调优 HashMap<a class=headerlink href=#hashmap title="Permanent link">#</a></h2> <p>我们有可能手动调优HashMap以提高其在特定应用程序中的性能。为了理解调整HashMap时的性能问题，一些术语是必要的：</p> <ul> <li>容量（Capacity）：表中存储的桶数量。</li> <li>初始容量（Initial Capacity）：当表被创建时，桶的初始个数。 HashMap 和 HashSet 有可以让你指定初始容量的构造器。</li> <li>个数（Size）：目前存储在表中的键值对的个数。</li> <li>负载因子（Load factor）：通常表现为 <span><span class=MathJax_Preview>\frac{size}{capacity}</span><script type=math/tex>\frac{size}{capacity}</script></span>。当负载因子大小为 0 的时候表示为一个空表。当负载因子大小为 0.5 表示为一个半满表（half-full table），以此类推。轻负载的表几乎没有冲突，因此是插入和查找的最佳选择（但会减慢使用迭代器进行遍历的过程）。 HashMap 和 HashSet 有可以让你指定负载因子的构造器。当表内容量达到了负载因子，集合就会自动扩充为原始容量（桶的数量）的两倍，并且会将原始的对象存储在新的桶集合中（也被称为 rehashing）</li> </ul> <p>HashMap 中负载因子的大小为 0.75（当表内容量大小不足四分之三的时候，不会发生 rehashing 现象）。这看起来是一个非常好的同时考虑到时间和空间消耗的平衡策略。更高的负载因子会减少空间的消耗，但是会增加查询的耗时。重要的是，查询操作是你使用的最频繁的一个操作（包括 <code>get()</code> 和 <code>put()</code> 方法）。</p> <p>如果你知道存储在 HashMap 中确切的条目个数，直接创建一个足够容量大小的 HashMap，以避免自动发生的 rehashing 操作。</p> <!-- 分页 --> <div style="page-break-after: always;"></div> <div class=footnote> <hr> <ol> <li id=fn:1></li> <li id=fn:2> <p>事实证明，质数实际上并不是散列桶的理想容量。近来，（经过广泛的测试）Java的散列函数都使用2的整数次方。对现代的处理器来说，除法与求余数是最慢的操作。使用2的整数次方长度的散列表，可用掩码代替除法。&#160;<a class=footnote-backref href=#fnref:2 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Appendix The Positive Legacy of C plus plus and Java </span> </div> </a> <a href=../GLOSSARY/ title=GLOSSARY class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> GLOSSARY </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://leay.net target=_blank rel=noopener title=home class="md-footer-social__link fa fa-home"></a> <a href=https://github.com/hqweay target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.c33a9706.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.ja.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.multi.js></script> <script>app.initialize({version:"1.1",url:{base:"../../../../.."}})</script> </body> </html>