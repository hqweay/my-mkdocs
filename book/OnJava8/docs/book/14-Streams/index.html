<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Thinking Drafts"><link href=https://wiki.leay.net/book/OnJava8/docs/book/14-Streams/ rel=canonical><meta name=author content=hqweay><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content="en, ja"><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>14 Streams - Hqweay's Wiki</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../../../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105976066-3", "wiki.leay.net")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=indigo> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=0 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" aria-label="Hqweay's Wiki" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Hqweay's Wiki </span> <span class=md-header-nav__topic> 14 Streams </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Book </a> </li> <li class=md-tabs__item> <a href=../../../../../doc/ class=md-tabs__link> Doc </a> </li> <li class=md-tabs__item> <a href=../../../../../life/reading/ class=md-tabs__link> Life </a> </li> <li class=md-tabs__item> <a href=../../../../../study/draft/try-wiki/ class=md-tabs__link> Study </a> </li> <li class=md-tabs__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ class=md-tabs__link> Tech </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Hqweay's Wiki </label> <div class=md-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../../../../test/ title=特殊语法 class=md-nav__link> 特殊语法 </a> </li> <li class=md-nav__item> <a href=../../../../../web-page/ title=静态文档导航 class=md-nav__link> 静态文档导航 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1 checked> <label class=md-nav__link for=nav-4-1> OnJava8 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> OnJava8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title="《On Java 8》中文版" class=md-nav__link> 《On Java 8》中文版 </a> </li> <li class=md-nav__item> <a href=../../../CONTRIBUTING/ title=CONTRIBUTING class=md-nav__link> CONTRIBUTING </a> </li> <li class=md-nav__item> <a href=../../../SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4 type=checkbox id=nav-4-1-4 checked> <label class=md-nav__link for=nav-4-1-4> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-1-4> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title=译者的话 class=md-nav__link> 译者的话 </a> </li> <li class=md-nav__item> <a href=../../_coverpage/ title=coverpage class=md-nav__link> coverpage </a> </li> <li class=md-nav__item> <a href=../../sidebar/ title=Sidebar class=md-nav__link> Sidebar </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4 type=checkbox id=nav-4-1-4-4> <label class=md-nav__link for=nav-4-1-4-4> style </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-4> style </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4-1 type=checkbox id=nav-4-1-4-4-1> <label class=md-nav__link for=nav-4-1-4-4-1> Prism master </label> <nav class=md-nav data-md-component=collapsible data-md-level=5> <label class=md-nav__title for=nav-4-1-4-4-1> Prism master </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_style/prism-master/ title=[Prism](http://prismjs.com/) class=md-nav__link> [Prism](http://prismjs.com/) </a> </li> <li class=md-nav__item> <a href=../../_style/prism-master/CHANGELOG/ title="Prism Changelog" class=md-nav__link> Prism Changelog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-5 type=checkbox id=nav-4-1-4-5 checked> <label class=md-nav__link for=nav-4-1-4-5> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-5> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../00-Introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../00-On-Java-8/ title="00 On Java 8" class=md-nav__link> 00 On Java 8 </a> </li> <li class=md-nav__item> <a href=../00-Preface/ title=前言 class=md-nav__link> 前言 </a> </li> <li class=md-nav__item> <a href=../01-What-is-an-Object/ title="第一章 对象的概念" class=md-nav__link> 第一章 对象的概念 </a> </li> <li class=md-nav__item> <a href=../02-Installing-Java-and-the-Book-Examples/ title="02 Installing Java and the Book Examples" class=md-nav__link> 02 Installing Java and the Book Examples </a> </li> <li class=md-nav__item> <a href=../03-Objects-Everywhere/ title="03 Objects Everywhere" class=md-nav__link> 03 Objects Everywhere </a> </li> <li class=md-nav__item> <a href=../04-Operators/ title="04 Operators" class=md-nav__link> 04 Operators </a> </li> <li class=md-nav__item> <a href=../05-Control-Flow/ title="05 Control Flow" class=md-nav__link> 05 Control Flow </a> </li> <li class=md-nav__item> <a href=../06-Housekeeping/ title="06 Housekeeping" class=md-nav__link> 06 Housekeeping </a> </li> <li class=md-nav__item> <a href=../07-Implementation-Hiding/ title="07 Implementation Hiding" class=md-nav__link> 07 Implementation Hiding </a> </li> <li class=md-nav__item> <a href=../08-Reuse/ title="08 Reuse" class=md-nav__link> 08 Reuse </a> </li> <li class=md-nav__item> <a href=../09-Polymorphism/ title="09 Polymorphism" class=md-nav__link> 09 Polymorphism </a> </li> <li class=md-nav__item> <a href=../10-Interfaces/ title="10 Interfaces" class=md-nav__link> 10 Interfaces </a> </li> <li class=md-nav__item> <a href=../11-Inner-Classes/ title="11 Inner Classes" class=md-nav__link> 11 Inner Classes </a> </li> <li class=md-nav__item> <a href=../12-Collections/ title="12 Collections" class=md-nav__link> 12 Collections </a> </li> <li class=md-nav__item> <a href=../13-Functional-Programming/ title="13 Functional Programming" class=md-nav__link> 13 Functional Programming </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 14 Streams </label> <a href=./ title="14 Streams" class="md-nav__link md-nav__link--active"> 14 Streams </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 流支持 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 流创建 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 随机数流 </a> </li> <li class=md-nav__item> <a href=#int class=md-nav__link> int 类型的范围 </a> </li> <li class=md-nav__item> <a href=#generate class=md-nav__link> generate() </a> </li> <li class=md-nav__item> <a href=#iterate class=md-nav__link> iterate() </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 流的建造者模式 </a> </li> <li class=md-nav__item> <a href=#arrays class=md-nav__link> Arrays </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 正则表达式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 中间操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 跟踪和调试 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 流元素排序 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 移除元素 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 应用函数到元素 </a> </li> <li class=md-nav__item> <a href=#map class=md-nav__link> 在 map() 中组合流 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#optional class=md-nav__link> Optional类 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 便利函数 </a> </li> <li class=md-nav__item> <a href=#optional_1 class=md-nav__link> 创建 Optional </a> </li> <li class=md-nav__item> <a href=#optional_2 class=md-nav__link> Optional 对象操作 </a> </li> <li class=md-nav__item> <a href=#optional_3 class=md-nav__link> Optional 流 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 终端操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 数组 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 循环 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 集合 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 组合 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 匹配 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 查找 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 信息 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 数字流信息 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../15-Exceptions/ title="15 Exceptions" class=md-nav__link> 15 Exceptions </a> </li> <li class=md-nav__item> <a href=../16-Validating-Your-Code/ title="16 Validating Your Code" class=md-nav__link> 16 Validating Your Code </a> </li> <li class=md-nav__item> <a href=../17-Files/ title="17 Files" class=md-nav__link> 17 Files </a> </li> <li class=md-nav__item> <a href=../18-Strings/ title="18 Strings" class=md-nav__link> 18 Strings </a> </li> <li class=md-nav__item> <a href=../19-Type-Information/ title="19 Type Information" class=md-nav__link> 19 Type Information </a> </li> <li class=md-nav__item> <a href=../20-Generics/ title="20 Generics" class=md-nav__link> 20 Generics </a> </li> <li class=md-nav__item> <a href=../21-Arrays/ title="21 Arrays" class=md-nav__link> 21 Arrays </a> </li> <li class=md-nav__item> <a href=../22-Enumerations/ title="22 Enumerations" class=md-nav__link> 22 Enumerations </a> </li> <li class=md-nav__item> <a href=../23-Annotations/ title="23 Annotations" class=md-nav__link> 23 Annotations </a> </li> <li class=md-nav__item> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class=md-nav__link> 24 Concurrent Programming </a> </li> <li class=md-nav__item> <a href=../25-Patterns/ title="25 Patterns" class=md-nav__link> 25 Patterns </a> </li> <li class=md-nav__item> <a href=../Appendix-Becoming-a-Programmer/ title="Appendix Becoming a Programmer" class=md-nav__link> Appendix Becoming a Programmer </a> </li> <li class=md-nav__item> <a href=../Appendix-Benefits-and-Costs-of-Static-Type-Checking/ title="Appendix Benefits and Costs of Static Type Checking" class=md-nav__link> Appendix Benefits and Costs of Static Type Checking </a> </li> <li class=md-nav__item> <a href=../Appendix-Collection-Topics/ title="Appendix Collection Topics" class=md-nav__link> Appendix Collection Topics </a> </li> <li class=md-nav__item> <a href=../Appendix-Data-Compression/ title="Appendix Data Compression" class=md-nav__link> Appendix Data Compression </a> </li> <li class=md-nav__item> <a href=../Appendix-IO-Streams/ title="Appendix IO Streams" class=md-nav__link> Appendix IO Streams </a> </li> <li class=md-nav__item> <a href=../Appendix-Javadoc/ title="Appendix Javadoc" class=md-nav__link> Appendix Javadoc </a> </li> <li class=md-nav__item> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class=md-nav__link> Appendix Low Level Concurrency </a> </li> <li class=md-nav__item> <a href=../Appendix-New-IO/ title="Appendix New IO" class=md-nav__link> Appendix New IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class=md-nav__link> Appendix Object Serialization </a> </li> <li class=md-nav__item> <a href=../Appendix-Passing-and-Returning-Objects/ title="Appendix Passing and Returning Objects" class=md-nav__link> Appendix Passing and Returning Objects </a> </li> <li class=md-nav__item> <a href=../Appendix-Programming-Guidelines/ title="Appendix Programming Guidelines" class=md-nav__link> Appendix Programming Guidelines </a> </li> <li class=md-nav__item> <a href=../Appendix-Standard-IO/ title="Appendix Standard IO" class=md-nav__link> Appendix Standard IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Supplements/ title="Appendix Supplements" class=md-nav__link> Appendix Supplements </a> </li> <li class=md-nav__item> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class=md-nav__link> Appendix The Positive Legacy of C plus plus and Java </a> </li> <li class=md-nav__item> <a href=../Appendix-Understanding-equals-and-hashCode/ title="Appendix Understanding equals and hashCode" class=md-nav__link> Appendix Understanding equals and hashCode </a> </li> <li class=md-nav__item> <a href=../GLOSSARY/ title=GLOSSARY class=md-nav__link> GLOSSARY </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Doc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Doc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/ title=About class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> English </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1 type=checkbox id=nav-5-2-1> <label class=md-nav__link for=nav-5-2-1> A Programmers Guide to English </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-1> A Programmers Guide to English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/ title="A Programmer's Guide to English" class=md-nav__link> A Programmer's Guide to English </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-3 type=checkbox id=nav-5-2-1-3> <label class=md-nav__link for=nav-5-2-1-3> Essence </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-3> Essence </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/essence/ title=语言学习的本质浅析 class=md-nav__link> 语言学习的本质浅析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-4 type=checkbox id=nav-5-2-1-4> <label class=md-nav__link for=nav-5-2-1-4> Make a program </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-4> Make a program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/make-a-program/ title=如何构建一个识别英语的程序 class=md-nav__link> 如何构建一个识别英语的程序 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-5 type=checkbox id=nav-5-2-1-5> <label class=md-nav__link for=nav-5-2-1-5> Qa </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-5> Qa </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/ title="常见问题 QA" class=md-nav__link> 常见问题 QA </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/WhyPTE/ title="为什么我选择 PTE 考试" class=md-nav__link> 为什么我选择 PTE 考试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-6 type=checkbox id=nav-5-2-1-6> <label class=md-nav__link for=nav-5-2-1-6> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-6> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/resources/ title=资料、工具推荐和扩展阅读 class=md-nav__link> 资料、工具推荐和扩展阅读 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-7 type=checkbox id=nav-5-2-1-7> <label class=md-nav__link for=nav-5-2-1-7> Training </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-7> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ title=我的训练方法 class=md-nav__link> 我的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/KnowledgeBase/ title=扩充语料库的训练方法 class=md-nav__link> 扩充语料库的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ListeningandSpeaking/ title=发音和听力训练方法 class=md-nav__link> 发音和听力训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/Thinking/ title=英语思维训练 class=md-nav__link> 英语思维训练 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2 type=checkbox id=nav-5-2-2> <label class=md-nav__link for=nav-5-2-2> English level up tips for Chinese </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-2> English level up tips for Chinese </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/ title=English-level-up-tips-for-Chinese class=md-nav__link> English-level-up-tips-for-Chinese </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-3 type=checkbox id=nav-5-2-2-3> <label class=md-nav__link for=nav-5-2-2-3> Part 1 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-3> Part 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/1-understanding/ title=认知篇 class=md-nav__link> 认知篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/2-vocabulary/ title=单词篇 class=md-nav__link> 单词篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/3-listening/ title=听力篇 class=md-nav__link> 听力篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/4-reading/ title=阅读篇 class=md-nav__link> 阅读篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/5-speaking/ title="5 speaking" class=md-nav__link> 5 speaking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-4 type=checkbox id=nav-5-2-2-4> <label class=md-nav__link for=nav-5-2-2-4> Part 2 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-4> Part 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-2/x-misc/ title=扯淡篇 class=md-nav__link> 扯淡篇 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-5 type=checkbox id=nav-5-2-2-5> <label class=md-nav__link for=nav-5-2-2-5> Word list </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-5> Word list </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Go/ title=Go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Java/ title=Java class=md-nav__link> Java </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/JavaScript/ title=JavaScript class=md-nav__link> JavaScript </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/PHP/ title=PHP class=md-nav__link> PHP </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Swift/ title=Swift class=md-nav__link> Swift </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-3 type=checkbox id=nav-5-2-3> <label class=md-nav__link for=nav-5-2-3> Everyone can use english </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-3> Everyone can use english </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/ title=人人都能用英语 class=md-nav__link> 人人都能用英语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter1/ title="第一章 起点" class=md-nav__link> 第一章 起点 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter2/ title="第二章 口语" class=md-nav__link> 第二章 口语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter3/ title="第三章 语音" class=md-nav__link> 第三章 语音 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter4/ title="第四章 朗读" class=md-nav__link> 第四章 朗读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter5/ title="第五章 词典" class=md-nav__link> 第五章 词典 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter6/ title="第六章 语法" class=md-nav__link> 第六章 语法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter7/ title="第七章 精读" class=md-nav__link> 第七章 精读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter8/ title="第八章 叮嘱" class=md-nav__link> 第八章 叮嘱 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/end/ title=后记 class=md-nav__link> 后记 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-1 type=checkbox id=nav-5-3-1> <label class=md-nav__link for=nav-5-3-1> Chinese copywriting guidelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-1> Chinese copywriting guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/CHANGELOG/ title=CHANGELOG class=md-nav__link> CHANGELOG </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.en-US/ title="Chinese Copywriting Guidelines" class=md-nav__link> Chinese Copywriting Guidelines </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-CN/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-HK/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2> <label class=md-nav__link for=nav-5-3-2> Document style guide </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> Document style guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/ title=Index class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2-2 type=checkbox id=nav-5-3-2-2> <label class=md-nav__link for=nav-5-3-2-2> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-3-2-2> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/marks/ title=标点符号 class=md-nav__link> 标点符号 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/number/ title=数值 class=md-nav__link> 数值 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/paragraph/ title=段落 class=md-nav__link> 段落 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/reference/ title=参考链接 class=md-nav__link> 参考链接 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/structure/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/text/ title=文本 class=md-nav__link> 文本 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/title/ title=标题 class=md-nav__link> 标题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Life </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Life </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Reading </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/ title=阅读 class=md-nav__link> 阅读 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-2 type=checkbox id=nav-6-1-2> <label class=md-nav__link for=nav-6-1-2> Mark </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-2> Mark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back-up/ title="2019 暑假备份" class=md-nav__link> 2019 暑假备份 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back/ title=例行收集 class=md-nav__link> 例行收集 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/efficiency-time/ title=效率、时间、鸡汤 class=md-nav__link> 效率、时间、鸡汤 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fiction/ title=小说 class=md-nav__link> 小说 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/films-remark/ title=影评、电影 class=md-nav__link> 影评、电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fo/ title=佛 class=md-nav__link> 佛 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hackers-others/ title=互联网、思维方式 class=md-nav__link> 互联网、思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hooked-media/ title=媒介反思 class=md-nav__link> 媒介反思 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/isaka-kotaro/ title=伊坂幸太郎 class=md-nav__link> 伊坂幸太郎 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/knote/ title=整理 class=md-nav__link> 整理 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/mark-knote/ title=浪费时间 class=md-nav__link> 浪费时间 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/meaning/ title=思维方式 class=md-nav__link> 思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/morimi-tomihiko/ title=森见登美彦的文字好有趣啊! class=md-nav__link> 森见登美彦的文字好有趣啊! </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/murakamo-haruki/ title=村上春树 class=md-nav__link> 村上春树 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/no-fiction/ title=非虚构类 class=md-nav__link> 非虚构类 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/paper/ title=论文式总结 class=md-nav__link> 论文式总结 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/poem/ title=诗歌 class=md-nav__link> 诗歌 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/sence/ title=哲学相关通俗读物 class=md-nav__link> 哲学相关通俗读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/the-little-prince/ title="The Little Prince" class=md-nav__link> The Little Prince </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/universe/ title=物理科普读物 class=md-nav__link> 物理科普读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/utopia/ title=乌托邦小说世界关于书籍的冷幽默 class=md-nav__link> 乌托邦小说世界关于书籍的冷幽默 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/western-politics/ title=政哲 class=md-nav__link> 政哲 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/what-we-talk-about/ title=日本文学 class=md-nav__link> 日本文学 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/wuxia/ title=武侠 class=md-nav__link> 武侠 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/xiao-bo/ title=王小波 class=md-nav__link> 王小波 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-3 type=checkbox id=nav-6-1-3> <label class=md-nav__link for=nav-6-1-3> Note </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-3> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-02-book-JavaScript-DOM/ title="《JavaScript DOM 编程艺术》" class=md-nav__link> 《JavaScript DOM 编程艺术》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-09-coding-javascript-down/ title="尽量把 JavaScript 代码放到 HTML 网页底部" class=md-nav__link> 尽量把 JavaScript 代码放到 HTML 网页底部 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-05-23-HTTP/ title="《HTTP 图解》" class=md-nav__link> 《HTTP 图解》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-06-07-computer/ title=计算机系统基础 class=md-nav__link> 计算机系统基础 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-10-09-JVM/ title="JVM 笔记" class=md-nav__link> JVM 笔记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-11-25-computer/ title=计算机系统概论 class=md-nav__link> 计算机系统概论 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-4 type=checkbox id=nav-6-1-4> <label class=md-nav__link for=nav-6-1-4> Review </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-4> Review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-28-say-something/ title=听你吹牛的闲暇时光 class=md-nav__link> 听你吹牛的闲暇时光 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-29-wuxia/ title="《流星 蝴蝶 剑》简记" class=md-nav__link> 《流星 蝴蝶 剑》简记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-12-30-xiao-bo/ title=波波老师 class=md-nav__link> 波波老师 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-01-17-lai-zi-xin-shi-jie/ title=《来自新世界》 class=md-nav__link> 《来自新世界》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-10-06-October/ title=科普谈起 class=md-nav__link> 科普谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2019-09-07-story/ title=从网络小说谈起。 class=md-nav__link> 从网络小说谈起。 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Watching </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Watching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/watching/2017-08-29-watch-movies-rencently/ title=最近看的几部电影 class=md-nav__link> 最近看的几部电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-10-13-september-movies-record/ title=九月观影记录 class=md-nav__link> 九月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-11-01-October-summary/ title=十月看片与非专业类阅读 class=md-nav__link> 十月看片与非专业类阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-12-01-1112/ title=观影与阅读记录 class=md-nav__link> 观影与阅读记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-01-10-12/ title=最近看片与阅读 class=md-nav__link> 最近看片与阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-02-06-january/ title=一月观影记录 class=md-nav__link> 一月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-08-February/ title=二月至今观影记录 class=md-nav__link> 二月至今观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-31-March/ title=三月观影记录 class=md-nav__link> 三月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-12-26-Smultronst%C3%A4llet/ title=野草莓 class=md-nav__link> 野草莓 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-10-10-October/ title=克服本能就是善良吗？（从十月新番胡扯……） class=md-nav__link> 克服本能就是善良吗？（从十月新番胡扯……） </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-04-bgm/ title=无人声环 class=md-nav__link> 无人声环 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-13-the-end-of-the-world/ title="The End of the Fucking World" class=md-nav__link> The End of the Fucking World </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Study </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Study </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> Draft </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-1> Draft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/draft/try-wiki/ title="一些 Wiki 工具的尝试" class=md-nav__link> 一些 Wiki 工具的尝试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Language </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-2> Language </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/language/%E6%97%A5%E8%AF%AD%E5%85%A5%E9%97%A8/ title=日语入门 class=md-nav__link> 日语入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Tech </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Tech </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-1 type=checkbox id=nav-8-1-1> <label class=md-nav__link for=nav-8-1-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ title=大表哥的电商网页实战体验 class=md-nav__link> 大表哥的电商网页实战体验 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-23-know-nothing/ title=知其然不知其所以然 class=md-nav__link> 知其然不知其所以然 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2018-06-08-responsive/ title=大表哥的响应式设计 class=md-nav__link> 大表哥的响应式设计 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/zh-javascript-info/ title="现代 JavaScript 教程摘录" class=md-nav__link> 现代 JavaScript 教程摘录 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-2 type=checkbox id=nav-8-1-2> <label class=md-nav__link for=nav-8-1-2> Go </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-2> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/go/01/ title=01 class=md-nav__link> 01 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-3 type=checkbox id=nav-8-1-3> <label class=md-nav__link for=nav-8-1-3> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-3> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/java/2017-12-30-Java%20Web/ title="从 url 访问服务器资源讨论 Java Web 中的 Servlet" class=md-nav__link> 从 url 访问服务器资源讨论 Java Web 中的 Servlet </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2018-11-23-ArrayList/ title=ArrayList class=md-nav__link> ArrayList </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-01-31-HashMap/ title=HashMap class=md-nav__link> HashMap </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-01-String/ title="String 分析(栈,堆,字符串常量池)" class=md-nav__link> String 分析(栈,堆,字符串常量池) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-03-String/ title=String、StringBuffer、StingBuilder class=md-nav__link> String、StringBuffer、StingBuilder </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-06-Hashtable/ title=Hashtable class=md-nav__link> Hashtable </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-22-string-pool/ title=字符串常量池到底保存的是字符串对象还是字符串对象的引用? class=md-nav__link> 字符串常量池到底保存的是字符串对象还是字符串对象的引用? </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-23-Java-Thread-pool/ title="Java 线程池" class=md-nav__link> Java 线程池 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-29-Java%20Web/ title="Java Web 启动流程" class=md-nav__link> Java Web 启动流程 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-04-05-AQS-lock/ title="AQS 与 Java 锁的具体实现" class=md-nav__link> AQS 与 Java 锁的具体实现 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-4 type=checkbox id=nav-8-1-4> <label class=md-nav__link for=nav-8-1-4> Projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-4> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/projects/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-5 type=checkbox id=nav-8-1-5> <label class=md-nav__link for=nav-8-1-5> Spring </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-5> Spring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2018-09-01-Spring%20Security/ title="Spring Boot 与 Spring Security" class=md-nav__link> Spring Boot 与 Spring Security </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-03-29-Spring-init/ title="Spring 启动流程与简单源码分析" class=md-nav__link> Spring 启动流程与简单源码分析 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-04-06-Spring-MVC/ title="Spring MVC 简单源码分析" class=md-nav__link> Spring MVC 简单源码分析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Config </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Config </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Git </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/git/2018-02-01-git/ title="Git 的简单使用" class=md-nav__link> Git 的简单使用 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/2019-08-10-git-merge/ title="Git 协作管理项目时不可避免的 merge 操作" class=md-nav__link> Git 协作管理项目时不可避免的 merge 操作 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/submodule/ title=submodule class=md-nav__link> submodule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-2> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2019-12-18-manjaro/ title="Manjaro 个人新装配置" class=md-nav__link> Manjaro 个人新装配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/fontconfig/ title="Arch Emoji fontconfig" class=md-nav__link> Arch Emoji fontconfig </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/softwares/ title=各种工具 class=md-nav__link> 各种工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-3> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/tools/cz-conventional-changelog/ title=cz-conventional-changelog class=md-nav__link> cz-conventional-changelog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-03-31-Generator-SpringBoot-Gradle/ title="MyBatis Generator + Spring Boot + Gradle 配置" class=md-nav__link> MyBatis Generator + Spring Boot + Gradle 配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-25-VS-Code-Python/ title="VS Code 写 Python" class=md-nav__link> VS Code 写 Python </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-26-linux-kawa/ title="在 Linux 上使用 kawa" class=md-nav__link> 在 Linux 上使用 kawa </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-11-25-mysql/ title="【转】在 CentOS 上部署 MySQL 解压版" class=md-nav__link> 【转】在 CentOS 上部署 MySQL 解压版 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-04-03-Redis-lock/ title="Redis 的分布式锁实现" class=md-nav__link> Redis 的分布式锁实现 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-07-28-picGo/ title="Github + picGo ——有图床了" class=md-nav__link> Github + picGo ——有图床了 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-11-18-linux-mount/ title="Linux 挂载分区/磁盘" class=md-nav__link> Linux 挂载分区/磁盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-03-terminal-wifi/ title=把显卡驱动删了后在终端连热点 class=md-nav__link> 把显卡驱动删了后在终端连热点 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-12-css/ title=一个引号引发的惨案 class=md-nav__link> 一个引号引发的惨案 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-electron-vue/ title="用 Vue 写 Electron 的一次问题解决" class=md-nav__link> 用 Vue 写 Electron 的一次问题解决 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-ttrss/ title="部署 TTRSS 遇到的一些有趣的东西" class=md-nav__link> 部署 TTRSS 遇到的一些有趣的东西 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-04-02-hexo-asset-image/ title="hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了" class=md-nav__link> hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Project </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/project/2017-12-21-xiao-zong-jie/ title=做个小小的总结 class=md-nav__link> 做个小小的总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-06-25-tencent-news-spider-py/ title=腾讯新闻爬虫 class=md-nav__link> 腾讯新闻爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-09-13-lite-terminal-home-page/ title=简单的仿终端主页 class=md-nav__link> 简单的仿终端主页 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-01-11-tank/ title=花里胡哨的坦克大战 class=md-nav__link> 花里胡哨的坦克大战 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-02-05-new-year/ title=大年初一（爬取豆瓣条目及吐槽） class=md-nav__link> 大年初一（爬取豆瓣条目及吐槽） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-04-03-blog-project/ title=写博客 class=md-nav__link> 写博客 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-06-17-nodejs/ title="MarkAll 导入豆瓣数据 —— NodeJS 写爬虫" class=md-nav__link> MarkAll 导入豆瓣数据 —— NodeJS 写爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-Autumn-Json/ title="Autumn-From-Spring 自定义 BeanDefinitionReader" class=md-nav__link> Autumn-From-Spring 自定义 BeanDefinitionReader </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-bookmarkdown/ title="Chrome 插件——书签转 MarkDown" class=md-nav__link> Chrome 插件——书签转 MarkDown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-10-then-start/ title=那就开始吧 class=md-nav__link> 那就开始吧 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-16-Writing-is%20the-reward-of-writing-itself/ title=写就是写本身的报酬 class=md-nav__link> 写就是写本身的报酬 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-11-19-change-my-blog/ title=【过时内容】嘿，我转移博客啦！ class=md-nav__link> 【过时内容】嘿，我转移博客啦！ </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-12-08-yao-guai-ji-yu-you-ren-bo/ title=妖怪唧唧与友人波波 class=md-nav__link> 妖怪唧唧与友人波波 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-01-01-ubuntu/ title="折腾 ubuntu 与 win10 共存" class=md-nav__link> 折腾 ubuntu 与 win10 共存 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-02-09-pc-system/ title="黑苹果与 Ubuntu 及 PC 折腾系统" class=md-nav__link> 黑苹果与 Ubuntu 及 PC 折腾系统 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-12-install-Vmware-on-linux/ title="deepin 安装 VMware" class=md-nav__link> deepin 安装 VMware </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-31-SQL/ title="Spring Boot 开发遇到一些 SQL 问题" class=md-nav__link> Spring Boot 开发遇到一些 SQL 问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-jquery-confrim/ title="JQuery-Confrim 的一点问题" class=md-nav__link> JQuery-Confrim 的一点问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-some-plugins/ title="ECharts + PageHelper + Bootstrap Table" class=md-nav__link> ECharts + PageHelper + Bootstrap Table </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-js-in-thymeleaf/ title="Thymeleaf 里使用 JavaScript 时的注意事项" class=md-nav__link> Thymeleaf 里使用 JavaScript 时的注意事项 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-spring-boot-gradle-yml-log4j2/ title="Spring Boot + Gradle + yml 配置 log4j2" class=md-nav__link> Spring Boot + Gradle + yml 配置 log4j2 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-09-softwares/ title="Linux 常用软件" class=md-nav__link> Linux 常用软件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-hexo-image/ title="【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径）" class=md-nav__link> 【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-show/ title=如果给文章提供多种渲染方式 class=md-nav__link> 如果给文章提供多种渲染方式 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-08-30-vue-music/ title="简单的单页应用(Vue CLI2 的简单使用)" class=md-nav__link> 简单的单页应用(Vue CLI2 的简单使用) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-09-23-word-count/ title="WordCount 项目总结" class=md-nav__link> WordCount 项目总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-06-markall-douban-backup/ title=豆瓣标记数据备份插件 class=md-nav__link> 豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-07-markall-douban-backup-yes/ title=【过时】又一个——豆瓣标记数据备份插件 class=md-nav__link> 【过时】又一个——豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-13-blog/ title=从分析本网站的网络请求谈起 class=md-nav__link> 从分析本网站的网络请求谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/draft/ title=Draft class=md-nav__link> Draft </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 流支持 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 流创建 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 随机数流 </a> </li> <li class=md-nav__item> <a href=#int class=md-nav__link> int 类型的范围 </a> </li> <li class=md-nav__item> <a href=#generate class=md-nav__link> generate() </a> </li> <li class=md-nav__item> <a href=#iterate class=md-nav__link> iterate() </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 流的建造者模式 </a> </li> <li class=md-nav__item> <a href=#arrays class=md-nav__link> Arrays </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 正则表达式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 中间操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 跟踪和调试 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 流元素排序 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 移除元素 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 应用函数到元素 </a> </li> <li class=md-nav__item> <a href=#map class=md-nav__link> 在 map() 中组合流 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#optional class=md-nav__link> Optional类 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 便利函数 </a> </li> <li class=md-nav__item> <a href=#optional_1 class=md-nav__link> 创建 Optional </a> </li> <li class=md-nav__item> <a href=#optional_2 class=md-nav__link> Optional 对象操作 </a> </li> <li class=md-nav__item> <a href=#optional_3 class=md-nav__link> Optional 流 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 终端操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 数组 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 循环 </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 集合 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 组合 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 匹配 </a> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 查找 </a> </li> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 信息 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 数字流信息 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hqweay/my-mkdocs/edit/master/docs/book/OnJava8/docs/book/14-Streams.md title=编辑此页 class="md-icon md-content__icon">&#xE3C9;</a> <div class=toc> <ul> <li><a href=#_1>第十四章 流式编程</a><ul> <li><a href=#_2>流支持</a></li> <li><a href=#_3>流创建</a><ul> <li><a href=#_4>随机数流</a></li> <li><a href=#int>int 类型的范围</a></li> <li><a href=#generate>generate()</a></li> <li><a href=#iterate>iterate()</a></li> <li><a href=#_5>流的建造者模式</a></li> <li><a href=#arrays>Arrays</a></li> <li><a href=#_6>正则表达式</a></li> </ul> </li> <li><a href=#_7>中间操作</a><ul> <li><a href=#_8>跟踪和调试</a></li> <li><a href=#_9>流元素排序</a></li> <li><a href=#_10>移除元素</a></li> <li><a href=#_11>应用函数到元素</a></li> <li><a href=#map>在 map() 中组合流</a></li> </ul> </li> <li><a href=#optional>Optional类</a><ul> <li><a href=#_12>便利函数</a></li> <li><a href=#optional_1>创建 Optional</a></li> <li><a href=#optional_2>Optional 对象操作</a></li> <li><a href=#optional_3>Optional 流</a></li> </ul> </li> <li><a href=#_13>终端操作</a><ul> <li><a href=#_14>数组</a></li> <li><a href=#_15>循环</a></li> <li><a href=#_16>集合</a></li> <li><a href=#_17>组合</a></li> <li><a href=#_18>匹配</a></li> <li><a href=#_19>查找</a></li> <li><a href=#_20>信息</a></li> <li><a href=#_21>数字流信息</a></li> </ul> </li> <li><a href=#_22>本章小结</a></li> </ul> </li> </ul> </div> <!-- Streams --> <h1 id=_1>第十四章 流式编程<a class=headerlink href=#_1 title="Permanent link">#</a></h1> <blockquote> <p>集合优化了对象的存储，而流和对象的处理有关。</p> </blockquote> <p>流是一系列与特定存储机制无关的元素——实际上，流并没有“存储”之说。</p> <p>使用流，无需迭代集合中的元素，就可以从管道提取和操作元素。这些管道通常被组合在一起，形成一系列对流进行操作的管道。</p> <p>在大多数情况下，将对象存储在集合中是为了处理他们，因此你将会发现你将把编程的主要焦点从集合转移到了流上。流的一个核心好处是，它使得程序更加短小并且更易理解。当 Lambda 表达式和方法引用（method references）和流一起使用的时候会让人感觉自成一体。流使得 Java 8 更具吸引力。</p> <p>举个例子，假如你要随机展示 5 至 20 之间不重复的整数并进行排序。实际上，你的关注点首先是创建一个有序集合。围绕这个集合进行后续的操作。但是使用流式编程，你就可以简单陈述你想做什么：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Randoms.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Randoms</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>)</span>
            <span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>5</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
            <span class=p>.</span><span class=na>distinct</span><span class=p>()</span>
            <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
            <span class=p>.</span><span class=na>sorted</span><span class=p>()</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>6
10
13
16
17
18
19
</code></pre></div> <p>首先，我们给 <strong>Random</strong> 对象一个种子（以便程序再次运行时产生相同的输出）。<code>ints()</code> 方法产生一个流并且 <code>ints()</code> 方法有多种方式的重载 — 两个参数限定了产生的数值的边界。这将生成一个随机整数流。我们用中间流操作（intermediate stream operation） <code>distinct()</code> 使流中的整数不重复，然后使用 <code>limit()</code> 方法获取前 7 个元素。接下来使用 <code>sorted()</code> 方法排序。最终使用 <code>forEach()</code> 方法遍历输出，它根据传递给它的函数对流中的每个对象执行操作。在这里，我们传递了一个可以在控制台显示每个元素的方法引用：<code>System.out::println</code> 。</p> <p>注意 <code>Randoms.java</code> 中没有声明任何变量。流可以在不使用赋值或可变数据的情况下对有状态的系统建模，这非常有用。</p> <p>声明式编程（Declarative programming）是一种编程风格，它声明想要做什么，而非指明如何做。正如我们在函数式编程中所看到的。你会发现命令式编程的形式更难以理解。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/ImperativeRandoms.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ImperativeRandoms</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
        <span class=n>SortedSet</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>rints</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=k>while</span><span class=p>(</span><span class=n>rints</span><span class=p>.</span><span class=na>size</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>)</span> <span class=p>{</span>
            <span class=kt>int</span> <span class=n>r</span> <span class=o>=</span> <span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>r</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>)</span> <span class=k>continue</span><span class=p>;</span>
            <span class=n>rints</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>r</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rints</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>[7, 8, 9, 11, 13, 15, 18]
</code></pre></div> <p>在 <code>Randoms.java</code> 中，我们无需定义任何变量，但在这里我们定义了 3 个变量： <code>rand</code>，<code>rints</code> 和 <code>r</code>。由于 <code>nextInt()</code> 方法没有下限的原因（其内置的下限永远为 0），这段代码实现起来更复杂。所以我们要生成额外的值来过滤小于 5 的结果。</p> <p>注意，你必须用力的研究才能弄明白<code>ImperativeRandoms.java</code>程序在干什么。而在 <code>Randoms.java</code> 中，代码直接告诉了你它正在做什么。这种语义的清晰性是使用Java 8 流式编程的重要原因之一。</p> <p>像在 <code>ImperativeRandoms.java</code> 中那样显式地编写迭代过程的方式称为外部迭代。而在 <code>Randoms.java</code> 中，你看不到任何上述的迭代过程，所以它被称为内部迭代，这是流式编程的一个核心特征。内部迭代产生的代码可读性更强，而且能更简单的使用多核处理器。通过放弃对迭代过程的控制，可以把控制权交给并行化机制。我们将在<a href=../24-Concurrent-Programming/ >并发编程</a>一章中学习这部分内容。</p> <p>另一个重要方面，流是懒加载的。这代表着它只在绝对必要时才计算。你可以将流看作“延迟列表”。由于计算延迟，流使我们能够表示非常大（甚至无限）的序列，而不需要考虑内存问题。</p> <!-- Java 8 Stream Support --> <h2 id=_2>流支持<a class=headerlink href=#_2 title="Permanent link">#</a></h2> <p>Java 设计者面临着这样一个难题：现存的大量类库不仅为 Java 所用，同时也被应用在整个 Java 生态圈数百万行的代码中。如何将一个全新的流的概念融入到现有类库中呢？</p> <p>比如在 <strong>Random</strong> 中添加更多的方法。只要不改变原有的方法，现有代码就不会受到干扰。</p> <p>一个大的挑战来自于使用接口的库。集合类是其中关键的一部分，因为你想把集合转为流。但是如果你将一个新方法添加到接口，那就破坏了每一个实现接口的类，因为这些类都没有实现你添加的新方法。</p> <p>Java 8 采用的解决方案是：在<a href=../10-Interfaces/ >接口</a>中添加被 <code>default</code>（<code>默认</code>）修饰的方法。通过这种方案，设计者们可以将流式（<em>stream</em>）方法平滑地嵌入到现有类中。流方法预置的操作几乎已满足了我们平常所有的需求。流操作的类型有三种：创建流，修改流元素（中间操作， Intermediate Operations），消费流元素（终端操作， Terminal Operations）。最后一种类型通常意味着收集流元素（通常是到集合中）。</p> <p>下面我们来看下每种类型的流操作。</p> <!-- Stream Creation --> <h2 id=_3>流创建<a class=headerlink href=#_3 title="Permanent link">#</a></h2> <p>你可以通过 <code>Stream.of()</code> 很容易地将一组元素转化成为流（<code>Bubble</code> 类在本章的后面定义）：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/StreamOf.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOf</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;It&#39;s &quot;</span><span class=p>,</span> <span class=s>&quot;a &quot;</span><span class=p>,</span> <span class=s>&quot;wonderful &quot;</span><span class=p>,</span> <span class=s>&quot;day &quot;</span><span class=p>,</span> <span class=s>&quot;for &quot;</span><span class=p>,</span> <span class=s>&quot;pie!&quot;</span><span class=p>)</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mf>3.14159</span><span class=p>,</span> <span class=mf>2.718</span><span class=p>,</span> <span class=mf>1.618</span><span class=p>)</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Bubble(1)
Bubble(2)
Bubble(3)
It&#39;s a wonderful day for pie!
3.14159
2.718
1.618
</code></pre></div> <p>除此之外，每个集合都可以通过调用 <code>stream()</code> 方法来产生一个流。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/CollectionToStream.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CollectionToStream</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Bubble</span><span class=o>&gt;</span> <span class=n>bubbles</span> <span class=o>=</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span> <span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=mi>3</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bubbles</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
            <span class=p>.</span><span class=na>mapToInt</span><span class=p>(</span><span class=n>b</span> <span class=o>-&gt;</span> <span class=n>b</span><span class=p>.</span><span class=na>i</span><span class=p>)</span>
            <span class=p>.</span><span class=na>sum</span><span class=p>());</span>

        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>w</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=s>&quot;It&#39;s a wonderful day for pie!&quot;</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>)));</span>
        <span class=n>w</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
         <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>x</span> <span class=o>-&gt;</span> <span class=n>x</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
         <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>

        <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Double</span><span class=o>&gt;</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>m</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;pi&quot;</span><span class=p>,</span> <span class=mf>3.14159</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;e&quot;</span><span class=p>,</span> <span class=mf>2.718</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;phi&quot;</span><span class=p>,</span> <span class=mf>1.618</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>entrySet</span><span class=p>().</span><span class=na>stream</span><span class=p>()</span>
                    <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>e</span> <span class=o>-&gt;</span> <span class=n>e</span><span class=p>.</span><span class=na>getKey</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>e</span><span class=p>.</span><span class=na>getValue</span><span class=p>())</span>
                    <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>6
a pie! It&#39;s for wonderful day
phi: 1.618
e: 2.718
pi: 3.14159
</code></pre></div> <p>在创建 <code>List&lt;Bubble&gt;</code> 对象之后，我们只需要简单地调用所有集合中都有的 <code>stream()</code>。中间操作 <code>map()</code> 会获取流中的所有元素，并且对流中元素应用操作从而产生新的元素，并将其传递到后续的流中。通常 <code>map()</code> 会获取对象并产生新的对象，但在这里产生了特殊的用于数值类型的流。例如，<code>mapToInt()</code> 方法将一个对象流（object stream）转换成为包含整型数字的 <code>IntStream</code>。同样，针对 <code>Float</code> 和 <code>Double</code> 也有类似名字的操作。</p> <p>我们通过调用字符串的 <code>split()</code>（该方法会根据参数来拆分字符串）来获取元素用于定义变量 <code>w</code>。稍后你会知道 <code>split()</code> 参数可以是十分复杂，但在这里我们只是根据空格来分割字符串。</p> <p>为了从 <strong>Map</strong> 集合中产生流数据，我们首先调用 <code>entrySet()</code> 产生一个对象流，每个对象都包含一个 <code>key</code> 键以及与其相关联的 <code>value</code> 值。然后分别调用 <code>getKey()</code> 和 <code>getValue()</code> 获取值。</p> <h3 id=_4>随机数流<a class=headerlink href=#_4 title="Permanent link">#</a></h3> <p><code>Random</code> 类被一组生成流的方法增强了。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/RandomGenerators.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomGenerators</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=nf>show</span><span class=p>(</span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>stream</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>stream</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;++++++++&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>().</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>longs</span><span class=p>().</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>doubles</span><span class=p>().</span><span class=na>boxed</span><span class=p>());</span>
        <span class=c1>// 控制上限和下限：</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>longs</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>100</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>doubles</span><span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>30</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=c1>// 控制流大小：</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>2</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>longs</span><span class=p>(</span><span class=mi>2</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>doubles</span><span class=p>(</span><span class=mi>2</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=c1>// 控制流的大小和界限</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>9</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>longs</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>22</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
        <span class=n>show</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>doubles</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mf>11.5</span><span class=p>,</span> <span class=mf>12.3</span><span class=p>).</span><span class=na>boxed</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>-1172028779
1717241110
-2014573909
229403722
++++++++
2955289354441303771
3476817843704654257
-8917117694134521474
4941259272818818752
++++++++
0.2613610344283964
0.0508673570556899
0.8037155449603999
0.7620665811558285
++++++++
16
10
11
12
++++++++
65
99
54
58
++++++++
29.86777681078574
24.83968447804611
20.09247112332014
24.046793846338723
++++++++
1169976606
1947946283
++++++++
2970202997824602425
-2325326920272830366
++++++++
0.7024254510631527
0.6648552384607359
++++++++
6
7
7
++++++++
17
12
20
++++++++
12.27872414236691
11.732085449736195
12.196509449817267
++++++++
</code></pre></div> <p>为了消除冗余代码，我创建了一个泛型方法 <code>show(Stream&lt;T&gt; stream)</code> （在讲解泛型之前就使用这个特性，确实有点作弊，但是回报是值得的）。类型参数 <code>T</code> 可以是任何类型，所以这个方法对 <strong>Integer</strong>、<strong>Long</strong> 和 <strong>Double</strong> 类型都生效。但是 <strong>Random</strong> 类只能生成基本类型 <strong>int</strong>， <strong>long</strong>， <strong>double</strong> 的流。幸运的是， <code>boxed()</code> 流操作将会自动地把基本类型包装成为对应的装箱类型，从而使得 <code>show()</code> 能够接受流。</p> <p>我们可以使用 <strong>Random</strong> 为任意对象集合创建 <strong>Supplier</strong>。如下是一个文本文件提供字符串对象的例子。</p> <p>Cheese.dat 文件内容：</p> <div class=highlight><pre><span></span><code>// streams/Cheese.dat
Not much of a cheese shop really, is it?
Finest in the district, sir.
And what leads you to that conclusion?
Well, it&#39;s so clean.
It&#39;s certainly uncontaminated by cheese.
</code></pre></div> <p>我们通过 <strong>File</strong> 类将 Cheese.dat 文件的所有行读取到 <code>List&lt;String&gt;</code> 中。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/RandomWords.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomWords</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=n>RandomWords</span><span class=p>(</span><span class=n>String</span> <span class=n>fname</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>lines</span> <span class=o>=</span> <span class=n>Files</span><span class=p>.</span><span class=na>readAllLines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>fname</span><span class=p>));</span>
        <span class=c1>// 略过第一行</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>line</span> <span class=p>:</span> <span class=n>lines</span><span class=p>.</span><span class=na>subList</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>lines</span><span class=p>.</span><span class=na>size</span><span class=p>()))</span> <span class=p>{</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>word</span> <span class=p>:</span> <span class=n>line</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;[ .?,]+&quot;</span><span class=p>))</span>
                <span class=n>words</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>word</span><span class=p>.</span><span class=na>toLowerCase</span><span class=p>());</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>words</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>words</span><span class=p>.</span><span class=na>size</span><span class=p>()));</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>words</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
            <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
            <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=k>new</span> <span class=n>RandomWords</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>))</span>
                <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
                <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>)));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>it shop sir the much cheese by conclusion district is
</code></pre></div> <p>在这里可以看到 <code>split()</code> 更复杂的运用。在构造器里，每一行都被 <code>split()</code> 通过方括号内的空格或其它标点符号分割。在方括号后面的 <code>+</code> 表示 <code>+</code> 前面的东西可以出现一次或者多次。</p> <p>你会发现构造函数使用命令式编程（外部迭代）进行循环。在以后的例子中，你会看到我们是如何去除命令式编程的使用。这种旧的形式虽不是特别糟糕，但使用流会让人感觉更好。</p> <p>在<code>toString()</code> 和<code>main()</code>方法中你看到了 <code>collect()</code> 操作，它根据参数来结合所有的流元素。当你用 <code>Collectors.joining()</code>作为 <code>collect()</code> 的参数时，将得到一个<code>String</code> 类型的结果，该结果是流中的所有元素被<code>joining()</code>的参数隔开。还有很多不同的 <code>Collectors</code> 用于产生不同的结果。</p> <p>在主方法中，我们提前看到了 <strong>Stream.</strong><code>generate()</code> 的用法，它可以把任意 <code>Supplier&lt;T&gt;</code> 用于生成 <code>T</code> 类型的流。</p> <h3 id=int>int 类型的范围<a class=headerlink href=#int title="Permanent link">#</a></h3> <p><code>IntStream</code> 类提供了 <code>range()</code> 方法用于生成整型序列的流。编写循环时，这个方法会更加便利：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Ranges.java</span>
<span class=kn>import static</span> <span class=nn>java.util.stream.IntStream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Ranges</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 传统方法:</span>
        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>result</span> <span class=o>+=</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
        <span class=c1>// for-in 循环:</span>
        <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=p>:</span> <span class=n>range</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>).</span><span class=na>toArray</span><span class=p>())</span>
            <span class=n>result</span> <span class=o>+=</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>result</span><span class=p>);</span>
        <span class=c1>// 使用流:</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>range</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>).</span><span class=na>sum</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>145
145
145
</code></pre></div> <p>在主方法中的第一种方式是我们传统编写 <code>for</code> 循环的方式；第二种方式，我们使用 <code>range()</code> 创建了流并将其转化为数组，然后在 <code>for-in</code> 代码块中使用。但是，如果你能像第三种方法那样全程使用流是更好的。我们对范围中的数字进行求和。在流中可以很方便的使用 <code>sum()</code> 操作求和。</p> <p>注意 <strong>IntStream.</strong><code>range()</code> 相比 <code>onjava.Range.range()</code> 拥有更多的限制。这是由于其可选的第三个参数，后者允许步长大于 1，并且可以从大到小来生成。</p> <p>实用小功能 <code>repeat()</code> 可以用来替换简单的 <code>for</code> 循环。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/Repeat.java</span>
<span class=kn>package</span> <span class=nn>onjava</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>java.util.stream.IntStream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Repeat</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>repeat</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=n>Runnable</span> <span class=n>action</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=p>).</span><span class=na>forEach</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>action</span><span class=p>.</span><span class=na>run</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>其产生的循环更加清晰：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Looping.java</span>
<span class=kn>import static</span> <span class=nn>onjava.Repeat.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Looping</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>hi</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Hi!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>repeat</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Looping!&quot;</span><span class=p>));</span>
        <span class=n>repeat</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>Looping</span><span class=p>::</span><span class=n>hi</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Looping!
Looping!
Looping!
Hi!
Hi!
</code></pre></div> <p>原则上，在代码中包含并解释 <code>repeat()</code> 并不值得。诚然它是一个相当透明的工具，但结果取决于你的团队和公司的运作方式。</p> <h3 id=generate>generate()<a class=headerlink href=#generate title="Permanent link">#</a></h3> <p>参照 <code>RandomWords.java</code> 中 <strong>Stream.</strong><code>generate()</code> 搭配 <code>Supplier&lt;T&gt;</code> 使用的例子。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Generator.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Generator</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kt>char</span><span class=o>[]</span> <span class=n>letters</span> <span class=o>=</span> <span class=s>&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><span class=p>.</span><span class=na>toCharArray</span><span class=p>();</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;&quot;</span> <span class=o>+</span> <span class=n>letters</span><span class=o>[</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>letters</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>word</span> <span class=o>=</span> <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=k>new</span> <span class=n>Generator</span><span class=p>())</span>
                            <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>word</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>YNZBRNYGCFOWZNTCQRGSEGZMMJMROE
</code></pre></div> <p>使用 <code>Random.nextInt()</code> 方法来挑选字母表中的大写字母。<code>Random.nextInt()</code> 的参数代表可以接受的最大的随机数范围，所以使用数组边界是经过深思熟虑的。</p> <p>如果要创建包含相同对象的流，只需要传递一个生成那些对象的 <code>lambda</code> 到 <code>generate()</code> 中：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Duplicator.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Duplicator</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(()</span> <span class=o>-&gt;</span> <span class=s>&quot;duplicate&quot;</span><span class=p>)</span>
              <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
              <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>duplicate
duplicate
duplicate
</code></pre></div> <p>如下是在本章之前例子中使用过的 <code>Bubble</code> 类。<strong>注意</strong>它包含了自己的静态生成器（Static generator）方法。</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Bubble.java</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Bubble</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>

    <span class=kd>public</span> <span class=nf>Bubble</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>i</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Bubble(&quot;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>count</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Bubble</span> <span class=nf>bubbler</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>Bubble</span><span class=p>(</span><span class=n>count</span><span class=o>++</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>由于 <code>bubbler()</code> 与 <code>Supplier&lt;Bubble&gt;</code> 是接口兼容的，我们可以将其方法引用直接传递给 <strong>Stream.</strong><code>generate()</code>：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Bubbles.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Bubbles</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>Bubble</span><span class=p>::</span><span class=n>bubbler</span><span class=p>)</span>
              <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>5</span><span class=p>)</span>
              <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Bubble(0)
Bubble(1)
Bubble(2)
Bubble(3)
Bubble(4)
</code></pre></div> <p>这是创建单独工厂类（Separate Factory class）的另一种方式。在很多方面它更加整洁，但是这是一个对于代码组织和品味的问题——你总是可以创建一个完全不同的工厂类。</p> <h3 id=iterate>iterate()<a class=headerlink href=#iterate title="Permanent link">#</a></h3> <p><code>Stream.iterate()</code> 产生的流的第一个元素是种子（iterate方法的第一个参数），然后将种子传递给方法（iterate方法的第二个参数）。方法运行的结果被添加到流（作为流的第二个元素），并存储起来作为下次调用 <code>iterate()</code>时的第一个参数，以此类推。我们可以利用 <code>iterate()</code> 生成一个斐波那契数列。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Fibonacci.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Fibonacci</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=n>x</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>

    <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=nf>numbers</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Stream</span><span class=p>.</span><span class=na>iterate</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span> <span class=o>-&gt;</span> <span class=p>{</span>
            <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>x</span> <span class=o>+</span> <span class=n>i</span><span class=p>;</span>
            <span class=n>x</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
            <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
        <span class=p>});</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>new</span> <span class=n>Fibonacci</span><span class=p>().</span><span class=na>numbers</span><span class=p>()</span>
                       <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span> <span class=c1>// 过滤前 20 个</span>
                       <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span> <span class=c1>// 然后取 10 个</span>
                       <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>6765
10946
17711
28657
46368
75025
121393
196418
317811
514229
</code></pre></div> <p>斐波那契数列将数列中最后两个元素进行求和以产生下一个元素。<code>iterate()</code> 只能记忆结果，因此我们需要利用一个变量 <code>x</code> 追踪另外一个元素。</p> <p>在主方法中，我们使用了一个之前没有见过的 <code>skip()</code> 操作。它根据参数丢弃指定数量的流元素。在这里，我们丢弃了前 20 个元素。</p> <h3 id=_5>流的建造者模式<a class=headerlink href=#_5 title="Permanent link">#</a></h3> <p>在建造者模式（Builder design pattern）中，首先创建一个 <code>builder</code> 对象，然后将创建流所需的多个信息传递给它，最后<code>builder</code> 对象执行”创建“流的操作。<strong>Stream</strong> 库提供了这样的 <code>Builder</code>。在这里，我们重新审视文件读取并将其转换成为单词流的过程。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FileToWordsBuilder.java</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsBuilder</span> <span class=p>{</span>
    <span class=n>Stream</span><span class=p>.</span><span class=na>Builder</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>Stream</span><span class=p>.</span><span class=na>builder</span><span class=p>();</span>

    <span class=kd>public</span> <span class=nf>FileToWordsBuilder</span><span class=p>(</span><span class=n>String</span> <span class=n>filePath</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>Files</span><span class=p>.</span><span class=na>lines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>filePath</span><span class=p>))</span>
             <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// 略过开头的注释行</span>
             <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>line</span> <span class=o>-&gt;</span> <span class=p>{</span>
                  <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>w</span> <span class=p>:</span> <span class=n>line</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;[ .?,]+&quot;</span><span class=p>))</span>
                      <span class=n>builder</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>w</span><span class=p>);</span>
              <span class=p>});</span>
    <span class=p>}</span>

    <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=na>build</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=k>new</span> <span class=n>FileToWordsBuilder</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
            <span class=p>.</span><span class=na>stream</span><span class=p>()</span>
            <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
            <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Not much of a cheese shop really
</code></pre></div> <p><strong>注意</strong>，构造器会添加文件中的所有单词（除了第一行，它是包含文件路径信息的注释），但是其并没有调用 <code>build()</code>。只要你不调用 <code>stream()</code> 方法，就可以继续向 <code>builder</code> 对象中添加单词。</p> <p>在该类的更完整形式中，你可以添加一个标志位用于查看 <code>build()</code> 是否被调用，并且可能的话增加一个可以添加更多单词的方法。在 <code>Stream.Builder</code> 调用 <code>build()</code> 方法后继续尝试添加单词会产生一个异常。</p> <h3 id=arrays>Arrays<a class=headerlink href=#arrays title="Permanent link">#</a></h3> <p><code>Arrays</code> 类中含有一个名为 <code>stream()</code> 的静态方法用于把数组转换成为流。我们可以重写 <code>interfaces/Machine.java</code> 中的主方法用于创建一个流，并将 <code>execute()</code> 应用于每一个元素。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Machine2.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.Operations</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Machine2</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=k>new</span> <span class=n>Operations</span><span class=o>[]</span> <span class=p>{</span>
            <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=p>.</span><span class=na>show</span><span class=p>(</span><span class=s>&quot;Bing&quot;</span><span class=p>),</span>
            <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=p>.</span><span class=na>show</span><span class=p>(</span><span class=s>&quot;Crack&quot;</span><span class=p>),</span>
            <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=p>.</span><span class=na>show</span><span class=p>(</span><span class=s>&quot;Twist&quot;</span><span class=p>),</span>
            <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>Operations</span><span class=p>.</span><span class=na>show</span><span class=p>(</span><span class=s>&quot;Pop&quot;</span><span class=p>)</span>
        <span class=p>}).</span><span class=na>forEach</span><span class=p>(</span><span class=n>Operations</span><span class=p>::</span><span class=n>execute</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Bing
Crack
Twist
Pop
</code></pre></div> <p><code>new Operations[]</code> 表达式动态创建了 <code>Operations</code> 对象的数组。</p> <p><code>stream()</code> 同样可以产生 <strong>IntStream</strong>，<strong>LongStream</strong> 和 <strong>DoubleStream</strong>。</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/ArrayStreams.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ArrayStreams</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=k>new</span> <span class=kt>double</span><span class=o>[]</span> <span class=p>{</span> <span class=mf>3.14159</span><span class=p>,</span> <span class=mf>2.718</span><span class=p>,</span> <span class=mf>1.618</span> <span class=p>})</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%f &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>

        <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span> <span class=p>})</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>

        <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=k>new</span> <span class=kt>long</span><span class=o>[]</span> <span class=p>{</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>22</span><span class=p>,</span> <span class=mi>44</span><span class=p>,</span> <span class=mi>66</span> <span class=p>})</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>

        <span class=c1>// 选择一个子域:</span>
        <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>15</span><span class=p>,</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>37</span> <span class=p>},</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>6</span><span class=p>)</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>3.141590 2.718000 1.618000
1 3 5
11 22 44 66
7 15 28
</code></pre></div> <p>最后一次 <code>stream()</code> 的调用有两个额外的参数。第一个参数告诉 <code>stream()</code> 从数组的哪个位置开始选择元素，第二个参数用于告知在哪里停止。每种不同类型的 <code>stream()</code> 都有类似的操作。</p> <h3 id=_6>正则表达式<a class=headerlink href=#_6 title="Permanent link">#</a></h3> <p>Java 的正则表达式将在<a href=../18-Strings/ >字符串</a>这一章节详细介绍。Java 8 在 <code>java.util.regex.Pattern</code> 中增加了一个新的方法 <code>splitAsStream()</code>。这个方法可以根据传入的公式将字符序列转化为流。但是有一个限制，输入只能是 <strong>CharSequence</strong>，因此不能将流作为 <code>splitAsStream()</code> 的参数。</p> <p>我们再一次查看将文件转换为单词的过程。这一次，我们使用流将文件转换为一个字符串，接着使用正则表达式将字符串转化为单词流。</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FileToWordsRegexp.java</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.regex.Pattern</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsRegexp</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>all</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>FileToWordsRegexp</span><span class=p>(</span><span class=n>String</span> <span class=n>filePath</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>all</span> <span class=o>=</span> <span class=n>Files</span><span class=p>.</span><span class=na>lines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>filePath</span><span class=p>))</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// First (comment) line</span>
        <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Pattern</span>
        <span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=s>&quot;[ .,?]+&quot;</span><span class=p>).</span><span class=na>splitAsStream</span><span class=p>(</span><span class=n>all</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>FileToWordsRegexp</span> <span class=n>fw</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileToWordsRegexp</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>);</span>
        <span class=n>fw</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
          <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
          <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
          <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
        <span class=n>fw</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
          <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
          <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
          <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
          <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Not much of a cheese shop really is it
</code></pre></div> <p>在构造器中我们读取了文件中的所有内容（跳过第一行注释，并将其转化成为单行字符串）。现在，当你调用 <code>stream()</code> 的时候，可以像往常一样获取一个流，但这次你可以多次调用 <code>stream()</code> 在已存储的字符串中创建一个新的流。这里有个限制，整个文件必须存储在内存中；在大多数情况下这并不是什么问题，但是这损失了流操作非常重要的优势：</p> <ol> <li>“不需要把流存储起来。”当然，流确实需要一些内部存储，但存储的只是序列的一小部分，和存储整个序列不同。</li> <li>它们是懒加载计算的。</li> </ol> <p>幸运的是，我们稍后就会知道如何解决这个问题。</p> <!-- Intermediate Operations --> <h2 id=_7>中间操作<a class=headerlink href=#_7 title="Permanent link">#</a></h2> <p>中间操作用于从一个流中获取对象，并将对象作为另一个流从后端输出，以连接到其他操作。</p> <h3 id=_8>跟踪和调试<a class=headerlink href=#_8 title="Permanent link">#</a></h3> <p><code>peek()</code> 操作的目的是帮助调试。它允许你无修改地查看流中的元素。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Peeking.java</span>
<span class=kd>class</span> <span class=nc>Peeking</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>21</span><span class=p>)</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>4</span><span class=p>)</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>peek</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>)</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>String</span><span class=p>::</span><span class=n>toUpperCase</span><span class=p>)</span>
        <span class=p>.</span><span class=na>peek</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>)</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>String</span><span class=p>::</span><span class=n>toLowerCase</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Well WELL well it IT it s S s so SO so
</code></pre></div> <p><code>FileToWords</code> 稍后定义，但它的功能实现貌似和之前我们看到的差不多：产生字符串对象的流。之后在其通过管道时调用 <code>peek()</code> 进行处理。</p> <p>因为 <code>peek()</code> 符合无返回值的 <strong>Consumer</strong> 函数式接口，所以我们只能观察，无法使用不同的元素来替换流中的对象。</p> <h3 id=_9>流元素排序<a class=headerlink href=#_9 title="Permanent link">#</a></h3> <p>在 <code>Randoms.java</code> 中，我们熟识了 <code>sorted()</code> 的默认比较器实现。其实它还有另一种形式的实现：传入一个 <strong>Comparator</strong> 参数。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/SortedComparator.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SortedComparator</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
        <span class=p>.</span><span class=na>sorted</span><span class=p>(</span><span class=n>Comparator</span><span class=p>.</span><span class=na>reverseOrder</span><span class=p>())</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>w</span> <span class=o>-&gt;</span> <span class=n>w</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>print</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>you what to the that sir leads in district And
</code></pre></div> <p><code>sorted()</code> 预设了一些默认的比较器。这里我们使用的是反转“自然排序”。当然你也可以把 Lambda 函数作为参数传递给 <code>sorted()</code>。</p> <h3 id=_10>移除元素<a class=headerlink href=#_10 title="Permanent link">#</a></h3> <ul> <li> <p><code>distinct()</code>：在 <code>Randoms.java</code> 类中的 <code>distinct()</code> 可用于消除流中的重复元素。相比创建一个 <strong>Set</strong> 集合，该方法的工作量要少得多。</p> </li> <li> <p><code>filter(Predicate)</code>：若元素传递给过滤函数产生的结果为<code>true</code> ，则过滤操作保留这些元素。</p> </li> </ul> <p>在下例中，<code>isPrime()</code> 作为过滤器函数，用于检测质数。</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Prime.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>java.util.stream.LongStream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Prime</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Boolean</span> <span class=nf>isPrime</span><span class=p>(</span><span class=kt>long</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rangeClosed</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=p>(</span><span class=kt>long</span><span class=p>)</span><span class=n>Math</span><span class=p>.</span><span class=na>sqrt</span><span class=p>(</span><span class=n>n</span><span class=p>))</span>
        <span class=p>.</span><span class=na>noneMatch</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>n</span> <span class=o>%</span> <span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>LongStream</span> <span class=nf>numbers</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>iterate</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>i</span> <span class=o>-&gt;</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span>
        <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>Prime</span><span class=p>::</span><span class=n>isPrime</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>new</span> <span class=n>Prime</span><span class=p>().</span><span class=na>numbers</span><span class=p>()</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=k>new</span> <span class=n>Prime</span><span class=p>().</span><span class=na>numbers</span><span class=p>()</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>90</span><span class=p>)</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>2 3 5 7 11 13 17 19 23 29
467 479 487 491 499 503 509 521 523 541
</code></pre></div> <p><code>rangeClosed()</code> 包含了上限值。如果不能整除，即余数不等于 0，则 <code>noneMatch()</code> 操作返回 <code>true</code>，如果出现任何等于 0 的结果则返回 <code>false</code>。 <code>noneMatch()</code> 操作一旦有失败就会退出。</p> <h3 id=_11>应用函数到元素<a class=headerlink href=#_11 title="Permanent link">#</a></h3> <ul> <li> <p><code>map(Function)</code>：将函数操作应用在输入流的元素中，并将返回值传递到输出流中。</p> </li> <li> <p><code>mapToInt(ToIntFunction)</code>：操作同上，但结果是 <strong>IntStream</strong>。</p> </li> <li> <p><code>mapToLong(ToLongFunction)</code>：操作同上，但结果是 <strong>LongStream</strong>。</p> </li> <li> <p><code>mapToDouble(ToDoubleFunction)</code>：操作同上，但结果是 <strong>DoubleStream</strong>。</p> </li> </ul> <p>在这里，我们使用 <code>map()</code> 映射多种函数到一个字符串流中。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FunctionMap.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>FunctionMap</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span> <span class=s>&quot;12&quot;</span><span class=p>,</span> <span class=s>&quot;&quot;</span><span class=p>,</span> <span class=s>&quot;23&quot;</span><span class=p>,</span> <span class=s>&quot;45&quot;</span> <span class=p>};</span>
    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span>
    <span class=nf>testStream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>elements</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>descr</span><span class=p>,</span> <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>func</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; ---( &quot;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&quot; )---&quot;</span><span class=p>);</span>
        <span class=n>testStream</span><span class=p>()</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>func</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;add brackets&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=s>&quot;[&quot;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&quot;]&quot;</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Increment&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=k>catch</span><span class=p>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Replace&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>replace</span><span class=p>(</span><span class=s>&quot;2&quot;</span><span class=p>,</span> <span class=s>&quot;9&quot;</span><span class=p>));</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Take last digit&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
        <span class=n>s</span><span class=p>.</span><span class=na>charAt</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot;&quot;</span> <span class=p>:</span> <span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>---( add brackets )---
[12]
[]
[23]
[45]
---( Increment )---
13
24
46
---( Replace )---
19
93
45
---( Take last digit )---
2
3
5
</code></pre></div> <p>在上面的自增示例中，我们用 <code>Integer.parseInt()</code> 尝试将一个字符串转化为整数。如果字符串不能被转化成为整数就会抛出 <code>NumberFormatException</code> 异常，此时我们就回过头来把原始字符串放到输出流中。</p> <p>在以上例子中，<code>map()</code> 将一个字符串映射为另一个字符串，但是我们完全可以产生和接收类型完全不同的类型，从而改变流的数据类型。下面代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FunctionMap2.java</span>
<span class=c1>// Different input and output types （不同的输入输出类型）</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Numbered</span> <span class=p>{</span>
    <span class=kd>final</span> <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
    <span class=n>Numbered</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>n</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Numbered(&quot;</span> <span class=o>+</span> <span class=n>n</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>class</span> <span class=nc>FunctionMap2</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>13</span><span class=p>)</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>Numbered</span><span class=p>::</span><span class=k>new</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Numbered(1)
Numbered(5)
Numbered(7)
Numbered(9)
Numbered(11)
Numbered(13)
</code></pre></div> <p>我们将获取到的整数通过构造器 <code>Numbered::new</code> 转化成为 <code>Numbered</code> 类型。</p> <p>如果使用 <strong>Function</strong> 返回的结果是数值类型的一种，我们必须使用合适的 <code>mapTo数值类型</code> 进行替代。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FunctionMap3.java</span>
<span class=c1>// Producing numeric output streams（ 产生数值输出流）</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>FunctionMap3</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;5&quot;</span><span class=p>,</span> <span class=s>&quot;7&quot;</span><span class=p>,</span> <span class=s>&quot;9&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>mapToInt</span><span class=p>(</span><span class=n>Integer</span><span class=p>::</span><span class=n>parseInt</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;17&quot;</span><span class=p>,</span> <span class=s>&quot;19&quot;</span><span class=p>,</span> <span class=s>&quot;23&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>mapToLong</span><span class=p>(</span><span class=n>Long</span><span class=p>::</span><span class=n>parseLong</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;17&quot;</span><span class=p>,</span> <span class=s>&quot;1.9&quot;</span><span class=p>,</span> <span class=s>&quot;.23&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>mapToDouble</span><span class=p>(</span><span class=n>Double</span><span class=p>::</span><span class=n>parseDouble</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%f &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>5 7 9
17 19 23
17.000000 1.900000 0.230000
</code></pre></div> <p>遗憾的是，Java 设计者并没有尽最大努力去消除基本类型。</p> <h3 id=map>在 <code>map()</code> 中组合流<a class=headerlink href=#map title="Permanent link">#</a></h3> <p>假设我们现在有了一个传入的元素流，并且打算对流元素使用 <code>map()</code> 函数。现在你已经找到了一些可爱并独一无二的函数功能，但是问题来了：这个函数功能是产生一个流。我们想要产生一个元素流，而实际却产生了一个元素流的流。</p> <p><code>flatMap()</code> 做了两件事：将产生流的函数应用在每个元素上（与 <code>map()</code> 所做的相同），然后将每个流都扁平化为元素，因而最终产生的仅仅是元素。</p> <p><code>flatMap(Function)</code>：当 <code>Function</code> 产生流时使用。</p> <p><code>flatMapToInt(Function)</code>：当 <code>Function</code> 产生 <code>IntStream</code> 时使用。</p> <p><code>flatMapToLong(Function)</code>：当 <code>Function</code> 产生 <code>LongStream</code> 时使用。</p> <p><code>flatMapToDouble(Function)</code>：当 <code>Function</code> 产生 <code>DoubleStream</code> 时使用。</p> <p>为了弄清它的工作原理，我们从传入一个刻意设计的函数给 <code>map()</code> 开始。该函数接受一个整数并产生一个字符串流：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/StreamOfStreams.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfStreams</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;Gonzo&quot;</span><span class=p>,</span> <span class=s>&quot;Kermit&quot;</span><span class=p>,</span> <span class=s>&quot;Beaker&quot;</span><span class=p>))</span>
        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>e</span><span class=o>-&gt;</span> <span class=n>e</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getName</span><span class=p>())</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>java.util.stream.ReferencePipeline$Head
java.util.stream.ReferencePipeline$Head
java.util.stream.ReferencePipeline$Head
</code></pre></div> <p>我们天真地希望能够得到字符串流，但实际得到的却是“Head”流的流。我们可以使用 <code>flatMap()</code> 解决这个问题：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FlatMap.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FlatMap</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
        <span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;Gonzo&quot;</span><span class=p>,</span> <span class=s>&quot;Fozzie&quot;</span><span class=p>,</span> <span class=s>&quot;Beaker&quot;</span><span class=p>))</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Gonzo
Fozzie
Beaker
Gonzo
Fozzie
Beaker
Gonzo
Fozzie
Beaker
</code></pre></div> <p>从映射返回的每个流都会自动扁平为组成它的字符串。</p> <p>下面是另一个演示，我们从一个整数流开始，然后使用每一个整数去创建更多的随机数。</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/StreamOfRandoms.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfRandoms</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
            <span class=p>.</span><span class=na>flatMapToInt</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=n>IntStream</span><span class=p>.</span><span class=na>concat</span><span class=p>(</span>
        <span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>100</span><span class=p>).</span><span class=na>limit</span><span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=n>IntStream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)))</span>
            <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>58 -1 55 93 -1 61 61 29 -1 68 0 22 7 -1 88 28 51 89 9 -1
</code></pre></div> <p>在这里我们引入了 <code>concat()</code>，它以参数顺序组合两个流。 如此，我们在每个随机 <code>Integer</code> 流的末尾添加一个 -1 作为标记。你可以看到最终流确实是从一组扁平流中创建的。</p> <p>因为 <code>rand.ints()</code> 产生的是一个 <code>IntStream</code>，所以我必须使用 <code>flatMap()</code>、<code>concat()</code> 和 <code>of()</code> 的特定整数形式。</p> <p>让我们再看一下将文件划分为单词流的任务。我们最后使用到的是 <strong>FileToWordsRegexp.java</strong>，它的问题是需要将整个文件读入行列表中 —— 显然需要存储该列表。而我们真正想要的是创建一个不需要中间存储层的单词流。</p> <p>下面，我们再使用 <code>flatMap()</code> 来解决这个问题：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FileToWords.java</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.regex.Pattern</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWords</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=p>(</span><span class=n>String</span> <span class=n>filePath</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Files</span><span class=p>.</span><span class=na>lines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>filePath</span><span class=p>))</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// First (comment) line</span>
        <span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>line</span> <span class=o>-&gt;</span>
        <span class=n>Pattern</span><span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=s>&quot;\\W+&quot;</span><span class=p>).</span><span class=na>splitAsStream</span><span class=p>(</span><span class=n>line</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><code>stream()</code> 现在是一个静态方法，因为它可以自己完成整个流创建过程。</p> <p>注意：<code>\\W+</code> 是一个正则表达式。表示“非单词字符”，<code>+</code> 表示“可以出现一次或者多次”。小写形式的 <code>\\w</code> 表示“单词字符”。</p> <p>我们之前遇到的问题是 <code>Pattern.compile().splitAsStream()</code> 产生的结果为流，这意味着当我们只是想要一个简单的单词流时，在传入的行流（stream of lines）上调用 <code>map()</code> 会产生一个单词流的流。幸运的是，<code>flatMap()</code> 可以将元素流的流扁平化为一个简单的元素流。或者，我们可以使用 <code>String.split()</code> 生成一个数组，其可以被 <code>Arrays.stream()</code> 转化成为流：</p> <div class=highlight><pre><span></span><code><span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>line</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>line</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;\\W+&quot;</span><span class=p>))))</span>
</code></pre></div> <p>因为有了真正的流（而不是<code>FileToWordsRegexp.java</code> 中基于集合存储的流），所以每次需要一个新的流时，我们都必须从头开始创建，因为流不能被复用：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/FileToWordsTest.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileToWordsTest</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%s &quot;</span><span class=p>,</span> <span class=n>s</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
        <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span>
        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
        <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%s &quot;</span><span class=p>,</span> <span class=n>s</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Not much of a cheese shop really
is it
</code></pre></div> <p>在 <code>System.out.format()</code> 中的 <code>%s</code> 表明参数为 <strong>String</strong> 类型。</p> <!-- Optional --> <h2 id=optional>Optional类<a class=headerlink href=#optional title="Permanent link">#</a></h2> <p>在我们学习终端操作（Terminal Operations）之前，我们必须考虑如果你在一个空流中获取元素会发生什么。我们喜欢为了“happy path”而将流连接起来，并假设流不会被中断。在流中放置 <code>null</code> 是很好的中断方法。那么是否有某种对象，可作为流元素的持有者，即使查看的元素不存在也能友好地提示我们（也就是说，不会发生异常）？</p> <p><strong>Optional</strong> 可以实现这样的功能。一些标准流操作返回 <strong>Optional</strong> 对象，因为它们并不能保证预期结果一定存在。包括：</p> <ul> <li><code>findFirst()</code> 返回一个包含第一个元素的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li> <li><code>findAny()</code> 返回包含任意元素的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li> <li><code>max()</code> 和 <code>min()</code> 返回一个包含最大值或者最小值的 <strong>Optional</strong> 对象，如果流为空则返回 <strong>Optional.empty</strong></li> </ul> <p><code>reduce()</code> 不再以 <code>identity</code> 形式开头，而是将其返回值包装在 <strong>Optional</strong> 中。（<code>identity</code> 对象成为其他形式的 <code>reduce()</code> 的默认结果，因此不存在空结果的风险）</p> <p>对于数字流 <strong>IntStream</strong>、<strong>LongStream</strong> 和 <strong>DoubleStream</strong>，<code>average()</code> 会将结果包装在 <strong>Optional</strong> 以防止流为空。</p> <p>以下是对空流进行所有这些操作的简单测试：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/OptionalsFromEmptyStreams.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>OptionalsFromEmptyStreams</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>findFirst</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>findAny</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>min</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>reduce</span><span class=p>((</span><span class=n>s1</span><span class=p>,</span> <span class=n>s2</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>s1</span> <span class=o>+</span> <span class=n>s2</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>IntStream</span><span class=p>.</span><span class=na>empty</span><span class=p>()</span>
             <span class=p>.</span><span class=na>average</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
OptionalDouble.empty
</code></pre></div> <p>当流为空的时候你会获得一个 <strong>Optional.empty</strong> 对象，而不是抛出异常。<strong>Optional</strong> 拥有 <code>toString()</code> 方法可以用于展示有用信息。</p> <p>注意，空流是通过 <code>Stream.&lt;String&gt;empty()</code> 创建的。如果你在没有任何上下文环境的情况下调用 <code>Stream.empty()</code>，Java 并不知道它的数据类型；这个语法解决了这个问题。如果编译器拥有了足够的上下文信息，比如：</p> <div class=highlight><pre><span></span><code><span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>s</span> <span class=o>=</span> <span class=n>Stream</span><span class=p>.</span><span class=na>empty</span><span class=p>();</span>
</code></pre></div> <p>就可以在调用 <code>empty()</code> 时推断类型。</p> <p>这个示例展示了 <strong>Optional</strong> 的两个基本用法：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/OptionalBasics.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>OptionalBasics</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>get</span><span class=p>());</span> 
        <span class=k>else</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Nothing inside!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;Epithets&quot;</span><span class=p>).</span><span class=na>findFirst</span><span class=p>());</span>
        <span class=n>test</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>().</span><span class=na>findFirst</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Epithets
Nothing inside!
</code></pre></div> <p>当你接收到 <strong>Optional</strong> 对象时，应首先调用 <code>isPresent()</code> 检查其中是否包含元素。如果存在，可使用 <code>get()</code> 获取。</p> <!-- Convenience Functions --> <h3 id=_12>便利函数<a class=headerlink href=#_12 title="Permanent link">#</a></h3> <p>有许多便利函数可以解包 <strong>Optional</strong> ，这简化了上述“对所包含的对象的检查和执行操作”的过程：</p> <ul> <li><code>ifPresent(Consumer)</code>：当值存在时调用 <strong>Consumer</strong>，否则什么也不做。</li> <li><code>orElse(otherObject)</code>：如果值存在则直接返回，否则生成 <strong>otherObject</strong>。</li> <li><code>orElseGet(Supplier)</code>：如果值存在则直接返回，否则使用 <strong>Supplier</strong> 函数生成一个可替代对象。</li> <li><code>orElseThrow(Supplier)</code>：如果值存在直接返回，否则使用 <strong>Supplier</strong> 函数生成一个异常。</li> </ul> <p>如下是针对不同便利函数的简单演示：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Optionals.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Optionals</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>basics</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>isPresent</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>get</span><span class=p>());</span> 
        <span class=k>else</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Nothing inside!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>ifPresent</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>optString</span><span class=p>.</span><span class=na>ifPresent</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElse</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=s>&quot;Nada&quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElseGet</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
        <span class=n>optString</span><span class=p>.</span><span class=na>orElseGet</span><span class=p>(()</span> <span class=o>-&gt;</span> <span class=s>&quot;Generated&quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>orElseThrow</span><span class=p>(</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>optString</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>optString</span><span class=p>.</span><span class=na>orElseThrow</span><span class=p>(</span>
            <span class=p>()</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Exception</span><span class=p>(</span><span class=s>&quot;Supplied&quot;</span><span class=p>)));</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Caught &quot;</span> <span class=o>+</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>testName</span><span class=p>,</span> <span class=n>Consumer</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>cos</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; === &quot;</span> <span class=o>+</span> <span class=n>testName</span> <span class=o>+</span> <span class=s>&quot; === &quot;</span><span class=p>);</span>
        <span class=n>cos</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;Epithets&quot;</span><span class=p>).</span><span class=na>findFirst</span><span class=p>());</span>
        <span class=n>cos</span><span class=p>.</span><span class=na>accept</span><span class=p>(</span><span class=n>Stream</span><span class=p>.</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=n>empty</span><span class=p>().</span><span class=na>findFirst</span><span class=p>());</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;basics&quot;</span><span class=p>,</span> <span class=n>Optionals</span><span class=p>::</span><span class=n>basics</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;ifPresent&quot;</span><span class=p>,</span> <span class=n>Optionals</span><span class=p>::</span><span class=n>ifPresent</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;orElse&quot;</span><span class=p>,</span> <span class=n>Optionals</span><span class=p>::</span><span class=n>orElse</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;orElseGet&quot;</span><span class=p>,</span> <span class=n>Optionals</span><span class=p>::</span><span class=n>orElseGet</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;orElseThrow&quot;</span><span class=p>,</span> <span class=n>Optionals</span><span class=p>::</span><span class=n>orElseThrow</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>=== basics ===
Epithets
Nothing inside!
=== ifPresent ===
Epithets
=== orElse ===
Epithets
Nada
=== orElseGet ===
Epithets
Generated
=== orElseThrow ===
Epithets
Caught java.lang.Exception: Supplied
</code></pre></div> <p><code>test()</code> 通过传入所有方法都适用的 <strong>Consumer</strong> 来避免重复代码。</p> <p><code>orElseThrow()</code> 通过 <strong>catch</strong> 关键字来捕获抛出的异常。更多细节，将在 <a href=../15-Exceptions/ >异常</a> 这一章节中学习。</p> <!-- Creating Optionals --> <h3 id=optional_1>创建 Optional<a class=headerlink href=#optional_1 title="Permanent link">#</a></h3> <p>当我们在自己的代码中加入 <strong>Optional</strong> 时，可以使用下面 3 个静态方法：</p> <ul> <li><code>empty()</code>：生成一个空 <strong>Optional</strong>。</li> <li><code>of(value)</code>：将一个非空值包装到 <strong>Optional</strong> 里。</li> <li><code>ofNullable(value)</code>：针对一个可能为空的值，为空时自动生成 <strong>Optional.empty</strong>，否则将值包装在 <strong>Optional</strong> 中。</li> </ul> <p>下面来看看它是如何工作的。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/CreatingOptionals.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>CreatingOptionals</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>testName</span><span class=p>,</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>opt</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; === &quot;</span> <span class=o>+</span> <span class=n>testName</span> <span class=o>+</span> <span class=s>&quot; === &quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>opt</span><span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=s>&quot;Null&quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;empty&quot;</span><span class=p>,</span> <span class=n>Optional</span><span class=p>.</span><span class=na>empty</span><span class=p>());</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;of&quot;</span><span class=p>,</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;Howdy&quot;</span><span class=p>));</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>test</span><span class=p>(</span><span class=s>&quot;of&quot;</span><span class=p>,</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=kc>null</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;ofNullable&quot;</span><span class=p>,</span> <span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=s>&quot;Hi&quot;</span><span class=p>));</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;ofNullable&quot;</span><span class=p>,</span> <span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=kc>null</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>=== empty ===
Null
=== of ===
Howdy
java.lang.NullPointerException
=== ofNullable ===
Hi
=== ofNullable ===
Null
</code></pre></div> <p>我们不能通过传递 <code>null</code> 到 <code>of()</code> 来创建 <code>Optional</code> 对象。最安全的方法是， 使用 <code>ofNullable()</code> 来优雅地处理 <code>null</code>。</p> <h3 id=optional_2>Optional 对象操作<a class=headerlink href=#optional_2 title="Permanent link">#</a></h3> <p>当我们的流管道生成了 <strong>Optional</strong> 对象，下面 3 个方法可使得 <strong>Optional</strong> 的后续能做更多的操作：</p> <ul> <li> <p><code>filter(Predicate)</code>：对 <strong>Optional</strong> 中的内容应用<strong>Predicate</strong> 并将结果返回。如果 <strong>Optional</strong> 不满足 <strong>Predicate</strong> ，将 <strong>Optional</strong> 转化为空 <strong>Optional</strong> 。如果 <strong>Optional</strong> 已经为空，则直接返回空<strong>Optional</strong> 。</p> </li> <li> <p><code>map(Function)</code>：如果 <strong>Optional</strong> 不为空，应用 <strong>Function</strong> 于 <strong>Optional</strong> 中的内容，并返回结果。否则直接返回 <strong>Optional.empty</strong>。</p> </li> <li> <p><code>flatMap(Function)</code>：同 <code>map()</code>，但是提供的映射函数将结果包装在 <strong>Optional</strong> 对象中，因此 <code>flatMap()</code> 不会在最后进行任何包装。</p> </li> </ul> <p>以上方法都不适用于数值型 <strong>Optional</strong>。一般来说，流的 <code>filter()</code> 会在 <strong>Predicate</strong> 返回 <code>false</code> 时移除流元素。而 <code>Optional.filter()</code> 在失败时不会删除 <strong>Optional</strong>，而是将其保留下来，并转化为空。下面请看代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/OptionalFilter.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>OptionalFilter</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span>
            <span class=s>&quot;Foo&quot;</span><span class=p>,</span> <span class=s>&quot;&quot;</span><span class=p>,</span> <span class=s>&quot;Bar&quot;</span><span class=p>,</span> <span class=s>&quot;Baz&quot;</span><span class=p>,</span> <span class=s>&quot;Bingo&quot;</span>
    <span class=p>};</span>
    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>elements</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>descr</span><span class=p>,</span> <span class=n>Predicate</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>pred</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; ---( &quot;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&quot; )---&quot;</span><span class=p>);</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=n>testStream</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>findFirst</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>pred</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;true&quot;</span><span class=p>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=kc>true</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;false&quot;</span><span class=p>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=kc>false</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;str != \&quot;\&quot;&quot;</span><span class=p>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span> <span class=o>!=</span> <span class=s>&quot;&quot;</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;str.length() == 3&quot;</span><span class=p>,</span> <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>3</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;startsWith(\&quot;B\&quot;)&quot;</span><span class=p>,</span>
                <span class=n>str</span> <span class=o>-&gt;</span> <span class=n>str</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&quot;B&quot;</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>---( true )---
Optional[Foo]
Optional[]
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
---( false )---
Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
Optional.empty
---( str != &quot;&quot; )---
Optional[Foo]
Optional.empty
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
---( str.length() == 3 )---
Optional[Foo]
Optional.empty
Optional[Bar]
Optional[Baz]
Optional.empty
Optional.empty
---( startsWith(&quot;B&quot;) )---
Optional.empty
Optional.empty
Optional[Bar]
Optional[Baz]
Optional[Bingo]
Optional.empty
</code></pre></div> <p>即使输出看起来像流，要特别注意 <code>test()</code> 中的 for 循环。每一次的for循环都重新启动流，然后跳过for循环索引指定的数量的元素，这就是流只剩后续元素的原因。然后调用<code>findFirst()</code> 获取剩余元素中的第一个元素，并包装在一个 <code>Optional</code>对象中。</p> <p><strong>注意</strong>，不同于普通 for 循环，这里的索引值范围并不是 <code>i &lt; elements.length</code>， 而是 <code>i &lt;= elements.length</code>。所以最后一个元素实际上超出了流。方便的是，这将自动成为 <strong>Optional.empty</strong>，你可以在每一个测试的结尾中看到。</p> <p>同 <code>map()</code> 一样 ， <code>Optional.map()</code> 执行一个函数。它仅在 <strong>Optional</strong> 不为空时才执行这个映射函数。并将 <strong>Optional</strong> 的内容提取出来，传递给映射函数。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/OptionalMap.java</span>
<span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.Function</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.Stream</span><span class=p>;</span>

<span class=kd>class</span> <span class=nc>OptionalMap</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span><span class=s>&quot;12&quot;</span><span class=p>,</span> <span class=s>&quot;&quot;</span><span class=p>,</span> <span class=s>&quot;23&quot;</span><span class=p>,</span> <span class=s>&quot;45&quot;</span><span class=p>};</span>

    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>elements</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>descr</span><span class=p>,</span> <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>func</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; ---( &quot;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&quot; )---&quot;</span><span class=p>);</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=n>testStream</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>findFirst</span><span class=p>()</span> <span class=c1>// Produces an Optional</span>
                            <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>func</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// If Optional is not empty, map() first extracts</span>
        <span class=c1>// the contents which it then passes</span>
        <span class=c1>// to the function:</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Add brackets&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=s>&quot;[&quot;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&quot;]&quot;</span><span class=p>);</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Increment&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>s</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>});</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Replace&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>replace</span><span class=p>(</span><span class=s>&quot;2&quot;</span><span class=p>,</span> <span class=s>&quot;9&quot;</span><span class=p>));</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Take last digit&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
                <span class=n>s</span><span class=p>.</span><span class=na>charAt</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot;&quot;</span> <span class=p>:</span> <span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// After the function is finished, map() wraps the</span>
    <span class=c1>// result in an Optional before returning it:</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>---( Add brackets )---
Optional[[12]]
Optional[[]]
Optional[[23]]
Optional[[45]]
Optional.empty
---( Increment )---
Optional[13]
Optional[]
Optional[24]
Optional[46]
Optional.empty
---( Replace )---
Optional[19]
Optional[]
Optional[93]
Optional[45]
Optional.empty
---( Take last digit )---
Optional[2]
Optional[]
Optional[3]
Optional[5]
Optional.empty
</code></pre></div> <p>映射函数的返回结果会自动包装成为 <strong>Optional</strong>。<strong>Optional.empty</strong> 会被直接跳过。</p> <p><strong>Optional</strong> 的 <code>flatMap()</code> 应用于已生成 <strong>Optional</strong> 的映射函数，所以 <code>flatMap()</code> 不会像 <code>map()</code> 那样将结果封装在 <strong>Optional</strong> 中。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/OptionalFlatMap.java</span>
<span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.Optional</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.Function</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.Stream</span><span class=p>;</span>

<span class=kd>class</span> <span class=nc>OptionalFlatMap</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>String</span><span class=o>[]</span> <span class=n>elements</span> <span class=o>=</span> <span class=p>{</span><span class=s>&quot;12&quot;</span><span class=p>,</span> <span class=s>&quot;&quot;</span><span class=p>,</span> <span class=s>&quot;23&quot;</span><span class=p>,</span> <span class=s>&quot;45&quot;</span><span class=p>};</span>

    <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>testStream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>elements</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>(</span><span class=n>String</span> <span class=n>descr</span><span class=p>,</span>
                     <span class=n>Function</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>func</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; ---( &quot;</span> <span class=o>+</span> <span class=n>descr</span> <span class=o>+</span> <span class=s>&quot; )---&quot;</span><span class=p>);</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;=</span> <span class=n>elements</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=n>testStream</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
                            <span class=p>.</span><span class=na>findFirst</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>func</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Add brackets&quot;</span><span class=p>,</span>
                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;[&quot;</span> <span class=o>+</span> <span class=n>s</span> <span class=o>+</span> <span class=s>&quot;]&quot;</span><span class=p>));</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Increment&quot;</span><span class=p>,</span> <span class=n>s</span> <span class=o>-&gt;</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span>
                        <span class=n>Integer</span><span class=p>.</span><span class=na>parseInt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>+</span> <span class=s>&quot;&quot;</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>NumberFormatException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>});</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Replace&quot;</span><span class=p>,</span>
                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>replace</span><span class=p>(</span><span class=s>&quot;2&quot;</span><span class=p>,</span> <span class=s>&quot;9&quot;</span><span class=p>)));</span>
        <span class=n>test</span><span class=p>(</span><span class=s>&quot;Take last digit&quot;</span><span class=p>,</span>
                <span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>?</span>
                        <span class=n>s</span><span class=p>.</span><span class=na>charAt</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot;&quot;</span>
                        <span class=p>:</span> <span class=n>s</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>---( Add brackets )---
Optional[[12]]
Optional[[]]
Optional[[23]]
Optional[[45]]
Optional.empty
 ---( Increment )---
Optional[13]
Optional[]
Optional[24]
Optional[46]
Optional.empty
 ---( Replace )---
Optional[19]
Optional[]
Optional[93]
Optional[45]
Optional.empty
 ---( Take last digit )---
Optional[2]
Optional[]
Optional[3]
Optional[5]
Optional.empty
</code></pre></div> <p>同 <code>map()</code>，<code>flatMap()</code> 将提取非空 <strong>Optional</strong> 的内容并将其应用在映射函数。唯一的区别就是 <code>flatMap()</code> 不会把结果包装在 <strong>Optional</strong> 中，因为映射函数已经被包装过了。在如上示例中，我们已经在每一个映射函数中显式地完成了包装，但是很显然 <code>Optional.flatMap()</code> 是为那些自己已经生成 <strong>Optional</strong> 的函数而设计的。</p> <!-- Streams of Optionals --> <h3 id=optional_3>Optional 流<a class=headerlink href=#optional_3 title="Permanent link">#</a></h3> <p>假设你的生成器可能产生 <code>null</code> 值，那么当用它来创建流时，你会自然地想到用 <strong>Optional</strong> 来包装元素。如下是它的样子，代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Signal.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Signal</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>msg</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>Signal</span><span class=p>(</span><span class=n>String</span> <span class=n>msg</span><span class=p>)</span> <span class=p>{</span> <span class=k>this</span><span class=p>.</span><span class=na>msg</span> <span class=o>=</span> <span class=n>msg</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getMsg</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>msg</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Signal(&quot;</span> <span class=o>+</span> <span class=n>msg</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Signal</span> <span class=nf>morse</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>case</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Signal</span><span class=p>(</span><span class=s>&quot;dot&quot;</span><span class=p>);</span>
            <span class=k>case</span> <span class=mi>2</span><span class=p>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Signal</span><span class=p>(</span><span class=s>&quot;dash&quot;</span><span class=p>);</span>
            <span class=k>default</span><span class=p>:</span> <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Signal</span><span class=o>&gt;&gt;</span> <span class=nf>stream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>Signal</span><span class=p>::</span><span class=n>morse</span><span class=p>)</span>
                <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>signal</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>.</span><span class=na>ofNullable</span><span class=p>(</span><span class=n>signal</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>当我们使用这个流的时候，必须要弄清楚如何解包 <strong>Optional</strong>。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/StreamOfOptionals.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StreamOfOptionals</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Signal</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
                <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; ---&quot;</span><span class=p>);</span>
        <span class=n>Signal</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
                <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>Optional</span><span class=p>::</span><span class=n>isPresent</span><span class=p>)</span>
                <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>Optional</span><span class=p>::</span><span class=n>get</span><span class=p>)</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code><span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dot</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=p>.</span><span class=na>empty</span>
<span class=n>Optional</span><span class=p>.</span><span class=na>empty</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=p>.</span><span class=na>empty</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dot</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span><span class=o>]</span>
<span class=n>Optional</span><span class=o>[</span><span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span><span class=o>]</span>
<span class=o>---</span>
<span class=n>Signal</span><span class=p>(</span><span class=n>dot</span><span class=p>)</span>
<span class=n>Signal</span><span class=p>(</span><span class=n>dot</span><span class=p>)</span>
<span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span>
<span class=n>Signal</span><span class=p>(</span><span class=n>dash</span><span class=p>)</span>
</code></pre></div> <p>在这里，我们使用 <code>filter()</code> 来保留那些非空 <strong>Optional</strong>，然后在 <code>map()</code> 中使用 <code>get()</code> 获取元素。由于每种情况都需要定义“空值”的含义，所以通常我们要为每个应用程序采用不同的方法。</p> <!-- Terminal Operations --> <h2 id=_13>终端操作<a class=headerlink href=#_13 title="Permanent link">#</a></h2> <p>以下操作将会获取流的最终结果。至此我们无法再继续往后传递流。可以说，终端操作（Terminal Operations）总是我们在流管道中所做的最后一件事。</p> <!-- Convert to an Array --> <h3 id=_14>数组<a class=headerlink href=#_14 title="Permanent link">#</a></h3> <ul> <li><code>toArray()</code>：将流转换成适当类型的数组。</li> <li><code>toArray(generator)</code>：在特殊情况下，生成自定义类型的数组。</li> </ul> <p>当我们需要得到数组类型的数据以便于后续操作时，上面的方法就很有用。假设我们需要复用流产生的随机数时，就可以这么使用。代码示例:</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/RandInts.java</span>
<span class=kn>package</span> <span class=nn>streams</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandInts</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span><span class=o>[]</span> <span class=n>rints</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>).</span><span class=na>ints</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1000</span><span class=p>).</span><span class=na>limit</span><span class=p>(</span><span class=mi>100</span><span class=p>).</span><span class=na>toArray</span><span class=p>();</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IntStream</span> <span class=nf>rands</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>rints</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>上例将100个数值范围在 0 到 1000 之间的随机数流转换成为数组并将其存储在 <code>rints</code> 中。这样一来，每次调用 <code>rands()</code> 的时候可以重复获取相同的整数流。</p> <!-- Apply a Final Operation to Every Element --> <h3 id=_15>循环<a class=headerlink href=#_15 title="Permanent link">#</a></h3> <ul> <li><code>forEach(Consumer)</code>常见如 <code>System.out::println</code> 作为 <strong>Consumer</strong> 函数。</li> <li><code>forEachOrdered(Consumer)</code>： 保证 <code>forEach</code> 按照原始流顺序操作。</li> </ul> <p>第一种形式：无序操作，仅在引入并行流时才有意义。在 <a href=../24-Concurrent-Programming/ >并发编程</a> 章节之前我们不会深入研究这个问题。这里简单介绍下 <code>parallel()</code>：可实现多处理器并行操作。实现原理为将流分割为多个（通常数目为 CPU 核心数）并在不同处理器上分别执行操作。因为我们采用的是内部迭代，而不是外部迭代，所以这是可能实现的。</p> <p><code>parallel()</code> 看似简单，实则棘手。更多内容将在稍后的 <a href=../24-Concurrent-Programming/ >并发编程</a> 章节中学习。</p> <p>下例引入 <code>parallel()</code> 来帮助理解 <code>forEachOrdered(Consumer)</code> 的作用和使用场景。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/ForEach.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ForEach</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>SZ</span> <span class=o>=</span> <span class=mi>14</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>rands</span><span class=p>().</span><span class=na>limit</span><span class=p>(</span><span class=n>SZ</span><span class=p>)</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>rands</span><span class=p>().</span><span class=na>limit</span><span class=p>(</span><span class=n>SZ</span><span class=p>)</span>
                <span class=p>.</span><span class=na>parallel</span><span class=p>()</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
        <span class=n>rands</span><span class=p>().</span><span class=na>limit</span><span class=p>(</span><span class=n>SZ</span><span class=p>)</span>
                <span class=p>.</span><span class=na>parallel</span><span class=p>()</span>
                <span class=p>.</span><span class=na>forEachOrdered</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>258 555 693 861 961 429 868 200 522 207 288 128 551 589
551 861 429 589 200 522 555 693 258 128 868 288 961 207
258 555 693 861 961 429 868 200 522 207 288 128 551 589
</code></pre></div> <p>为了方便测试不同大小的流，我们抽离出了 <code>SZ</code> 变量。然而即使 <code>SZ</code> 值为14也产生了有趣的结果。在第一个流中，未使用 <code>parallel()</code> ，因此以元素从 <code>rands()</code>出来的顺序输出结果。在第二个流中，引入<code>parallel()</code> ，即便流很小，输出的结果的顺序也和前面不一样。这是由于多处理器并行操作的原因，如果你将程序多运行几次，你会发现输出都不相同，这是多处理器并行操作的不确定性造成的结果。</p> <p>在最后一个流中，同时使用了 <code>parallel()</code> 和 <code>forEachOrdered()</code> 来强制保持原始流顺序。因此，对非并行流使用 <code>forEachOrdered()</code> 是没有任何影响的。</p> <!-- Collecting --> <h3 id=_16>集合<a class=headerlink href=#_16 title="Permanent link">#</a></h3> <ul> <li><code>collect(Collector)</code>：使用 <strong>Collector</strong> 收集流元素到结果集合中。</li> <li><code>collect(Supplier, BiConsumer, BiConsumer)</code>：同上，第一个参数 <strong>Supplier</strong> 创建了一个新的结果集合，第二个参数 <strong>BiConsumer</strong> 将下一个元素收集到结果集合中，第三个参数 <strong>BiConsumer</strong> 用于将两个结果集合合并起来。</li> </ul> <p>在这里我们只是简单介绍了几个 <strong>Collectors</strong> 的运用示例。实际上，它还有一些非常复杂的操作实现，可通过查看 <code>java.util.stream.Collectors</code> 的 API 文档了解。例如，我们可以将元素收集到任意一种特定的集合中。</p> <p>假设我们现在为了保证元素有序，将元素存储在 <strong>TreeSet</strong> 中。<strong>Collectors</strong> 里面没有特定的 <code>toTreeSet()</code>，但是我们可以通过将集合的构造函数引用传递给 <code>Collectors.toCollection()</code>，从而构建任何类型的集合。下面我们来将一个文件中的单词收集到 <strong>TreeSet</strong> 集合中。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/TreeSetOfWords.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TreeSetOfWords</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words2</span> <span class=o>=</span>
                <span class=n>Files</span><span class=p>.</span><span class=na>lines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;TreeSetOfWords.java&quot;</span><span class=p>))</span>
                        <span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;\\W+&quot;</span><span class=p>)))</span>
                        <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>s</span><span class=p>.</span><span class=na>matches</span><span class=p>(</span><span class=s>&quot;\\d+&quot;</span><span class=p>))</span> <span class=c1>// No numbers</span>
                        <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>String</span><span class=p>::</span><span class=n>trim</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>2</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>100</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toCollection</span><span class=p>(</span><span class=n>TreeSet</span><span class=p>::</span><span class=k>new</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>words2</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>[Arrays, Collectors, Exception, Files, Output, Paths,
Set, String, System, TreeSet, TreeSetOfWords, args,
class, collect, file, filter, flatMap, get, import,
java, length, limit, lines, main, map, matches, new,
nio, numbers, out, println, public, split, static,
stream, streams, throws, toCollection, trim, util,
void, words2]
</code></pre></div> <p><strong>Files.</strong><code>lines()</code> 打开 <strong>Path</strong> 并将其转换成为由行组成的流。下一行代码以一个或多个非单词字符（<code>\\W+</code>）为分界，对每一行进行分割，结果是产生一个数组，然后使用 <strong>Arrays.</strong><code>stream()</code> 将数组转化成为流，最后<code>flatMap()</code>将各行形成的多个单词流，扁平映射为一个单词流。使用 <code>matches(\\d+)</code> 查找并移除全部是数字的字符串（注意,<code>words2</code> 是通过的）。然后用 <strong>String.</strong><code>trim()</code> 去除单词两边的空白，<code>filter()</code> 过滤所有长度小于3的单词，并只获取前100个单词，最后将其保存到 <strong>TreeSet</strong> 中。</p> <p>我们也可以在流中生成 <strong>Map</strong>。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/MapCollector.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Pair</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>final</span> <span class=n>Character</span> <span class=n>c</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kd>final</span> <span class=n>Integer</span> <span class=n>i</span><span class=p>;</span>
    <span class=n>Pair</span><span class=p>(</span><span class=n>Character</span> <span class=n>c</span><span class=p>,</span> <span class=n>Integer</span> <span class=n>i</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>c</span> <span class=o>=</span> <span class=n>c</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>i</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Character</span> <span class=nf>getC</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>c</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Integer</span> <span class=nf>getI</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>i</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Pair(&quot;</span> <span class=o>+</span> <span class=n>c</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>class</span> <span class=nc>RandomPair</span> <span class=p>{</span>
    <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=c1>// An infinite iterator of random capital letters:</span>
    <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>capChars</span> <span class=o>=</span> <span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>65</span><span class=p>,</span><span class=mi>91</span><span class=p>)</span>
            <span class=p>.</span><span class=na>mapToObj</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>i</span><span class=p>)</span>
            <span class=p>.</span><span class=na>iterator</span><span class=p>();</span>
    <span class=kd>public</span> <span class=n>Stream</span><span class=o>&lt;</span><span class=n>Pair</span><span class=o>&gt;</span> <span class=nf>stream</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>rand</span><span class=p>.</span><span class=na>ints</span><span class=p>(</span><span class=mi>100</span><span class=p>,</span> <span class=mi>1000</span><span class=p>).</span><span class=na>distinct</span><span class=p>()</span>
                <span class=p>.</span><span class=na>mapToObj</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>Pair</span><span class=p>(</span><span class=n>capChars</span><span class=p>.</span><span class=na>next</span><span class=p>(),</span> <span class=n>i</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MapCollector</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span> <span class=n>Character</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span>
                <span class=k>new</span> <span class=n>RandomPair</span><span class=p>().</span><span class=na>stream</span><span class=p>()</span>
                        <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>collect</span><span class=p>(</span>
                                <span class=n>Collectors</span><span class=p>.</span><span class=na>toMap</span><span class=p>(</span><span class=n>Pair</span><span class=p>::</span><span class=n>getI</span><span class=p>,</span> <span class=n>Pair</span><span class=p>::</span><span class=n>getC</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>map</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>{688=W, 309=C, 293=B, 761=N, 858=N, 668=G, 622=F, 751=N}
</code></pre></div> <p><strong>Pair</strong> 只是一个基础的数据对象。<strong>RandomPair</strong> 创建了随机生成的 <strong>Pair</strong> 对象流。在 Java 中，我们不能直接以某种方式组合两个流。所以我创建了一个整数流，并且使用 <code>mapToObj()</code> 将整数流转化成为 <strong>Pair</strong> 流。 <strong>capChars</strong>的随机大写字母迭代器创建了流，然后<code>next()</code>让我们可以在<code>stream()</code>中使用这个流。就我所知，这是将多个流组合成新的对象流的唯一方法。</p> <p>在这里，我们只使用最简单形式的 <code>Collectors.toMap()</code>，这个方法只需要两个从流中获取键和值的函数。还有其他重载形式，其中一种当是键发生冲突时，使用一个函数来处理冲突。</p> <p>大多数情况下，<code>java.util.stream.Collectors</code> 中预设的 <strong>Collector</strong> 就能满足我们的要求。除此之外，你还可以使用第二种形式的 <code>collect()</code>。 我把它留作更高级的练习，下例给出基本用法：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/SpecialCollector.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SpecialCollector</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=o>=</span>
                <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>ArrayList</span><span class=p>::</span><span class=k>new</span><span class=p>,</span>
                                <span class=n>ArrayList</span><span class=p>::</span><span class=n>add</span><span class=p>,</span>
                                <span class=n>ArrayList</span><span class=p>::</span><span class=n>addAll</span><span class=p>);</span>
        <span class=n>words</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;cheese&quot;</span><span class=p>))</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>cheese
cheese
</code></pre></div> <p>在这里， <strong>ArrayList</strong> 的方法已经做了你所需要的操作，但更有可能的是，如果你必须使用这种形式的 <code>collect()</code>，就要自己创建特定的定义。</p> <!-- Combining All Stream Elements --> <h3 id=_17>组合<a class=headerlink href=#_17 title="Permanent link">#</a></h3> <ul> <li><code>reduce(BinaryOperator)</code>：使用 <strong>BinaryOperator</strong> 来组合所有流中的元素。因为流可能为空，其返回值为 <strong>Optional</strong>。</li> <li><code>reduce(identity, BinaryOperator)</code>：功能同上，但是使用 <strong>identity</strong> 作为其组合的初始值。因此如果流为空，<strong>identity</strong> 就是结果。</li> <li><code>reduce(identity, BiFunction, BinaryOperator)</code>：更复杂的使用形式（暂不介绍），这里把它包含在内，因为它可以提高效率。通常，我们可以显式地组合 <code>map()</code> 和 <code>reduce()</code> 来更简单的表达它。</li> </ul> <p>下面来看下 <code>reduce</code> 的代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Reduce.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Frobnitz</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=n>size</span><span class=p>;</span>
    <span class=n>Frobnitz</span><span class=p>(</span><span class=kt>int</span> <span class=n>sz</span><span class=p>)</span> <span class=p>{</span> <span class=n>size</span> <span class=o>=</span> <span class=n>sz</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Frobnitz(&quot;</span> <span class=o>+</span> <span class=n>size</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// Generator:</span>
    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BOUND</span> <span class=o>=</span> <span class=mi>100</span><span class=p>;</span>
    <span class=kd>static</span> <span class=n>Frobnitz</span> <span class=nf>supply</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>Frobnitz</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>BOUND</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Reduce</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>generate</span><span class=p>(</span><span class=n>Frobnitz</span><span class=p>::</span><span class=n>supply</span><span class=p>)</span>
                <span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
                <span class=p>.</span><span class=na>peek</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>)</span>
                <span class=p>.</span><span class=na>reduce</span><span class=p>((</span><span class=n>fr0</span><span class=p>,</span> <span class=n>fr1</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>fr0</span><span class=p>.</span><span class=na>size</span> <span class=o>&lt;</span> <span class=mi>50</span> <span class=o>?</span> <span class=n>fr0</span> <span class=p>:</span> <span class=n>fr1</span><span class=p>)</span>
                <span class=p>.</span><span class=na>ifPresent</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Frobnitz(58)
Frobnitz(55)
Frobnitz(93)
Frobnitz(61)
Frobnitz(61)
Frobnitz(29)
Frobnitz(68)
Frobnitz(0)
Frobnitz(22)
Frobnitz(7)
Frobnitz(29)
</code></pre></div> <p><strong>Frobnitz</strong> 包含一个可生成自身的生成器 <code>supply()</code> ；因为 <code>supply()</code> 方法作为一个 <code>Supplier&lt;Frobnitz&gt;</code> 是签名兼容的，我们可以把 <code>supply()</code> 作为一个方法引用传递给 <code>Stream.generate()</code> （这种签名兼容性被称作结构一致性）。我们使用了没有“初始值”作为第一个参数的 <code>reduce()</code>方法，所以产生的结果是 <strong>Optional</strong> 类型。<code>Optional.ifPresent()</code> 方法只有在结果非空的时候才会调用 <code>Consumer&lt;Frobnitz&gt;</code> （<code>println</code> 方法可以被调用是因为 <strong>Frobnitz</strong> 可以通过 <code>toString()</code> 方法转换成 <strong>String</strong>）。</p> <p>Lambda 表达式中的第一个参数 <code>fr0</code> 是 <code>reduce()</code> 中上一次调用的结果。而第二个参数 <code>fr1</code> 是从流传递过来的值。</p> <p><code>reduce()</code> 中的 Lambda 表达式使用了三元表达式来获取结果，当 <code>fr0</code> 的 <code>size</code> 值小于 50 的时候，将 <code>fr0</code> 作为结果，否则将序列中的下一个元素即 <code>fr1</code>作为结果。当取得第一个 <code>size</code> 值小于 50 的 <code>Frobnitz</code>，只要得到这个结果就会忽略流中其他元素。这是个非常奇怪的限制， 但也确实让我们对 <code>reduce()</code> 有了更多的了解。</p> <!-- Matching --> <h3 id=_18>匹配<a class=headerlink href=#_18 title="Permanent link">#</a></h3> <ul> <li><code>allMatch(Predicate)</code> ：如果流的每个元素提供给 <strong>Predicate</strong> 都返回 true ，结果返回为 true。在第一个 false 时，则停止执行计算。</li> <li><code>anyMatch(Predicate)</code>：如果流的任意一个元素提供给 <strong>Predicate</strong> 返回 true ，结果返回为 true。在第一个 true 是停止执行计算。</li> <li><code>noneMatch(Predicate)</code>：如果流的每个元素提供给 <strong>Predicate</strong> 都返回 false 时，结果返回为 true。在第一个 true 时停止执行计算。</li> </ul> <p>我们已经在 <code>Prime.java</code> 中看到了 <code>noneMatch()</code> 的示例；<code>allMatch()</code> 和 <code>anyMatch()</code> 的用法基本上是等同的。下面我们来探究一下短路行为。为了消除冗余代码，我们创建了 <code>show()</code>。首先我们必须知道如何统一地描述这三个匹配器的操作，然后再将其转换为 <strong>Matcher</strong> 接口。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Matching.java</span>
<span class=c1>// Demonstrates short-circuiting of *Match() operations</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=p>;</span>

<span class=kd>interface</span> <span class=nc>Matcher</span> <span class=kd>extends</span> <span class=n>BiPredicate</span><span class=o>&lt;</span><span class=n>Stream</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Predicate</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;&gt;</span> <span class=p>{}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Matching</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>show</span><span class=p>(</span><span class=n>Matcher</span> <span class=n>match</span><span class=p>,</span> <span class=kt>int</span> <span class=n>val</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>match</span><span class=p>.</span><span class=na>test</span><span class=p>(</span>
                        <span class=n>IntStream</span><span class=p>.</span><span class=na>rangeClosed</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>9</span><span class=p>)</span>
                                <span class=p>.</span><span class=na>boxed</span><span class=p>()</span>
                                <span class=p>.</span><span class=na>peek</span><span class=p>(</span><span class=n>n</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%d &quot;</span><span class=p>,</span> <span class=n>n</span><span class=p>)),</span>
                        <span class=n>n</span> <span class=o>-&gt;</span> <span class=n>n</span> <span class=o>&lt;</span> <span class=n>val</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>allMatch</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>allMatch</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>anyMatch</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>anyMatch</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>noneMatch</span><span class=p>,</span> <span class=mi>5</span><span class=p>);</span>
        <span class=n>show</span><span class=p>(</span><span class=n>Stream</span><span class=p>::</span><span class=n>noneMatch</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>1 2 3 4 5 6 7 8 9 true
1 2 3 4 false
1 true
1 2 3 4 5 6 7 8 9 false
1 false
1 2 3 4 5 6 7 8 9 true
</code></pre></div> <p><strong>BiPredicate</strong> 是一个二元谓词，它接受两个参数并返回 true 或者 false。第一个参数是我们要测试的流，第二个参数是一个谓词 <strong>Predicate</strong>。<strong>Matcher</strong> 可以匹配所有的 <strong>Stream::*Match</strong> 方法，所以可以将每一个<strong>Stream::*Match</strong>方法引用传递到 <code>show()</code> 中。对<code>match.test()</code> 的调用会被转换成 对方法引用<strong>Stream::*Match</strong> 的调用。</p> <p><code>show()</code> 接受一个<strong>Matcher</strong>和一个 <code>val</code> 参数，<code>val</code> 在判断测试 <code>n &lt; val</code>中指定了最大值。<code>show()</code> 方法生成了整数1-9组成的一个流。<code>peek()</code>用来展示在测试短路之前测试进行到了哪一步。从输出中可以看到每次都发生了短路。</p> <h3 id=_19>查找<a class=headerlink href=#_19 title="Permanent link">#</a></h3> <ul> <li><code>findFirst()</code>：返回第一个流元素的 <strong>Optional</strong>，如果流为空返回 <strong>Optional.empty</strong>。</li> <li><code>findAny(</code>：返回含有任意流元素的 <strong>Optional</strong>，如果流为空返回 <strong>Optional.empty</strong>。</li> </ul> <p>代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/SelectElement.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SelectElement</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>findFirst</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>rands</span><span class=p>().</span><span class=na>parallel</span><span class=p>().</span><span class=na>findFirst</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>findAny</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>rands</span><span class=p>().</span><span class=na>parallel</span><span class=p>().</span><span class=na>findAny</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>258
258
258
242
</code></pre></div> <p>无论流是否为并行化，<code>findFirst()</code> 总是会选择流中的第一个元素。对于非并行流，<code>findAny()</code>会选择流中的第一个元素（即使从定义上来看是选择任意元素）。在这个例子中，用 <code>parallel()</code> 将流并行化，以展示 <code>findAny()</code> 不选择流的第一个元素的可能性。</p> <p>如果必须选择流中最后一个元素，那就使用 <code>reduce()</code>。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/LastElement.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LastElement</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>OptionalInt</span> <span class=n>last</span> <span class=o>=</span> <span class=n>IntStream</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
                <span class=p>.</span><span class=na>reduce</span><span class=p>((</span><span class=n>n1</span><span class=p>,</span> <span class=n>n2</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>n2</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>last</span><span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>));</span>
        <span class=c1>// Non-numeric object:</span>
        <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>lastobj</span> <span class=o>=</span>
                <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>,</span> <span class=s>&quot;two&quot;</span><span class=p>,</span> <span class=s>&quot;three&quot;</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>reduce</span><span class=p>((</span><span class=n>n1</span><span class=p>,</span> <span class=n>n2</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>n2</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>lastobj</span><span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=s>&quot;Nothing there!&quot;</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>19
three
</code></pre></div> <p><code>reduce()</code> 的参数只是用最后一个元素替换了最后两个元素，最终只生成最后一个元素。如果为数字流，你必须使用相近的数字 <strong>Optional</strong> 类型（ numeric optional type），否则使用 <strong>Optional</strong> 类型，就像上例中的 <code>Optional&lt;String&gt;</code>。</p> <!-- Informational --> <h3 id=_20>信息<a class=headerlink href=#_20 title="Permanent link">#</a></h3> <ul> <li><code>count()</code>：流中的元素个数。</li> <li><code>max(Comparator)</code>：根据所传入的 <strong>Comparator</strong> 所决定的“最大”元素。</li> <li><code>min(Comparator)</code>：根据所传入的 <strong>Comparator</strong> 所决定的“最小”元素。</li> </ul> <p><strong>String</strong> 类型有预设的 <strong>Comparator</strong> 实现。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// streams/Informational.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Informational</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>).</span><span class=na>count</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>min</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=s>&quot;NONE&quot;</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>FileToWords</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=s>&quot;Cheese.dat&quot;</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=n>String</span><span class=p>.</span><span class=na>CASE_INSENSITIVE_ORDER</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>orElse</span><span class=p>(</span><span class=s>&quot;NONE&quot;</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>32
a
you
</code></pre></div> <p><code>min()</code> 和 <code>max()</code> 的返回类型为 <strong>Optional</strong>，这需要我们使用 <code>orElse()</code>来解包。</p> <!-- Information for Numeric Streams --> <h3 id=_21>数字流信息<a class=headerlink href=#_21 title="Permanent link">#</a></h3> <ul> <li><code>average()</code> ：求取流元素平均值。</li> <li><code>max()</code> 和 <code>min()</code>：数值流操作无需 <strong>Comparator</strong>。</li> <li><code>sum()</code>：对所有流元素进行求和。</li> <li><code>summaryStatistics()</code>：生成可能有用的数据。目前并不太清楚这个方法存在的必要性，因为我们其实可以用更直接的方法获得需要的数据。</li> </ul> <div class=highlight><pre><span></span><code><span class=c1>// streams/NumericStreamInfo.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>streams.RandInts.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>NumericStreamInfo</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>average</span><span class=p>().</span><span class=na>getAsDouble</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>max</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>min</span><span class=p>().</span><span class=na>getAsInt</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>sum</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>rands</span><span class=p>().</span><span class=na>summaryStatistics</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>507.94
998
8
50794
IntSummaryStatistics{count=100, sum=50794, min=8, average=507.940000, max=998}
</code></pre></div> <p>上例操作对于 <strong>LongStream</strong> 和 <strong>DoubleStream</strong> 同样适用。</p> <h2 id=_22>本章小结<a class=headerlink href=#_22 title="Permanent link">#</a></h2> <p>流式操作改变并极大地提升了 Java 语言的可编程性，并可能极大地阻止了 Java 编程人员向诸如 Scala 这种函数式语言的流转。在本书的剩余部分，我们将尽可能地使用流。</p> <!-- 分页 --> <div style="page-break-after: always;"></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../13-Functional-Programming/ title="13 Functional Programming" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 13 Functional Programming </span> </div> </a> <a href=../15-Exceptions/ title="15 Exceptions" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 15 Exceptions </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://leay.net target=_blank rel=noopener title=home class="md-footer-social__link fa fa-home"></a> <a href=https://github.com/hqweay target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.c33a9706.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.ja.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.multi.js></script> <script>app.initialize({version:"1.1",url:{base:"../../../../.."}})</script> </body> </html>