<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Thinking Drafts"><link href=https://wiki.leay.net/book/OnJava8/docs/book/22-Enumerations/ rel=canonical><meta name=author content=hqweay><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content="en, ja"><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>22 Enumerations - Hqweay's Wiki</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../../../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105976066-3", "wiki.leay.net")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=indigo> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=0 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" aria-label="Hqweay's Wiki" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Hqweay's Wiki </span> <span class=md-header-nav__topic> 22 Enumerations </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Book </a> </li> <li class=md-tabs__item> <a href=../../../../../doc/ class=md-tabs__link> Doc </a> </li> <li class=md-tabs__item> <a href=../../../../../life/reading/ class=md-tabs__link> Life </a> </li> <li class=md-tabs__item> <a href=../../../../../study/draft/try-wiki/ class=md-tabs__link> Study </a> </li> <li class=md-tabs__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ class=md-tabs__link> Tech </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Hqweay's Wiki </label> <div class=md-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../../../../test/ title=特殊语法 class=md-nav__link> 特殊语法 </a> </li> <li class=md-nav__item> <a href=../../../../../web-page/ title=静态文档导航 class=md-nav__link> 静态文档导航 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1 checked> <label class=md-nav__link for=nav-4-1> OnJava8 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> OnJava8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title="《On Java 8》中文版" class=md-nav__link> 《On Java 8》中文版 </a> </li> <li class=md-nav__item> <a href=../../../CONTRIBUTING/ title=CONTRIBUTING class=md-nav__link> CONTRIBUTING </a> </li> <li class=md-nav__item> <a href=../../../SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4 type=checkbox id=nav-4-1-4 checked> <label class=md-nav__link for=nav-4-1-4> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-1-4> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title=译者的话 class=md-nav__link> 译者的话 </a> </li> <li class=md-nav__item> <a href=../../_coverpage/ title=coverpage class=md-nav__link> coverpage </a> </li> <li class=md-nav__item> <a href=../../sidebar/ title=Sidebar class=md-nav__link> Sidebar </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4 type=checkbox id=nav-4-1-4-4> <label class=md-nav__link for=nav-4-1-4-4> style </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-4> style </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4-1 type=checkbox id=nav-4-1-4-4-1> <label class=md-nav__link for=nav-4-1-4-4-1> Prism master </label> <nav class=md-nav data-md-component=collapsible data-md-level=5> <label class=md-nav__title for=nav-4-1-4-4-1> Prism master </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_style/prism-master/ title=[Prism](http://prismjs.com/) class=md-nav__link> [Prism](http://prismjs.com/) </a> </li> <li class=md-nav__item> <a href=../../_style/prism-master/CHANGELOG/ title="Prism Changelog" class=md-nav__link> Prism Changelog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-5 type=checkbox id=nav-4-1-4-5 checked> <label class=md-nav__link for=nav-4-1-4-5> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-5> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../00-Introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../00-On-Java-8/ title="00 On Java 8" class=md-nav__link> 00 On Java 8 </a> </li> <li class=md-nav__item> <a href=../00-Preface/ title=前言 class=md-nav__link> 前言 </a> </li> <li class=md-nav__item> <a href=../01-What-is-an-Object/ title="第一章 对象的概念" class=md-nav__link> 第一章 对象的概念 </a> </li> <li class=md-nav__item> <a href=../02-Installing-Java-and-the-Book-Examples/ title="02 Installing Java and the Book Examples" class=md-nav__link> 02 Installing Java and the Book Examples </a> </li> <li class=md-nav__item> <a href=../03-Objects-Everywhere/ title="03 Objects Everywhere" class=md-nav__link> 03 Objects Everywhere </a> </li> <li class=md-nav__item> <a href=../04-Operators/ title="04 Operators" class=md-nav__link> 04 Operators </a> </li> <li class=md-nav__item> <a href=../05-Control-Flow/ title="05 Control Flow" class=md-nav__link> 05 Control Flow </a> </li> <li class=md-nav__item> <a href=../06-Housekeeping/ title="06 Housekeeping" class=md-nav__link> 06 Housekeeping </a> </li> <li class=md-nav__item> <a href=../07-Implementation-Hiding/ title="07 Implementation Hiding" class=md-nav__link> 07 Implementation Hiding </a> </li> <li class=md-nav__item> <a href=../08-Reuse/ title="08 Reuse" class=md-nav__link> 08 Reuse </a> </li> <li class=md-nav__item> <a href=../09-Polymorphism/ title="09 Polymorphism" class=md-nav__link> 09 Polymorphism </a> </li> <li class=md-nav__item> <a href=../10-Interfaces/ title="10 Interfaces" class=md-nav__link> 10 Interfaces </a> </li> <li class=md-nav__item> <a href=../11-Inner-Classes/ title="11 Inner Classes" class=md-nav__link> 11 Inner Classes </a> </li> <li class=md-nav__item> <a href=../12-Collections/ title="12 Collections" class=md-nav__link> 12 Collections </a> </li> <li class=md-nav__item> <a href=../13-Functional-Programming/ title="13 Functional Programming" class=md-nav__link> 13 Functional Programming </a> </li> <li class=md-nav__item> <a href=../14-Streams/ title="14 Streams" class=md-nav__link> 14 Streams </a> </li> <li class=md-nav__item> <a href=../15-Exceptions/ title="15 Exceptions" class=md-nav__link> 15 Exceptions </a> </li> <li class=md-nav__item> <a href=../16-Validating-Your-Code/ title="16 Validating Your Code" class=md-nav__link> 16 Validating Your Code </a> </li> <li class=md-nav__item> <a href=../17-Files/ title="17 Files" class=md-nav__link> 17 Files </a> </li> <li class=md-nav__item> <a href=../18-Strings/ title="18 Strings" class=md-nav__link> 18 Strings </a> </li> <li class=md-nav__item> <a href=../19-Type-Information/ title="19 Type Information" class=md-nav__link> 19 Type Information </a> </li> <li class=md-nav__item> <a href=../20-Generics/ title="20 Generics" class=md-nav__link> 20 Generics </a> </li> <li class=md-nav__item> <a href=../21-Arrays/ title="21 Arrays" class=md-nav__link> 21 Arrays </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 22 Enumerations </label> <a href=./ title="22 Enumerations" class="md-nav__link md-nav__link--active"> 22 Enumerations </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#enum class=md-nav__link> 基本 enum 特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_1 class=md-nav__link> 将静态类型导入用于 enum </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 方法添加 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_2 class=md-nav__link> 覆盖 enum 的方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#switch-enum class=md-nav__link> switch 语句中的 enum </a> </li> <li class=md-nav__item> <a href=#values class=md-nav__link> values 方法的神秘之处 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 实现而非继承 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 随机选择 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 使用接口组织枚举 </a> </li> <li class=md-nav__item> <a href=#enumset-flags class=md-nav__link> 使用 EnumSet 替代 Flags </a> </li> <li class=md-nav__item> <a href=#enummap class=md-nav__link> 使用 EnumMap </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 常量特定方法 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_3 class=md-nav__link> 使用 enum 的职责链 </a> </li> <li class=md-nav__item> <a href=#enum_4 class=md-nav__link> 使用 enum 的状态机 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 多路分发 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_5 class=md-nav__link> 使用 enum 分发 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 使用常量相关的方法 </a> </li> <li class=md-nav__item> <a href=#enummap_1 class=md-nav__link> 使用 EnumMap 进行分发 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 使用二维数组 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../23-Annotations/ title="23 Annotations" class=md-nav__link> 23 Annotations </a> </li> <li class=md-nav__item> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class=md-nav__link> 24 Concurrent Programming </a> </li> <li class=md-nav__item> <a href=../25-Patterns/ title="25 Patterns" class=md-nav__link> 25 Patterns </a> </li> <li class=md-nav__item> <a href=../Appendix-Becoming-a-Programmer/ title="Appendix Becoming a Programmer" class=md-nav__link> Appendix Becoming a Programmer </a> </li> <li class=md-nav__item> <a href=../Appendix-Benefits-and-Costs-of-Static-Type-Checking/ title="Appendix Benefits and Costs of Static Type Checking" class=md-nav__link> Appendix Benefits and Costs of Static Type Checking </a> </li> <li class=md-nav__item> <a href=../Appendix-Collection-Topics/ title="Appendix Collection Topics" class=md-nav__link> Appendix Collection Topics </a> </li> <li class=md-nav__item> <a href=../Appendix-Data-Compression/ title="Appendix Data Compression" class=md-nav__link> Appendix Data Compression </a> </li> <li class=md-nav__item> <a href=../Appendix-IO-Streams/ title="Appendix IO Streams" class=md-nav__link> Appendix IO Streams </a> </li> <li class=md-nav__item> <a href=../Appendix-Javadoc/ title="Appendix Javadoc" class=md-nav__link> Appendix Javadoc </a> </li> <li class=md-nav__item> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class=md-nav__link> Appendix Low Level Concurrency </a> </li> <li class=md-nav__item> <a href=../Appendix-New-IO/ title="Appendix New IO" class=md-nav__link> Appendix New IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class=md-nav__link> Appendix Object Serialization </a> </li> <li class=md-nav__item> <a href=../Appendix-Passing-and-Returning-Objects/ title="Appendix Passing and Returning Objects" class=md-nav__link> Appendix Passing and Returning Objects </a> </li> <li class=md-nav__item> <a href=../Appendix-Programming-Guidelines/ title="Appendix Programming Guidelines" class=md-nav__link> Appendix Programming Guidelines </a> </li> <li class=md-nav__item> <a href=../Appendix-Standard-IO/ title="Appendix Standard IO" class=md-nav__link> Appendix Standard IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Supplements/ title="Appendix Supplements" class=md-nav__link> Appendix Supplements </a> </li> <li class=md-nav__item> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class=md-nav__link> Appendix The Positive Legacy of C plus plus and Java </a> </li> <li class=md-nav__item> <a href=../Appendix-Understanding-equals-and-hashCode/ title="Appendix Understanding equals and hashCode" class=md-nav__link> Appendix Understanding equals and hashCode </a> </li> <li class=md-nav__item> <a href=../GLOSSARY/ title=GLOSSARY class=md-nav__link> GLOSSARY </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Doc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Doc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/ title=About class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> English </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1 type=checkbox id=nav-5-2-1> <label class=md-nav__link for=nav-5-2-1> A Programmers Guide to English </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-1> A Programmers Guide to English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/ title="A Programmer's Guide to English" class=md-nav__link> A Programmer's Guide to English </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-3 type=checkbox id=nav-5-2-1-3> <label class=md-nav__link for=nav-5-2-1-3> Essence </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-3> Essence </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/essence/ title=语言学习的本质浅析 class=md-nav__link> 语言学习的本质浅析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-4 type=checkbox id=nav-5-2-1-4> <label class=md-nav__link for=nav-5-2-1-4> Make a program </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-4> Make a program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/make-a-program/ title=如何构建一个识别英语的程序 class=md-nav__link> 如何构建一个识别英语的程序 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-5 type=checkbox id=nav-5-2-1-5> <label class=md-nav__link for=nav-5-2-1-5> Qa </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-5> Qa </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/ title="常见问题 QA" class=md-nav__link> 常见问题 QA </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/WhyPTE/ title="为什么我选择 PTE 考试" class=md-nav__link> 为什么我选择 PTE 考试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-6 type=checkbox id=nav-5-2-1-6> <label class=md-nav__link for=nav-5-2-1-6> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-6> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/resources/ title=资料、工具推荐和扩展阅读 class=md-nav__link> 资料、工具推荐和扩展阅读 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-7 type=checkbox id=nav-5-2-1-7> <label class=md-nav__link for=nav-5-2-1-7> Training </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-7> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ title=我的训练方法 class=md-nav__link> 我的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/KnowledgeBase/ title=扩充语料库的训练方法 class=md-nav__link> 扩充语料库的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ListeningandSpeaking/ title=发音和听力训练方法 class=md-nav__link> 发音和听力训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/Thinking/ title=英语思维训练 class=md-nav__link> 英语思维训练 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2 type=checkbox id=nav-5-2-2> <label class=md-nav__link for=nav-5-2-2> English level up tips for Chinese </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-2> English level up tips for Chinese </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/ title=English-level-up-tips-for-Chinese class=md-nav__link> English-level-up-tips-for-Chinese </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-3 type=checkbox id=nav-5-2-2-3> <label class=md-nav__link for=nav-5-2-2-3> Part 1 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-3> Part 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/1-understanding/ title=认知篇 class=md-nav__link> 认知篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/2-vocabulary/ title=单词篇 class=md-nav__link> 单词篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/3-listening/ title=听力篇 class=md-nav__link> 听力篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/4-reading/ title=阅读篇 class=md-nav__link> 阅读篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/5-speaking/ title="5 speaking" class=md-nav__link> 5 speaking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-4 type=checkbox id=nav-5-2-2-4> <label class=md-nav__link for=nav-5-2-2-4> Part 2 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-4> Part 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-2/x-misc/ title=扯淡篇 class=md-nav__link> 扯淡篇 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-5 type=checkbox id=nav-5-2-2-5> <label class=md-nav__link for=nav-5-2-2-5> Word list </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-5> Word list </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Go/ title=Go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Java/ title=Java class=md-nav__link> Java </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/JavaScript/ title=JavaScript class=md-nav__link> JavaScript </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/PHP/ title=PHP class=md-nav__link> PHP </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Swift/ title=Swift class=md-nav__link> Swift </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-3 type=checkbox id=nav-5-2-3> <label class=md-nav__link for=nav-5-2-3> Everyone can use english </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-3> Everyone can use english </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/ title=人人都能用英语 class=md-nav__link> 人人都能用英语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter1/ title="第一章 起点" class=md-nav__link> 第一章 起点 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter2/ title="第二章 口语" class=md-nav__link> 第二章 口语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter3/ title="第三章 语音" class=md-nav__link> 第三章 语音 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter4/ title="第四章 朗读" class=md-nav__link> 第四章 朗读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter5/ title="第五章 词典" class=md-nav__link> 第五章 词典 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter6/ title="第六章 语法" class=md-nav__link> 第六章 语法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter7/ title="第七章 精读" class=md-nav__link> 第七章 精读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter8/ title="第八章 叮嘱" class=md-nav__link> 第八章 叮嘱 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/end/ title=后记 class=md-nav__link> 后记 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-1 type=checkbox id=nav-5-3-1> <label class=md-nav__link for=nav-5-3-1> Chinese copywriting guidelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-1> Chinese copywriting guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/CHANGELOG/ title=CHANGELOG class=md-nav__link> CHANGELOG </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.en-US/ title="Chinese Copywriting Guidelines" class=md-nav__link> Chinese Copywriting Guidelines </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-CN/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-HK/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2> <label class=md-nav__link for=nav-5-3-2> Document style guide </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> Document style guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/ title=Index class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2-2 type=checkbox id=nav-5-3-2-2> <label class=md-nav__link for=nav-5-3-2-2> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-3-2-2> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/marks/ title=标点符号 class=md-nav__link> 标点符号 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/number/ title=数值 class=md-nav__link> 数值 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/paragraph/ title=段落 class=md-nav__link> 段落 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/reference/ title=参考链接 class=md-nav__link> 参考链接 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/structure/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/text/ title=文本 class=md-nav__link> 文本 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/title/ title=标题 class=md-nav__link> 标题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Life </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Life </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Reading </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/ title=阅读 class=md-nav__link> 阅读 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-2 type=checkbox id=nav-6-1-2> <label class=md-nav__link for=nav-6-1-2> Mark </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-2> Mark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back-up/ title="2019 暑假备份" class=md-nav__link> 2019 暑假备份 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back/ title=例行收集 class=md-nav__link> 例行收集 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/efficiency-time/ title=效率、时间、鸡汤 class=md-nav__link> 效率、时间、鸡汤 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fiction/ title=小说 class=md-nav__link> 小说 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/films-remark/ title=影评、电影 class=md-nav__link> 影评、电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fo/ title=佛 class=md-nav__link> 佛 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hackers-others/ title=互联网、思维方式 class=md-nav__link> 互联网、思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hooked-media/ title=媒介反思 class=md-nav__link> 媒介反思 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/isaka-kotaro/ title=伊坂幸太郎 class=md-nav__link> 伊坂幸太郎 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/knote/ title=整理 class=md-nav__link> 整理 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/mark-knote/ title=浪费时间 class=md-nav__link> 浪费时间 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/meaning/ title=思维方式 class=md-nav__link> 思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/morimi-tomihiko/ title=森见登美彦的文字好有趣啊! class=md-nav__link> 森见登美彦的文字好有趣啊! </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/murakamo-haruki/ title=村上春树 class=md-nav__link> 村上春树 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/no-fiction/ title=非虚构类 class=md-nav__link> 非虚构类 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/paper/ title=论文式总结 class=md-nav__link> 论文式总结 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/poem/ title=诗歌 class=md-nav__link> 诗歌 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/sence/ title=哲学相关通俗读物 class=md-nav__link> 哲学相关通俗读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/the-little-prince/ title="The Little Prince" class=md-nav__link> The Little Prince </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/universe/ title=物理科普读物 class=md-nav__link> 物理科普读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/utopia/ title=乌托邦小说世界关于书籍的冷幽默 class=md-nav__link> 乌托邦小说世界关于书籍的冷幽默 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/western-politics/ title=政哲 class=md-nav__link> 政哲 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/what-we-talk-about/ title=日本文学 class=md-nav__link> 日本文学 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/wuxia/ title=武侠 class=md-nav__link> 武侠 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/xiao-bo/ title=王小波 class=md-nav__link> 王小波 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-3 type=checkbox id=nav-6-1-3> <label class=md-nav__link for=nav-6-1-3> Note </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-3> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-02-book-JavaScript-DOM/ title="《JavaScript DOM 编程艺术》" class=md-nav__link> 《JavaScript DOM 编程艺术》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-09-coding-javascript-down/ title="尽量把 JavaScript 代码放到 HTML 网页底部" class=md-nav__link> 尽量把 JavaScript 代码放到 HTML 网页底部 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-05-23-HTTP/ title="《HTTP 图解》" class=md-nav__link> 《HTTP 图解》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-06-07-computer/ title=计算机系统基础 class=md-nav__link> 计算机系统基础 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-10-09-JVM/ title="JVM 笔记" class=md-nav__link> JVM 笔记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-11-25-computer/ title=计算机系统概论 class=md-nav__link> 计算机系统概论 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-4 type=checkbox id=nav-6-1-4> <label class=md-nav__link for=nav-6-1-4> Review </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-4> Review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-28-say-something/ title=听你吹牛的闲暇时光 class=md-nav__link> 听你吹牛的闲暇时光 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-29-wuxia/ title="《流星 蝴蝶 剑》简记" class=md-nav__link> 《流星 蝴蝶 剑》简记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-12-30-xiao-bo/ title=波波老师 class=md-nav__link> 波波老师 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-01-17-lai-zi-xin-shi-jie/ title=《来自新世界》 class=md-nav__link> 《来自新世界》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-10-06-October/ title=科普谈起 class=md-nav__link> 科普谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2019-09-07-story/ title=从网络小说谈起。 class=md-nav__link> 从网络小说谈起。 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Watching </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Watching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/watching/2017-08-29-watch-movies-rencently/ title=最近看的几部电影 class=md-nav__link> 最近看的几部电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-10-13-september-movies-record/ title=九月观影记录 class=md-nav__link> 九月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-11-01-October-summary/ title=十月看片与非专业类阅读 class=md-nav__link> 十月看片与非专业类阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-12-01-1112/ title=观影与阅读记录 class=md-nav__link> 观影与阅读记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-01-10-12/ title=最近看片与阅读 class=md-nav__link> 最近看片与阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-02-06-january/ title=一月观影记录 class=md-nav__link> 一月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-08-February/ title=二月至今观影记录 class=md-nav__link> 二月至今观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-31-March/ title=三月观影记录 class=md-nav__link> 三月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-12-26-Smultronst%C3%A4llet/ title=野草莓 class=md-nav__link> 野草莓 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-10-10-October/ title=克服本能就是善良吗？（从十月新番胡扯……） class=md-nav__link> 克服本能就是善良吗？（从十月新番胡扯……） </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-04-bgm/ title=无人声环 class=md-nav__link> 无人声环 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-13-the-end-of-the-world/ title="The End of the Fucking World" class=md-nav__link> The End of the Fucking World </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Study </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Study </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> Draft </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-1> Draft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/draft/try-wiki/ title="一些 Wiki 工具的尝试" class=md-nav__link> 一些 Wiki 工具的尝试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Language </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-2> Language </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/language/%E6%97%A5%E8%AF%AD%E5%85%A5%E9%97%A8/ title=日语入门 class=md-nav__link> 日语入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Tech </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Tech </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-1 type=checkbox id=nav-8-1-1> <label class=md-nav__link for=nav-8-1-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ title=大表哥的电商网页实战体验 class=md-nav__link> 大表哥的电商网页实战体验 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-23-know-nothing/ title=知其然不知其所以然 class=md-nav__link> 知其然不知其所以然 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2018-06-08-responsive/ title=大表哥的响应式设计 class=md-nav__link> 大表哥的响应式设计 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/zh-javascript-info/ title="现代 JavaScript 教程摘录" class=md-nav__link> 现代 JavaScript 教程摘录 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-2 type=checkbox id=nav-8-1-2> <label class=md-nav__link for=nav-8-1-2> Go </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-2> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/go/01/ title=01 class=md-nav__link> 01 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-3 type=checkbox id=nav-8-1-3> <label class=md-nav__link for=nav-8-1-3> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-3> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/java/2017-12-30-Java%20Web/ title="从 url 访问服务器资源讨论 Java Web 中的 Servlet" class=md-nav__link> 从 url 访问服务器资源讨论 Java Web 中的 Servlet </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2018-11-23-ArrayList/ title=ArrayList class=md-nav__link> ArrayList </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-01-31-HashMap/ title=HashMap class=md-nav__link> HashMap </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-01-String/ title="String 分析(栈,堆,字符串常量池)" class=md-nav__link> String 分析(栈,堆,字符串常量池) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-03-String/ title=String、StringBuffer、StingBuilder class=md-nav__link> String、StringBuffer、StingBuilder </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-06-Hashtable/ title=Hashtable class=md-nav__link> Hashtable </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-22-string-pool/ title=字符串常量池到底保存的是字符串对象还是字符串对象的引用? class=md-nav__link> 字符串常量池到底保存的是字符串对象还是字符串对象的引用? </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-23-Java-Thread-pool/ title="Java 线程池" class=md-nav__link> Java 线程池 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-29-Java%20Web/ title="Java Web 启动流程" class=md-nav__link> Java Web 启动流程 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-04-05-AQS-lock/ title="AQS 与 Java 锁的具体实现" class=md-nav__link> AQS 与 Java 锁的具体实现 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-4 type=checkbox id=nav-8-1-4> <label class=md-nav__link for=nav-8-1-4> Projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-4> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/projects/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-5 type=checkbox id=nav-8-1-5> <label class=md-nav__link for=nav-8-1-5> Spring </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-5> Spring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2018-09-01-Spring%20Security/ title="Spring Boot 与 Spring Security" class=md-nav__link> Spring Boot 与 Spring Security </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-03-29-Spring-init/ title="Spring 启动流程与简单源码分析" class=md-nav__link> Spring 启动流程与简单源码分析 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-04-06-Spring-MVC/ title="Spring MVC 简单源码分析" class=md-nav__link> Spring MVC 简单源码分析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Config </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Config </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Git </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/git/2018-02-01-git/ title="Git 的简单使用" class=md-nav__link> Git 的简单使用 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/2019-08-10-git-merge/ title="Git 协作管理项目时不可避免的 merge 操作" class=md-nav__link> Git 协作管理项目时不可避免的 merge 操作 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/submodule/ title=submodule class=md-nav__link> submodule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-2> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2019-12-18-manjaro/ title="Manjaro 个人新装配置" class=md-nav__link> Manjaro 个人新装配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/fontconfig/ title="Arch Emoji fontconfig" class=md-nav__link> Arch Emoji fontconfig </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/softwares/ title=各种工具 class=md-nav__link> 各种工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-3> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/tools/cz-conventional-changelog/ title=cz-conventional-changelog class=md-nav__link> cz-conventional-changelog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-03-31-Generator-SpringBoot-Gradle/ title="MyBatis Generator + Spring Boot + Gradle 配置" class=md-nav__link> MyBatis Generator + Spring Boot + Gradle 配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-25-VS-Code-Python/ title="VS Code 写 Python" class=md-nav__link> VS Code 写 Python </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-26-linux-kawa/ title="在 Linux 上使用 kawa" class=md-nav__link> 在 Linux 上使用 kawa </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-11-25-mysql/ title="【转】在 CentOS 上部署 MySQL 解压版" class=md-nav__link> 【转】在 CentOS 上部署 MySQL 解压版 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-04-03-Redis-lock/ title="Redis 的分布式锁实现" class=md-nav__link> Redis 的分布式锁实现 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-07-28-picGo/ title="Github + picGo ——有图床了" class=md-nav__link> Github + picGo ——有图床了 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-11-18-linux-mount/ title="Linux 挂载分区/磁盘" class=md-nav__link> Linux 挂载分区/磁盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-03-terminal-wifi/ title=把显卡驱动删了后在终端连热点 class=md-nav__link> 把显卡驱动删了后在终端连热点 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-12-css/ title=一个引号引发的惨案 class=md-nav__link> 一个引号引发的惨案 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-electron-vue/ title="用 Vue 写 Electron 的一次问题解决" class=md-nav__link> 用 Vue 写 Electron 的一次问题解决 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-ttrss/ title="部署 TTRSS 遇到的一些有趣的东西" class=md-nav__link> 部署 TTRSS 遇到的一些有趣的东西 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-04-02-hexo-asset-image/ title="hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了" class=md-nav__link> hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Project </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/project/2017-12-21-xiao-zong-jie/ title=做个小小的总结 class=md-nav__link> 做个小小的总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-06-25-tencent-news-spider-py/ title=腾讯新闻爬虫 class=md-nav__link> 腾讯新闻爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-09-13-lite-terminal-home-page/ title=简单的仿终端主页 class=md-nav__link> 简单的仿终端主页 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-01-11-tank/ title=花里胡哨的坦克大战 class=md-nav__link> 花里胡哨的坦克大战 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-02-05-new-year/ title=大年初一（爬取豆瓣条目及吐槽） class=md-nav__link> 大年初一（爬取豆瓣条目及吐槽） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-04-03-blog-project/ title=写博客 class=md-nav__link> 写博客 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-06-17-nodejs/ title="MarkAll 导入豆瓣数据 —— NodeJS 写爬虫" class=md-nav__link> MarkAll 导入豆瓣数据 —— NodeJS 写爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-Autumn-Json/ title="Autumn-From-Spring 自定义 BeanDefinitionReader" class=md-nav__link> Autumn-From-Spring 自定义 BeanDefinitionReader </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-bookmarkdown/ title="Chrome 插件——书签转 MarkDown" class=md-nav__link> Chrome 插件——书签转 MarkDown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-10-then-start/ title=那就开始吧 class=md-nav__link> 那就开始吧 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-16-Writing-is%20the-reward-of-writing-itself/ title=写就是写本身的报酬 class=md-nav__link> 写就是写本身的报酬 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-11-19-change-my-blog/ title=【过时内容】嘿，我转移博客啦！ class=md-nav__link> 【过时内容】嘿，我转移博客啦！ </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-12-08-yao-guai-ji-yu-you-ren-bo/ title=妖怪唧唧与友人波波 class=md-nav__link> 妖怪唧唧与友人波波 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-01-01-ubuntu/ title="折腾 ubuntu 与 win10 共存" class=md-nav__link> 折腾 ubuntu 与 win10 共存 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-02-09-pc-system/ title="黑苹果与 Ubuntu 及 PC 折腾系统" class=md-nav__link> 黑苹果与 Ubuntu 及 PC 折腾系统 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-12-install-Vmware-on-linux/ title="deepin 安装 VMware" class=md-nav__link> deepin 安装 VMware </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-31-SQL/ title="Spring Boot 开发遇到一些 SQL 问题" class=md-nav__link> Spring Boot 开发遇到一些 SQL 问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-jquery-confrim/ title="JQuery-Confrim 的一点问题" class=md-nav__link> JQuery-Confrim 的一点问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-some-plugins/ title="ECharts + PageHelper + Bootstrap Table" class=md-nav__link> ECharts + PageHelper + Bootstrap Table </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-js-in-thymeleaf/ title="Thymeleaf 里使用 JavaScript 时的注意事项" class=md-nav__link> Thymeleaf 里使用 JavaScript 时的注意事项 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-spring-boot-gradle-yml-log4j2/ title="Spring Boot + Gradle + yml 配置 log4j2" class=md-nav__link> Spring Boot + Gradle + yml 配置 log4j2 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-09-softwares/ title="Linux 常用软件" class=md-nav__link> Linux 常用软件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-hexo-image/ title="【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径）" class=md-nav__link> 【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-show/ title=如果给文章提供多种渲染方式 class=md-nav__link> 如果给文章提供多种渲染方式 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-08-30-vue-music/ title="简单的单页应用(Vue CLI2 的简单使用)" class=md-nav__link> 简单的单页应用(Vue CLI2 的简单使用) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-09-23-word-count/ title="WordCount 项目总结" class=md-nav__link> WordCount 项目总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-06-markall-douban-backup/ title=豆瓣标记数据备份插件 class=md-nav__link> 豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-07-markall-douban-backup-yes/ title=【过时】又一个——豆瓣标记数据备份插件 class=md-nav__link> 【过时】又一个——豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-13-blog/ title=从分析本网站的网络请求谈起 class=md-nav__link> 从分析本网站的网络请求谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/draft/ title=Draft class=md-nav__link> Draft </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#enum class=md-nav__link> 基本 enum 特性 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_1 class=md-nav__link> 将静态类型导入用于 enum </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 方法添加 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_2 class=md-nav__link> 覆盖 enum 的方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#switch-enum class=md-nav__link> switch 语句中的 enum </a> </li> <li class=md-nav__item> <a href=#values class=md-nav__link> values 方法的神秘之处 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 实现而非继承 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 随机选择 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 使用接口组织枚举 </a> </li> <li class=md-nav__item> <a href=#enumset-flags class=md-nav__link> 使用 EnumSet 替代 Flags </a> </li> <li class=md-nav__item> <a href=#enummap class=md-nav__link> 使用 EnumMap </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 常量特定方法 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_3 class=md-nav__link> 使用 enum 的职责链 </a> </li> <li class=md-nav__item> <a href=#enum_4 class=md-nav__link> 使用 enum 的状态机 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 多路分发 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#enum_5 class=md-nav__link> 使用 enum 分发 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 使用常量相关的方法 </a> </li> <li class=md-nav__item> <a href=#enummap_1 class=md-nav__link> 使用 EnumMap 进行分发 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 使用二维数组 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hqweay/my-mkdocs/edit/master/docs/book/OnJava8/docs/book/22-Enumerations.md title=编辑此页 class="md-icon md-content__icon">&#xE3C9;</a> <div class=toc> <ul> <li><a href=#_1>第二十二章 枚举</a><ul> <li><a href=#enum>基本 enum 特性</a><ul> <li><a href=#enum_1>将静态类型导入用于 enum</a></li> </ul> </li> <li><a href=#_2>方法添加</a><ul> <li><a href=#enum_2>覆盖 enum 的方法</a></li> </ul> </li> <li><a href=#switch-enum>switch 语句中的 enum</a></li> <li><a href=#values>values 方法的神秘之处</a></li> <li><a href=#_3>实现而非继承</a></li> <li><a href=#_4>随机选择</a></li> <li><a href=#_5>使用接口组织枚举</a></li> <li><a href=#enumset-flags>使用 EnumSet 替代 Flags</a></li> <li><a href=#enummap>使用 EnumMap</a></li> <li><a href=#_6>常量特定方法</a><ul> <li><a href=#enum_3>使用 enum 的职责链</a></li> <li><a href=#enum_4>使用 enum 的状态机</a></li> </ul> </li> <li><a href=#_7>多路分发</a><ul> <li><a href=#enum_5>使用 enum 分发</a></li> <li><a href=#_8>使用常量相关的方法</a></li> <li><a href=#enummap_1>使用 EnumMap 进行分发</a></li> <li><a href=#_9>使用二维数组</a></li> </ul> </li> <li><a href=#_10>本章小结</a></li> </ul> </li> </ul> </div> <!-- Enumerations --> <h1 id=_1>第二十二章 枚举<a class=headerlink href=#_1 title="Permanent link">#</a></h1> <blockquote> <p>关键字 enum 可以将一组具名的值的有限集合创建为一种新的类型，而这些具名的值可以作为常规的程序组件使用。这是一种非常有用的功能</p> </blockquote> <p>在<a href>初始化和清理 </a> 这章结束的时候，我们已经简单地介绍了枚举的概念。现在，你对 Java 已经有了更深刻的理解，因此可以更深入地学习 Java 中的枚举了。你将在本章中看到，使用 enum 可以做很多有趣的事情，同时，我们也会深入其他的 Java 特性，例如泛型和反射。在这个过程中，我们还将学习一些设计模式。</p> <!-- Basic enum Features --> <h2 id=enum>基本 enum 特性<a class=headerlink href=#enum title="Permanent link">#</a></h2> <p>我们已经在<a href>初始化和清理 </a> 这章章看到，调用 enum 的 values() 方法，可以遍历 enum 实例 .values() 方法返回 enum 实例的数组，而且该数组中的元素严格保持其在 enum 中声明时的顺序，因此你可以在循环中使用 values() 返回的数组。</p> <p>创建 enum 时，编译器会为你生成一个相关的类，这个类继承自 Java.lang.Enum。下面的例子演示了 Enum 提供的一些功能：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/EnumClass.java</span>
<span class=c1>// Capabilities of the Enum class</span>
<span class=kd>enum</span> <span class=n>Shrubbery</span> <span class=p>{</span> <span class=n>GROUND</span><span class=p>,</span> <span class=n>CRAWLING</span><span class=p>,</span> <span class=n>HANGING</span> <span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnumClass</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Shrubbery</span> <span class=n>s</span> <span class=p>:</span> <span class=n>Shrubbery</span><span class=p>.</span><span class=na>values</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=n>s</span> <span class=o>+</span> <span class=s>&quot; ordinal: &quot;</span> <span class=o>+</span> <span class=n>s</span><span class=p>.</span><span class=na>ordinal</span><span class=p>());</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
                    <span class=n>s</span><span class=p>.</span><span class=na>compareTo</span><span class=p>(</span><span class=n>Shrubbery</span><span class=p>.</span><span class=na>CRAWLING</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
                    <span class=n>s</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>Shrubbery</span><span class=p>.</span><span class=na>CRAWLING</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s</span> <span class=o>==</span> <span class=n>Shrubbery</span><span class=p>.</span><span class=na>CRAWLING</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>getDeclaringClass</span><span class=p>());</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>name</span><span class=p>());</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;********************&quot;</span><span class=p>);</span>
        <span class=p>}</span>
<span class=c1>// Produce an enum value from a String name:</span>
        <span class=k>for</span><span class=p>(</span><span class=n>String</span> <span class=n>s</span> <span class=p>:</span>
                <span class=s>&quot;HANGING CRAWLING GROUND&quot;</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>Shrubbery</span> <span class=n>shrub</span> <span class=o>=</span>
                    <span class=n>Enum</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>Shrubbery</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=n>s</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>shrub</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出：</p> <div class=highlight><pre><span></span><code>GROUND ordinal: 0
-1 false false
class Shrubbery
GROUND
********************
CRAWLING ordinal: 1
0 true true
class Shrubbery
CRAWLING
********************
HANGING ordinal: 2
1 false false
class Shrubbery
HANGING
********************
HANGING
CRAWLING
GROUND
</code></pre></div> <p>ordinal() 方法返回一个 int 值，这是每个 enum 实例在声明时的次序，从 0 开始。可以使用==来比较 enum 实例，编译器会自动为你提供 equals() 和 hashCode() 方法。Enum 类实现了 Comparable 接口，所以它具有 compareTo() 方法。同时，它还实现了 Serializable 接口。</p> <p>如果在 enum 实例上调用 getDeclaringClass() 方法，我们就能知道其所属的 enum 类。</p> <p>name() 方法返回 enum 实例声明时的名字，这与使用 toString() 方法效果相同。valueOf() 是在 Enum 中定义的 static 方法，它根据给定的名字返回相应的 enum 实例，如果不存在给定名字的实例，将会抛出异常。</p> <h3 id=enum_1>将静态类型导入用于 enum<a class=headerlink href=#enum_1 title="Permanent link">#</a></h3> <p>先看一看 <a href>初始化和清理 </a> 这章中 Burrito.java 的另一个版本：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/SpicinessEnum.java</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>SpicinessEnum</span> <span class=p>{</span>
    <span class=n>NOT</span><span class=p>,</span> <span class=n>MILD</span><span class=p>,</span> <span class=n>MEDIUM</span><span class=p>,</span> <span class=n>HOT</span><span class=p>,</span> <span class=n>FLAMING</span>
<span class=p>}</span>
<span class=c1>// enums/Burrito2.java</span>
<span class=c1>// {java enums.Burrito2}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.SpicinessEnum.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Burrito2</span> <span class=p>{</span>
    <span class=n>SpicinessEnum</span> <span class=n>degree</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>Burrito2</span><span class=p>(</span><span class=n>SpicinessEnum</span> <span class=n>degree</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>degree</span> <span class=o>=</span> <span class=n>degree</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;Burrito is &quot;</span><span class=o>+</span> <span class=n>degree</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=k>new</span> <span class=n>Burrito2</span><span class=p>(</span><span class=n>NOT</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=k>new</span> <span class=n>Burrito2</span><span class=p>(</span><span class=n>MEDIUM</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=k>new</span> <span class=n>Burrito2</span><span class=p>(</span><span class=n>HOT</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>Burrito is NOT
Burrito is MEDIUM
Burrito is HOT
</code></pre></div> <p>使用 static import 能够将 enum 实例的标识符带入当前的命名空间，所以无需再用 enum 类型来修饰 enum 实例。这是一个好的想法吗？或者还是显式地修饰 enum 实例更好？这要看代码的复杂程度了。编译器可以确保你使用的是正确的类型，所以唯一需要担心的是，使用静态导入会不会导致你的代码令人难以理解。多数情况下，使用 static import 还是有好处的，不过，程序员还是应该对具体情况进行具体分析。</p> <p>注意，在定义 enum 的同一个文件中，这种技巧无法使用，如果是在默认包中定义 enum，这种技巧也无法使用（在 Sun 内部对这一点显然也有不同意见）。</p> <!-- Adding Methods to an enum --> <h2 id=_2>方法添加<a class=headerlink href=#_2 title="Permanent link">#</a></h2> <p>除了不能继承自一个 enum 之外，我们基本上可以将 enum 看作一个常规的类。也就是说我们可以向 enum 中添加方法。enum 甚至可以有 main() 方法。</p> <p>一般来说，我们希望每个枚举实例能够返回对自身的描述，而不仅仅只是默认的 toString() 实现，这只能返回枚举实例的名字。为此，你可以提供一个构造器，专门负责处理这个额外的信息，然后添加一个方法，返回这个描述信息。看一看下面的示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/OzWitch.java</span>
<span class=c1>// The witches in the land of Oz</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>OzWitch</span> <span class=p>{</span>
    <span class=c1>// Instances must be defined first, before methods:</span>
    <span class=n>WEST</span><span class=p>(</span><span class=s>&quot;Miss Gulch, aka the Wicked Witch of the West&quot;</span><span class=p>),</span>
    <span class=n>NORTH</span><span class=p>(</span><span class=s>&quot;Glinda, the Good Witch of the North&quot;</span><span class=p>),</span>
    <span class=n>EAST</span><span class=p>(</span><span class=s>&quot;Wicked Witch of the East, wearer of the Ruby &quot;</span> <span class=o>+</span>
            <span class=s>&quot;Slippers, crushed by Dorothy&#39;s house&quot;</span><span class=p>),</span>
    <span class=n>SOUTH</span><span class=p>(</span><span class=s>&quot;Good by inference, but missing&quot;</span><span class=p>);</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>description</span><span class=p>;</span>
    <span class=c1>// Constructor must be package or private access:</span>
    <span class=kd>private</span> <span class=nf>OzWitch</span><span class=p>(</span><span class=n>String</span> <span class=n>description</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>description</span> <span class=o>=</span> <span class=n>description</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getDescription</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>description</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>OzWitch</span> <span class=n>witch</span> <span class=p>:</span> <span class=n>OzWitch</span><span class=p>.</span><span class=na>values</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=n>witch</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>witch</span><span class=p>.</span><span class=na>getDescription</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>WEST: Miss Gulch, aka the Wicked Witch of the West
NORTH: Glinda, the Good Witch of the North
EAST: Wicked Witch of the East, wearer of the Ruby
Slippers, crushed by Dorothy&#39;s house
SOUTH: Good by inference, but missing
</code></pre></div> <p>注意，如果你打算定义自己的方法，那么必须在 enum 实例序列的最后添加一个分号。同时，Java 要求你必须先定义 enum 实例。如果在定义 enum 实例之前定义了任何方法或属性，那么在编译时就会得到错误信息。</p> <p>enum 中的构造器与方法和普通的类没有区别，因为除了有少许限制之外，enum 就是一个普通的类。所以，我们可以使用 enum 做许多事情（虽然，我们一般只使用普通的枚举类型）</p> <p>在这个例子中，虽然我们有意识地将 enum 的构造器声明为 private，但对于它的可访问性而言，其实并没有什么变化，因为（即使不声明为 private）我们只能在 enum 定义的内部使用其构造器创建 enum 实例。一旦 enum 的定义结束，编译器就不允许我们再使用其构造器来创建任何实例了。</p> <h3 id=enum_2>覆盖 enum 的方法<a class=headerlink href=#enum_2 title="Permanent link">#</a></h3> <p>覆盖 toSring() 方法，给我们提供了另一种方式来为枚举实例生成不同的字符串描述信息。 在下面的示例中，我们使用的就是实例的名字，不过我们希望改变其格式。覆盖 enum 的 toSring() 方法与覆盖一般类的方法没有区别：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/SpaceShip.java</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>SpaceShip</span> <span class=p>{</span>
    <span class=n>SCOUT</span><span class=p>,</span> <span class=n>CARGO</span><span class=p>,</span> <span class=n>TRANSPORT</span><span class=p>,</span>
    <span class=n>CRUISER</span><span class=p>,</span> <span class=n>BATTLESHIP</span><span class=p>,</span> <span class=n>MOTHERSHIP</span><span class=p>;</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=n>name</span><span class=p>();</span>
        <span class=n>String</span> <span class=n>lower</span> <span class=o>=</span> <span class=n>id</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=na>toLowerCase</span><span class=p>();</span>
        <span class=k>return</span> <span class=n>id</span><span class=p>.</span><span class=na>charAt</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>+</span> <span class=n>lower</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Stream</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>values</span><span class=p>())</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>Scout
Cargo
Transport
Cruiser
Battleship
Mothership
</code></pre></div> <p>toString() 方法通过调用 name() 方法取得 SpaceShip 的名字，然后将其修改为只有首字母大写的格式。</p> <!-- enums in switch Statements --> <h2 id=switch-enum>switch 语句中的 enum<a class=headerlink href=#switch-enum title="Permanent link">#</a></h2> <p>在 switch 中使用 enum，是 enum 提供的一项非常便利的功能。一般来说，在 switch 中只能使用整数值，而枚举实例天生就具备整数值的次序，并且可以通过 ordinal() 方法取得其次序（显然编译器帮我们做了类似的工作），因此我们可以在 switch 语句中使用 enum。</p> <p>虽然一般情况下我们必须使用 enum 类型来修饰一个 enum 实例，但是在 case 语句中却不必如此。下面的例子使用 enum 构造了一个小型状态机：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/TrafficLight.java</span>
<span class=c1>// Enums in switch statements</span>
<span class=c1>// Define an enum type:</span>
<span class=kd>enum</span> <span class=n>Signal</span> <span class=p>{</span> <span class=n>GREEN</span><span class=p>,</span> <span class=n>YELLOW</span><span class=p>,</span> <span class=n>RED</span><span class=p>,</span> <span class=p>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TrafficLight</span> <span class=p>{</span>
    <span class=n>Signal</span> <span class=n>color</span> <span class=o>=</span> <span class=n>Signal</span><span class=p>.</span><span class=na>RED</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>change</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>color</span><span class=p>)</span> <span class=p>{</span>
           <span class=c1>// Note you don&#39;t have to say Signal.RED</span>
            <span class=c1>// in the case statement:</span>
            <span class=k>case</span> <span class=n>RED</span><span class=p>:</span> <span class=n>color</span> <span class=o>=</span> <span class=n>Signal</span><span class=p>.</span><span class=na>GREEN</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=n>GREEN</span><span class=p>:</span> <span class=n>color</span> <span class=o>=</span> <span class=n>Signal</span><span class=p>.</span><span class=na>YELLOW</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=n>YELLOW</span><span class=p>:</span> <span class=n>color</span> <span class=o>=</span> <span class=n>Signal</span><span class=p>.</span><span class=na>RED</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;The traffic light is &quot;</span> <span class=o>+</span> <span class=n>color</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>TrafficLight</span> <span class=n>t</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TrafficLight</span><span class=p>();</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>7</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
            <span class=n>t</span><span class=p>.</span><span class=na>change</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>The traffic light is RED
The traffic light is GREEN
The traffic light is YELLOW
The traffic light is RED
The traffic light is GREEN
The traffic light is YELLOW
The traffic light is RED
</code></pre></div> <p>编译器并没有抱怨 switch 中没有 default 语句，但这并不是因为每一个 Signal 都有对应的 case 语句。如果你注释掉其中的某个 case 语句，编译器同样不会抱怨什么。这意味着，你必须确保自己覆盖了所有的分支。但是，如果在 case 语句中调用 return，那么编译器就会抱怨缺少 default 语句了。这与是否覆盖了 enum 的所有实例无关。</p> <!-- The Mystery of values() --> <h2 id=values>values 方法的神秘之处<a class=headerlink href=#values title="Permanent link">#</a></h2> <p>前面已经提到，编译器为你创建的 enum 类都继承自 Enum 类。然而，如果你研究一下 Enum 类就会发现，它并没有 values() 方法。可我们明明已经用过该方法了，难道存在某种“隐藏的”方法吗？我们可以利用反射机制编写一个简单的程序，来查看其中的究竟：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/Reflection.java</span>
<span class=c1>// Analyzing enums using reflection</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>Explore</span> <span class=p>{</span> <span class=n>HERE</span><span class=p>,</span> <span class=n>THERE</span> <span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Reflection</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span>
    <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>analyze</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>enumClass</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=s>&quot;_____ Analyzing &quot;</span> <span class=o>+</span> <span class=n>enumClass</span> <span class=o>+</span> <span class=s>&quot; _____&quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Interfaces:&quot;</span><span class=p>);</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Type</span> <span class=n>t</span> <span class=p>:</span> <span class=n>enumClass</span><span class=p>.</span><span class=na>getGenericInterfaces</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=s>&quot;Base: &quot;</span> <span class=o>+</span> <span class=n>enumClass</span><span class=p>.</span><span class=na>getSuperclass</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Methods: &quot;</span><span class=p>);</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>methods</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TreeSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>enumClass</span><span class=p>.</span><span class=na>getMethods</span><span class=p>())</span>
            <span class=n>methods</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>methods</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>methods</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>exploreMethods</span> <span class=o>=</span>
                <span class=n>analyze</span><span class=p>(</span><span class=n>Explore</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>enumMethods</span> <span class=o>=</span> <span class=n>analyze</span><span class=p>(</span><span class=n>Enum</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=s>&quot;Explore.containsAll(Enum)? &quot;</span> <span class=o>+</span>
                        <span class=n>exploreMethods</span><span class=p>.</span><span class=na>containsAll</span><span class=p>(</span><span class=n>enumMethods</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Explore.removeAll(Enum): &quot;</span><span class=p>);</span>
        <span class=n>exploreMethods</span><span class=p>.</span><span class=na>removeAll</span><span class=p>(</span><span class=n>enumMethods</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>exploreMethods</span><span class=p>);</span>
<span class=c1>// Decompile the code for the enum:</span>
        <span class=n>OSExecute</span><span class=p>.</span><span class=na>command</span><span class=p>(</span>
                <span class=s>&quot;javap -cp build/classes/main Explore&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>_____</span> <span class=n>Analyzing</span> <span class=kd>class</span> <span class=nc>Explore</span> <span class=n>_____</span>
<span class=nl>Interfaces:</span>
<span class=nl>Base:</span> <span class=kd>class</span> <span class=nc>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Enum</span>
<span class=nl>Methods:</span>
<span class=o>[</span><span class=n>compareTo</span><span class=p>,</span> <span class=n>equals</span><span class=p>,</span> <span class=n>getClass</span><span class=p>,</span> <span class=n>getDeclaringClass</span><span class=p>,</span>
<span class=n>hashCode</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>notify</span><span class=p>,</span> <span class=n>notifyAll</span><span class=p>,</span> <span class=n>ordinal</span><span class=p>,</span> <span class=n>toString</span><span class=p>,</span>
<span class=n>valueOf</span><span class=p>,</span> <span class=n>values</span><span class=p>,</span> <span class=n>wait</span><span class=o>]</span>
<span class=n>_____</span> <span class=n>Analyzing</span> <span class=kd>class</span> <span class=nc>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Enum</span> <span class=n>_____</span>
<span class=nl>Interfaces:</span>
<span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Comparable</span><span class=o>&lt;</span><span class=n>E</span><span class=o>&gt;</span>
<span class=kd>interface</span> <span class=nc>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>Serializable</span>
<span class=nl>Base:</span> <span class=kd>class</span> <span class=nc>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Object</span>
<span class=nl>Methods:</span>
<span class=o>[</span><span class=n>compareTo</span><span class=p>,</span> <span class=n>equals</span><span class=p>,</span> <span class=n>getClass</span><span class=p>,</span> <span class=n>getDeclaringClass</span><span class=p>,</span>
<span class=n>hashCode</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>notify</span><span class=p>,</span> <span class=n>notifyAll</span><span class=p>,</span> <span class=n>ordinal</span><span class=p>,</span> <span class=n>toString</span><span class=p>,</span>
<span class=n>valueOf</span><span class=p>,</span> <span class=n>wait</span><span class=o>]</span>
<span class=n>Explore</span><span class=p>.</span><span class=na>containsAll</span><span class=p>(</span><span class=n>Enum</span><span class=p>)</span><span class=o>?</span> <span class=kc>true</span>
<span class=n>Explore</span><span class=p>.</span><span class=na>removeAll</span><span class=p>(</span><span class=n>Enum</span><span class=p>):</span> <span class=o>[</span><span class=n>values</span><span class=o>]</span>
<span class=n>Compiled</span> <span class=n>from</span> <span class=s>&quot;Reflection.java&quot;</span>
<span class=kd>final</span> <span class=kd>class</span> <span class=nc>Explore</span> <span class=kd>extends</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Enum</span><span class=o>&lt;</span><span class=n>Explore</span><span class=o>&gt;</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Explore</span> <span class=n>HERE</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Explore</span> <span class=n>THERE</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Explore</span><span class=o>[]</span> <span class=nf>values</span><span class=p>();</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=n>Explore</span> <span class=nf>valueOf</span><span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=p>);</span>
  <span class=kd>static</span> <span class=p>{};</span>
<span class=p>}</span>
</code></pre></div> <p>答案是，values() 是由编译器添加的 static 方法。可以看出，在创建 Explore 的过程中，编译器还为其添加了 valueOf() 方法。这可能有点令人迷惑，Enum 类不是已经有 valueOf() 方法了吗。</p> <p>不过 Enum 中的 valueOf() 方法需要两个参数，而这个新增的方法只需一个参数。由于这里使用的 Set 只存储方法的名字，而不考虑方法的签名，所以在调用 Explore.removeAll(Enum) 之后，就只剩下[values] 了。</p> <p>从最后的输出中可以看到，编译器将 Explore 标记为 final 类，所以无法继承自 enum，其中还有一个 static 的初始化子句，稍后我们将学习如何重定义该句。</p> <p>由于擦除效应（在<a href>泛型 </a> 章节中介绍过），反编译无法得到 Enum 的完整信息，所以它展示的 Explore 的父类只是一个原始的 Enum，而非事实上的 Enum\&lt;Explore>。</p> <p>由于 values() 方法是由编译器插入到 enum 定义中的 static 方法，所以，如果你将 enum 实例向上转型为 Enum，那么 values() 方法就不可访问了。不过，在 Class 中有一个 getEnumConstants() 方法，所以即便 Enum 接口中没有 values() 方法，我们仍然可以通过 Class 对象取得所有 enum 实例。</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/UpcastEnum.java</span>
<span class=c1>// No values() method if you upcast an enum</span>
<span class=kd>enum</span> <span class=n>Search</span> <span class=p>{</span> <span class=n>HITHER</span><span class=p>,</span> <span class=n>YON</span> <span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UpcastEnum</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Search</span><span class=o>[]</span> <span class=n>vals</span> <span class=o>=</span> <span class=n>Search</span><span class=p>.</span><span class=na>values</span><span class=p>();</span>
        <span class=n>Enum</span> <span class=n>e</span> <span class=o>=</span> <span class=n>Search</span><span class=p>.</span><span class=na>HITHER</span><span class=p>;</span> <span class=c1>// Upcast</span>
<span class=c1>// e.values(); // No values() in Enum</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Enum</span> <span class=n>en</span> <span class=p>:</span> <span class=n>e</span><span class=p>.</span><span class=na>getClass</span><span class=p>().</span><span class=na>getEnumConstants</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>en</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>HITHER
YON
</code></pre></div> <p>因为 getEnumConstants() 是 Class 上的方法，所以你甚至可以对不是枚举的类调用此方法：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/NonEnum.java</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>NonEnum</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Class</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>intClass</span> <span class=o>=</span> <span class=n>Integer</span><span class=p>.</span><span class=na>class</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Object</span> <span class=n>en</span> <span class=p>:</span> <span class=n>intClass</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>())</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>en</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Expected: &quot;</span> <span class=o>+</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=nl>Expected:</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>NullPointerException</span>
</code></pre></div> <p>只不过，此时该方法返回 null，所以当你试图使用其返回的结果时会发生异常。</p> <!-- Implements, not Inherits --> <h2 id=_3>实现而非继承<a class=headerlink href=#_3 title="Permanent link">#</a></h2> <p>我们已经知道，所有的 enum 都继承自 Java.lang.Enum 类。由于 Java 不支持多重继承，所以你的 enum 不能再继承其他类：</p> <div class=highlight><pre><span></span><code><span class=kd>enum</span> <span class=n>NotPossible</span> <span class=kd>extends</span> <span class=n>Pet</span> <span class=p>{</span> <span class=p>...</span> <span class=c1>// Won&#39;t work</span>
</code></pre></div> <p>然而，在我们创建一个新的 enum 时，可以同时实现一个或多个接口：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/cartoons/EnumImplementation.java</span>
<span class=c1>// An enum can implement an interface</span>
<span class=c1>// {java enums.cartoons.EnumImplementation}</span>
<span class=kn>package</span> <span class=nn>enums.cartoons</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>CartoonCharacter</span>
        <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>CartoonCharacter</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>SLAPPY</span><span class=p>,</span> <span class=n>SPANKY</span><span class=p>,</span> <span class=n>PUNCHY</span><span class=p>,</span>
    <span class=n>SILLY</span><span class=p>,</span> <span class=n>BOUNCY</span><span class=p>,</span> <span class=n>NUTTY</span><span class=p>,</span> <span class=n>BOB</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>CartoonCharacter</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>values</span><span class=p>()</span><span class=o>[</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>values</span><span class=p>().</span><span class=na>length</span><span class=p>)</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnumImplementation</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=kt>void</span> <span class=nf>printNext</span><span class=p>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>rg</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>rg</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
<span class=c1>// Choose any instance:</span>
        <span class=n>CartoonCharacter</span> <span class=n>cc</span> <span class=o>=</span> <span class=n>CartoonCharacter</span><span class=p>.</span><span class=na>BOB</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>printNext</span><span class=p>(</span><span class=n>cc</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>BOB, PUNCHY, BOB, SPANKY, NUTTY, PUNCHY, SLAPPY, NUTTY,
NUTTY, SLAPPY,
</code></pre></div> <p>这个结果有点奇怪，不过你必须要有一个 enum 实例才能调用其上的方法。现在，在任何接受 Supplier 参数的方法中，例如 printNext()，都可以使用 CartoonCharacter。</p> <!-- Random Selection --> <h2 id=_4>随机选择<a class=headerlink href=#_4 title="Permanent link">#</a></h2> <p>就像你在 CartoonCharacter.get() 中看到的那样，本章中的很多示例都需要从 enum 实例中进行随机选择。我们可以利用泛型，从而使得这个工作更一般化，并将其加入到我们的工具库中。</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/Enums.java</span>
<span class=kn>package</span> <span class=nn>onjava</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Enums</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Enum</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=n>T</span> <span class=nf>random</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>ec</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>random</span><span class=p>(</span><span class=n>ec</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>random</span><span class=p>(</span><span class=n>T</span><span class=o>[]</span> <span class=n>values</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>values</span><span class=o>[</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>values</span><span class=p>.</span><span class=na>length</span><span class=p>)</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>古怪的语法\&lt;T extends Enum\&lt;T>> 表示 T 是一个 enum 实例。而将 Class\&lt;T> 作为参数的话，我们就可以利用 Class 对象得到 enum 实例的数组了。重载后的 random() 方法只需使用 T[] 作为参数，因为它并不会调用 Enum 上的任何操作，它只需从数组中随机选择一个元素即可。这样，最终的返回类型正是 enum 的类型。</p> <p>下面是 random() 方法的一个简单示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RandomTest.java</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>Activity</span> <span class=p>{</span> <span class=n>SITTING</span><span class=p>,</span> <span class=n>LYING</span><span class=p>,</span> <span class=n>STANDING</span><span class=p>,</span> <span class=n>HOPPING</span><span class=p>,</span>
    <span class=n>RUNNING</span><span class=p>,</span> <span class=n>DODGING</span><span class=p>,</span> <span class=n>JUMPING</span><span class=p>,</span> <span class=n>FALLING</span><span class=p>,</span> <span class=n>FLYING</span> <span class=p>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RandomTest</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>20</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
                    <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>Activity</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>STANDING FLYING RUNNING STANDING RUNNING STANDING LYING
DODGING SITTING RUNNING HOPPING HOPPING HOPPING RUNNING
STANDING LYING FALLING RUNNING FLYING LYING
</code></pre></div> <!-- Using Interfaces for Organization --> <h2 id=_5>使用接口组织枚举<a class=headerlink href=#_5 title="Permanent link">#</a></h2> <p>无法从 enum 继承子类有时很令人沮丧。这种需求有时源自我们希望扩展原 enum 中的元素，有时是因为我们希望使用子类将一个 enum 中的元素进行分组。</p> <p>在一个接口的内部，创建实现该接口的枚举，以此将元素进行分组，可以达到将枚举元素分类组织的目的。举例来说，假设你想用 enum 来表示不同类别的食物，同时还希望每个 enum 元素仍然保持 Food 类型。那可以这样实现：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/menu/Food.java</span>
<span class=c1>// Subcategorization of enums within interfaces</span>
<span class=kn>package</span> <span class=nn>enums.menu</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Food</span> <span class=p>{</span>
    <span class=kd>enum</span> <span class=n>Appetizer</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
        <span class=n>SALAD</span><span class=p>,</span> <span class=n>SOUP</span><span class=p>,</span> <span class=n>SPRING_ROLLS</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>enum</span> <span class=n>MainCourse</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
        <span class=n>LASAGNE</span><span class=p>,</span> <span class=n>BURRITO</span><span class=p>,</span> <span class=n>PAD_THAI</span><span class=p>,</span>
        <span class=n>LENTILS</span><span class=p>,</span> <span class=n>HUMMOUS</span><span class=p>,</span> <span class=n>VINDALOO</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>enum</span> <span class=n>Dessert</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
        <span class=n>TIRAMISU</span><span class=p>,</span> <span class=n>GELATO</span><span class=p>,</span> <span class=n>BLACK_FOREST_CAKE</span><span class=p>,</span>
        <span class=n>FRUIT</span><span class=p>,</span> <span class=n>CREME_CARAMEL</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>enum</span> <span class=n>Coffee</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
        <span class=n>BLACK_COFFEE</span><span class=p>,</span> <span class=n>DECAF_COFFEE</span><span class=p>,</span> <span class=n>ESPRESSO</span><span class=p>,</span>
        <span class=n>LATTE</span><span class=p>,</span> <span class=n>CAPPUCCINO</span><span class=p>,</span> <span class=n>TEA</span><span class=p>,</span> <span class=n>HERB_TEA</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>对于 enum 而言，实现接口是使其子类化的唯一办法，所以嵌入在 Food 中的每个 enum 都实现了 Food 接口。现在，在下面的程序中，我们可以说“所有东西都是某种类型的 Food"。</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/menu/TypeOfFood.java</span>
<span class=c1>// {java enums.menu.TypeOfFood}</span>
<span class=kn>package</span> <span class=nn>enums.menu</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.menu.Food.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TypeOfFood</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Food</span> <span class=n>food</span> <span class=o>=</span> <span class=n>Appetizer</span><span class=p>.</span><span class=na>SALAD</span><span class=p>;</span>
        <span class=n>food</span> <span class=o>=</span> <span class=n>MainCourse</span><span class=p>.</span><span class=na>LASAGNE</span><span class=p>;</span>
        <span class=n>food</span> <span class=o>=</span> <span class=n>Dessert</span><span class=p>.</span><span class=na>GELATO</span><span class=p>;</span>
        <span class=n>food</span> <span class=o>=</span> <span class=n>Coffee</span><span class=p>.</span><span class=na>CAPPUCCINO</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>如果 enum 类型实现了 Food 接口，那么我们就可以将其实例向上转型为 Food，所以上例中的所有东西都是 Food。</p> <p>然而，当你需要与一大堆类型打交道时，接口就不如 enum 好用了。例如，如果你想创建一个“校举的枚举”，那么可以创建一个新的 enum，然后用其实例包装 Food 中的每一个 enum 类：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/menu/Course.java</span>
<span class=kn>package</span> <span class=nn>enums.menu</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>Course</span> <span class=p>{</span>
    <span class=n>APPETIZER</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Appetizer</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>MAINCOURSE</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>MainCourse</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>DESSERT</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Dessert</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>COFFEE</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Coffee</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=kd>private</span> <span class=n>Food</span><span class=o>[]</span> <span class=n>values</span><span class=p>;</span>
    <span class=kd>private</span> <span class=nf>Course</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Food</span><span class=o>&gt;</span> <span class=n>kind</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>values</span> <span class=o>=</span> <span class=n>kind</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Food</span> <span class=nf>randomSelection</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>values</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>每一个 Course 的实例都将其对应的 Class 对象作为构造器的参数。通过 getEnumConstants0 方法，可以从该 Class 对象中取得某个 Food 子类的所有 enum 实例。这些实例在 randomSelection() 中被用到。因此，通过从每一个 Course 实例中随机地选择一个 Food，我们便能够生成一份菜单：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/menu/Meal.java</span>
<span class=c1>// {java enums.menu.Meal}</span>
<span class=kn>package</span> <span class=nn>enums.menu</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Meal</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Course</span> <span class=n>course</span> <span class=p>:</span> <span class=n>Course</span><span class=p>.</span><span class=na>values</span><span class=p>())</span> <span class=p>{</span>
                <span class=n>Food</span> <span class=n>food</span> <span class=o>=</span> <span class=n>course</span><span class=p>.</span><span class=na>randomSelection</span><span class=p>();</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>food</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;***&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>SPRING_ROLLS
VINDALOO
FRUIT
DECAF_COFFEE
***
SOUP
VINDALOO
FRUIT
TEA
***
SALAD
BURRITO
FRUIT
TEA
***
SALAD
BURRITO
CREME_CARAMEL
LATTE
***
SOUP
BURRITO
TIRAMISU
ESPRESSO
***
</code></pre></div> <p>在这个例子中，我们通过遍历每一个 Course 实例来获得“枚举的枚举”的值。稍后，在 VendingMachine.java 中，我们会看到另一种组织枚举实例的方式，但其也有一些其他的限制。</p> <p>此外，还有一种更简洁的管理枚举的办法，就是将一个 enum 嵌套在另一个 enum 内。就像这样：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/SecurityCategory.java</span>
<span class=c1>// More succinct subcategorization of enums</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>SecurityCategory</span> <span class=p>{</span>
    <span class=n>STOCK</span><span class=p>(</span><span class=n>Security</span><span class=p>.</span><span class=na>Stock</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>BOND</span><span class=p>(</span><span class=n>Security</span><span class=p>.</span><span class=na>Bond</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>Security</span><span class=o>[]</span> <span class=n>values</span><span class=p>;</span>
    <span class=n>SecurityCategory</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Security</span><span class=o>&gt;</span> <span class=n>kind</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>values</span> <span class=o>=</span> <span class=n>kind</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=kd>interface</span> <span class=nc>Security</span> <span class=p>{</span>
        <span class=kd>enum</span> <span class=n>Stock</span> <span class=kd>implements</span> <span class=n>Security</span> <span class=p>{</span>
            <span class=n>SHORT</span><span class=p>,</span> <span class=n>LONG</span><span class=p>,</span> <span class=n>MARGIN</span>
        <span class=p>}</span>
        <span class=kd>enum</span> <span class=n>Bond</span> <span class=kd>implements</span> <span class=n>Security</span> <span class=p>{</span>
            <span class=n>MUNICIPAL</span><span class=p>,</span> <span class=n>JUNK</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Security</span> <span class=nf>randomSelection</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>values</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>SecurityCategory</span> <span class=n>category</span> <span class=o>=</span>
                    <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>SecurityCategory</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>category</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span>
                    <span class=n>category</span><span class=p>.</span><span class=na>randomSelection</span><span class=p>());</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>BOND: MUNICIPAL
BOND: MUNICIPAL
STOCK: MARGIN
STOCK: MARGIN
BOND: JUNK
STOCK: SHORT
STOCK: LONG
STOCK: LONG
BOND: MUNICIPAL
BOND: JUNK
</code></pre></div> <p>Security 接口的作用是将其所包含的 enum 组合成一个公共类型，这一点是有必要的。然后，SecurityCategory 才能将 Security 中的 enum 作为其构造器的参数使用，以起到组织的效果。</p> <p>如果我们将这种方式应用于 Food 的例子，结果应该这样：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/menu/Meal2.java</span>
<span class=c1>// {java enums.menu.Meal2}</span>
<span class=kn>package</span> <span class=nn>enums.menu</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>Meal2</span> <span class=p>{</span>
    <span class=n>APPETIZER</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Appetizer</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>MAINCOURSE</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>MainCourse</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>DESSERT</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Dessert</span><span class=p>.</span><span class=na>class</span><span class=p>),</span>
    <span class=n>COFFEE</span><span class=p>(</span><span class=n>Food</span><span class=p>.</span><span class=na>Coffee</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=kd>private</span> <span class=n>Food</span><span class=o>[]</span> <span class=n>values</span><span class=p>;</span>
    <span class=kd>private</span> <span class=nf>Meal2</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>Food</span><span class=o>&gt;</span> <span class=n>kind</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>values</span> <span class=o>=</span> <span class=n>kind</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Food</span> <span class=p>{</span>
        <span class=kd>enum</span> <span class=n>Appetizer</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
            <span class=n>SALAD</span><span class=p>,</span> <span class=n>SOUP</span><span class=p>,</span> <span class=n>SPRING_ROLLS</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=kd>enum</span> <span class=n>MainCourse</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
            <span class=n>LASAGNE</span><span class=p>,</span> <span class=n>BURRITO</span><span class=p>,</span> <span class=n>PAD_THAI</span><span class=p>,</span>
            <span class=n>LENTILS</span><span class=p>,</span> <span class=n>HUMMOUS</span><span class=p>,</span> <span class=n>VINDALOO</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=kd>enum</span> <span class=n>Dessert</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
            <span class=n>TIRAMISU</span><span class=p>,</span> <span class=n>GELATO</span><span class=p>,</span> <span class=n>BLACK_FOREST_CAKE</span><span class=p>,</span>
            <span class=n>FRUIT</span><span class=p>,</span> <span class=n>CREME_CARAMEL</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=kd>enum</span> <span class=n>Coffee</span> <span class=kd>implements</span> <span class=n>Food</span> <span class=p>{</span>
            <span class=n>BLACK_COFFEE</span><span class=p>,</span> <span class=n>DECAF_COFFEE</span><span class=p>,</span> <span class=n>ESPRESSO</span><span class=p>,</span>
            <span class=n>LATTE</span><span class=p>,</span> <span class=n>CAPPUCCINO</span><span class=p>,</span> <span class=n>TEA</span><span class=p>,</span> <span class=n>HERB_TEA</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Food</span> <span class=nf>randomSelection</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>values</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>5</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Meal2</span> <span class=n>meal</span> <span class=p>:</span> <span class=n>Meal2</span><span class=p>.</span><span class=na>values</span><span class=p>())</span> <span class=p>{</span>
                <span class=n>Food</span> <span class=n>food</span> <span class=o>=</span> <span class=n>meal</span><span class=p>.</span><span class=na>randomSelection</span><span class=p>();</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>food</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;***&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>SPRING_ROLLS
VINDALOO
FRUIT
DECAF_COFFEE
***
SOUP
VINDALOO
FRUIT
TEA
***
SALAD
BURRITO
FRUIT
TEA
***
SALAD
BURRITO
CREME_CARAMEL
LATTE
***
SOUP
BURRITO
TIRAMISU
ESPRESSO
***
</code></pre></div> <p>其实，这仅仅是重新组织了一下代码，不过多数情况下，这种方式使你的代码具有更清晰的结构。</p> <!-- Using EnumSet Instead of Flags --> <h2 id=enumset-flags>使用 EnumSet 替代 Flags<a class=headerlink href=#enumset-flags title="Permanent link">#</a></h2> <p>Set 是一种集合，只能向其中添加不重复的对象。当然，enum 也要求其成员都是唯一的，所以 enum 看起来也具有集合的行为。不过，由于不能从 enum 中删除或添加元素，所以它只能算是不太有用的集合。Java SE5 引入 EnumSet，是为了通过 enum 创建一种替代品，以替代传统的基于 int 的“位标志”。这种标志可以用来表示某种“开/关”信息，不过，使用这种标志，我们最终操作的只是一些 bit，而不是这些 bit 想要表达的概念，因此很容易写出令人难以理解的代码。</p> <p>EnumSet 的设计充分考虑到了速度因素，因为它必须与非常高效的 bit 标志相竞争（其操作与 HashSet 相比，非常地快），就其内部而言，它（可能）就是将一个 long 值作为比特向量，所以 EnumSet 非常快速高效。使用 EnumSet 的优点是，它在说明一个二进制位是否存在时，具有更好的表达能力，并且无需担心性能。</p> <p>EnumSet 中的元素必须来自一个 enum。下面的 enum 表示在一座大楼中，警报传感器的安放位置：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/AlarmPoints.java</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>AlarmPoints</span> <span class=p>{</span>
    <span class=n>STAIR1</span><span class=p>,</span> <span class=n>STAIR2</span><span class=p>,</span> <span class=n>LOBBY</span><span class=p>,</span> <span class=n>OFFICE1</span><span class=p>,</span> <span class=n>OFFICE2</span><span class=p>,</span> <span class=n>OFFICE3</span><span class=p>,</span>
    <span class=n>OFFICE4</span><span class=p>,</span> <span class=n>BATHROOM</span><span class=p>,</span> <span class=n>UTILITY</span><span class=p>,</span> <span class=n>KITCHEN</span>
<span class=p>}</span>
</code></pre></div> <p>然后，我们用 EnumSet 来跟踪报警器的状态：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/EnumSets.java</span>
<span class=c1>// Operations on EnumSets</span>
<span class=c1>// {java enums.EnumSets}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.AlarmPoints.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnumSets</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>EnumSet</span><span class=o>&lt;</span><span class=n>AlarmPoints</span><span class=o>&gt;</span> <span class=n>points</span> <span class=o>=</span>
                <span class=n>EnumSet</span><span class=p>.</span><span class=na>noneOf</span><span class=p>(</span><span class=n>AlarmPoints</span><span class=p>.</span><span class=na>class</span><span class=p>);</span> <span class=c1>// Empty</span>
        <span class=n>points</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>BATHROOM</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
        <span class=n>points</span><span class=p>.</span><span class=na>addAll</span><span class=p>(</span>
                <span class=n>EnumSet</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>STAIR1</span><span class=p>,</span> <span class=n>STAIR2</span><span class=p>,</span> <span class=n>KITCHEN</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
        <span class=n>points</span> <span class=o>=</span> <span class=n>EnumSet</span><span class=p>.</span><span class=na>allOf</span><span class=p>(</span><span class=n>AlarmPoints</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>points</span><span class=p>.</span><span class=na>removeAll</span><span class=p>(</span>
                <span class=n>EnumSet</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>STAIR1</span><span class=p>,</span> <span class=n>STAIR2</span><span class=p>,</span> <span class=n>KITCHEN</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
        <span class=n>points</span><span class=p>.</span><span class=na>removeAll</span><span class=p>(</span>
                <span class=n>EnumSet</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=n>OFFICE1</span><span class=p>,</span> <span class=n>OFFICE4</span><span class=p>));</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
        <span class=n>points</span> <span class=o>=</span> <span class=n>EnumSet</span><span class=p>.</span><span class=na>complementOf</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>points</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=o>[</span><span class=n>BATHROOM</span><span class=o>]</span>
<span class=o>[</span><span class=n>STAIR1</span><span class=p>,</span> <span class=n>STAIR2</span><span class=p>,</span> <span class=n>BATHROOM</span><span class=p>,</span> <span class=n>KITCHEN</span><span class=o>]</span>
<span class=o>[</span><span class=n>LOBBY</span><span class=p>,</span> <span class=n>OFFICE1</span><span class=p>,</span> <span class=n>OFFICE2</span><span class=p>,</span> <span class=n>OFFICE3</span><span class=p>,</span> <span class=n>OFFICE4</span><span class=p>,</span> <span class=n>BATHROOM</span><span class=p>,</span>
<span class=n>UTILITY</span><span class=o>]</span>
<span class=o>[</span><span class=n>LOBBY</span><span class=p>,</span> <span class=n>BATHROOM</span><span class=p>,</span> <span class=n>UTILITY</span><span class=o>]</span>
<span class=o>[</span><span class=n>STAIR1</span><span class=p>,</span> <span class=n>STAIR2</span><span class=p>,</span> <span class=n>OFFICE1</span><span class=p>,</span> <span class=n>OFFICE2</span><span class=p>,</span> <span class=n>OFFICE3</span><span class=p>,</span> <span class=n>OFFICE4</span><span class=p>,</span>
<span class=n>KITCHEN</span><span class=o>]</span>
</code></pre></div> <p>使用 static import 可以简化 enum 常量的使用。EnumSet 的方法的名字都相当直观，你可以查阅 JDK 文档找到其完整详细的描述。如果仔细研究了 EnumSet 的文档，你还会发现 of() 方法被重载了很多次，不但为可变数量参数进行了重载，而且为接收 2 至 5 个显式的参数的情况都进行了重载。这也从侧面表现了 EnumSet 对性能的关注。因为，其实只使用单独的 of() 方法解决可变参数已经可以解决整个问题了，但是对比显式的参数，会有一点性能损失。采用现在这种设计，当你只使用 2 到 5 个参数调用 of() 方法时，你可以调用对应的重载过的方法（速度稍快一点），而当你使用一个参数或多过 5 个参数时，你调用的将是使用可变参数的 of() 方法。注意，如果你只使用一个参数，编译器并不会构造可变参数的数组，所以与调用只有一个参数的方法相比，也就不会有额外的性能损耗。</p> <p>EnumSet 的基础是 long，一个 long 值有 64 位，而一个 enum 实例只需一位 bit 表示其是否存在。 也就是说，在不超过一个 long 的表达能力的情况下，你的 EnumSet 可以应用于最多不超过 64 个元素的 enum。如果 enum 超过了 64 个元素会发生什么呢？</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/BigEnumSet.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BigEnumSet</span> <span class=p>{</span>
    <span class=kd>enum</span> <span class=n>Big</span> <span class=p>{</span> <span class=n>A0</span><span class=p>,</span> <span class=n>A1</span><span class=p>,</span> <span class=n>A2</span><span class=p>,</span> <span class=n>A3</span><span class=p>,</span> <span class=n>A4</span><span class=p>,</span> <span class=n>A5</span><span class=p>,</span> <span class=n>A6</span><span class=p>,</span> <span class=n>A7</span><span class=p>,</span> <span class=n>A8</span><span class=p>,</span> <span class=n>A9</span><span class=p>,</span>
        <span class=n>A10</span><span class=p>,</span> <span class=n>A11</span><span class=p>,</span> <span class=n>A12</span><span class=p>,</span> <span class=n>A13</span><span class=p>,</span> <span class=n>A14</span><span class=p>,</span> <span class=n>A15</span><span class=p>,</span> <span class=n>A16</span><span class=p>,</span> <span class=n>A17</span><span class=p>,</span> <span class=n>A18</span><span class=p>,</span> <span class=n>A19</span><span class=p>,</span>
        <span class=n>A20</span><span class=p>,</span> <span class=n>A21</span><span class=p>,</span> <span class=n>A22</span><span class=p>,</span> <span class=n>A23</span><span class=p>,</span> <span class=n>A24</span><span class=p>,</span> <span class=n>A25</span><span class=p>,</span> <span class=n>A26</span><span class=p>,</span> <span class=n>A27</span><span class=p>,</span> <span class=n>A28</span><span class=p>,</span> <span class=n>A29</span><span class=p>,</span>
        <span class=n>A30</span><span class=p>,</span> <span class=n>A31</span><span class=p>,</span> <span class=n>A32</span><span class=p>,</span> <span class=n>A33</span><span class=p>,</span> <span class=n>A34</span><span class=p>,</span> <span class=n>A35</span><span class=p>,</span> <span class=n>A36</span><span class=p>,</span> <span class=n>A37</span><span class=p>,</span> <span class=n>A38</span><span class=p>,</span> <span class=n>A39</span><span class=p>,</span>
        <span class=n>A40</span><span class=p>,</span> <span class=n>A41</span><span class=p>,</span> <span class=n>A42</span><span class=p>,</span> <span class=n>A43</span><span class=p>,</span> <span class=n>A44</span><span class=p>,</span> <span class=n>A45</span><span class=p>,</span> <span class=n>A46</span><span class=p>,</span> <span class=n>A47</span><span class=p>,</span> <span class=n>A48</span><span class=p>,</span> <span class=n>A49</span><span class=p>,</span>
        <span class=n>A50</span><span class=p>,</span> <span class=n>A51</span><span class=p>,</span> <span class=n>A52</span><span class=p>,</span> <span class=n>A53</span><span class=p>,</span> <span class=n>A54</span><span class=p>,</span> <span class=n>A55</span><span class=p>,</span> <span class=n>A56</span><span class=p>,</span> <span class=n>A57</span><span class=p>,</span> <span class=n>A58</span><span class=p>,</span> <span class=n>A59</span><span class=p>,</span>
        <span class=n>A60</span><span class=p>,</span> <span class=n>A61</span><span class=p>,</span> <span class=n>A62</span><span class=p>,</span> <span class=n>A63</span><span class=p>,</span> <span class=n>A64</span><span class=p>,</span> <span class=n>A65</span><span class=p>,</span> <span class=n>A66</span><span class=p>,</span> <span class=n>A67</span><span class=p>,</span> <span class=n>A68</span><span class=p>,</span> <span class=n>A69</span><span class=p>,</span>
        <span class=n>A70</span><span class=p>,</span> <span class=n>A71</span><span class=p>,</span> <span class=n>A72</span><span class=p>,</span> <span class=n>A73</span><span class=p>,</span> <span class=n>A74</span><span class=p>,</span> <span class=n>A75</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>EnumSet</span><span class=o>&lt;</span><span class=n>Big</span><span class=o>&gt;</span> <span class=n>bigEnumSet</span> <span class=o>=</span> <span class=n>EnumSet</span><span class=p>.</span><span class=na>allOf</span><span class=p>(</span><span class=n>Big</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bigEnumSet</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=o>[</span><span class=n>A0</span><span class=p>,</span> <span class=n>A1</span><span class=p>,</span> <span class=n>A2</span><span class=p>,</span> <span class=n>A3</span><span class=p>,</span> <span class=n>A4</span><span class=p>,</span> <span class=n>A5</span><span class=p>,</span> <span class=n>A6</span><span class=p>,</span> <span class=n>A7</span><span class=p>,</span> <span class=n>A8</span><span class=p>,</span> <span class=n>A9</span><span class=p>,</span> <span class=n>A10</span><span class=p>,</span> <span class=n>A11</span><span class=p>,</span> <span class=n>A12</span><span class=p>,</span>
<span class=n>A13</span><span class=p>,</span> <span class=n>A14</span><span class=p>,</span> <span class=n>A15</span><span class=p>,</span> <span class=n>A16</span><span class=p>,</span> <span class=n>A17</span><span class=p>,</span> <span class=n>A18</span><span class=p>,</span> <span class=n>A19</span><span class=p>,</span> <span class=n>A20</span><span class=p>,</span> <span class=n>A21</span><span class=p>,</span> <span class=n>A22</span><span class=p>,</span> <span class=n>A23</span><span class=p>,</span>
<span class=n>A24</span><span class=p>,</span> <span class=n>A25</span><span class=p>,</span> <span class=n>A26</span><span class=p>,</span> <span class=n>A27</span><span class=p>,</span> <span class=n>A28</span><span class=p>,</span> <span class=n>A29</span><span class=p>,</span> <span class=n>A30</span><span class=p>,</span> <span class=n>A31</span><span class=p>,</span> <span class=n>A32</span><span class=p>,</span> <span class=n>A33</span><span class=p>,</span> <span class=n>A34</span><span class=p>,</span>
<span class=n>A35</span><span class=p>,</span> <span class=n>A36</span><span class=p>,</span> <span class=n>A37</span><span class=p>,</span> <span class=n>A38</span><span class=p>,</span> <span class=n>A39</span><span class=p>,</span> <span class=n>A40</span><span class=p>,</span> <span class=n>A41</span><span class=p>,</span> <span class=n>A42</span><span class=p>,</span> <span class=n>A43</span><span class=p>,</span> <span class=n>A44</span><span class=p>,</span> <span class=n>A45</span><span class=p>,</span>
<span class=n>A46</span><span class=p>,</span> <span class=n>A47</span><span class=p>,</span> <span class=n>A48</span><span class=p>,</span> <span class=n>A49</span><span class=p>,</span> <span class=n>A50</span><span class=p>,</span> <span class=n>A51</span><span class=p>,</span> <span class=n>A52</span><span class=p>,</span> <span class=n>A53</span><span class=p>,</span> <span class=n>A54</span><span class=p>,</span> <span class=n>A55</span><span class=p>,</span> <span class=n>A56</span><span class=p>,</span>
<span class=n>A57</span><span class=p>,</span> <span class=n>A58</span><span class=p>,</span> <span class=n>A59</span><span class=p>,</span> <span class=n>A60</span><span class=p>,</span> <span class=n>A61</span><span class=p>,</span> <span class=n>A62</span><span class=p>,</span> <span class=n>A63</span><span class=p>,</span> <span class=n>A64</span><span class=p>,</span> <span class=n>A65</span><span class=p>,</span> <span class=n>A66</span><span class=p>,</span> <span class=n>A67</span><span class=p>,</span>
<span class=n>A68</span><span class=p>,</span> <span class=n>A69</span><span class=p>,</span> <span class=n>A70</span><span class=p>,</span> <span class=n>A71</span><span class=p>,</span> <span class=n>A72</span><span class=p>,</span> <span class=n>A73</span><span class=p>,</span> <span class=n>A74</span><span class=p>,</span> <span class=n>A75</span><span class=o>]</span>
</code></pre></div> <p>显然，EnumSet 可以应用于多过 64 个元素的 enum，所以我猜测，Enum 会在必要的时候增加一个 long。</p> <!-- Using EnumMap --> <h2 id=enummap>使用 EnumMap<a class=headerlink href=#enummap title="Permanent link">#</a></h2> <p>EnumMap 是一种特殊的 Map，它要求其中的键（key）必须来自一个 enum，由于 enum 本身的限制，所以 EnumMap 在内部可由数组实现。因此 EnumMap 的速度很快，我们可以放心地使用 enum 实例在 EnumMap 中进行查找操作。不过，我们只能将 enum 的实例作为键来调用 put() 可方法，其他操作与使用一般的 Map 差不多。</p> <p>下面的例子演示了<em>命令设计模式</em>的用法。一般来说，命令模式首先需要一个只有单一方法的接口，然后从该接口实现具有各自不同的行为的多个子类。接下来，程序员就可以构造命令对象，并在需要的时候使用它们了：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/EnumMaps.java</span>
<span class=c1>// Basics of EnumMaps</span>
<span class=c1>// {java enums.EnumMaps}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.AlarmPoints.*</span><span class=p>;</span>
<span class=kd>interface</span> <span class=nc>Command</span> <span class=p>{</span> <span class=kt>void</span> <span class=nf>action</span><span class=p>();</span> <span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>EnumMaps</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>EnumMap</span><span class=o>&lt;</span><span class=n>AlarmPoints</span><span class=p>,</span><span class=n>Command</span><span class=o>&gt;</span> <span class=n>em</span> <span class=o>=</span>
                <span class=k>new</span> <span class=n>EnumMap</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>AlarmPoints</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>em</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>KITCHEN</span><span class=p>,</span>
                <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Kitchen fire!&quot;</span><span class=p>));</span>
        <span class=n>em</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>BATHROOM</span><span class=p>,</span>
                <span class=p>()</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Bathroom alert!&quot;</span><span class=p>));</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>Entry</span><span class=o>&lt;</span><span class=n>AlarmPoints</span><span class=p>,</span><span class=n>Command</span><span class=o>&gt;</span> <span class=n>e</span><span class=p>:</span>
                <span class=n>em</span><span class=p>.</span><span class=na>entrySet</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getKey</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span><span class=p>);</span>
            <span class=n>e</span><span class=p>.</span><span class=na>getValue</span><span class=p>().</span><span class=na>action</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>try</span> <span class=p>{</span> <span class=c1>// If there&#39;s no value for a particular key:</span>
            <span class=n>em</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>UTILITY</span><span class=p>).</span><span class=na>action</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Expected: &quot;</span> <span class=o>+</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>BATHROOM: Bathroom alert!
KITCHEN: Kitchen fire!
Expected: java.lang.NullPointerException
</code></pre></div> <p>与 EnumSet 一样，enum 实例定义时的次序决定了其在 EnumMap 中的顺序。</p> <p>main() 方法的最后部分说明，enum 的每个实例作为一个键，总是存在的。但是，如果你没有为这个键调用 put() 方法来存入相应的值的话，其对应的值就是 null。</p> <p>与常量相关的方法（constant-specific methods 将在下一节中介绍）相比，EnumMap 有一个优点，那 EnumMap 允许程序员改变值对象，而常量相关的方法在编译期就被固定了。稍后你会看到，在你有多种类型的 enum，而且它们之间存在互操作的情况下，我们可以用 EnumMap 实现多路分发（multiple dispatching）。</p> <!-- Constant-Specific Methods --> <h2 id=_6>常量特定方法<a class=headerlink href=#_6 title="Permanent link">#</a></h2> <p>Java 的 enum 有一个非常有趣的特性，即它允许程序员为 enum 实例编写方法，从而为每个 enum 实例赋予各自不同的行为。要实现常量相关的方法，你需要为 enum 定义一个或多个 abstract 方法，然后为每个 enum 实例实现该抽象方法。参考下面的例子：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/ConstantSpecificMethod.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.text.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>ConstantSpecificMethod</span> <span class=p>{</span>
    <span class=n>DATE_TIME</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=n>String</span> <span class=nf>getInfo</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span>
                    <span class=n>DateFormat</span><span class=p>.</span><span class=na>getDateInstance</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=k>new</span> <span class=n>Date</span><span class=p>());</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>CLASSPATH</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=n>String</span> <span class=nf>getInfo</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>System</span><span class=p>.</span><span class=na>getenv</span><span class=p>(</span><span class=s>&quot;CLASSPATH&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>VERSION</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=n>String</span> <span class=nf>getInfo</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;java.version&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getInfo</span><span class=p>();</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>ConstantSpecificMethod</span> <span class=n>csm</span> <span class=p>:</span> <span class=n>values</span><span class=p>())</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>csm</span><span class=p>.</span><span class=na>getInfo</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>May</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>2017</span>
<span class=nl>C:</span><span class=err>\</span><span class=n>Users</span><span class=err>\</span><span class=n>Bruce</span><span class=err>\</span><span class=n>Documents</span><span class=err>\</span><span class=n>GitHub</span><span class=err>\</span><span class=n>on</span><span class=o>-</span>
<span class=n>java</span><span class=err>\</span><span class=n>ExtractedExamples</span><span class=err>\\</span><span class=n>gradle</span><span class=err>\</span><span class=n>wrapper</span><span class=err>\</span><span class=n>gradle</span><span class=o>-</span>
<span class=n>wrapper</span><span class=p>.</span><span class=na>jar</span>
<span class=mf>1.8.0_112</span>
</code></pre></div> <p>通过相应的 enum 实例，我们可以调用其上的方法。这通常也称为表驱动的代码（table-driven code，请注意它与前面提到的命令模式的相似之处）。</p> <p>在面向对象的程序设计中，不同的行为与不同的类关联。而通过常量相关的方法，每个 enum 实例可以具备自己独特的行为，这似乎说明每个 enum 实例就像一个独特的类。在上面的例子中，enum 实例似乎被当作其“超类”ConstantSpecificMethod 来使用，在调用 getInfo() 方法时，体现出多态的行为。</p> <p>然而，enum 实例与类的相似之处也仅限于此了。我们并不能真的将 enum 实例作为一个类型来使用：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/NotClasses.java</span>
<span class=c1>// {javap -c LikeClasses}</span>
<span class=kd>enum</span> <span class=n>LikeClasses</span> <span class=p>{</span>
    <span class=n>WINKEN</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kt>void</span> <span class=nf>behavior</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Behavior1&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>BLINKEN</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kt>void</span> <span class=nf>behavior</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Behavior2&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>NOD</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kt>void</span> <span class=nf>behavior</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Behavior3&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>behavior</span><span class=p>();</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>NotClasses</span> <span class=p>{</span>
    <span class=c1>// void f1(LikeClasses.WINKEN instance) {} // Nope</span>
<span class=p>}</span>
</code></pre></div> <p>输出为（前 12 行）：</p> <div class=highlight><pre><span></span><code>Compiled from &quot;NotClasses.java&quot;
abstract class LikeClasses extends
java.lang.Enum&lt;LikeClasses&gt; {
public static final LikeClasses WINKEN;
public static final LikeClasses BLINKEN;
public static final LikeClasses NOD;
public static LikeClasses[] values();
Code:
0: getstatic #2 // Field
$VALUES:[LLikeClasses;
3: invokevirtual #3 // Method
&quot;[LLikeClasses;&quot;.clone:()Ljava/lang/Object;
...
</code></pre></div> <p>在方法 f1() 中，编译器不允许我们将一个 enum 实例当作 class 类型。如果我们分析一下编译器生成的代码，就知道这种行为也是很正常的。因为每个 enum 元素都是一个 LikeClasses 类型的 static final 实例。</p> <p>同时，由于它们是 static 实例，无法访问外部类的非 static 元素或方法，所以对于内部的 enum 的实例而言，其行为与一般的内部类并不相同。</p> <p>再看一个更有趣的关于洗车的例子。每个顾客在洗车时，都有一个选择菜单，每个选择对应一个不同的动作。可以将一个常量相关的方法关联到一个选择上，再使用一个 EnumSet 来保存客户的选择：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/CarWash.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>CarWash</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>enum</span> <span class=n>Cycle</span> <span class=p>{</span>
        <span class=n>UNDERBODY</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Spraying the underbody&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>WHEELWASH</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Washing the wheels&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>PREWASH</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Loosening the dirt&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>BASIC</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;The basic wash&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>HOTWAX</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Applying hot wax&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>RINSE</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Rinsing&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>BLOWDRY</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>action</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Blowing dry&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>};</span>
        <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>action</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>EnumSet</span><span class=o>&lt;</span><span class=n>Cycle</span><span class=o>&gt;</span> <span class=n>cycles</span> <span class=o>=</span>
            <span class=n>EnumSet</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>Cycle</span><span class=p>.</span><span class=na>BASIC</span><span class=p>,</span> <span class=n>Cycle</span><span class=p>.</span><span class=na>RINSE</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span><span class=p>(</span><span class=n>Cycle</span> <span class=n>cycle</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>cycles</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>cycle</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>washCar</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Cycle</span> <span class=n>c</span> <span class=p>:</span> <span class=n>cycles</span><span class=p>)</span>
            <span class=n>c</span><span class=p>.</span><span class=na>action</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>cycles</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>CarWash</span> <span class=n>wash</span> <span class=o>=</span> <span class=k>new</span> <span class=n>CarWash</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>wash</span><span class=p>);</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>washCar</span><span class=p>();</span>
<span class=c1>// Order of addition is unimportant:</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Cycle</span><span class=p>.</span><span class=na>BLOWDRY</span><span class=p>);</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Cycle</span><span class=p>.</span><span class=na>BLOWDRY</span><span class=p>);</span> <span class=c1>// Duplicates ignored</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Cycle</span><span class=p>.</span><span class=na>RINSE</span><span class=p>);</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Cycle</span><span class=p>.</span><span class=na>HOTWAX</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>wash</span><span class=p>);</span>
        <span class=n>wash</span><span class=p>.</span><span class=na>washCar</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>[BASIC, RINSE]
The basic wash
Rinsing
[BASIC, HOTWAX, RINSE, BLOWDRY]
The basic wash
Applying hot wax
Rinsing
Blowing dry
</code></pre></div> <p>与使用匿名内部类相比较，定义常量相关方法的语法更高效、简洁。</p> <p>这个例子也展示了 EnumSet 了一些特性。因为它是一个集合，所以对于同一个元素而言，只能出现一次，因此对同一个参数重复地调用 add0 方法会被忽略掉（这是正确的行为，因为一个 bit 位开关只能“打开”一次），同样地，向 EnumSet 添加 enum 实例的顺序并不重要，因为其输出的次序决定于 enum 实例定义时的次序。</p> <p>除了实现 abstract 方法以外，程序员是否可以覆盖常量相关的方法呢？答案是肯定的，参考下面的程序：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/OverrideConstantSpecific.java</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>OverrideConstantSpecific</span> <span class=p>{</span>
    <span class=n>NUT</span><span class=p>,</span> <span class=n>BOLT</span><span class=p>,</span>
    <span class=n>WASHER</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Overridden method&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=kt>void</span> <span class=nf>f</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;default behavior&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>OverrideConstantSpecific</span> <span class=n>ocs</span> <span class=p>:</span> <span class=n>values</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>ocs</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span><span class=p>);</span>
            <span class=n>ocs</span><span class=p>.</span><span class=na>f</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>NUT: default behavior
BOLT: default behavior
WASHER: Overridden method
</code></pre></div> <p>虽然 enum 有某些限制，但是一般而言，我们还是可以将其看作是类。</p> <h3 id=enum_3>使用 enum 的职责链<a class=headerlink href=#enum_3 title="Permanent link">#</a></h3> <p>在职责链（Chain of Responsibility）设计模式中，程序员以多种不同的方式来解决一个问题，然后将它们链接在一起。当一个请求到来时，它遍历这个链，直到链中的某个解决方案能够处理该请求。</p> <p>通过常量相关的方法，我们可以很容易地实现一个简单的职责链。我们以一个邮局的模型为例。邮局需要以尽可能通用的方式来处理每一封邮件，并且要不断尝试处理邮件，直到该邮件最终被确定为一封死信。其中的每一次尝试可以看作为一个策略（也是一个设计模式），而完整的处理方式列表就是一个职责链。</p> <p>我们先来描述一下邮件。邮件的每个关键特征都可以用 enum 来表示。程序将随机地生成 Mail 对象，如果要减小一封邮件的 GeneralDelivery 为 YES 的概率，那最简单的方法就是多创建几个不是 YES 的 enum 实例，所以 enum 的定义看起来有点古怪。</p> <p>我们看到 Mail 中有一个 randomMail() 方法，它负责随机地创建用于测试的邮件。而 generator() 方法生成一个 Iterable 对象，该对象在你调用 next() 方法时，在其内部使用 randomMail() 来创建 Mail 对象。这样的结构使程序员可以通过调用 Mail.generator() 方法，很容易地构造出一个 foreach 循环：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/PostOffice.java</span>
<span class=c1>// Modeling a post office</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>class</span> <span class=nc>Mail</span> <span class=p>{</span>
    <span class=c1>// The NO&#39;s reduce probability of random selection:</span>
    <span class=kd>enum</span> <span class=n>GeneralDelivery</span> <span class=p>{</span><span class=n>YES</span><span class=p>,</span><span class=n>NO1</span><span class=p>,</span><span class=n>NO2</span><span class=p>,</span><span class=n>NO3</span><span class=p>,</span><span class=n>NO4</span><span class=p>,</span><span class=n>NO5</span><span class=p>}</span>
    <span class=kd>enum</span> <span class=n>Scannability</span> <span class=p>{</span><span class=n>UNSCANNABLE</span><span class=p>,</span><span class=n>YES1</span><span class=p>,</span><span class=n>YES2</span><span class=p>,</span><span class=n>YES3</span><span class=p>,</span><span class=n>YES4</span><span class=p>}</span>
    <span class=kd>enum</span> <span class=n>Readability</span> <span class=p>{</span><span class=n>ILLEGIBLE</span><span class=p>,</span><span class=n>YES1</span><span class=p>,</span><span class=n>YES2</span><span class=p>,</span><span class=n>YES3</span><span class=p>,</span><span class=n>YES4</span><span class=p>}</span>
    <span class=kd>enum</span> <span class=n>Address</span> <span class=p>{</span><span class=n>INCORRECT</span><span class=p>,</span><span class=n>OK1</span><span class=p>,</span><span class=n>OK2</span><span class=p>,</span><span class=n>OK3</span><span class=p>,</span><span class=n>OK4</span><span class=p>,</span><span class=n>OK5</span><span class=p>,</span><span class=n>OK6</span><span class=p>}</span>
    <span class=kd>enum</span> <span class=n>ReturnAddress</span> <span class=p>{</span><span class=n>MISSING</span><span class=p>,</span><span class=n>OK1</span><span class=p>,</span><span class=n>OK2</span><span class=p>,</span><span class=n>OK3</span><span class=p>,</span><span class=n>OK4</span><span class=p>,</span><span class=n>OK5</span><span class=p>}</span>
    <span class=n>GeneralDelivery</span> <span class=n>generalDelivery</span><span class=p>;</span>
    <span class=n>Scannability</span> <span class=n>scannability</span><span class=p>;</span>
    <span class=n>Readability</span> <span class=n>readability</span><span class=p>;</span>
    <span class=n>Address</span> <span class=n>address</span><span class=p>;</span>
    <span class=n>ReturnAddress</span> <span class=n>returnAddress</span><span class=p>;</span>
    <span class=kd>static</span> <span class=kt>long</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kt>long</span> <span class=n>id</span> <span class=o>=</span> <span class=n>counter</span><span class=o>++</span><span class=p>;</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&quot;Mail &quot;</span> <span class=o>+</span> <span class=n>id</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>details</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>toString</span><span class=p>()</span> <span class=o>+</span>
                <span class=s>&quot;, General Delivery: &quot;</span> <span class=o>+</span> <span class=n>generalDelivery</span> <span class=o>+</span>
                <span class=s>&quot;, Address Scanability: &quot;</span> <span class=o>+</span> <span class=n>scannability</span> <span class=o>+</span>
                <span class=s>&quot;, Address Readability: &quot;</span> <span class=o>+</span> <span class=n>readability</span> <span class=o>+</span>
                <span class=s>&quot;, Address Address: &quot;</span> <span class=o>+</span> <span class=n>address</span> <span class=o>+</span>
                <span class=s>&quot;, Return address: &quot;</span> <span class=o>+</span> <span class=n>returnAddress</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// Generate test Mail:</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Mail</span> <span class=nf>randomMail</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>Mail</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Mail</span><span class=p>();</span>
        <span class=n>m</span><span class=p>.</span><span class=na>generalDelivery</span> <span class=o>=</span>
                <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>GeneralDelivery</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>scannability</span> <span class=o>=</span>
                <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>Scannability</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>readability</span> <span class=o>=</span>
                <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>Readability</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>address</span> <span class=o>=</span> <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>Address</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>returnAddress</span> <span class=o>=</span>
                <span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>ReturnAddress</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>m</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span>
    <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>Mail</span><span class=o>&gt;</span> <span class=nf>generator</span><span class=p>(</span><span class=kd>final</span> <span class=kt>int</span> <span class=n>count</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>Mail</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
            <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=n>count</span><span class=p>;</span>
            <span class=nd>@Override</span>
            <span class=kd>public</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Mail</span><span class=o>&gt;</span> <span class=nf>iterator</span><span class=p>()</span> <span class=p>{</span>
                <span class=k>return</span> <span class=k>new</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>Mail</span><span class=o>&gt;</span><span class=p>()</span> <span class=p>{</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>hasNext</span><span class=p>()</span> <span class=p>{</span>
                        <span class=k>return</span> <span class=n>n</span><span class=o>--</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span>
                    <span class=p>}</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=n>Mail</span> <span class=nf>next</span><span class=p>()</span> <span class=p>{</span>
                        <span class=k>return</span> <span class=n>randomMail</span><span class=p>();</span>
                    <span class=p>}</span>
                    <span class=nd>@Override</span>
                    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>remove</span><span class=p>()</span> <span class=p>{</span> <span class=c1>// Not implemented</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=p>();</span>
                    <span class=p>}</span>
                <span class=p>};</span>
            <span class=p>}</span>
        <span class=p>};</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PostOffice</span> <span class=p>{</span>
    <span class=kd>enum</span> <span class=n>MailHandler</span> <span class=p>{</span>
        <span class=n>GENERAL_DELIVERY</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>boolean</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>generalDelivery</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>YES</span><span class=p>:</span>
                        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                                <span class=s>&quot;Using general delivery for &quot;</span> <span class=o>+</span> <span class=n>m</span><span class=p>);</span>
                        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>MACHINE_SCAN</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>boolean</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>scannability</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>UNSCANNABLE</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                        <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>address</span><span class=p>)</span> <span class=p>{</span>
                            <span class=k>case</span> <span class=n>INCORRECT</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                            <span class=k>default</span><span class=p>:</span>
                                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                                        <span class=s>&quot;Delivering &quot;</span><span class=o>+</span> <span class=n>m</span> <span class=o>+</span> <span class=s>&quot; automatically&quot;</span><span class=p>);</span>
                                <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
                        <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>VISUAL_INSPECTION</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>boolean</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>readability</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>ILLEGIBLE</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                        <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>address</span><span class=p>)</span> <span class=p>{</span>
                            <span class=k>case</span> <span class=n>INCORRECT</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                            <span class=k>default</span><span class=p>:</span>
                                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                                        <span class=s>&quot;Delivering &quot;</span> <span class=o>+</span> <span class=n>m</span> <span class=o>+</span> <span class=s>&quot; normally&quot;</span><span class=p>);</span>
                                <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
                        <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>RETURN_TO_SENDER</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>boolean</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>returnAddress</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>MISSING</span><span class=p>:</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                                <span class=s>&quot;Returning &quot;</span> <span class=o>+</span> <span class=n>m</span> <span class=o>+</span> <span class=s>&quot; to sender&quot;</span><span class=p>);</span>
                        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>};</span>
        <span class=kd>abstract</span> <span class=kt>boolean</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>handle</span><span class=p>(</span><span class=n>Mail</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>MailHandler</span> <span class=n>handler</span> <span class=p>:</span> <span class=n>MailHandler</span><span class=p>.</span><span class=na>values</span><span class=p>())</span>
            <span class=k>if</span><span class=p>(</span><span class=n>handler</span><span class=p>.</span><span class=na>handle</span><span class=p>(</span><span class=n>m</span><span class=p>))</span>
                <span class=k>return</span><span class=p>;</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>m</span> <span class=o>+</span> <span class=s>&quot; is a dead letter&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Mail</span> <span class=n>mail</span> <span class=p>:</span> <span class=n>Mail</span><span class=p>.</span><span class=na>generator</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>mail</span><span class=p>.</span><span class=na>details</span><span class=p>());</span>
            <span class=n>handle</span><span class=p>(</span><span class=n>mail</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;*****&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>Mail 0, General Delivery: NO2, Address Scanability:
UNSCANNABLE, Address Readability: YES3, Address
Address: OK1, Return address: OK1
Delivering Mail 0 normally
*****
Mail 1, General Delivery: NO5, Address Scanability:
YES3, Address Readability: ILLEGIBLE, Address Address:
OK5, Return address: OK1
Delivering Mail 1 automatically
*****
Mail 2, General Delivery: YES, Address Scanability:
YES3, Address Readability: YES1, Address Address: OK1,
Return address: OK5
Using general delivery for Mail 2
*****
Mail 3, General Delivery: NO4, Address Scanability:
YES3, Address Readability: YES1, Address Address:
INCORRECT, Return address: OK4
Returning Mail 3 to sender
*****
Mail 4, General Delivery: NO4, Address Scanability:
UNSCANNABLE, Address Readability: YES1, Address
Address: INCORRECT, Return address: OK2
Returning Mail 4 to sender
*****
Mail 5, General Delivery: NO3, Address Scanability:
YES1, Address Readability: ILLEGIBLE, Address Address:
OK4, Return address: OK2
Delivering Mail 5 automatically
*****
Mail 6, General Delivery: YES, Address Scanability:
YES4, Address Readability: ILLEGIBLE, Address Address:
OK4, Return address: OK4
Using general delivery for Mail 6
*****
Mail 7, General Delivery: YES, Address Scanability:
YES3, Address Readability: YES4, Address Address: OK2,
Return address: MISSING
Using general delivery for Mail 7
*****
Mail 8, General Delivery: NO3, Address Scanability:
YES1, Address Readability: YES3, Address Address:
INCORRECT, Return address: MISSING
Mail 8 is a dead letter
*****
Mail 9, General Delivery: NO1, Address Scanability:
UNSCANNABLE, Address Readability: YES2, Address
Address: OK1, Return address: OK4
Delivering Mail 9 normally
*****
</code></pre></div> <p>职责链由 enum MailHandler 实现，而 enum 定义的次序决定了各个解决策略在应用时的次序。对每一封邮件，都要按此顺序尝试每个解决策略，直到其中一个能够成功地处理该邮件，如果所有的策略都失败了，那么该邮件将被判定为一封死信。</p> <h3 id=enum_4>使用 enum 的状态机<a class=headerlink href=#enum_4 title="Permanent link">#</a></h3> <p>枚举类型非常适合用来创建状态机。一个状态机可以具有有限个特定的状态，它通常根据输入，从一个状态转移到下一个状态，不过也可能存在瞬时状态（transient states），而一旦任务执行结束，状态机就会立刻离开瞬时状态。</p> <p>每个状态都具有某些可接受的输入，不同的输入会使状态机从当前状态转移到不同的新状态。由于 enum 对其实例有严格限制，非常适合用来表现不同的状态和输入。一般而言，每个状态都具有一些相关的输出。</p> <p>自动售贷机是一个很好的状态机的例子。首先，我们用一个 enum 定义各种输入：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/Input.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>Input</span> <span class=p>{</span>
    <span class=n>NICKEL</span><span class=p>(</span><span class=mi>5</span><span class=p>),</span> <span class=n>DIME</span><span class=p>(</span><span class=mi>10</span><span class=p>),</span> <span class=n>QUARTER</span><span class=p>(</span><span class=mi>25</span><span class=p>),</span> <span class=n>DOLLAR</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span>
    <span class=n>TOOTHPASTE</span><span class=p>(</span><span class=mi>200</span><span class=p>),</span> <span class=n>CHIPS</span><span class=p>(</span><span class=mi>75</span><span class=p>),</span> <span class=n>SODA</span><span class=p>(</span><span class=mi>100</span><span class=p>),</span> <span class=n>SOAP</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span>
    <span class=n>ABORT_TRANSACTION</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>int</span> <span class=nf>amount</span><span class=p>()</span> <span class=p>{</span> <span class=c1>// Disallow</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;ABORT.amount()&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>STOP</span> <span class=p>{</span> <span class=c1>// This must be the last instance.</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=kt>int</span> <span class=nf>amount</span><span class=p>()</span> <span class=p>{</span> <span class=c1>// Disallow</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;SHUT_DOWN.amount()&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=kt>int</span> <span class=n>value</span><span class=p>;</span> <span class=c1>// In cents</span>
    <span class=n>Input</span><span class=p>(</span><span class=kt>int</span> <span class=n>value</span><span class=p>)</span> <span class=p>{</span> <span class=k>this</span><span class=p>.</span><span class=na>value</span> <span class=o>=</span> <span class=n>value</span><span class=p>;</span> <span class=p>}</span>
    <span class=n>Input</span><span class=p>()</span> <span class=p>{}</span>
    <span class=kt>int</span> <span class=nf>amount</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>value</span><span class=p>;</span> <span class=p>};</span> <span class=c1>// In cents</span>
    <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Input</span> <span class=nf>randomSelection</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// Don&#39;t include STOP:</span>
        <span class=k>return</span> <span class=n>values</span><span class=p>()</span><span class=o>[</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=n>values</span><span class=p>().</span><span class=na>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>注意，除了两个特殊的 Input 实例之外，其他的 Input 都有相应的价格，因此在接口中定义了 amount（方法。然而，对那两个特殊 Input 实例而言，调用 amount（方法并不合适，所以如果程序员调用它们的 amount）方法就会有异常抛出（在接口内定义了一个方法，然后在你调用该方法的某个实现时就会抛出异常），这似乎有点奇怪，但由于 enum 的限制，我们不得不采用这种方式。</p> <p>VendingMachine 对输入的第一个反应是将其归类为 Category enum 中的某一个 enum 实例，这可以通过 switch 实现。下面的例子演示了 enum 是如何使代码变得更加清晰且易于管理的：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/VendingMachine.java</span>
<span class=c1>// {java VendingMachine VendingMachineInput.txt}</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.function.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>Category</span> <span class=p>{</span>
    <span class=n>MONEY</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>NICKEL</span><span class=p>,</span> <span class=n>Input</span><span class=p>.</span><span class=na>DIME</span><span class=p>,</span>
            <span class=n>Input</span><span class=p>.</span><span class=na>QUARTER</span><span class=p>,</span> <span class=n>Input</span><span class=p>.</span><span class=na>DOLLAR</span><span class=p>),</span>
    <span class=n>ITEM_SELECTION</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>TOOTHPASTE</span><span class=p>,</span> <span class=n>Input</span><span class=p>.</span><span class=na>CHIPS</span><span class=p>,</span>
            <span class=n>Input</span><span class=p>.</span><span class=na>SODA</span><span class=p>,</span> <span class=n>Input</span><span class=p>.</span><span class=na>SOAP</span><span class=p>),</span>
    <span class=n>QUIT_TRANSACTION</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>ABORT_TRANSACTION</span><span class=p>),</span>
    <span class=n>SHUT_DOWN</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>STOP</span><span class=p>);</span>
    <span class=kd>private</span> <span class=n>Input</span><span class=o>[]</span> <span class=n>values</span><span class=p>;</span>
    <span class=n>Category</span><span class=p>(</span><span class=n>Input</span><span class=p>...</span> <span class=n>types</span><span class=p>)</span> <span class=p>{</span> <span class=n>values</span> <span class=o>=</span> <span class=n>types</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>EnumMap</span><span class=o>&lt;</span><span class=n>Input</span><span class=p>,</span><span class=n>Category</span><span class=o>&gt;</span> <span class=n>categories</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>EnumMap</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=kd>static</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Category</span> <span class=n>c</span> <span class=p>:</span> <span class=n>Category</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getEnumConstants</span><span class=p>())</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Input</span> <span class=n>type</span> <span class=p>:</span> <span class=n>c</span><span class=p>.</span><span class=na>values</span><span class=p>)</span>
                <span class=n>categories</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>type</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Category</span> <span class=nf>categorize</span><span class=p>(</span><span class=n>Input</span> <span class=n>input</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>categories</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>input</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>VendingMachine</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>State</span> <span class=n>state</span> <span class=o>=</span> <span class=n>State</span><span class=p>.</span><span class=na>RESTING</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>amount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Input</span> <span class=n>selection</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=kd>enum</span> <span class=n>StateDuration</span> <span class=p>{</span> <span class=n>TRANSIENT</span> <span class=p>}</span> <span class=c1>// Tagging enum</span>
    <span class=kd>enum</span> <span class=n>State</span> <span class=p>{</span>
        <span class=n>RESTING</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>next</span><span class=p>(</span><span class=n>Input</span> <span class=n>input</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>Category</span><span class=p>.</span><span class=na>categorize</span><span class=p>(</span><span class=n>input</span><span class=p>))</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>MONEY</span><span class=p>:</span>
                        <span class=n>amount</span> <span class=o>+=</span> <span class=n>input</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span>
                        <span class=n>state</span> <span class=o>=</span> <span class=n>ADDING_MONEY</span><span class=p>;</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=n>SHUT_DOWN</span><span class=p>:</span>
                        <span class=n>state</span> <span class=o>=</span> <span class=n>TERMINAL</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>ADDING_MONEY</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>next</span><span class=p>(</span><span class=n>Input</span> <span class=n>input</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>Category</span><span class=p>.</span><span class=na>categorize</span><span class=p>(</span><span class=n>input</span><span class=p>))</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=n>MONEY</span><span class=p>:</span>
                        <span class=n>amount</span> <span class=o>+=</span> <span class=n>input</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=n>ITEM_SELECTION</span><span class=p>:</span>
                        <span class=n>selection</span> <span class=o>=</span> <span class=n>input</span><span class=p>;</span>
                        <span class=k>if</span><span class=p>(</span><span class=n>amount</span> <span class=o>&lt;</span> <span class=n>selection</span><span class=p>.</span><span class=na>amount</span><span class=p>())</span>
                            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                                    <span class=s>&quot;Insufficient money for &quot;</span> <span class=o>+</span> <span class=n>selection</span><span class=p>);</span>
                        <span class=k>else</span> <span class=n>state</span> <span class=o>=</span> <span class=n>DISPENSING</span><span class=p>;</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=n>QUIT_TRANSACTION</span><span class=p>:</span>
                        <span class=n>state</span> <span class=o>=</span> <span class=n>GIVING_CHANGE</span><span class=p>;</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=n>SHUT_DOWN</span><span class=p>:</span>
                        <span class=n>state</span> <span class=o>=</span> <span class=n>TERMINAL</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>DISPENSING</span><span class=p>(</span><span class=n>StateDuration</span><span class=p>.</span><span class=na>TRANSIENT</span><span class=p>)</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>next</span><span class=p>()</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;here is your &quot;</span> <span class=o>+</span> <span class=n>selection</span><span class=p>);</span>
                <span class=n>amount</span> <span class=o>-=</span> <span class=n>selection</span><span class=p>.</span><span class=na>amount</span><span class=p>();</span>
                <span class=n>state</span> <span class=o>=</span> <span class=n>GIVING_CHANGE</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>GIVING_CHANGE</span><span class=p>(</span><span class=n>StateDuration</span><span class=p>.</span><span class=na>TRANSIENT</span><span class=p>)</span> <span class=p>{</span>
            <span class=nd>@Override</span>
            <span class=kt>void</span> <span class=nf>next</span><span class=p>()</span> <span class=p>{</span>
                <span class=k>if</span><span class=p>(</span><span class=n>amount</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Your change: &quot;</span> <span class=o>+</span> <span class=n>amount</span><span class=p>);</span>
                    <span class=n>amount</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
                <span class=p>}</span>
                <span class=n>state</span> <span class=o>=</span> <span class=n>RESTING</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>},</span>
        <span class=n>TERMINAL</span> <span class=p>{</span><span class=nd>@Override</span>
        <span class=kt>void</span> <span class=nf>output</span><span class=p>()</span> <span class=p>{</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Halted&quot;</span><span class=p>);</span> <span class=p>}</span> <span class=p>};</span>
        <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>isTransient</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=n>State</span><span class=p>()</span> <span class=p>{}</span>
        <span class=n>State</span><span class=p>(</span><span class=n>StateDuration</span> <span class=n>trans</span><span class=p>)</span> <span class=p>{</span> <span class=n>isTransient</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span> <span class=p>}</span>
        <span class=kt>void</span> <span class=nf>next</span><span class=p>(</span><span class=n>Input</span> <span class=n>input</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;Only call &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;next(Input input) for non-transient states&quot;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=kt>void</span> <span class=nf>next</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span>
                    <span class=s>&quot;Only call next() for &quot;</span> <span class=o>+</span>
                            <span class=s>&quot;StateDuration.TRANSIENT states&quot;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=kt>void</span> <span class=nf>output</span><span class=p>()</span> <span class=p>{</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>amount</span><span class=p>);</span> <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>(</span><span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Input</span><span class=o>&gt;</span> <span class=n>gen</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>while</span><span class=p>(</span><span class=n>state</span> <span class=o>!=</span> <span class=n>State</span><span class=p>.</span><span class=na>TERMINAL</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>state</span><span class=p>.</span><span class=na>next</span><span class=p>(</span><span class=n>gen</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
            <span class=k>while</span><span class=p>(</span><span class=n>state</span><span class=p>.</span><span class=na>isTransient</span><span class=p>)</span>
                <span class=n>state</span><span class=p>.</span><span class=na>next</span><span class=p>();</span>
            <span class=n>state</span><span class=p>.</span><span class=na>output</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Input</span><span class=o>&gt;</span> <span class=n>gen</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomInputSupplier</span><span class=p>();</span>
        <span class=k>if</span><span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span>
            <span class=n>gen</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputSupplier</span><span class=p>(</span><span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>);</span>
        <span class=n>run</span><span class=p>(</span><span class=n>gen</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// For a basic sanity check:</span>
<span class=kd>class</span> <span class=nc>RandomInputSupplier</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Input</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Input</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>Input</span><span class=p>.</span><span class=na>randomSelection</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// Create Inputs from a file of &#39;;&#39;-separated strings:</span>
<span class=kd>class</span> <span class=nc>FileInputSupplier</span> <span class=kd>implements</span> <span class=n>Supplier</span><span class=o>&lt;</span><span class=n>Input</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>input</span><span class=p>;</span>
    <span class=n>FileInputSupplier</span><span class=p>(</span><span class=n>String</span> <span class=n>fileName</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>input</span> <span class=o>=</span> <span class=n>Files</span><span class=p>.</span><span class=na>lines</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>fileName</span><span class=p>))</span>
                    <span class=p>.</span><span class=na>skip</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=c1>// Skip the comment line</span>
                    <span class=p>.</span><span class=na>flatMap</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>s</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>)))</span>
                    <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>String</span><span class=p>::</span><span class=n>trim</span><span class=p>)</span>
                    <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>())</span>
                    <span class=p>.</span><span class=na>iterator</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Input</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>input</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>Enum</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>Input</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=n>input</span><span class=p>.</span><span class=na>next</span><span class=p>().</span><span class=na>trim</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>25
50
75
here is your CHIPS
0
100
200
here is your TOOTHPASTE
0
25
35
Your change: 35
0
25
35
Insufficient money for SODA
35
60
70
75
Insufficient money for SODA
75
Your change: 75
0
Halted
</code></pre></div> <p>由于用 switch 语句从 enum 实例中进行选择是最常见的一种方式（请注意，为了使 enum 在 switch 语句中的使用变得简单，我们是需要付出其他代价的），所以，我们经常遇到这样的问题：将多个 enum 进行分类时，“我们希望在什么 enum 中使用 switch 语句？”我们通过 VendingMachine 的例子来研究一下这个问题。对于每一个 State，我们都需要在输入动作的基本分类中进行查找：用户塞入钞票，选择了某个货物，操作被取消，以及机器停止。然而，在这些基本分类之下，我们又可以塞人不同类型的钞票，可以选择不同的货物。Category enum 将不同类型的 Input 进行分组，因而，可以使用 categorize0 方法为 switch 语句生成恰当的 Cateroy 实例。并且，该方法使用的 EnumMap 确保了在其中进行查询时的效率与安全。</p> <p>如果读者仔细研究 VendingMachine 类，就会发现每种状态的不同之处，以及对于输入的不同响应，其中还有两个瞬时状态。在 run() 方法中，状态机等待着下一个 Input，并一直在各个状态中移动，直到它不再处于瞬时状态。</p> <p>通过两种不同的 Generator 对象，我们可以使用不同的 Supplier 对象来测试 VendingMachine，首先是 RandomInputSupplier，它会不停地生成除了 SHUT-DOWN 之外的各种输入。通过长时间地运行 RandomInputSupplier，可以起到健全测试（sanity test）的作用，能够确保该状态机不会进入一个错误状态。另一个是 FileInputSupplier，使用文件以文本的方式来描述输入，然后将它们转换成 enum 实例，并创建对应的 Input 对象。上面的程序使用的正是如下的文本文件：</p> <div class=highlight><pre><span></span><code>// enums/VendingMachineInput.txt
QUARTER; QUARTER; QUARTER; CHIPS;
DOLLAR; DOLLAR; TOOTHPASTE;
QUARTER; DIME; ABORT_TRANSACTION;
QUARTER; DIME; SODA;
QUARTER; DIME; NICKEL; SODA;
ABORT_TRANSACTION;
STOP;
</code></pre></div> <p>FileInputSupplier 构造函数将此文件转换为流，并跳过注释行。然后它使用 String.split() 以分号进行分割。这会生成一个 String 数组，并可以通过将其转换为 Stream，然后应用 flatMap() 来将其输入到流中。其输出结果将去除所有空格空格，并转换为 List\&lt;String>，且从中获取 Iterator\&lt;String>。</p> <p>这种设计有一个缺陷，它要求 enum State 实例访问的 VendingMachine 属性必须声明为 static，这意味着，你只能有一个 VendingMachine 实例。不过如果我们思考一下实际的（嵌入式 Java）应用，这也许并不是一个大问题，因为在一台机器上，我们可能只有一个应用程序。</p> <!-- Multiple Dispatching --> <h2 id=_7>多路分发<a class=headerlink href=#_7 title="Permanent link">#</a></h2> <p>当你要处理多种交互类型时，程序可能会变得相当杂乱。举例来说，如果一个系统要分析和执行数学表达式。我们可能会声明 Number.plus(Number)，Number.multiple(Number) 等等，其中 Number 是各种数字对象的超类。然而，当你声明 a.plus(b) 时，你并不知道 a 或 b 的确切类型，那你如何能让它们正确地交互呢？</p> <p>你可能从未思考过这个问题的答案.Java 只支持单路分发。也就是说，如果要执行的操作包含了不止一个类型未知的对象时，那么 Java 的动态绑定机制只能处理其中一个的类型。这就无法解决我们上面提到的问题。所以，你必须自己来判定其他的类型，从而实现自己的动态线定行为。</p> <p>解决上面问题的办法就是多路分发（在那个例子中，只有两个分发，一般称之为两路分发）.多态只能发生在方法调用时，所以，如果你想使用两路分发，那么就必须有两个方法调用：第一个方法调用决定第一个未知类型，第二个方法调用决定第二个未知的类型。要利用多路分发，程序员必须为每一个类型提供一个实际的方法调用，如果你要处理两个不同的类型体系，就需要为每个类型体系执行一个方法调用。一般而言，程序员需要有设定好的某种配置，以便一个方法调用能够引出更多的方法调用，从而能够在这个过程中处理多种类型。为了达到这种效果，我们需要与多个方法一同工作：因为每个分发都需要一个方法调用。在下面的例子中（实现了 “石头、剪刀、布”游戏，也称为 RoShamBo）对应的方法是 compete() 和 eval()，二者都是同一个类型的成员，它们可以产生三种 Outcome 实例中的一个作为结果：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/Outcome.java</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>Outcome</span> <span class=p>{</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>DRAW</span> <span class=p>}</span>
<span class=c1>// enums/RoShamBo1.java</span>
<span class=c1>// Demonstration of multiple dispatching</span>
<span class=c1>// {java enums.RoShamBo1}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
        <span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
        <span class=kn>import static</span> <span class=nn>enums.Outcome.*</span><span class=p>;</span>
<span class=kd>interface</span> <span class=nc>Item</span> <span class=p>{</span>
    <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>Item</span> <span class=n>it</span><span class=p>);</span>
    <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Paper</span> <span class=n>p</span><span class=p>);</span>
    <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Scissors</span> <span class=n>s</span><span class=p>);</span>
    <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Rock</span> <span class=n>r</span><span class=p>);</span>
<span class=p>}</span>
<span class=kd>class</span> <span class=nc>Paper</span> <span class=kd>implements</span> <span class=n>Item</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>Item</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>it</span><span class=p>.</span><span class=na>eval</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Paper</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Scissors</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Rock</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&quot;Paper&quot;</span><span class=p>;</span> <span class=p>}</span>
<span class=p>}</span>
<span class=kd>class</span> <span class=nc>Scissors</span> <span class=kd>implements</span> <span class=n>Item</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>Item</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>it</span><span class=p>.</span><span class=na>eval</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Paper</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Scissors</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Rock</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&quot;Scissors&quot;</span><span class=p>;</span> <span class=p>}</span>
<span class=p>}</span>
<span class=kd>class</span> <span class=nc>Rock</span> <span class=kd>implements</span> <span class=n>Item</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>Item</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>it</span><span class=p>.</span><span class=na>eval</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Paper</span> <span class=n>p</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Scissors</span> <span class=n>s</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>eval</span><span class=p>(</span><span class=n>Rock</span> <span class=n>r</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=s>&quot;Rock&quot;</span><span class=p>;</span> <span class=p>}</span>
<span class=p>}</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RoShamBo1</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>SIZE</span> <span class=o>=</span> <span class=mi>20</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>Item</span> <span class=nf>newItem</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>rand</span><span class=p>.</span><span class=na>nextInt</span><span class=p>(</span><span class=mi>3</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>default</span><span class=p>:</span>
            <span class=k>case</span> <span class=mi>0</span><span class=p>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Scissors</span><span class=p>();</span>
            <span class=k>case</span> <span class=mi>1</span><span class=p>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Paper</span><span class=p>();</span>
            <span class=k>case</span> <span class=mi>2</span><span class=p>:</span> <span class=k>return</span> <span class=k>new</span> <span class=n>Rock</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>match</span><span class=p>(</span><span class=n>Item</span> <span class=n>a</span><span class=p>,</span> <span class=n>Item</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>a</span> <span class=o>+</span> <span class=s>&quot; vs. &quot;</span> <span class=o>+</span> <span class=n>b</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>a</span><span class=p>.</span><span class=na>compete</span><span class=p>(</span><span class=n>b</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>SIZE</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>match</span><span class=p>(</span><span class=n>newItem</span><span class=p>(),</span> <span class=n>newItem</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>Rock vs. Rock: DRAW
Paper vs. Rock: WIN
Paper vs. Rock: WIN
Paper vs. Rock: WIN
Scissors vs. Paper: WIN
Scissors vs. Scissors: DRAW
Scissors vs. Paper: WIN
Rock vs. Paper: LOSE
Paper vs. Paper: DRAW
Rock vs. Paper: LOSE
Paper vs. Scissors: LOSE
Paper vs. Scissors: LOSE
Rock vs. Scissors: WIN
Rock vs. Paper: LOSE
Paper vs. Rock: WIN
Scissors vs. Paper: WIN
Paper vs. Scissors: LOSE
Paper vs. Scissors: LOSE
Paper vs. Scissors: LOSE
Paper vs. Scissors: LOSE
</code></pre></div> <p>Item 是这几种类型的接口，将会被用作多路分发。RoShamBo1.match() 有两个 Item 参数，通过调用 Item.compete90) 方法开始两路分发。要判定 a 的类型，分发机制会在 a 的实际类型的 compete（内部起到分发的作用。compete() 方法通过调用 eval() 来为另一个类型实现第二次分法。</p> <p>将自身（this）作为参数调用 evalo，能够调用重载过的 eval() 方法，这能够保留第一次分发的类型信息。当第二次分发完成时，你就能够知道两个 Item 对象的具体类型了。</p> <p>要配置好多路分发需要很多的工序，不过要记住，它的好处在于方法调用时的优雅的话法，这避免了在一个方法中判定多个对象的类型的丑陋代码，你只需说，“嘿，你们两个，我不在乎你们是什么类型，请你们自己交流！”不过，在使用多路分发前，请先明确，这种优雅的代码对你确实有重要的意义。</p> <h3 id=enum_5>使用 enum 分发<a class=headerlink href=#enum_5 title="Permanent link">#</a></h3> <p>直接将 RoShamBol.java 翻译为基于 enum 的版本是有问题的，因为 enum 实例不是类型，不能将 enum 实例作为参数的类型，所以无法重载 eval() 方法。不过，还有很多方式可以实现多路分发，并从 enum 中获益。</p> <p>一种方式是使用构造器来初始化每个 enum 实例，并以“一组”结果作为参数。这二者放在一块，形成了类似查询表的结构：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RoShamBo2.java</span>
<span class=c1>// Switching one enum on another</span>
<span class=c1>// {java enums.RoShamBo2}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.Outcome.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>RoShamBo2</span> <span class=kd>implements</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>RoShamBo2</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>PAPER</span><span class=p>(</span><span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span><span class=p>),</span>
    <span class=n>SCISSORS</span><span class=p>(</span><span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>),</span>
    <span class=n>ROCK</span><span class=p>(</span><span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>);</span>
    <span class=kd>private</span> <span class=n>Outcome</span> <span class=n>vPAPER</span><span class=p>,</span> <span class=n>vSCISSORS</span><span class=p>,</span> <span class=n>vROCK</span><span class=p>;</span>
    <span class=n>RoShamBo2</span><span class=p>(</span><span class=n>Outcome</span> <span class=n>paper</span><span class=p>,</span>
              <span class=n>Outcome</span> <span class=n>scissors</span><span class=p>,</span> <span class=n>Outcome</span> <span class=n>rock</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>vPAPER</span> <span class=o>=</span> <span class=n>paper</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>vSCISSORS</span> <span class=o>=</span> <span class=n>scissors</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>vROCK</span> <span class=o>=</span> <span class=n>rock</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo2</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>switch</span><span class=p>(</span><span class=n>it</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>default</span><span class=p>:</span>
            <span class=k>case</span> <span class=n>PAPER</span><span class=p>:</span> <span class=k>return</span> <span class=n>vPAPER</span><span class=p>;</span>
            <span class=k>case</span> <span class=n>SCISSORS</span><span class=p>:</span> <span class=k>return</span> <span class=n>vSCISSORS</span><span class=p>;</span>
            <span class=k>case</span> <span class=n>ROCK</span><span class=p>:</span> <span class=k>return</span> <span class=n>vROCK</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RoShamBo</span><span class=p>.</span><span class=na>play</span><span class=p>(</span><span class=n>RoShamBo2</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>ROCK vs. ROCK: DRAW
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
PAPER vs. PAPER: DRAW
PAPER vs. SCISSORS: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. SCISSORS: DRAW
ROCK vs. SCISSORS: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
ROCK vs. PAPER: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
</code></pre></div> <p>在 compete() 方法中，一旦两种类型都被确定了，那么唯一的操作就是返回结果 Outcome 然而，你可能还需要调用其他的方法，（例如）甚至是调用在构造器中指定的某个命令对象上的方法。</p> <p>RoShamBo2.javal 之前的例子短小得多，而且更直接，更易于理解。注意，我们仍然是使用两路分发来判定两个对象的类型。在 RoShamBol.java 中，两次分发都是通过实际的方法调用实现，而在这个例子中，只有第一次分发是实际的方法调用。第二个分发使用的是 switch，不过这样做是安全的，因为 enum 限制了 switch 语句的选择分支。</p> <p>在代码中，enum 被单独抽取出来，因此它可以应用在其他例子中。首先，Competitor 接口定义了一种类型，该类型的对象可以与另一个 Competitor 相竞争：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/Competitor.java</span>
<span class=c1>// Switching one enum on another</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Competitor</span><span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
    <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>T</span> <span class=n>competitor</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>然后，我们定义两个 static 方法（static 可以避免显式地指明参数类型），第一个是 match() 方法，它会为一个 Competitor 对象调用 compete() 方法，并与另一个 Competitor 对象作比较。在这个例子中，我们看到，match()）方法的参数需要是 Competitor\&lt;T> 类型。但是在 play() 方法中，类型参数必须同时是 Enum\&lt;T> 类型（因为它将在 Enums.random() 中使用）和 Competitor\&lt;T> 类型因为它将被传递给 match() 方法）：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RoShamBo.java</span>
<span class=c1>// Common tools for RoShamBo examples</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RoShamBo</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span>
    <span class=kt>void</span> <span class=nf>match</span><span class=p>(</span><span class=n>T</span> <span class=n>a</span><span class=p>,</span> <span class=n>T</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=n>a</span> <span class=o>+</span> <span class=s>&quot; vs. &quot;</span> <span class=o>+</span> <span class=n>b</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>a</span><span class=p>.</span><span class=na>compete</span><span class=p>(</span><span class=n>b</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=o>&lt;</span><span class=n>T</span> <span class=kd>extends</span> <span class=n>Enum</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=o>&amp;</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;&gt;</span>
    <span class=kt>void</span> <span class=nf>play</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>rsbClass</span><span class=p>,</span> <span class=kt>int</span> <span class=n>size</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>size</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>match</span><span class=p>(</span><span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>rsbClass</span><span class=p>),</span><span class=n>Enums</span><span class=p>.</span><span class=na>random</span><span class=p>(</span><span class=n>rsbClass</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>play() 方法没有将类型参数 T 作为返回值类型，因此，似乎我们应该在 Class\&lt;T> 中使用通配符来代替上面的参数声明。然而，通配符不能扩展多个基类，所以我们必须采用以上的表达式。</p> <h3 id=_8>使用常量相关的方法<a class=headerlink href=#_8 title="Permanent link">#</a></h3> <p>常量相关的方法允许我们为每个 enum 实例提供方法的不同实现，这使得常量相关的方法似乎是实现多路分发的完美解决方案。不过，通过这种方式，enum 实例虽然可以具有不同的行为，但它们仍然不是类型，不能将其作为方法签名中的参数类型来使用。最好的办法是将 enum 用在 switch 语句中，见下例：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RoShamBo3.java</span>
<span class=c1>// Using constant-specific methods</span>
<span class=c1>// {java enums.RoShamBo3}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.Outcome.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>RoShamBo3</span> <span class=kd>implements</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>RoShamBo3</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>PAPER</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo3</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>switch</span><span class=p>(</span><span class=n>it</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>default</span><span class=p>:</span> <span class=c1>// To placate the compiler</span>
                <span class=k>case</span> <span class=n>PAPER</span><span class=p>:</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>SCISSORS</span><span class=p>:</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>ROCK</span><span class=p>:</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>SCISSORS</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo3</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>switch</span><span class=p>(</span><span class=n>it</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>default</span><span class=p>:</span>
                <span class=k>case</span> <span class=n>PAPER</span><span class=p>:</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>SCISSORS</span><span class=p>:</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>ROCK</span><span class=p>:</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>ROCK</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo3</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>switch</span><span class=p>(</span><span class=n>it</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>default</span><span class=p>:</span>
                <span class=k>case</span> <span class=n>PAPER</span><span class=p>:</span> <span class=k>return</span> <span class=n>LOSE</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>SCISSORS</span><span class=p>:</span> <span class=k>return</span> <span class=n>WIN</span><span class=p>;</span>
                <span class=k>case</span> <span class=n>ROCK</span><span class=p>:</span> <span class=k>return</span> <span class=n>DRAW</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo3</span> <span class=n>it</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RoShamBo</span><span class=p>.</span><span class=na>play</span><span class=p>(</span><span class=n>RoShamBo3</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>ROCK vs. ROCK: DRAW
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
PAPER vs. PAPER: DRAW
PAPER vs. SCISSORS: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. SCISSORS: DRAW
ROCK vs. SCISSORS: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
ROCK vs. PAPER: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
</code></pre></div> <p>虽然这种方式可以工作，但是却不甚合理，如果采用 RoShamB02.java 的解决方案，那么在添加一个新的类型时，只需更少的代码，而且也更直接。</p> <p>:然而，RoShamBo3.java 还可以压缩简化一下：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RoShamBo4.java</span>
<span class=c1>// {java enums.RoShamBo4}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>enum</span> <span class=n>RoShamBo4</span> <span class=kd>implements</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>RoShamBo4</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>ROCK</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo4</span> <span class=n>opponent</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>compete</span><span class=p>(</span><span class=n>SCISSORS</span><span class=p>,</span> <span class=n>opponent</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>SCISSORS</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo4</span> <span class=n>opponent</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>compete</span><span class=p>(</span><span class=n>PAPER</span><span class=p>,</span> <span class=n>opponent</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>},</span>
    <span class=n>PAPER</span> <span class=p>{</span>
        <span class=nd>@Override</span>
        <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo4</span> <span class=n>opponent</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>compete</span><span class=p>(</span><span class=n>ROCK</span><span class=p>,</span> <span class=n>opponent</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>};</span>
    <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo4</span> <span class=n>loser</span><span class=p>,</span> <span class=n>RoShamBo4</span> <span class=n>opponent</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>((</span><span class=n>opponent</span> <span class=o>==</span> <span class=k>this</span><span class=p>)</span> <span class=o>?</span> <span class=n>Outcome</span><span class=p>.</span><span class=na>DRAW</span>
                <span class=p>:</span> <span class=p>((</span><span class=n>opponent</span> <span class=o>==</span> <span class=n>loser</span><span class=p>)</span> <span class=o>?</span> <span class=n>Outcome</span><span class=p>.</span><span class=na>WIN</span>
                <span class=p>:</span> <span class=n>Outcome</span><span class=p>.</span><span class=na>LOSE</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RoShamBo</span><span class=p>.</span><span class=na>play</span><span class=p>(</span><span class=n>RoShamBo4</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>PAPER vs. PAPER: DRAW
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
ROCK vs. SCISSORS: WIN
ROCK vs. ROCK: DRAW
ROCK vs. SCISSORS: WIN
PAPER vs. SCISSORS: LOSE
SCISSORS vs. SCISSORS: DRAW
PAPER vs. SCISSORS: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
PAPER vs. ROCK: WIN
PAPER vs. SCISSORS: LOSE
SCISSORS vs. PAPER: WIN
ROCK vs. SCISSORS: WIN
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
</code></pre></div> <p>其中，具有两个参数的 compete() 方法执行第二个分发，该方法执行一系列的比较，其行为类似 switch 语句。这个版本的程序更简短，不过却比较难理解，对于一个大型系统而言，难以理解的代码将导致整个系统不够健壮。</p> <h3 id=enummap_1>使用 EnumMap 进行分发<a class=headerlink href=#enummap_1 title="Permanent link">#</a></h3> <p>使用 EnumMap 能够实现“真正的”两路分发。EnumMap 是为 enum 专门设计的一种性能非常好的特殊 Map。由于我们的目的是摸索出两种未知的类型，所以可以用一个 EnumMap 的 EnumMap 来实现两路分发：</p> <div class=highlight><pre><span></span><code><span class=c1>// enums/RoShamBo5.java</span>
<span class=c1>// Multiple dispatching using an EnumMap of EnumMaps</span>
<span class=c1>// {java enums.RoShamBo5}</span>
<span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import static</span> <span class=nn>enums.Outcome.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>RoShamBo5</span> <span class=kd>implements</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>RoShamBo5</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>PAPER</span><span class=p>,</span> <span class=n>SCISSORS</span><span class=p>,</span> <span class=n>ROCK</span><span class=p>;</span>
    <span class=kd>static</span> <span class=n>EnumMap</span><span class=o>&lt;</span><span class=n>RoShamBo5</span><span class=p>,</span><span class=n>EnumMap</span><span class=o>&lt;</span><span class=n>RoShamBo5</span><span class=p>,</span><span class=n>Outcome</span><span class=o>&gt;&gt;</span>
            <span class=n>table</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EnumMap</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=kd>static</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>RoShamBo5</span> <span class=n>it</span> <span class=p>:</span> <span class=n>RoShamBo5</span><span class=p>.</span><span class=na>values</span><span class=p>())</span>
            <span class=n>table</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>it</span><span class=p>,</span> <span class=k>new</span> <span class=n>EnumMap</span><span class=o>&lt;&gt;</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>class</span><span class=p>));</span>
        <span class=n>initRow</span><span class=p>(</span><span class=n>PAPER</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span><span class=p>);</span>
        <span class=n>initRow</span><span class=p>(</span><span class=n>SCISSORS</span><span class=p>,</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>);</span>
        <span class=n>initRow</span><span class=p>(</span><span class=n>ROCK</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>initRow</span><span class=p>(</span><span class=n>RoShamBo5</span> <span class=n>it</span><span class=p>,</span>
                        <span class=n>Outcome</span> <span class=n>vPAPER</span><span class=p>,</span> <span class=n>Outcome</span> <span class=n>vSCISSORS</span><span class=p>,</span> <span class=n>Outcome</span> <span class=n>vROCK</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>EnumMap</span><span class=o>&lt;</span><span class=n>RoShamBo5</span><span class=p>,</span><span class=n>Outcome</span><span class=o>&gt;</span> <span class=n>row</span> <span class=o>=</span>
                <span class=n>RoShamBo5</span><span class=p>.</span><span class=na>table</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
        <span class=n>row</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>PAPER</span><span class=p>,</span> <span class=n>vPAPER</span><span class=p>);</span>
        <span class=n>row</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>SCISSORS</span><span class=p>,</span> <span class=n>vSCISSORS</span><span class=p>);</span>
        <span class=n>row</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>ROCK</span><span class=p>,</span> <span class=n>vROCK</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo5</span> <span class=n>it</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>table</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=k>this</span><span class=p>).</span><span class=na>get</span><span class=p>(</span><span class=n>it</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RoShamBo</span><span class=p>.</span><span class=na>play</span><span class=p>(</span><span class=n>RoShamBo5</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>ROCK vs. ROCK: DRAW
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
PAPER vs. PAPER: DRAW
PAPER vs. SCISSORS: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. SCISSORS: DRAW
ROCK vs. SCISSORS: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
ROCK vs. PAPER: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
</code></pre></div> <p>该程序在一个 static 子句中初始化 EnumMap 对象，具体见表格似的 initRow() 方法调用。请注意 compete() 方法，您可以看到，在一行语句中发生了两次分发。</p> <h3 id=_9>使用二维数组<a class=headerlink href=#_9 title="Permanent link">#</a></h3> <p>我们还可以进一步简化实现两路分发的解决方案。我们注意到，每个 enum 实例都有一个固定的值（基于其声明的次序），并且可以通过 ordinal() 方法取得该值。因此我们可以使用二维数组，将竞争者映射到竞争结果。采用这种方式能够获得最简洁、最直接的解决方案（很可能也是最快速的，虽然我们知道 EnumMap 内部其实也是使用数组实现的）。</p> <div class=highlight><pre><span></span><code><span class=n>We</span> <span class=n>can</span> <span class=n>simplify</span> <span class=n>the</span> <span class=n>solution</span> <span class=n>even</span> <span class=n>more</span> <span class=n>by</span> <span class=n>noting</span> <span class=n>that</span> <span class=n>each</span>  <span class=kd>enum</span> <span class=n>instance</span> <span class=n>has</span> <span class=n>a</span> <span class=n>fixed</span>
        <span class=nf>value</span> <span class=p>(</span><span class=n>based</span> <span class=n>on</span> <span class=n>its</span> <span class=n>declaration</span> <span class=n>order</span><span class=p>)</span> <span class=n>and</span> <span class=n>that</span>  <span class=nf>ordinal</span><span class=p>()</span> <span class=n>produces</span> <span class=k>this</span> <span class=n>value</span><span class=p>.</span> <span class=n>A</span> <span class=n>two</span><span class=o>-</span>
        <span class=n>dimensional</span> <span class=n>array</span> <span class=n>mapping</span> <span class=n>the</span> <span class=n>competitors</span> <span class=n>onto</span> <span class=n>the</span> <span class=n>outcomes</span> <span class=n>produces</span> <span class=n>the</span> <span class=n>smallest</span>
        <span class=n>and</span> <span class=n>most</span> <span class=n>straightforward</span> <span class=nf>solution</span> <span class=p>(</span><span class=n>and</span> <span class=n>possibly</span> <span class=n>the</span> <span class=n>fastest</span><span class=p>,</span> <span class=n>although</span> <span class=n>remember</span> <span class=n>that</span>
        <span class=n>EnumMap</span> <span class=n>uses</span> <span class=n>an</span> <span class=n>internal</span> <span class=n>array</span><span class=p>):</span>
<span class=c1>// enums/RoShamBo6.java</span>
<span class=c1>// Enums using &quot;tables&quot; instead of multiple dispatch</span>
<span class=c1>// {java enums.RoShamBo6}</span>
        <span class=kn>package</span> <span class=nn>enums</span><span class=p>;</span>
        <span class=kn>import static</span> <span class=nn>enums.Outcome.*</span><span class=p>;</span>
<span class=kd>enum</span> <span class=n>RoShamBo6</span> <span class=kd>implements</span> <span class=n>Competitor</span><span class=o>&lt;</span><span class=n>RoShamBo6</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=n>PAPER</span><span class=p>,</span> <span class=n>SCISSORS</span><span class=p>,</span> <span class=n>ROCK</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Outcome</span><span class=o>[][]</span> <span class=n>table</span> <span class=o>=</span> <span class=p>{</span>
            <span class=p>{</span> <span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span> <span class=p>},</span> <span class=c1>// PAPER</span>
            <span class=p>{</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span><span class=p>,</span> <span class=n>LOSE</span> <span class=p>},</span> <span class=c1>// SCISSORS</span>
            <span class=p>{</span> <span class=n>LOSE</span><span class=p>,</span> <span class=n>WIN</span><span class=p>,</span> <span class=n>DRAW</span> <span class=p>},</span> <span class=c1>// ROCK</span>
    <span class=p>};</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Outcome</span> <span class=nf>compete</span><span class=p>(</span><span class=n>RoShamBo6</span> <span class=n>other</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>table</span><span class=o>[</span><span class=k>this</span><span class=p>.</span><span class=na>ordinal</span><span class=p>()</span><span class=o>][</span><span class=n>other</span><span class=p>.</span><span class=na>ordinal</span><span class=p>()</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>RoShamBo</span><span class=p>.</span><span class=na>play</span><span class=p>(</span><span class=n>RoShamBo6</span><span class=p>.</span><span class=na>class</span><span class=p>,</span> <span class=mi>20</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code>ROCK vs. ROCK: DRAW
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
PAPER vs. PAPER: DRAW
PAPER vs. SCISSORS: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. SCISSORS: DRAW
ROCK vs. SCISSORS: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
ROCK vs. PAPER: LOSE
ROCK vs. SCISSORS: WIN
SCISSORS vs. ROCK: LOSE
PAPER vs. SCISSORS: LOSE
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
SCISSORS vs. PAPER: WIN
</code></pre></div> <p>table 与前一个例子中 initRow() 方法的调用次序完全相同。</p> <p>与前面一个例子相比，这个程序代码虽然简短，但表达能力却更强，部分原因是其代码更易于理解与修改，而且也更直接。不过，由于它使用的是数组，所以这种方式不太“安全”。如果使用一个大型数组，可能会不小心使用了错误的尺寸，而且，如果你的测试不能覆盖所有的可能性，有些错误可能会从你眼前溜过。</p> <p>事实上，以上所有的解决方案只是各种不同类型的表罢了。不过，分析各种表的表现形式，找出最适合的那一种，还是很有价值的。注意，虽然上例是最简洁的一种解决方案，但它也是相当僵硬的方案，因为它只能针对给定的常量输入产生常量输出。然而，也没有什么特别的理由阻止你用 table 来生成功能对象。对于某类问题而言，“表驱动式编码”的概念具有非常强大的功能。</p> <!-- Summary --> <h2 id=_10>本章小结<a class=headerlink href=#_10 title="Permanent link">#</a></h2> <p>虽然枚举类型本身并不是特别复杂，但我还是将本章安排在全书比较靠后的位置，这是因为，程序员可以将 enum 与 Java 语言的其他功能结合使用，例如多态、泛型和反射。</p> <p>虽然 Java 中的枚举比 C 或 C++中的 enum 更成熟，但它仍然是一个“小”功能，Java 没有它也已经（虽然有点笨拙）存在很多年了。而本章正好说明了一个“小”功能所能带来的价值。有时恰恰因为它，你才能够优雅而干净地解决问题。正如我在本书中一再强调的那样，优雅与清晰很重要，正是它们区别了成功的解决方案与失败的解决方案。而失败的解决方案就是因为其他人无法理解它。</p> <p>关于清晰的话题，Java 1.0 对术语 enumeration 的选择正是一个不幸的反例。对于一个专门用于从序列中选择每一个元素的对象而言，Java 竟然没有使用更通用、更普遍接受的术语 iterator 来表示它（参见<a href>集合 </a> 章节），有些语言甚至将枚举的数据类型称为 “enumerators”！Java 修正了这个错误，但是 Enumeration 接口已经无法轻易地抹去了，因此它将一直存在于旧的（甚至有些新的）代码、类库以及文档中。</p> <!-- 分页 --> <div style="page-break-after: always;"></div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../21-Arrays/ title="21 Arrays" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 21 Arrays </span> </div> </a> <a href=../23-Annotations/ title="23 Annotations" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 23 Annotations </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://leay.net target=_blank rel=noopener title=home class="md-footer-social__link fa fa-home"></a> <a href=https://github.com/hqweay target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.c33a9706.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.ja.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.multi.js></script> <script>app.initialize({version:"1.1",url:{base:"../../../../.."}})</script> </body> </html>