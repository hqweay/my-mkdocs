<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Thinking Drafts"><link href=https://wiki.leay.net/book/OnJava8/docs/book/Appendix-New-IO/ rel=canonical><meta name=author content=hqweay><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content="en, ja"><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>Appendix New IO - Hqweay's Wiki</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../../../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105976066-3", "wiki.leay.net")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=indigo> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#io tabindex=0 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" aria-label="Hqweay's Wiki" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Hqweay's Wiki </span> <span class=md-header-nav__topic> Appendix New IO </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Book </a> </li> <li class=md-tabs__item> <a href=../../../../../doc/ class=md-tabs__link> Doc </a> </li> <li class=md-tabs__item> <a href=../../../../../life/reading/ class=md-tabs__link> Life </a> </li> <li class=md-tabs__item> <a href=../../../../../study/draft/try-wiki/ class=md-tabs__link> Study </a> </li> <li class=md-tabs__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ class=md-tabs__link> Tech </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Hqweay's Wiki </label> <div class=md-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../../../../test/ title=特殊语法 class=md-nav__link> 特殊语法 </a> </li> <li class=md-nav__item> <a href=../../../../../web-page/ title=静态文档导航 class=md-nav__link> 静态文档导航 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1 checked> <label class=md-nav__link for=nav-4-1> OnJava8 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> OnJava8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title="《On Java 8》中文版" class=md-nav__link> 《On Java 8》中文版 </a> </li> <li class=md-nav__item> <a href=../../../CONTRIBUTING/ title=CONTRIBUTING class=md-nav__link> CONTRIBUTING </a> </li> <li class=md-nav__item> <a href=../../../SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4 type=checkbox id=nav-4-1-4 checked> <label class=md-nav__link for=nav-4-1-4> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-1-4> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title=译者的话 class=md-nav__link> 译者的话 </a> </li> <li class=md-nav__item> <a href=../../_coverpage/ title=coverpage class=md-nav__link> coverpage </a> </li> <li class=md-nav__item> <a href=../../sidebar/ title=Sidebar class=md-nav__link> Sidebar </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4 type=checkbox id=nav-4-1-4-4> <label class=md-nav__link for=nav-4-1-4-4> style </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-4> style </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4-1 type=checkbox id=nav-4-1-4-4-1> <label class=md-nav__link for=nav-4-1-4-4-1> Prism master </label> <nav class=md-nav data-md-component=collapsible data-md-level=5> <label class=md-nav__title for=nav-4-1-4-4-1> Prism master </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_style/prism-master/ title=[Prism](http://prismjs.com/) class=md-nav__link> [Prism](http://prismjs.com/) </a> </li> <li class=md-nav__item> <a href=../../_style/prism-master/CHANGELOG/ title="Prism Changelog" class=md-nav__link> Prism Changelog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-5 type=checkbox id=nav-4-1-4-5 checked> <label class=md-nav__link for=nav-4-1-4-5> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-5> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../00-Introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../00-On-Java-8/ title="00 On Java 8" class=md-nav__link> 00 On Java 8 </a> </li> <li class=md-nav__item> <a href=../00-Preface/ title=前言 class=md-nav__link> 前言 </a> </li> <li class=md-nav__item> <a href=../01-What-is-an-Object/ title="第一章 对象的概念" class=md-nav__link> 第一章 对象的概念 </a> </li> <li class=md-nav__item> <a href=../02-Installing-Java-and-the-Book-Examples/ title="02 Installing Java and the Book Examples" class=md-nav__link> 02 Installing Java and the Book Examples </a> </li> <li class=md-nav__item> <a href=../03-Objects-Everywhere/ title="03 Objects Everywhere" class=md-nav__link> 03 Objects Everywhere </a> </li> <li class=md-nav__item> <a href=../04-Operators/ title="04 Operators" class=md-nav__link> 04 Operators </a> </li> <li class=md-nav__item> <a href=../05-Control-Flow/ title="05 Control Flow" class=md-nav__link> 05 Control Flow </a> </li> <li class=md-nav__item> <a href=../06-Housekeeping/ title="06 Housekeeping" class=md-nav__link> 06 Housekeeping </a> </li> <li class=md-nav__item> <a href=../07-Implementation-Hiding/ title="07 Implementation Hiding" class=md-nav__link> 07 Implementation Hiding </a> </li> <li class=md-nav__item> <a href=../08-Reuse/ title="08 Reuse" class=md-nav__link> 08 Reuse </a> </li> <li class=md-nav__item> <a href=../09-Polymorphism/ title="09 Polymorphism" class=md-nav__link> 09 Polymorphism </a> </li> <li class=md-nav__item> <a href=../10-Interfaces/ title="10 Interfaces" class=md-nav__link> 10 Interfaces </a> </li> <li class=md-nav__item> <a href=../11-Inner-Classes/ title="11 Inner Classes" class=md-nav__link> 11 Inner Classes </a> </li> <li class=md-nav__item> <a href=../12-Collections/ title="12 Collections" class=md-nav__link> 12 Collections </a> </li> <li class=md-nav__item> <a href=../13-Functional-Programming/ title="13 Functional Programming" class=md-nav__link> 13 Functional Programming </a> </li> <li class=md-nav__item> <a href=../14-Streams/ title="14 Streams" class=md-nav__link> 14 Streams </a> </li> <li class=md-nav__item> <a href=../15-Exceptions/ title="15 Exceptions" class=md-nav__link> 15 Exceptions </a> </li> <li class=md-nav__item> <a href=../16-Validating-Your-Code/ title="16 Validating Your Code" class=md-nav__link> 16 Validating Your Code </a> </li> <li class=md-nav__item> <a href=../17-Files/ title="17 Files" class=md-nav__link> 17 Files </a> </li> <li class=md-nav__item> <a href=../18-Strings/ title="18 Strings" class=md-nav__link> 18 Strings </a> </li> <li class=md-nav__item> <a href=../19-Type-Information/ title="19 Type Information" class=md-nav__link> 19 Type Information </a> </li> <li class=md-nav__item> <a href=../20-Generics/ title="20 Generics" class=md-nav__link> 20 Generics </a> </li> <li class=md-nav__item> <a href=../21-Arrays/ title="21 Arrays" class=md-nav__link> 21 Arrays </a> </li> <li class=md-nav__item> <a href=../22-Enumerations/ title="22 Enumerations" class=md-nav__link> 22 Enumerations </a> </li> <li class=md-nav__item> <a href=../23-Annotations/ title="23 Annotations" class=md-nav__link> 23 Annotations </a> </li> <li class=md-nav__item> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class=md-nav__link> 24 Concurrent Programming </a> </li> <li class=md-nav__item> <a href=../25-Patterns/ title="25 Patterns" class=md-nav__link> 25 Patterns </a> </li> <li class=md-nav__item> <a href=../Appendix-Becoming-a-Programmer/ title="Appendix Becoming a Programmer" class=md-nav__link> Appendix Becoming a Programmer </a> </li> <li class=md-nav__item> <a href=../Appendix-Benefits-and-Costs-of-Static-Type-Checking/ title="Appendix Benefits and Costs of Static Type Checking" class=md-nav__link> Appendix Benefits and Costs of Static Type Checking </a> </li> <li class=md-nav__item> <a href=../Appendix-Collection-Topics/ title="Appendix Collection Topics" class=md-nav__link> Appendix Collection Topics </a> </li> <li class=md-nav__item> <a href=../Appendix-Data-Compression/ title="Appendix Data Compression" class=md-nav__link> Appendix Data Compression </a> </li> <li class=md-nav__item> <a href=../Appendix-IO-Streams/ title="Appendix IO Streams" class=md-nav__link> Appendix IO Streams </a> </li> <li class=md-nav__item> <a href=../Appendix-Javadoc/ title="Appendix Javadoc" class=md-nav__link> Appendix Javadoc </a> </li> <li class=md-nav__item> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class=md-nav__link> Appendix Low Level Concurrency </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Appendix New IO </label> <a href=./ title="Appendix New IO" class="md-nav__link md-nav__link--active"> Appendix New IO </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#bytebuffer class=md-nav__link> ByteBuffer </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 数据转换 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本类型获取 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 视图缓冲区 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 字节存储次序 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 缓冲区数据操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 缓冲区细节 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 内存映射文件 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 性能 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 文件锁定 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 映射文件的部分锁定 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class=md-nav__link> Appendix Object Serialization </a> </li> <li class=md-nav__item> <a href=../Appendix-Passing-and-Returning-Objects/ title="Appendix Passing and Returning Objects" class=md-nav__link> Appendix Passing and Returning Objects </a> </li> <li class=md-nav__item> <a href=../Appendix-Programming-Guidelines/ title="Appendix Programming Guidelines" class=md-nav__link> Appendix Programming Guidelines </a> </li> <li class=md-nav__item> <a href=../Appendix-Standard-IO/ title="Appendix Standard IO" class=md-nav__link> Appendix Standard IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Supplements/ title="Appendix Supplements" class=md-nav__link> Appendix Supplements </a> </li> <li class=md-nav__item> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class=md-nav__link> Appendix The Positive Legacy of C plus plus and Java </a> </li> <li class=md-nav__item> <a href=../Appendix-Understanding-equals-and-hashCode/ title="Appendix Understanding equals and hashCode" class=md-nav__link> Appendix Understanding equals and hashCode </a> </li> <li class=md-nav__item> <a href=../GLOSSARY/ title=GLOSSARY class=md-nav__link> GLOSSARY </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Doc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Doc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/ title=About class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> English </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1 type=checkbox id=nav-5-2-1> <label class=md-nav__link for=nav-5-2-1> A Programmers Guide to English </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-1> A Programmers Guide to English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/ title="A Programmer's Guide to English" class=md-nav__link> A Programmer's Guide to English </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-3 type=checkbox id=nav-5-2-1-3> <label class=md-nav__link for=nav-5-2-1-3> Essence </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-3> Essence </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/essence/ title=语言学习的本质浅析 class=md-nav__link> 语言学习的本质浅析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-4 type=checkbox id=nav-5-2-1-4> <label class=md-nav__link for=nav-5-2-1-4> Make a program </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-4> Make a program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/make-a-program/ title=如何构建一个识别英语的程序 class=md-nav__link> 如何构建一个识别英语的程序 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-5 type=checkbox id=nav-5-2-1-5> <label class=md-nav__link for=nav-5-2-1-5> Qa </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-5> Qa </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/ title="常见问题 QA" class=md-nav__link> 常见问题 QA </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/WhyPTE/ title="为什么我选择 PTE 考试" class=md-nav__link> 为什么我选择 PTE 考试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-6 type=checkbox id=nav-5-2-1-6> <label class=md-nav__link for=nav-5-2-1-6> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-6> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/resources/ title=资料、工具推荐和扩展阅读 class=md-nav__link> 资料、工具推荐和扩展阅读 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-7 type=checkbox id=nav-5-2-1-7> <label class=md-nav__link for=nav-5-2-1-7> Training </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-7> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ title=我的训练方法 class=md-nav__link> 我的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/KnowledgeBase/ title=扩充语料库的训练方法 class=md-nav__link> 扩充语料库的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ListeningandSpeaking/ title=发音和听力训练方法 class=md-nav__link> 发音和听力训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/Thinking/ title=英语思维训练 class=md-nav__link> 英语思维训练 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2 type=checkbox id=nav-5-2-2> <label class=md-nav__link for=nav-5-2-2> English level up tips for Chinese </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-2> English level up tips for Chinese </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/ title=English-level-up-tips-for-Chinese class=md-nav__link> English-level-up-tips-for-Chinese </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-3 type=checkbox id=nav-5-2-2-3> <label class=md-nav__link for=nav-5-2-2-3> Part 1 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-3> Part 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/1-understanding/ title=认知篇 class=md-nav__link> 认知篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/2-vocabulary/ title=单词篇 class=md-nav__link> 单词篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/3-listening/ title=听力篇 class=md-nav__link> 听力篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/4-reading/ title=阅读篇 class=md-nav__link> 阅读篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/5-speaking/ title="5 speaking" class=md-nav__link> 5 speaking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-4 type=checkbox id=nav-5-2-2-4> <label class=md-nav__link for=nav-5-2-2-4> Part 2 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-4> Part 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-2/x-misc/ title=扯淡篇 class=md-nav__link> 扯淡篇 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-5 type=checkbox id=nav-5-2-2-5> <label class=md-nav__link for=nav-5-2-2-5> Word list </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-5> Word list </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Go/ title=Go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Java/ title=Java class=md-nav__link> Java </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/JavaScript/ title=JavaScript class=md-nav__link> JavaScript </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/PHP/ title=PHP class=md-nav__link> PHP </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Swift/ title=Swift class=md-nav__link> Swift </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-3 type=checkbox id=nav-5-2-3> <label class=md-nav__link for=nav-5-2-3> Everyone can use english </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-3> Everyone can use english </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/ title=人人都能用英语 class=md-nav__link> 人人都能用英语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter1/ title="第一章 起点" class=md-nav__link> 第一章 起点 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter2/ title="第二章 口语" class=md-nav__link> 第二章 口语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter3/ title="第三章 语音" class=md-nav__link> 第三章 语音 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter4/ title="第四章 朗读" class=md-nav__link> 第四章 朗读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter5/ title="第五章 词典" class=md-nav__link> 第五章 词典 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter6/ title="第六章 语法" class=md-nav__link> 第六章 语法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter7/ title="第七章 精读" class=md-nav__link> 第七章 精读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter8/ title="第八章 叮嘱" class=md-nav__link> 第八章 叮嘱 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/end/ title=后记 class=md-nav__link> 后记 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-1 type=checkbox id=nav-5-3-1> <label class=md-nav__link for=nav-5-3-1> Chinese copywriting guidelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-1> Chinese copywriting guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/CHANGELOG/ title=CHANGELOG class=md-nav__link> CHANGELOG </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.en-US/ title="Chinese Copywriting Guidelines" class=md-nav__link> Chinese Copywriting Guidelines </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-CN/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-HK/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2> <label class=md-nav__link for=nav-5-3-2> Document style guide </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> Document style guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/ title=Index class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2-2 type=checkbox id=nav-5-3-2-2> <label class=md-nav__link for=nav-5-3-2-2> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-3-2-2> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/marks/ title=标点符号 class=md-nav__link> 标点符号 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/number/ title=数值 class=md-nav__link> 数值 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/paragraph/ title=段落 class=md-nav__link> 段落 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/reference/ title=参考链接 class=md-nav__link> 参考链接 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/structure/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/text/ title=文本 class=md-nav__link> 文本 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/title/ title=标题 class=md-nav__link> 标题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Life </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Life </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Reading </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/ title=阅读 class=md-nav__link> 阅读 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-2 type=checkbox id=nav-6-1-2> <label class=md-nav__link for=nav-6-1-2> Mark </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-2> Mark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back-up/ title="2019 暑假备份" class=md-nav__link> 2019 暑假备份 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back/ title=例行收集 class=md-nav__link> 例行收集 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/efficiency-time/ title=效率、时间、鸡汤 class=md-nav__link> 效率、时间、鸡汤 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fiction/ title=小说 class=md-nav__link> 小说 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/films-remark/ title=影评、电影 class=md-nav__link> 影评、电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fo/ title=佛 class=md-nav__link> 佛 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hackers-others/ title=互联网、思维方式 class=md-nav__link> 互联网、思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hooked-media/ title=媒介反思 class=md-nav__link> 媒介反思 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/isaka-kotaro/ title=伊坂幸太郎 class=md-nav__link> 伊坂幸太郎 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/knote/ title=整理 class=md-nav__link> 整理 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/mark-knote/ title=浪费时间 class=md-nav__link> 浪费时间 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/meaning/ title=思维方式 class=md-nav__link> 思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/morimi-tomihiko/ title=森见登美彦的文字好有趣啊! class=md-nav__link> 森见登美彦的文字好有趣啊! </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/murakamo-haruki/ title=村上春树 class=md-nav__link> 村上春树 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/no-fiction/ title=非虚构类 class=md-nav__link> 非虚构类 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/paper/ title=论文式总结 class=md-nav__link> 论文式总结 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/poem/ title=诗歌 class=md-nav__link> 诗歌 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/sence/ title=哲学相关通俗读物 class=md-nav__link> 哲学相关通俗读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/the-little-prince/ title="The Little Prince" class=md-nav__link> The Little Prince </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/universe/ title=物理科普读物 class=md-nav__link> 物理科普读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/utopia/ title=乌托邦小说世界关于书籍的冷幽默 class=md-nav__link> 乌托邦小说世界关于书籍的冷幽默 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/western-politics/ title=政哲 class=md-nav__link> 政哲 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/what-we-talk-about/ title=日本文学 class=md-nav__link> 日本文学 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/wuxia/ title=武侠 class=md-nav__link> 武侠 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/xiao-bo/ title=王小波 class=md-nav__link> 王小波 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-3 type=checkbox id=nav-6-1-3> <label class=md-nav__link for=nav-6-1-3> Note </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-3> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-02-book-JavaScript-DOM/ title="《JavaScript DOM 编程艺术》" class=md-nav__link> 《JavaScript DOM 编程艺术》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-09-coding-javascript-down/ title="尽量把 JavaScript 代码放到 HTML 网页底部" class=md-nav__link> 尽量把 JavaScript 代码放到 HTML 网页底部 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-05-23-HTTP/ title="《HTTP 图解》" class=md-nav__link> 《HTTP 图解》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-06-07-computer/ title=计算机系统基础 class=md-nav__link> 计算机系统基础 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-10-09-JVM/ title="JVM 笔记" class=md-nav__link> JVM 笔记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-11-25-computer/ title=计算机系统概论 class=md-nav__link> 计算机系统概论 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-4 type=checkbox id=nav-6-1-4> <label class=md-nav__link for=nav-6-1-4> Review </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-4> Review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-28-say-something/ title=听你吹牛的闲暇时光 class=md-nav__link> 听你吹牛的闲暇时光 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-29-wuxia/ title="《流星 蝴蝶 剑》简记" class=md-nav__link> 《流星 蝴蝶 剑》简记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-12-30-xiao-bo/ title=波波老师 class=md-nav__link> 波波老师 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-01-17-lai-zi-xin-shi-jie/ title=《来自新世界》 class=md-nav__link> 《来自新世界》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-10-06-October/ title=科普谈起 class=md-nav__link> 科普谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2019-09-07-story/ title=从网络小说谈起。 class=md-nav__link> 从网络小说谈起。 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Watching </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Watching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/watching/2017-08-29-watch-movies-rencently/ title=最近看的几部电影 class=md-nav__link> 最近看的几部电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-10-13-september-movies-record/ title=九月观影记录 class=md-nav__link> 九月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-11-01-October-summary/ title=十月看片与非专业类阅读 class=md-nav__link> 十月看片与非专业类阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-12-01-1112/ title=观影与阅读记录 class=md-nav__link> 观影与阅读记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-01-10-12/ title=最近看片与阅读 class=md-nav__link> 最近看片与阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-02-06-january/ title=一月观影记录 class=md-nav__link> 一月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-08-February/ title=二月至今观影记录 class=md-nav__link> 二月至今观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-31-March/ title=三月观影记录 class=md-nav__link> 三月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-12-26-Smultronst%C3%A4llet/ title=野草莓 class=md-nav__link> 野草莓 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-10-10-October/ title=克服本能就是善良吗？（从十月新番胡扯……） class=md-nav__link> 克服本能就是善良吗？（从十月新番胡扯……） </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-04-bgm/ title=无人声环 class=md-nav__link> 无人声环 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-13-the-end-of-the-world/ title="The End of the Fucking World" class=md-nav__link> The End of the Fucking World </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Study </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Study </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> Draft </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-1> Draft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/draft/try-wiki/ title="一些 Wiki 工具的尝试" class=md-nav__link> 一些 Wiki 工具的尝试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Language </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-2> Language </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/language/%E6%97%A5%E8%AF%AD%E5%85%A5%E9%97%A8/ title=日语入门 class=md-nav__link> 日语入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Tech </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Tech </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-1 type=checkbox id=nav-8-1-1> <label class=md-nav__link for=nav-8-1-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ title=大表哥的电商网页实战体验 class=md-nav__link> 大表哥的电商网页实战体验 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-23-know-nothing/ title=知其然不知其所以然 class=md-nav__link> 知其然不知其所以然 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2018-06-08-responsive/ title=大表哥的响应式设计 class=md-nav__link> 大表哥的响应式设计 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/zh-javascript-info/ title="现代 JavaScript 教程摘录" class=md-nav__link> 现代 JavaScript 教程摘录 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-2 type=checkbox id=nav-8-1-2> <label class=md-nav__link for=nav-8-1-2> Go </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-2> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/go/01/ title=01 class=md-nav__link> 01 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-3 type=checkbox id=nav-8-1-3> <label class=md-nav__link for=nav-8-1-3> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-3> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/java/2017-12-30-Java%20Web/ title="从 url 访问服务器资源讨论 Java Web 中的 Servlet" class=md-nav__link> 从 url 访问服务器资源讨论 Java Web 中的 Servlet </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2018-11-23-ArrayList/ title=ArrayList class=md-nav__link> ArrayList </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-01-31-HashMap/ title=HashMap class=md-nav__link> HashMap </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-01-String/ title="String 分析(栈,堆,字符串常量池)" class=md-nav__link> String 分析(栈,堆,字符串常量池) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-03-String/ title=String、StringBuffer、StingBuilder class=md-nav__link> String、StringBuffer、StingBuilder </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-06-Hashtable/ title=Hashtable class=md-nav__link> Hashtable </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-22-string-pool/ title=字符串常量池到底保存的是字符串对象还是字符串对象的引用? class=md-nav__link> 字符串常量池到底保存的是字符串对象还是字符串对象的引用? </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-23-Java-Thread-pool/ title="Java 线程池" class=md-nav__link> Java 线程池 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-29-Java%20Web/ title="Java Web 启动流程" class=md-nav__link> Java Web 启动流程 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-04-05-AQS-lock/ title="AQS 与 Java 锁的具体实现" class=md-nav__link> AQS 与 Java 锁的具体实现 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-4 type=checkbox id=nav-8-1-4> <label class=md-nav__link for=nav-8-1-4> Projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-4> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/projects/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-5 type=checkbox id=nav-8-1-5> <label class=md-nav__link for=nav-8-1-5> Spring </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-5> Spring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2018-09-01-Spring%20Security/ title="Spring Boot 与 Spring Security" class=md-nav__link> Spring Boot 与 Spring Security </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-03-29-Spring-init/ title="Spring 启动流程与简单源码分析" class=md-nav__link> Spring 启动流程与简单源码分析 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-04-06-Spring-MVC/ title="Spring MVC 简单源码分析" class=md-nav__link> Spring MVC 简单源码分析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Config </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Config </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Git </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/git/2018-02-01-git/ title="Git 的简单使用" class=md-nav__link> Git 的简单使用 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/2019-08-10-git-merge/ title="Git 协作管理项目时不可避免的 merge 操作" class=md-nav__link> Git 协作管理项目时不可避免的 merge 操作 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/submodule/ title=submodule class=md-nav__link> submodule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-2> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2019-12-18-manjaro/ title="Manjaro 个人新装配置" class=md-nav__link> Manjaro 个人新装配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/fontconfig/ title="Arch Emoji fontconfig" class=md-nav__link> Arch Emoji fontconfig </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/softwares/ title=各种工具 class=md-nav__link> 各种工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-3> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/tools/cz-conventional-changelog/ title=cz-conventional-changelog class=md-nav__link> cz-conventional-changelog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-03-31-Generator-SpringBoot-Gradle/ title="MyBatis Generator + Spring Boot + Gradle 配置" class=md-nav__link> MyBatis Generator + Spring Boot + Gradle 配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-25-VS-Code-Python/ title="VS Code 写 Python" class=md-nav__link> VS Code 写 Python </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-26-linux-kawa/ title="在 Linux 上使用 kawa" class=md-nav__link> 在 Linux 上使用 kawa </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-11-25-mysql/ title="【转】在 CentOS 上部署 MySQL 解压版" class=md-nav__link> 【转】在 CentOS 上部署 MySQL 解压版 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-04-03-Redis-lock/ title="Redis 的分布式锁实现" class=md-nav__link> Redis 的分布式锁实现 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-07-28-picGo/ title="Github + picGo ——有图床了" class=md-nav__link> Github + picGo ——有图床了 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-11-18-linux-mount/ title="Linux 挂载分区/磁盘" class=md-nav__link> Linux 挂载分区/磁盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-03-terminal-wifi/ title=把显卡驱动删了后在终端连热点 class=md-nav__link> 把显卡驱动删了后在终端连热点 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-12-css/ title=一个引号引发的惨案 class=md-nav__link> 一个引号引发的惨案 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-electron-vue/ title="用 Vue 写 Electron 的一次问题解决" class=md-nav__link> 用 Vue 写 Electron 的一次问题解决 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-ttrss/ title="部署 TTRSS 遇到的一些有趣的东西" class=md-nav__link> 部署 TTRSS 遇到的一些有趣的东西 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-04-02-hexo-asset-image/ title="hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了" class=md-nav__link> hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Project </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/project/2017-12-21-xiao-zong-jie/ title=做个小小的总结 class=md-nav__link> 做个小小的总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-06-25-tencent-news-spider-py/ title=腾讯新闻爬虫 class=md-nav__link> 腾讯新闻爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-09-13-lite-terminal-home-page/ title=简单的仿终端主页 class=md-nav__link> 简单的仿终端主页 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-01-11-tank/ title=花里胡哨的坦克大战 class=md-nav__link> 花里胡哨的坦克大战 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-02-05-new-year/ title=大年初一（爬取豆瓣条目及吐槽） class=md-nav__link> 大年初一（爬取豆瓣条目及吐槽） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-04-03-blog-project/ title=写博客 class=md-nav__link> 写博客 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-06-17-nodejs/ title="MarkAll 导入豆瓣数据 —— NodeJS 写爬虫" class=md-nav__link> MarkAll 导入豆瓣数据 —— NodeJS 写爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-Autumn-Json/ title="Autumn-From-Spring 自定义 BeanDefinitionReader" class=md-nav__link> Autumn-From-Spring 自定义 BeanDefinitionReader </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-bookmarkdown/ title="Chrome 插件——书签转 MarkDown" class=md-nav__link> Chrome 插件——书签转 MarkDown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-10-then-start/ title=那就开始吧 class=md-nav__link> 那就开始吧 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-16-Writing-is%20the-reward-of-writing-itself/ title=写就是写本身的报酬 class=md-nav__link> 写就是写本身的报酬 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-11-19-change-my-blog/ title=【过时内容】嘿，我转移博客啦！ class=md-nav__link> 【过时内容】嘿，我转移博客啦！ </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-12-08-yao-guai-ji-yu-you-ren-bo/ title=妖怪唧唧与友人波波 class=md-nav__link> 妖怪唧唧与友人波波 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-01-01-ubuntu/ title="折腾 ubuntu 与 win10 共存" class=md-nav__link> 折腾 ubuntu 与 win10 共存 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-02-09-pc-system/ title="黑苹果与 Ubuntu 及 PC 折腾系统" class=md-nav__link> 黑苹果与 Ubuntu 及 PC 折腾系统 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-12-install-Vmware-on-linux/ title="deepin 安装 VMware" class=md-nav__link> deepin 安装 VMware </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-31-SQL/ title="Spring Boot 开发遇到一些 SQL 问题" class=md-nav__link> Spring Boot 开发遇到一些 SQL 问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-jquery-confrim/ title="JQuery-Confrim 的一点问题" class=md-nav__link> JQuery-Confrim 的一点问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-some-plugins/ title="ECharts + PageHelper + Bootstrap Table" class=md-nav__link> ECharts + PageHelper + Bootstrap Table </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-js-in-thymeleaf/ title="Thymeleaf 里使用 JavaScript 时的注意事项" class=md-nav__link> Thymeleaf 里使用 JavaScript 时的注意事项 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-spring-boot-gradle-yml-log4j2/ title="Spring Boot + Gradle + yml 配置 log4j2" class=md-nav__link> Spring Boot + Gradle + yml 配置 log4j2 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-09-softwares/ title="Linux 常用软件" class=md-nav__link> Linux 常用软件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-hexo-image/ title="【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径）" class=md-nav__link> 【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-show/ title=如果给文章提供多种渲染方式 class=md-nav__link> 如果给文章提供多种渲染方式 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-08-30-vue-music/ title="简单的单页应用(Vue CLI2 的简单使用)" class=md-nav__link> 简单的单页应用(Vue CLI2 的简单使用) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-09-23-word-count/ title="WordCount 项目总结" class=md-nav__link> WordCount 项目总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-06-markall-douban-backup/ title=豆瓣标记数据备份插件 class=md-nav__link> 豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-07-markall-douban-backup-yes/ title=【过时】又一个——豆瓣标记数据备份插件 class=md-nav__link> 【过时】又一个——豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-13-blog/ title=从分析本网站的网络请求谈起 class=md-nav__link> 从分析本网站的网络请求谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/draft/ title=Draft class=md-nav__link> Draft </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#bytebuffer class=md-nav__link> ByteBuffer </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 数据转换 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本类型获取 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 视图缓冲区 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 字节存储次序 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 缓冲区数据操作 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 缓冲区细节 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 内存映射文件 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 性能 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 文件锁定 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 映射文件的部分锁定 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hqweay/my-mkdocs/edit/master/docs/book/OnJava8/docs/book/Appendix-New-IO.md title=编辑此页 class="md-icon md-content__icon">&#xE3C9;</a> <div class=toc> <ul> <li><a href=#io>附录:新IO</a><ul> <li><a href=#bytebuffer>ByteBuffer</a></li> <li><a href=#_1>数据转换</a></li> <li><a href=#_2>基本类型获取</a></li> <li><a href=#_3>视图缓冲区</a><ul> <li><a href=#_4>字节存储次序</a></li> </ul> </li> <li><a href=#_5>缓冲区数据操作</a><ul> <li><a href=#_6>缓冲区细节</a></li> </ul> </li> <li><a href=#_7>内存映射文件</a><ul> <li><a href=#_8>性能</a></li> </ul> </li> <li><a href=#_9>文件锁定</a><ul> <li><a href=#_10>映射文件的部分锁定</a></li> </ul> </li> </ul> </li> </ul> </div> <!-- Appendix: New I/O --> <h1 id=io>附录:新IO<a class=headerlink href=#io title="Permanent link">#</a></h1> <blockquote> <p>Java 新I/O 库是在 1.4 版本引入到 <code>Java .nio.* package</code> 中的，旨在更快速。</p> </blockquote> <p>实际上，新 I/O 使用 <strong>NIO</strong>（同步非阻塞）的方式重写了老的 I/O 了，因此它获得了 <strong>NIO</strong> 的种种优点。即使我们不显式地使用 <strong>NIO</strong> 方式来编写代码，也能带来性能和速度的提高。这种提升不仅仅体现在文件读写（File I/O），同时也体现在网络读写（Network I/O）中。例如，网络编程。</p> <p>速度的提升来自于使用了更接近操作系统 I/O 执行方式的结构：<strong>Channel</strong>（通道） 和 <strong>Buffer</strong>（缓冲区）。我们可以想象一个煤矿：通道就是连接矿层（数据）的矿井，缓冲区是运送煤矿的小车。通过小车装煤，再从车里取矿。换句话说，我们不能直接和 <strong>Channel</strong> 交互; 我们需要与 <strong>Buffer</strong> 交互并将 <strong>Buffer</strong> 中的数据发送到 <strong>Channel</strong> 中；<strong>Channel</strong> 需要从 <strong>Buffer</strong> 中提取或放入数据。</p> <p>本篇我们将深入探讨 <code>nio</code> 包。虽然 像 I/O 流这样的高级库使用了 <strong>NIO</strong>，但多数时候，我们考虑这个层次的问题。使用Java 7 和 8 版本，理想情况下我们甚至不必费心去处理 I/O 流。当然，一些特殊情况除外。在<a href=../17-Files/ >文件</a>（<strong>File</strong>）一章中基本涵盖了我们日常使用的相关内容。只有在遇到性能瓶颈（例如内存映射文件）或创建自己的 I/O 库时，我们才需要去理解 <strong>NIO</strong>。</p> <!-- ByteBufferS --> <h2 id=bytebuffer>ByteBuffer<a class=headerlink href=#bytebuffer title="Permanent link">#</a></h2> <p>有且仅有 <strong>ByteBuffer</strong>（字节缓冲区，保存原始字节的缓冲区）这一类型可直接与通道交互。查看 <code>java.nio.</code><strong>ByteBuffer</strong> 的 JDK 文档，你会发现它是相当基础的：通过初始化某个大小的存储空间，再使用一些方法以原始字节形式或原始数据类型来放置和获取数据。但是我们无法直接存放对象，即使是最基本的 <strong>String</strong> 类型数据。这是一个相当底层的操作，也正因如此，使得它与大多数操作系统的映射更加高效。</p> <p>旧式 I/O 中的三个类分别被更新成 <strong>FileChannel</strong>（文件通道），分别是：<strong>FileInputStream</strong>、<strong>FileOutputStream</strong>，以及用于读写的 <strong>RandomAccessFile</strong> 类。</p> <p>注意，这些都是符合底层 <strong>NIO</strong> 特性的字节操作流。 另外，还有 <strong>Reader</strong> 和 <strong>Writer</strong> 字符模式的类是不产生通道的。但 <code>java.nio.channels.</code><strong>Channels</strong> 类具有从通道中生成 <strong>Reader</strong> 和 <strong>Writer</strong> 的实用方法。</p> <p>下面来练习上述三种类型的流生成可读、可写、可读/写的通道：</p> <div class=highlight><pre><span></span><code><span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们不保证这段代码用于其他用途时是否有效</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多信息</span>
<span class=c1>// 从流中获取通道</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GetChannel</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=s>&quot;data.txt&quot;</span><span class=p>;</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BSIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 写入一个文件:</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
        <span class=p>.</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ByteBuffer</span>
        <span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=s>&quot;Some text &quot;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>()));</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 在文件尾添加：</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span>
        <span class=n>name</span><span class=p>,</span> <span class=s>&quot;rw&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>position</span><span class=p>(</span><span class=n>fc</span><span class=p>.</span><span class=na>size</span><span class=p>());</span> <span class=c1>// 移动到结尾</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ByteBuffer</span>
        <span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=s>&quot;Some more&quot;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>()));</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 读取文件e:</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
        <span class=p>.</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>ByteBuffer</span> <span class=n>buff</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>BSIZE</span><span class=p>);</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buff</span><span class=p>);</span>
      <span class=n>buff</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span>
      <span class=k>while</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>get</span><span class=p>());</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>flush</span><span class=p>();</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Some text Some more
</code></pre></div> <p>我们这里所讲的任何流类，都可以通过调用 <code>getChannel( )</code> 方法生成一个 <strong>FileChannel</strong>（文件通道）。<strong>FileChannel</strong> 的操作相当基础：操作 <strong>ByteBuffer</strong> 来用于读写，并独占式访问和锁定文件区域(稍后将对此进行描述)。</p> <p>将字节放入 <strong>ByteBuffer</strong> 的一种方法是直接调用 <code>put()</code> 方法将一个或多个字节放入 <strong>ByteBuffer</strong>；当然也可以是其它基本类型的数据。此外，参考上例，我们还可以调用 <code>wrap()</code> 方法包装现有字节数组到 <strong>ByteBuffer</strong>。执行此操作时，不会复制底层数组，而是将其用作生成的 <strong>ByteBuffer</strong> 存储。这样产生的 <strong>ByteBuffer</strong> 是数组“支持”的。</p> <p>data.txt 文件被 <strong>RandomAccessFile</strong> 重新打开。<strong>注意</strong>，你可以在文件中移动 <strong>FileChanne</strong>。 在这里，它被移动到末尾，以便添加额外的写操作。</p> <p>对于只读访问，必须使用静态 <code>allocate()</code> 方法显式地分配 <strong>ByteBuffer</strong>。<strong>NIO</strong> 的目标是快速移动大量数据，因此 <strong>ByteBuffer</strong> 的大小应该很重要 —— 实际上，这里设置的 1K 都可能偏小了(我们在工作中应该反复测试以找到最佳大小)。</p> <p>通过使用 <code>allocateDirect()</code> 而不是 <code>allocate()</code> 来生成与操作系统具备更高耦合度的“直接”缓冲区，也有可能获得更高的速度。然而，这种分配的开销更大，而且实际效果因操作系统的不同而有所不同，因此，在工作中你必须再次测试程序，以检验直接缓冲区是否能为你带来速度上的优势。</p> <p>一旦调用 <strong>FileChannel</strong> 类的 <code>read()</code> 方法将字节数据存储到 <strong>ByteBuffer</strong> 中，你还必须调用缓冲区上的 <code>flip()</code> 方法来准备好提取字节（这听起来有点粗糙，实际上这已是非常低层的操作，且为了达到最高速度）。如果要进一步调用 <code>read()</code> 来使用 <strong>ByteBuffer</strong> ，还需要每次 <code>clear()</code> 来准备缓冲区。下面是个简单的代码示例:</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/ChannelCopy.java</span>

<span class=c1>// 使用 channels and buffers 移动文件</span>
<span class=c1>// {java ChannelCopy ChannelCopy.java test.txt}</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ChannelCopy</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BSIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span><span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
        <span class=s>&quot;arguments: sourcefile destfile&quot;</span><span class=p>);</span>
      <span class=n>System</span><span class=p>.</span><span class=na>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
        <span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>).</span><span class=na>getChannel</span><span class=p>();</span>
      <span class=n>FileChannel</span> <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
        <span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>ByteBuffer</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>BSIZE</span><span class=p>);</span>
      <span class=k>while</span><span class=p>(</span><span class=n>in</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>buffer</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span> <span class=c1>// 准备写入</span>
        <span class=n>out</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span>
        <span class=n>buffer</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>  <span class=c1>// 准备读取</span>
      <span class=p>}</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><strong>第一个FileChannel</strong> 用于读取；<strong>第二个FileChannel</strong> 用于写入。当 <strong>ByteBuffer</strong> 分配好存储，调用 <strong>FileChannel</strong> 的 <code>read()</code> 方法返回 <strong>-1</strong>（毫无疑问，这是来源于 Unix 和 C 语言）时，说明输入流读取完了。在每次 <code>read()</code> 将数据放入缓冲区之后，<code>flip()</code> 都会准备好缓冲区，以便 <code>write()</code> 提取它的信息。在 <code>write()</code> 之后，数据仍然在缓冲区中，我们需要 <code>clear()</code> 来重置所有内部指针，以便在下一次 <code>read()</code> 中接受数据。 </p> <p>但是，上例并不是处理这种操作的理想方法。方法 <code>transferTo()</code> 和 <code>transferFrom()</code> 允许你直接连接此通道到彼通道：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/TransferTo.java</span>

<span class=c1>// 使用 transferTo() 在通道间传输</span>
<span class=c1>// {java TransferTo TransferTo.java TransferTo.txt}</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TransferTo</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span><span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=na>length</span> <span class=o>!=</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
        <span class=s>&quot;arguments: sourcefile destfile&quot;</span><span class=p>);</span>
      <span class=n>System</span><span class=p>.</span><span class=na>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>in</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
        <span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>).</span><span class=na>getChannel</span><span class=p>();</span>
      <span class=n>FileChannel</span> <span class=n>out</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
        <span class=n>args</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>in</span><span class=p>.</span><span class=na>transferTo</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>in</span><span class=p>.</span><span class=na>size</span><span class=p>(),</span> <span class=n>out</span><span class=p>);</span>
      <span class=c1>// Or:</span>
      <span class=c1>// out.transferFrom(in, 0, in.size());</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>可能不会经常用到，但知道这一点很好。</p> <!-- Converting Data --> <h2 id=_1>数据转换<a class=headerlink href=#_1 title="Permanent link">#</a></h2> <p>为了将 <strong>GetChannel.java</strong> 文件中的信息打印出来。在 Java 中，我们每次提取一个字节的数据并将其转换为字符。看起来很简单 —— 如果你有看过 <code>ava.nio.</code><strong>CharBuffer</strong> 类，你会发现一个 <code>toString()</code> 方法。该方法的作用是“返回一个包含此缓冲区字符的字符串”。</p> <p>既然 <strong>ByteBuffer</strong> 可以通过 <strong>CharBuffer</strong> 类的 <code>asCharBuffer()</code> 方法查看，那我们就来尝试一样。从下面输出语句的第一行可以看出，这并不正确：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/BufferToText.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// text 和 ByteBuffers 互转</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.charset.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>BufferToText</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BSIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>

    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ByteBuffer</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=s>&quot;Some text&quot;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>()));</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>ByteBuffer</span> <span class=n>buff</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>BSIZE</span><span class=p>);</span>

    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buff</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>buff</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span>
    <span class=c1>// 无法运行</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>());</span>
    <span class=c1>// 使用默认系统默认编码解码</span>
    <span class=n>buff</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=n>String</span> <span class=n>encoding</span> <span class=o>=</span>
      <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;file.encoding&quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Decoded using &quot;</span> <span class=o>+</span>
      <span class=n>encoding</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span>
      <span class=o>+</span> <span class=n>Charset</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>encoding</span><span class=p>).</span><span class=na>decode</span><span class=p>(</span><span class=n>buff</span><span class=p>));</span>

    <span class=c1>// 编码和打印</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>ByteBuffer</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span>
        <span class=s>&quot;Some text&quot;</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(</span><span class=s>&quot;UTF-16BE&quot;</span><span class=p>)));</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 尝试再次读取：</span>
    <span class=n>buff</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buff</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>buff</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>());</span>
    <span class=c1>// 通过 CharBuffer 写入：</span>
    <span class=n>buff</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=mi>24</span><span class=p>);</span>
    <span class=n>buff</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;Some text&quot;</span><span class=p>);</span>

    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>buff</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 读取和显示：</span>
    <span class=n>buff</span><span class=p>.</span><span class=na>clear</span><span class=p>();</span>

    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
        <span class=s>&quot;data2.txt&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>fc</span><span class=p>.</span><span class=na>read</span><span class=p>(</span><span class=n>buff</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>buff</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>());</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>????
Decoded using windows-1252: Some text
Some text
Some textNULNULNUL
</code></pre></div> <p>缓冲区包含普通字节，为了将这些字节转换为字符，我们必须在输入时对它们进行编码(这样它们输出时就有意义了)，或者在输出时对它们进行解码。我们可以使用 <code>java.nio.charset.</code><strong>Charset</strong> 字符集工具类来完成。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/AvailableCharSets.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// 展示 Charsets 和 aliases</span>
<span class=kn>import</span> <span class=nn>java.nio.charset.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AvailableCharSets</span> <span class=p>{</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
      <span class=n>SortedMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span><span class=n>Charset</span><span class=o>&gt;</span> <span class=n>charSets</span> <span class=o>=</span>
      <span class=n>Charset</span><span class=p>.</span><span class=na>availableCharsets</span><span class=p>();</span>

    <span class=k>for</span><span class=p>(</span><span class=n>String</span> <span class=n>csName</span> <span class=p>:</span> <span class=n>charSets</span><span class=p>.</span><span class=na>keySet</span><span class=p>())</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>csName</span><span class=p>);</span>
      <span class=n>Iterator</span> <span class=n>aliases</span> <span class=o>=</span> <span class=n>charSets</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>csName</span><span class=p>)</span>
        <span class=p>.</span><span class=na>aliases</span><span class=p>().</span><span class=na>iterator</span><span class=p>();</span>
      <span class=k>if</span><span class=p>(</span><span class=n>aliases</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;: &quot;</span><span class=p>);</span>

      <span class=k>while</span><span class=p>(</span><span class=n>aliases</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>aliases</span><span class=p>.</span><span class=na>next</span><span class=p>());</span>
        <span class=k>if</span><span class=p>(</span><span class=n>aliases</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span>
          <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;, &quot;</span><span class=p>);</span>
      <span class=p>}</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Big5: csBig5
Big5-HKSCS: big5-hkscs, big5hk, Big5_HKSCS, big5hkscs
CESU-8: CESU8, csCESU-8
EUC-JP: csEUCPkdFmtjapanese, x-euc-jp, eucjis,
Extended_UNIX_Code_Packed_Format_for_Japanese, euc_jp,
eucjp, x-eucjp
EUC-KR: ksc5601-1987, csEUCKR, ksc5601_1987, ksc5601,
5601,
euc_kr, ksc_5601, ks_c_5601-1987, euckr
GB18030: gb18030-2000
GB2312: gb2312, euc-cn, x-EUC-CN, euccn, EUC_CN,
gb2312-80,
gb2312-1980
                  ...
</code></pre></div> <p>回到 <strong>BufferToText.java</strong> 中，如果你 <code>rewind()</code> 缓冲区（回到数据的开头），使用该平台的默认字符集 <code>decode()</code> 数据，那么生成的 <strong>CharBuffer</strong> 数据将在控制台上正常显示。可以通过 <code>System.getProperty(“file.encoding”)</code> 方法来查看平台默认字符集名称。传递该名称参数到 <code>Charset.forName()</code> 方法可以生成对应的 <code>Charset</code> 对象用于解码字符串。</p> <p>另一种方法是使用字符集 <code>encode()</code> 方法，该字符集在读取文件时生成可打印的内容，如你在 <strong>BufferToText.java</strong> 的第三部分中所看到的。上例中，<strong>UTF-16BE</strong> 被用于将文本写入文件，当文本被读取时，你所要做的就是将其转换为 <strong>CharBuffer</strong>，并生成预期的文本。</p> <p>最后，如果将 <strong>CharBuffer</strong> 写入 <strong>ByteBuffer</strong>，你会看到发生了什么(更多详情，稍后了解)。<strong>注意</strong>，为 <strong>ByteBuffer</strong> 分配了24个字节，按照每个字符占用 2 个自字节， 12 个字符的空间已经足够了。由于“some text”只有 9 个字符，受其 <code>toString()</code> 方法影响，剩下的 0 字节部分也出现在了 <strong>CharBuffer</strong> 的展示中，如输出所示。</p> <!-- Fetching Primitives --> <h2 id=_2>基本类型获取<a class=headerlink href=#_2 title="Permanent link">#</a></h2> <p>虽然 <strong>ByteBuffer</strong> 只包含字节，但它包含了一些方法，用于从其所包含的字节中生成各种不同的基本类型数据。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/GetData.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// 从 ByteBuffer 中获取不同的数据展示</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GetData</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BSIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ByteBuffer</span> <span class=n>bb</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>BSIZE</span><span class=p>);</span>
    <span class=c1>// 自动分配 0 到 ByteBuffer:</span>
    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=k>while</span><span class=p>(</span><span class=n>i</span><span class=o>++</span> <span class=o>&lt;</span> <span class=n>bb</span><span class=p>.</span><span class=na>limit</span><span class=p>())</span>
      <span class=k>if</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;nonzero&quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;i = &quot;</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 char 数组:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;Howdy!&quot;</span><span class=p>);</span>
    <span class=kt>char</span> <span class=n>c</span><span class=p>;</span>
    <span class=k>while</span><span class=p>((</span><span class=n>c</span> <span class=o>=</span> <span class=n>bb</span><span class=p>.</span><span class=na>getChar</span><span class=p>())</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>c</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 short:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asShortBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>((</span><span class=kt>short</span><span class=p>)</span><span class=mi>471142</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>getShort</span><span class=p>());</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 int:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asIntBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=mi>99471142</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>getInt</span><span class=p>());</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 long:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asLongBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=mi>99471142</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>getLong</span><span class=p>());</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 float:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asFloatBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=mi>99471142</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>getFloat</span><span class=p>());</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=c1>// 保存和读取 double:</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asDoubleBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=mi>99471142</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>getDouble</span><span class=p>());</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>i = 1025
H o w d y !
12390
99471142
99471142
9.9471144E7
9.9471142E7
</code></pre></div> <p>在分配 <strong>ByteBuffer</strong> 之后，我们检查并确认它的 1,024 元素被初始化为 0。（截至到达 <code>limit()</code> 结果的位置）。</p> <p>将基本类型数据插入 <strong>ByteBuffer</strong> 的最简单方法就是使用 <code>asCharBuffer()</code>、<code>asShortBuffer()</code> 等方法获取该缓冲区适当的“视图”（View），然后调用该“视图”的 <code>put()</code> 方法。</p> <p>这是针对每种基本数据类型执行的。其中唯一有点奇怪的是 <strong>ShortBuffer</strong> 的 <code>put()</code>，它需要类型强制转换。其他视图缓冲区不需要在其 <code>put()</code> 方法中进行转换。</p> <!-- View Buffers --> <h2 id=_3>视图缓冲区<a class=headerlink href=#_3 title="Permanent link">#</a></h2> <p>“视图缓冲区”（view buffer）是通过特定的基本类型的窗口来查看底层 <strong>ByteBuffer</strong>。<strong>ByteBuffer</strong> 仍然是“支持”视图的实际存储，因此对视图所做的任何更改都反映在对 <strong>ByteBuffer</strong> 中的数据的修改中。</p> <p>如前面的示例所示，这方便地将基本类型插入 <strong>ByteBuffer</strong>。视图缓冲区还可以从 <strong>ByteBuffer</strong> 读取基本类型数据，每次单个（<strong>ByteBuffer</strong> 规定），或者批量读取到数组。下面是一个通过 <strong>IntBuffer</strong> 在 <strong>ByteBuffer</strong> 中操作 <strong>int</strong> 的例子：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/IntBufferDemo.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// 利用 IntBuffer 保存 int 数据到 ByteBuffer</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>IntBufferDemo</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>BSIZE</span> <span class=o>=</span> <span class=mi>1024</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ByteBuffer</span> <span class=n>bb</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>BSIZE</span><span class=p>);</span>
    <span class=n>IntBuffer</span> <span class=n>ib</span> <span class=o>=</span> <span class=n>bb</span><span class=p>.</span><span class=na>asIntBuffer</span><span class=p>();</span>
    <span class=c1>// 保存 int 数组：</span>
    <span class=n>ib</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=k>new</span> <span class=kt>int</span><span class=o>[]</span><span class=p>{</span> <span class=mi>11</span><span class=p>,</span> <span class=mi>42</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>99</span><span class=p>,</span> <span class=mi>143</span><span class=p>,</span> <span class=mi>811</span><span class=p>,</span> <span class=mi>1016</span> <span class=p>});</span>
    <span class=c1>//绝对位置读写：</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>ib</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=mi>3</span><span class=p>));</span>
    <span class=n>ib</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>1811</span><span class=p>);</span>
    <span class=c1>// 在重置缓冲区前设置新的限制</span>

    <span class=n>ib</span><span class=p>.</span><span class=na>flip</span><span class=p>();</span>
    <span class=k>while</span><span class=p>(</span><span class=n>ib</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span> <span class=p>{</span>
      <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>ib</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>99
11
42
47
1811
143
811
1016
</code></pre></div> <p><code>put()</code> 方法重载，首先用于存储 <strong>int</strong> 数组。下面的 <code>get()</code> 和 <code>put()</code> 方法调用直接访问底层 <strong>ByteBuffer</strong> 中的 <strong>int</strong> 位置。<strong>注意</strong>，通过直接操作 <strong>ByteBuffer</strong> ，这些绝对位置访问也可以用于基本类型。</p> <p>一旦底层 <strong>ByteBuffer</strong> 通过视图缓冲区填充了 <strong>int</strong> 或其他基本类型，那么就可以直接将该 <strong>ByteBuffer</strong> 写入通道。你可以轻松地从通道读取数据，并使用视图缓冲区将所有内容转换为特定的基本类型。下面是一个例子，通过在同一个 <strong>ByteBuffer</strong> 上生成不同的视图缓冲区，将相同的字节序列解释为 <strong>short</strong>、<strong>int</strong>、<strong>float</strong>、<strong>long</strong> 和 <strong>double</strong>。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/ViewBuffers.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ViewBuffers</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ByteBuffer</span> <span class=n>bb</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span>
      <span class=k>new</span> <span class=kt>byte</span><span class=o>[]</span><span class=p>{</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span> <span class=p>});</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Byte Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>bb</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>bb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>CharBuffer</span> <span class=n>cb</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asCharBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Char Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>cb</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>cb</span><span class=p>.</span><span class=na>position</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>cb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>FloatBuffer</span> <span class=n>fb</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asFloatBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Float Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>fb</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>fb</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>fb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>IntBuffer</span> <span class=n>ib</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asIntBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Int Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>ib</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>ib</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>ib</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>LongBuffer</span> <span class=n>lb</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asLongBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Long Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>lb</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>lb</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>lb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>ShortBuffer</span> <span class=n>sb</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asShortBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Short Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>sb</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>sb</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>sb</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>();</span>
    <span class=n>DoubleBuffer</span> <span class=n>db</span> <span class=o>=</span>
      <span class=p>((</span><span class=n>ByteBuffer</span><span class=p>)</span><span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>()).</span><span class=na>asDoubleBuffer</span><span class=p>();</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;Double Buffer &quot;</span><span class=p>);</span>
    <span class=k>while</span><span class=p>(</span><span class=n>db</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span>
        <span class=n>db</span><span class=p>.</span><span class=na>position</span><span class=p>()</span><span class=o>+</span> <span class=s>&quot; -&gt; &quot;</span> <span class=o>+</span> <span class=n>db</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Byte Buffer 0 -&gt; 0, 1 -&gt; 0, 2 -&gt; 0, 3 -&gt; 0, 4 -&gt; 0, 5
-&gt; 0, 6 -&gt; 0, 7 -&gt; 97,
Char Buffer 0 -&gt; NUL, 1 -&gt; NUL, 2 -&gt; NUL, 3 -&gt; a,
Float Buffer 0 -&gt; 0.0, 1 -&gt; 1.36E-43,
Int Buffer 0 -&gt; 0, 1 -&gt; 97,
Long Buffer 0 -&gt; 97,
Short Buffer 0 -&gt; 0, 1 -&gt; 0, 2 -&gt; 0, 3 -&gt; 97,
Double Buffer 0 -&gt; 4.8E-322,
</code></pre></div> <p><strong>ByteBuffer</strong> 通过“包装”一个 8 字节数组生成，然后通过所有不同基本类型的视图缓冲区显示该数组。下图显示了从不同类型的缓冲区读取数据时，数据显示的差异：</p> <p><img alt=1554546258113 src=../../images/1554546258113.png></p> <!-- Endians --> <h3 id=_4>字节存储次序<a class=headerlink href=#_4 title="Permanent link">#</a></h3> <p>不同的机器可以使用不同的字节存储顺序（Endians）来存储数据。“高位优先”（Big Endian）：将最重要的字节放在最低内存地址中，而“低位优先”（Little Endian）：将最重要的字节放在最高内存地址中。</p> <p>当存储大于单字节的数据时，如 <strong>int</strong>、<strong>float</strong> 等，我们可能需要考虑字节排序问题。<strong>ByteBuffer</strong> 以“高位优先”形式存储数据；通过网络发送的数据总是使用“高位优先”形式。我们可以 使用 <strong>ByteOrder</strong> 的 <code>order()</code> 方法和参数 <strong>ByteOrder.BIG_ENDIAN</strong> 或 <strong>ByteOrder.LITTLE_ENDIAN</strong> 来改变它的字节存储次序。</p> <p>下例是一个包含两个字节的 <strong>ByteBuffer</strong> ：</p> <p><img alt=1554546378822 src=../../images/1554546378822.png></p> <p>将数据作为 <strong>short</strong> 型来读取（<code>ByteBuffer.asshortbuffer()</code>)），生成数字 97 （00000000 01100001）。更改为“低位优先”后 将生成数字 24832 （01100001 00000000）。</p> <p>这显示了字节顺序的变化取决于字节存储次序设置:</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/Endians.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// 不同字节存储次序的存储</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Endians</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>ByteBuffer</span> <span class=n>bb</span> <span class=o>=</span> <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>wrap</span><span class=p>(</span><span class=k>new</span> <span class=kt>byte</span><span class=o>[</span><span class=mi>12</span><span class=o>]</span><span class=p>);</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;abcdef&quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>array</span><span class=p>()));</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>order</span><span class=p>(</span><span class=n>ByteOrder</span><span class=p>.</span><span class=na>BIG_ENDIAN</span><span class=p>);</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;abcdef&quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>array</span><span class=p>()));</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>rewind</span><span class=p>();</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>order</span><span class=p>(</span><span class=n>ByteOrder</span><span class=p>.</span><span class=na>LITTLE_ENDIAN</span><span class=p>);</span>
    <span class=n>bb</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>().</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;abcdef&quot;</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>bb</span><span class=p>.</span><span class=na>array</span><span class=p>()));</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>[0, 97, 0, 98, 0, 99, 0, 100, 0, 101, 0, 102]
[0, 97, 0, 98, 0, 99, 0, 100, 0, 101, 0, 102]
[97, 0, 98, 0, 99, 0, 100, 0, 101, 0, 102, 0]
</code></pre></div> <p><strong>ByteBuffer</strong> 分配空间将 <strong>charArray</strong> 中的所有字节作为外部缓冲区保存，因此可以调用 <code>array()</code> 方法来显示底层字节。<code>array()</code> 方法是“可选的”，你只能在数组支持的缓冲区上调用它，否则将抛出 <strong>UnsupportedOperationException</strong> 异常。</p> <p><strong>charArray</strong> 通过 <strong>CharBuffer</strong> 视图插入到 <strong>ByteBuffer</strong> 中。当显示底层字节时，默认排序与后续“高位”相同，而“地位”交换字节</p> <!-- Data Manipulation with Buffers --> <h2 id=_5>缓冲区数据操作<a class=headerlink href=#_5 title="Permanent link">#</a></h2> <p>下图说明了 <strong>nio</strong> 类之间的关系，展示了如何移动和转换数据。例如，要将字节数组写入文件，使用 <strong>ByteBuffer.</strong><code>wrap()</code> 方法包装字节数组，使用 <code>getChannel()</code> 在 <strong>FileOutputStream</strong> 上打开通道，然后从 <strong>ByteBuffer</strong> 将数据写入 <strong>FileChannel</strong>。</p> <p><img alt=1554546452861 src=../../images/1554546452861.png></p> <p><strong>ByteBuffer</strong> 是将数据移入和移出通道的唯一方法，我们只能创建一个独立的基本类型缓冲区，或者使用 <code>as</code> 方法从 <strong>ByteBuffer</strong> 获得一个新缓冲区。也就是说，不能将基本类型缓冲区转换为 <strong>ByteBuffer</strong>。但我们能够通过视图缓冲区将基本类型数据移动到 <strong>ByteBuffer</strong> 中或移出 <strong>ByteBuffer</strong>。</p> <h3 id=_6>缓冲区细节<a class=headerlink href=#_6 title="Permanent link">#</a></h3> <p>缓冲区由数据和四个索引组成，以有效地访问和操作该数据：mark、position、limit 和 capacity（标记、位置、限制和容量）。伴随着的还有一组方法可以设置和重置这些索引，并可查询它们的值。</p> <table> <thead> <tr> <th align=left></th> <th align=left></th> </tr> </thead> <tbody> <tr> <td align=left><strong>capacity()</strong></td> <td align=left>返回缓冲区的 capacity</td> </tr> <tr> <td align=left><strong>clear()</strong></td> <td align=left>清除缓冲区，将 position 设置为零并 设 limit 为 capacity;可调用此方法来覆盖现有缓冲区</td> </tr> <tr> <td align=left><strong>flip()</strong></td> <td align=left>将 limit 设置为 position，并将 position 设置为 0;此方法用于准备缓冲区，以便在数据写入缓冲区后进行读取</td> </tr> <tr> <td align=left><strong>limit()</strong></td> <td align=left>返回 limit 的值</td> </tr> <tr> <td align=left><strong>limit(int limit)</strong></td> <td align=left>重设 limit</td> </tr> <tr> <td align=left><strong>mark()</strong></td> <td align=left>设置 mark 为当前的 position</td> </tr> <tr> <td align=left><strong>position()</strong></td> <td align=left>返回 position</td> </tr> <tr> <td align=left><strong>position(int pos)</strong></td> <td align=left>设置 position</td> </tr> <tr> <td align=left><strong>remaining()</strong></td> <td align=left>返回 limit 到 position</td> </tr> <tr> <td align=left><strong>hasRemaining()</strong></td> <td align=left>如果在 position 与 limit 中间有元素，返回 <code>true</code></td> </tr> </tbody> </table> <p>从缓冲区插入和提取数据的方法通过更新索引来反映所做的更改。下例使用一种非常简单的算法（交换相邻字符）来对 <strong>CharBuffer</strong> 中的字符进行加扰和解扰。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/UsingBuffers.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UsingBuffers</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span>
  <span class=kt>void</span> <span class=nf>symmetricScramble</span><span class=p>(</span><span class=n>CharBuffer</span> <span class=n>buffer</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>while</span><span class=p>(</span><span class=n>buffer</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span> <span class=p>{</span>
      <span class=n>buffer</span><span class=p>.</span><span class=na>mark</span><span class=p>();</span>
      <span class=kt>char</span> <span class=n>c1</span> <span class=o>=</span> <span class=n>buffer</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
      <span class=kt>char</span> <span class=n>c2</span> <span class=o>=</span> <span class=n>buffer</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
      <span class=n>buffer</span><span class=p>.</span><span class=na>reset</span><span class=p>();</span>
      <span class=n>buffer</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>c2</span><span class=p>).</span><span class=na>put</span><span class=p>(</span><span class=n>c1</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=kt>char</span><span class=o>[]</span> <span class=n>data</span> <span class=o>=</span> <span class=s>&quot;UsingBuffers&quot;</span><span class=p>.</span><span class=na>toCharArray</span><span class=p>();</span>
    <span class=n>ByteBuffer</span> <span class=n>bb</span> <span class=o>=</span>
      <span class=n>ByteBuffer</span><span class=p>.</span><span class=na>allocate</span><span class=p>(</span><span class=n>data</span><span class=p>.</span><span class=na>length</span> <span class=o>*</span> <span class=mi>2</span><span class=p>);</span>
    <span class=n>CharBuffer</span> <span class=n>cb</span> <span class=o>=</span> <span class=n>bb</span><span class=p>.</span><span class=na>asCharBuffer</span><span class=p>();</span>
    <span class=n>cb</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cb</span><span class=p>.</span><span class=na>rewind</span><span class=p>());</span>
    <span class=n>symmetricScramble</span><span class=p>(</span><span class=n>cb</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cb</span><span class=p>.</span><span class=na>rewind</span><span class=p>());</span>
    <span class=n>symmetricScramble</span><span class=p>(</span><span class=n>cb</span><span class=p>);</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cb</span><span class=p>.</span><span class=na>rewind</span><span class=p>());</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>UsingBuffers
sUniBgfuefsr
UsingBuffers
</code></pre></div> <p>虽然可以通过使用 <strong>char</strong> 数组调用 <code>wrap()</code> 直接生成 <strong>CharBuffer</strong>，但是底层的 <strong>ByteBuffer</strong> 将被分配，而 <strong>CharBuffer</strong> 将作为 <strong>ByteBuffer</strong> 上的视图生成。这强调了目标始终是操作 <strong>ByteBuffer</strong>，因为它与通道交互。</p> <p>下面是程序在 <code>symmetricgrab()</code> 方法入口时缓冲区的样子:</p> <p><img alt=1554546627710 src=../../images/1554546627710.png></p> <p>position 指向缓冲区中的第一个元素，capacity 和 limit 紧接在最后一个元素之后。在<code>symmetricgrab()</code> 中，<strong>while</strong> 循环迭代到 position 等于 limit。当在缓冲区上调用相对位置的 <code>get()</code> 或 <code>put()</code> 函数时，缓冲区的位置会发生变化。你可以调用绝对位置的 <code>get()</code> 和 <code>put()</code> 方法，它们包含索引参数：<code>get()</code> 或 <code>put()</code> 发生的位置。这些方法不修改缓冲区 position 的值。</p> <p>当控件进入 <strong>while</strong> 循环时，使用 <code>mark()</code> 设置 mark 的值。缓冲区的状态为：</p> <p><img alt=1554546666685 src=../../images/1554546666685.png></p> <p>两个相对 <code>get()</code> 调用将前两个字符的值保存在变量 <code>c1</code> 和 <code>c2</code> 中。在这两个调用之后，缓冲区看起来是这样的：</p> <p><img alt=1554546693664 src=../../images/1554546693664.png></p> <p>为了执行交换，我们在位置 0 处编写 <code>c2</code>，在位置 1 处编写 <code>c1</code>。我们可以使用绝对 <code>put()</code> 方法来实现这一点，或者用 <code>reset()</code> 方法，将 position 的值设置为 mark：</p> <p><img alt=1554546847181 src=../../images/1554546847181.png></p> <p>两个 <code>put()</code> 方法分别编写 <code>c2</code> 和 <code>c1</code> ：</p> <p><img alt=1554546861836 src=../../images/1554546861836.png></p> <p>在下一次循环中，将 mark 设置为 position 的当前值：</p> <p><img alt=1554546881189 src=../../images/1554546881189.png></p> <p>该过程将继续，直到遍历整个缓冲区为止。在 <strong>while</strong> 循环的末尾，position 位于缓冲区的末尾。如果显示缓冲区，则只显示位置和限制之间的字符。因此，要显示缓冲区的全部内容，必须使用 <code>rewind()</code> 将 position 设置为缓冲区的开始位置。这是 <code>rewind()</code> 调用后缓冲区的状态（mark 的值变成未定义）：</p> <p><img alt=1554546890132 src=../../images/1554546890132.png></p> <p>再次调用 <code>symmetricgrab()</code> 方法时，<strong>CharBuffer</strong> 将经历相同的过程并恢复到原始状态。</p> <!-- Memory-Mapped Files --> <h2 id=_7>内存映射文件<a class=headerlink href=#_7 title="Permanent link">#</a></h2> <p>内存映射文件能让你创建和修改那些因为太大而无法放入内存的文件。有了内存映射文件，你就可以认为文件已经全部读进了内存，然后把它当成一个非常大的数组来访问。这种解决办法能大大简化修改文件的代码：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/LargeMappedFiles.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// 使用内存映射来创建一个大文件</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LargeMappedFiles</span> <span class=p>{</span>
  <span class=kd>static</span> <span class=kt>int</span> <span class=n>length</span> <span class=o>=</span> <span class=mh>0x8000000</span><span class=p>;</span> <span class=c1>// 128 MB</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
  <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>RandomAccessFile</span> <span class=n>tdat</span> <span class=o>=</span>
        <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span><span class=s>&quot;test.dat&quot;</span><span class=p>,</span> <span class=s>&quot;rw&quot;</span><span class=p>)</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=n>MappedByteBuffer</span> <span class=n>out</span> <span class=o>=</span> <span class=n>tdat</span><span class=p>.</span><span class=na>getChannel</span><span class=p>().</span><span class=na>map</span><span class=p>(</span>
        <span class=n>FileChannel</span><span class=p>.</span><span class=na>MapMode</span><span class=p>.</span><span class=na>READ_WRITE</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>length</span><span class=p>);</span>
      <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>out</span><span class=p>.</span><span class=na>put</span><span class=p>((</span><span class=kt>byte</span><span class=p>)</span><span class=sc>&#39;x&#39;</span><span class=p>);</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Finished writing&quot;</span><span class=p>);</span>
      <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>length</span><span class=o>/</span><span class=mi>2</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>length</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=mi>6</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>((</span><span class=kt>char</span><span class=p>)</span><span class=n>out</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span><span class=p>));</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Finished writing
xxxxxx
</code></pre></div> <p>为了读写，我们从 <strong>RandomAccessFile</strong> 开始，获取该文件的通道，然后调用 <code>map()</code> 来生成 <strong>MappedByteBuffer</strong> ，这是一种特殊的直接缓冲区。你必须指定要在文件中映射的区域的起始点和长度—这意味着你可以选择映射大文件的较小区域。</p> <p><strong>MappedByteBuffer</strong> 继承了 <strong>ByteBuffer</strong>，所以拥有<strong>ByteBuffer</strong> 全部的方法。这里只展示了 <code>put()</code> 和 <code>get()</code> 的最简单用法，但是你也可以使用 <code>asCharBuffer()</code> 等方法。</p> <p>使用前面的程序创建的文件长度为 128MB，可能比你的操作系统单次所允许的操作的内存要大。该文件似乎可以同时访问，因为它只有一部分被带进内存，而其他部分被交换出去。这样，一个非常大的文件（最多 2GB）可以很容易地修改。<strong>注意</strong>，操作系统底层的文件映射工具用于性能的最大化。</p> <!-- Performance --> <h3 id=_8>性能<a class=headerlink href=#_8 title="Permanent link">#</a></h3> <p>虽然旧的 I/O 流的性能通过使用 <strong>NIO</strong> 实现得到了改进，但是映射文件访问往往要快得多。下例带来一个简单的性能比较。代码示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/MappedIO.java</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>MappedIO</span> <span class=p>{</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>numOfInts</span> <span class=o>=</span>      <span class=mi>4_000_000</span><span class=p>;</span>
  <span class=kd>private</span> <span class=kd>static</span> <span class=kt>int</span> <span class=n>numOfUbuffInts</span> <span class=o>=</span> <span class=mi>100_000</span><span class=p>;</span>
  <span class=kd>private</span> <span class=kd>abstract</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Tester</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
    <span class=n>Tester</span><span class=p>(</span><span class=n>String</span> <span class=n>name</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>this</span><span class=p>.</span><span class=na>name</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>runTest</span><span class=p>()</span> <span class=p>{</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>name</span> <span class=o>+</span> <span class=s>&quot;: &quot;</span><span class=p>);</span>
      <span class=kt>long</span> <span class=n>start</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>();</span>
      <span class=n>test</span><span class=p>();</span>
      <span class=kt>double</span> <span class=n>duration</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>nanoTime</span><span class=p>()</span> <span class=o>-</span> <span class=n>start</span><span class=p>;</span>
      <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%.3f%n&quot;</span><span class=p>,</span> <span class=n>duration</span><span class=o>/</span><span class=mf>1.0e9</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>abstract</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>();</span>
  <span class=p>}</span>

  <span class=kd>private</span> <span class=kd>static</span> <span class=n>Tester</span><span class=o>[]</span> <span class=n>tests</span> <span class=o>=</span> <span class=p>{</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Stream Write&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>DataOutputStream</span> <span class=n>dos</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>DataOutputStream</span><span class=p>(</span>
              <span class=k>new</span> <span class=n>BufferedOutputStream</span><span class=p>(</span>
                <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span>
                  <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>))))</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numOfInts</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>dos</span><span class=p>.</span><span class=na>writeInt</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Mapped Write&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>,</span> <span class=s>&quot;rw&quot;</span><span class=p>)</span>
              <span class=p>.</span><span class=na>getChannel</span><span class=p>()</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=n>IntBuffer</span> <span class=n>ib</span> <span class=o>=</span>
            <span class=n>fc</span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>FileChannel</span><span class=p>.</span><span class=na>MapMode</span><span class=p>.</span><span class=na>READ_WRITE</span><span class=p>,</span>
              <span class=mi>0</span><span class=p>,</span> <span class=n>fc</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>asIntBuffer</span><span class=p>();</span>
          <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numOfInts</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>ib</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Stream Read&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>DataInputStream</span> <span class=n>dis</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>DataInputStream</span><span class=p>(</span>
              <span class=k>new</span> <span class=n>BufferedInputStream</span><span class=p>(</span>
                <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>)))</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numOfInts</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>dis</span><span class=p>.</span><span class=na>readInt</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Mapped Read&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span>
            <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>)).</span><span class=na>getChannel</span><span class=p>()</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=n>IntBuffer</span> <span class=n>ib</span> <span class=o>=</span>
            <span class=n>fc</span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>FileChannel</span><span class=p>.</span><span class=na>MapMode</span><span class=p>.</span><span class=na>READ_ONLY</span><span class=p>,</span>
              <span class=mi>0</span><span class=p>,</span> <span class=n>fc</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>asIntBuffer</span><span class=p>();</span>
          <span class=k>while</span><span class=p>(</span><span class=n>ib</span><span class=p>.</span><span class=na>hasRemaining</span><span class=p>())</span>
            <span class=n>ib</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Stream Read/Write&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>RandomAccessFile</span> <span class=n>raf</span> <span class=o>=</span>
            <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span>
              <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>),</span> <span class=s>&quot;rw&quot;</span><span class=p>)</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=n>raf</span><span class=p>.</span><span class=na>writeInt</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
          <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numOfUbuffInts</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>raf</span><span class=p>.</span><span class=na>seek</span><span class=p>(</span><span class=n>raf</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>-</span> <span class=mi>4</span><span class=p>);</span>
            <span class=n>raf</span><span class=p>.</span><span class=na>writeInt</span><span class=p>(</span><span class=n>raf</span><span class=p>.</span><span class=na>readInt</span><span class=p>());</span>
          <span class=p>}</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>},</span>
    <span class=k>new</span> <span class=n>Tester</span><span class=p>(</span><span class=s>&quot;Mapped Read/Write&quot;</span><span class=p>)</span> <span class=p>{</span>
      <span class=nd>@Override</span>
      <span class=kd>public</span> <span class=kt>void</span> <span class=nf>test</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
          <span class=n>FileChannel</span> <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span>
            <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=s>&quot;temp.tmp&quot;</span><span class=p>),</span> <span class=s>&quot;rw&quot;</span><span class=p>).</span><span class=na>getChannel</span><span class=p>()</span>
        <span class=p>)</span> <span class=p>{</span>
          <span class=n>IntBuffer</span> <span class=n>ib</span> <span class=o>=</span>
            <span class=n>fc</span><span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>FileChannel</span><span class=p>.</span><span class=na>MapMode</span><span class=p>.</span><span class=na>READ_WRITE</span><span class=p>,</span>
              <span class=mi>0</span><span class=p>,</span> <span class=n>fc</span><span class=p>.</span><span class=na>size</span><span class=p>()).</span><span class=na>asIntBuffer</span><span class=p>();</span>
          <span class=n>ib</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
          <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>numOfUbuffInts</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>ib</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>ib</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>i</span> <span class=o>-</span> <span class=mi>1</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>};</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Arrays</span><span class=p>.</span><span class=na>stream</span><span class=p>(</span><span class=n>tests</span><span class=p>).</span><span class=na>forEach</span><span class=p>(</span><span class=n>Tester</span><span class=p>::</span><span class=n>runTest</span><span class=p>);</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Stream Write: 0.615
Mapped Write: 0.050
Stream Read: 0.577
Mapped Read: 0.015
Stream Read/Write: 4.069
Mapped Read/Write: 0.013
</code></pre></div> <p><strong>Tester</strong> 使用了模板方法（Template Method）模式，它为匿名内部子类中定义的 <code>test()</code> 的各种实现创建一个测试框架。每个子类都执行一种测试，因此 <code>test()</code> 方法还提供了执行各种I/O 活动的原型。</p> <p>虽然映射的写似乎使用 <strong>FileOutputStream</strong>，但是文件映射中的所有输出必须使用 <strong>RandomAccessFile</strong>，就像前面代码中的读/写一样。</p> <p>请注意，<code>test()</code> 方法包括初始化各种 I/O 对象的时间，因此，尽管映射文件的设置可能很昂贵，但是与流 I/O 相比，总体收益非常可观。</p> <!-- File Locking --> <h2 id=_9>文件锁定<a class=headerlink href=#_9 title="Permanent link">#</a></h2> <p>文件锁定可同步访问，因此文件可以共享资源。但是，争用同一文件的两个线程可能位于不同的 JVM 中，或者一个可能是 Java 线程，另一个可能是操作系统中的本机线程。文件锁对其他操作系统进程可见，因为 Java 文件锁定直接映射到本机操作系统锁定工具。</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/FileLocking.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.concurrent.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FileLocking</span> <span class=p>{</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>try</span><span class=p>(</span>
      <span class=n>FileOutputStream</span> <span class=n>fos</span> <span class=o>=</span>
        <span class=k>new</span> <span class=n>FileOutputStream</span><span class=p>(</span><span class=s>&quot;file.txt&quot;</span><span class=p>);</span>
      <span class=n>FileLock</span> <span class=n>fl</span> <span class=o>=</span> <span class=n>fos</span><span class=p>.</span><span class=na>getChannel</span><span class=p>().</span><span class=na>tryLock</span><span class=p>()</span>
    <span class=p>)</span> <span class=p>{</span>
      <span class=k>if</span><span class=p>(</span><span class=n>fl</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Locked File&quot;</span><span class=p>);</span>
        <span class=n>TimeUnit</span><span class=p>.</span><span class=na>MILLISECONDS</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span>
        <span class=n>fl</span><span class=p>.</span><span class=na>release</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Released Lock&quot;</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=o>|</span> <span class=n>InterruptedException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Locked File
Released Lock
</code></pre></div> <p>通过调用 <strong>FileChannel</strong> 上的 <code>tryLock()</code> 或 <code>lock()</code>，可以获得整个文件的 <strong>FileLock</strong>。（<strong>SocketChannel</strong>、<strong>DatagramChannel</strong> 和 <strong>ServerSocketChannel</strong> 不需要锁定，因为它们本质上是单进程实体；通常不会在两个进程之间共享一个网络套接字）。</p> <p><code>tryLock()</code> 是非阻塞的。它试图获取锁，若不能获取（当其他进程已经持有相同的锁，并且它不是共享的），它只是从方法调用返回。</p> <p><code>lock()</code> 会阻塞，直到获得锁，或者调用 <code>lock()</code> 的线程中断，或者调用 <code>lock()</code> 方法的通道关闭。使用 <strong>FileLock.</strong><code>release()</code> 释放锁。</p> <p>还可以使用</p> <blockquote> <p><code>tryLock(long position, long size, boolean shared)</code></p> </blockquote> <p>或 </p> <blockquote> <p><code>lock(long position, long size, boolean shared)</code> </p> </blockquote> <p>锁定文件的一部分，锁住 <strong>size-position</strong> 区域。第三个参数指定是否共享此锁。</p> <p>虽然零参数锁定方法适应文件大小的变化，但是如果文件大小发生变化，具有固定大小的锁不会发生变化。如果从一个位置到另一个位置获得一个锁，并且文件的增长超过了 position + size ，那么超出 position + size 的部分没有被锁定。零参数锁定方法锁定整个文件，即使它在增长。</p> <p>底层操作系统必须提供对独占锁或共享锁的支持。如果操作系统不支持共享锁并且对一个操作系统发出请求，则使用独占锁。可以使用 <strong>FileLock.</strong><code>isShared()</code> 查询锁的类型（共享或独占）。</p> <!-- Locking Portions of a Mapped File --> <h3 id=_10>映射文件的部分锁定<a class=headerlink href=#_10 title="Permanent link">#</a></h3> <p>文件映射通常用于非常大的文件。你可能需要锁定此类文件的某些部分，以便其他进程可以修改未锁定的部分。例如，数据库必须同时对许多用户可用。这里你可以看到两个线程，每个线程都锁定文件的不同部分:</p> <div class=highlight><pre><span></span><code><span class=c1>// newio/LockingMappedFiles.java</span>
<span class=c1>// (c)2017 MindView LLC: see Copyright.txt</span>
<span class=c1>// 我们无法保证该代码是否适用于其他用途。</span>
<span class=c1>// 访问 http://OnJava8.com 了解更多本书信息。</span>
<span class=c1>// Locking portions of a mapped file</span>
<span class=kn>import</span> <span class=nn>java.nio.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.channels.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>LockingMappedFiles</span> <span class=p>{</span>
  <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>LENGTH</span> <span class=o>=</span> <span class=mh>0x8FFFFFF</span><span class=p>;</span> <span class=c1>// 128 MB</span>
  <span class=kd>static</span> <span class=n>FileChannel</span> <span class=n>fc</span><span class=p>;</span>
  <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
  <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
    <span class=n>fc</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RandomAccessFile</span><span class=p>(</span><span class=s>&quot;test.dat&quot;</span><span class=p>,</span> <span class=s>&quot;rw&quot;</span><span class=p>)</span>
      <span class=p>.</span><span class=na>getChannel</span><span class=p>();</span>
    <span class=n>MappedByteBuffer</span> <span class=n>out</span> <span class=o>=</span> <span class=n>fc</span><span class=p>.</span><span class=na>map</span><span class=p>(</span>
      <span class=n>FileChannel</span><span class=p>.</span><span class=na>MapMode</span><span class=p>.</span><span class=na>READ_WRITE</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>LENGTH</span><span class=p>);</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>LENGTH</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
      <span class=n>out</span><span class=p>.</span><span class=na>put</span><span class=p>((</span><span class=kt>byte</span><span class=p>)</span><span class=sc>&#39;x&#39;</span><span class=p>);</span>
    <span class=k>new</span> <span class=n>LockAndModify</span><span class=p>(</span><span class=n>out</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span> <span class=o>+</span> <span class=n>LENGTH</span><span class=o>/</span><span class=mi>3</span><span class=p>);</span>
    <span class=k>new</span> <span class=n>LockAndModify</span><span class=p>(</span>
      <span class=n>out</span><span class=p>,</span> <span class=n>LENGTH</span><span class=o>/</span><span class=mi>2</span><span class=p>,</span> <span class=n>LENGTH</span><span class=o>/</span><span class=mi>2</span> <span class=o>+</span> <span class=n>LENGTH</span><span class=o>/</span><span class=mi>4</span><span class=p>);</span>
  <span class=p>}</span>

  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>LockAndModify</span> <span class=kd>extends</span> <span class=n>Thread</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>ByteBuffer</span> <span class=n>buff</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>;</span>
    <span class=n>LockAndModify</span><span class=p>(</span><span class=n>ByteBuffer</span> <span class=n>mbb</span><span class=p>,</span> <span class=kt>int</span> <span class=n>start</span><span class=p>,</span> <span class=kt>int</span> <span class=n>end</span><span class=p>)</span> <span class=p>{</span>
      <span class=k>this</span><span class=p>.</span><span class=na>start</span> <span class=o>=</span> <span class=n>start</span><span class=p>;</span>
      <span class=k>this</span><span class=p>.</span><span class=na>end</span> <span class=o>=</span> <span class=n>end</span><span class=p>;</span>
      <span class=n>mbb</span><span class=p>.</span><span class=na>limit</span><span class=p>(</span><span class=n>end</span><span class=p>);</span>
      <span class=n>mbb</span><span class=p>.</span><span class=na>position</span><span class=p>(</span><span class=n>start</span><span class=p>);</span>
      <span class=n>buff</span> <span class=o>=</span> <span class=n>mbb</span><span class=p>.</span><span class=na>slice</span><span class=p>();</span>
      <span class=n>start</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>run</span><span class=p>()</span> <span class=p>{</span>
      <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// Exclusive lock with no overlap:</span>
        <span class=n>FileLock</span> <span class=n>fl</span> <span class=o>=</span> <span class=n>fc</span><span class=p>.</span><span class=na>lock</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=n>end</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
          <span class=s>&quot;Locked: &quot;</span><span class=o>+</span> <span class=n>start</span> <span class=o>+</span><span class=s>&quot; to &quot;</span><span class=o>+</span> <span class=n>end</span><span class=p>);</span>
        <span class=c1>// Perform modification:</span>
        <span class=k>while</span><span class=p>(</span><span class=n>buff</span><span class=p>.</span><span class=na>position</span><span class=p>()</span> <span class=o>&lt;</span> <span class=n>buff</span><span class=p>.</span><span class=na>limit</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
          <span class=n>buff</span><span class=p>.</span><span class=na>put</span><span class=p>((</span><span class=kt>byte</span><span class=p>)(</span><span class=n>buff</span><span class=p>.</span><span class=na>get</span><span class=p>()</span> <span class=o>+</span> <span class=mi>1</span><span class=p>));</span>
        <span class=n>fl</span><span class=p>.</span><span class=na>release</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
          <span class=s>&quot;Released: &quot;</span> <span class=o>+</span> <span class=n>start</span> <span class=o>+</span> <span class=s>&quot; to &quot;</span> <span class=o>+</span> <span class=n>end</span><span class=p>);</span>
      <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
      <span class=p>}</span>
    <span class=p>}</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出结果：</p> <div class=highlight><pre><span></span><code>Locked: 75497471 to 113246206
Locked: 0 to 50331647
Released: 75497471 to 113246206
Released: 0 to 50331647
</code></pre></div> <p><strong>LockAndModify</strong> 线程类设置缓冲区并创建要修改的 <code>slice()</code>，在 <code>run()</code> 中，锁在文件通道上获取（不能在缓冲区上获取锁—只能在通道上获取锁）。<code>lock()</code> 的调用非常类似于获取对象上的线程锁 —— 现在有了一个“临界区”，可以对文件的这部分进行独占访问。<sup id=fnref:1><a class=footnote-ref href=#fn:1>1</a></sup></p> <p>当 JVM 退出或关闭获取锁的通道时，锁会自动释放，但是你也可以显式地调用 <strong>FileLock</strong> 对象上的 <code>release()</code>，如上所示。</p> <!-- 脚注 --> <!-- 分页 --> <div style="page-break-after: always;"></div> <div class=footnote> <hr> <ol> <li id=fn:1> <p>更多详情可参考<a href=./book/Appendix-Low-Level-Concurrency.md>附录:并发底层原理</a>。&#160;<a class=footnote-backref href=#fnref:1 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Appendix Low Level Concurrency </span> </div> </a> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Appendix Object Serialization </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://leay.net target=_blank rel=noopener title=home class="md-footer-social__link fa fa-home"></a> <a href=https://github.com/hqweay target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.c33a9706.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.ja.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.multi.js></script> <script>app.initialize({version:"1.1",url:{base:"../../../../.."}})</script> </body> </html>