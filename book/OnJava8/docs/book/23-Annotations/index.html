<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Thinking Drafts"><link href=https://wiki.leay.net/book/OnJava8/docs/book/23-Annotations/ rel=canonical><meta name=author content=hqweay><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content="en, ja"><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../../../img/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>23 Annotations - Hqweay's Wiki</title><link rel=stylesheet href=../../../../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#3f51b5><script src=../../../../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Serif+SC:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Noto Serif SC","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../../../assets/fonts/material-icons.css><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-105976066-3", "wiki.leay.net")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=indigo> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#_1 tabindex=0 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" aria-label="Hqweay's Wiki" class="md-header-nav__button md-logo"> <i class=md-icon></i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Hqweay's Wiki </span> <span class=md-header-nav__topic> 23 Annotations </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> About </a> </li> <li class=md-tabs__item> <a href=../../../ class="md-tabs__link md-tabs__link--active"> Book </a> </li> <li class=md-tabs__item> <a href=../../../../../doc/ class=md-tabs__link> Doc </a> </li> <li class=md-tabs__item> <a href=../../../../../life/reading/ class=md-tabs__link> Life </a> </li> <li class=md-tabs__item> <a href=../../../../../study/draft/try-wiki/ class=md-tabs__link> Study </a> </li> <li class=md-tabs__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ class=md-tabs__link> Tech </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://wiki.leay.net/ title="Hqweay's Wiki" class="md-nav__button md-logo"> <i class=md-icon></i> </a> Hqweay's Wiki </label> <div class=md-nav__source> <a href=https://github.com/hqweay/my-mkdocs/ title="前往 Github 仓库" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> hqweay/my-mkdocs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. title=About class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../../../../test/ title=特殊语法 class=md-nav__link> 特殊语法 </a> </li> <li class=md-nav__item> <a href=../../../../../web-page/ title=静态文档导航 class=md-nav__link> 静态文档导航 </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1 type=checkbox id=nav-4-1 checked> <label class=md-nav__link for=nav-4-1> OnJava8 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-4-1> OnJava8 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../ title="《On Java 8》中文版" class=md-nav__link> 《On Java 8》中文版 </a> </li> <li class=md-nav__item> <a href=../../../CONTRIBUTING/ title=CONTRIBUTING class=md-nav__link> CONTRIBUTING </a> </li> <li class=md-nav__item> <a href=../../../SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4 type=checkbox id=nav-4-1-4 checked> <label class=md-nav__link for=nav-4-1-4> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-4-1-4> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ title=译者的话 class=md-nav__link> 译者的话 </a> </li> <li class=md-nav__item> <a href=../../_coverpage/ title=coverpage class=md-nav__link> coverpage </a> </li> <li class=md-nav__item> <a href=../../sidebar/ title=Sidebar class=md-nav__link> Sidebar </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4 type=checkbox id=nav-4-1-4-4> <label class=md-nav__link for=nav-4-1-4-4> style </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-4> style </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-4-1 type=checkbox id=nav-4-1-4-4-1> <label class=md-nav__link for=nav-4-1-4-4-1> Prism master </label> <nav class=md-nav data-md-component=collapsible data-md-level=5> <label class=md-nav__title for=nav-4-1-4-4-1> Prism master </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../_style/prism-master/ title=[Prism](http://prismjs.com/) class=md-nav__link> [Prism](http://prismjs.com/) </a> </li> <li class=md-nav__item> <a href=../../_style/prism-master/CHANGELOG/ title="Prism Changelog" class=md-nav__link> Prism Changelog </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4-1-4-5 type=checkbox id=nav-4-1-4-5 checked> <label class=md-nav__link for=nav-4-1-4-5> Book </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-4-1-4-5> Book </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../00-Introduction/ title=简介 class=md-nav__link> 简介 </a> </li> <li class=md-nav__item> <a href=../00-On-Java-8/ title="00 On Java 8" class=md-nav__link> 00 On Java 8 </a> </li> <li class=md-nav__item> <a href=../00-Preface/ title=前言 class=md-nav__link> 前言 </a> </li> <li class=md-nav__item> <a href=../01-What-is-an-Object/ title="第一章 对象的概念" class=md-nav__link> 第一章 对象的概念 </a> </li> <li class=md-nav__item> <a href=../02-Installing-Java-and-the-Book-Examples/ title="02 Installing Java and the Book Examples" class=md-nav__link> 02 Installing Java and the Book Examples </a> </li> <li class=md-nav__item> <a href=../03-Objects-Everywhere/ title="03 Objects Everywhere" class=md-nav__link> 03 Objects Everywhere </a> </li> <li class=md-nav__item> <a href=../04-Operators/ title="04 Operators" class=md-nav__link> 04 Operators </a> </li> <li class=md-nav__item> <a href=../05-Control-Flow/ title="05 Control Flow" class=md-nav__link> 05 Control Flow </a> </li> <li class=md-nav__item> <a href=../06-Housekeeping/ title="06 Housekeeping" class=md-nav__link> 06 Housekeeping </a> </li> <li class=md-nav__item> <a href=../07-Implementation-Hiding/ title="07 Implementation Hiding" class=md-nav__link> 07 Implementation Hiding </a> </li> <li class=md-nav__item> <a href=../08-Reuse/ title="08 Reuse" class=md-nav__link> 08 Reuse </a> </li> <li class=md-nav__item> <a href=../09-Polymorphism/ title="09 Polymorphism" class=md-nav__link> 09 Polymorphism </a> </li> <li class=md-nav__item> <a href=../10-Interfaces/ title="10 Interfaces" class=md-nav__link> 10 Interfaces </a> </li> <li class=md-nav__item> <a href=../11-Inner-Classes/ title="11 Inner Classes" class=md-nav__link> 11 Inner Classes </a> </li> <li class=md-nav__item> <a href=../12-Collections/ title="12 Collections" class=md-nav__link> 12 Collections </a> </li> <li class=md-nav__item> <a href=../13-Functional-Programming/ title="13 Functional Programming" class=md-nav__link> 13 Functional Programming </a> </li> <li class=md-nav__item> <a href=../14-Streams/ title="14 Streams" class=md-nav__link> 14 Streams </a> </li> <li class=md-nav__item> <a href=../15-Exceptions/ title="15 Exceptions" class=md-nav__link> 15 Exceptions </a> </li> <li class=md-nav__item> <a href=../16-Validating-Your-Code/ title="16 Validating Your Code" class=md-nav__link> 16 Validating Your Code </a> </li> <li class=md-nav__item> <a href=../17-Files/ title="17 Files" class=md-nav__link> 17 Files </a> </li> <li class=md-nav__item> <a href=../18-Strings/ title="18 Strings" class=md-nav__link> 18 Strings </a> </li> <li class=md-nav__item> <a href=../19-Type-Information/ title="19 Type Information" class=md-nav__link> 19 Type Information </a> </li> <li class=md-nav__item> <a href=../20-Generics/ title="20 Generics" class=md-nav__link> 20 Generics </a> </li> <li class=md-nav__item> <a href=../21-Arrays/ title="21 Arrays" class=md-nav__link> 21 Arrays </a> </li> <li class=md-nav__item> <a href=../22-Enumerations/ title="22 Enumerations" class=md-nav__link> 22 Enumerations </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> 23 Annotations </label> <a href=./ title="23 Annotations" class="md-nav__link md-nav__link--active"> 23 Annotations </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本语法 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 定义注解 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 元注解 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 编写注解处理器 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 注解元素 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 默认值限制 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 生成外部文件 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 替代方案 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 注解不支持继承 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 实现处理器 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#javac class=md-nav__link> 使用javac处理注解 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 最简单的处理器 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 更复杂的处理器 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 基于注解的单元测试 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unit class=md-nav__link> 在 @Unit 中使用泛型 </a> </li> <li class=md-nav__item> <a href=#unit_1 class=md-nav__link> 实现 @Unit </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class=md-nav__link> 24 Concurrent Programming </a> </li> <li class=md-nav__item> <a href=../25-Patterns/ title="25 Patterns" class=md-nav__link> 25 Patterns </a> </li> <li class=md-nav__item> <a href=../Appendix-Becoming-a-Programmer/ title="Appendix Becoming a Programmer" class=md-nav__link> Appendix Becoming a Programmer </a> </li> <li class=md-nav__item> <a href=../Appendix-Benefits-and-Costs-of-Static-Type-Checking/ title="Appendix Benefits and Costs of Static Type Checking" class=md-nav__link> Appendix Benefits and Costs of Static Type Checking </a> </li> <li class=md-nav__item> <a href=../Appendix-Collection-Topics/ title="Appendix Collection Topics" class=md-nav__link> Appendix Collection Topics </a> </li> <li class=md-nav__item> <a href=../Appendix-Data-Compression/ title="Appendix Data Compression" class=md-nav__link> Appendix Data Compression </a> </li> <li class=md-nav__item> <a href=../Appendix-IO-Streams/ title="Appendix IO Streams" class=md-nav__link> Appendix IO Streams </a> </li> <li class=md-nav__item> <a href=../Appendix-Javadoc/ title="Appendix Javadoc" class=md-nav__link> Appendix Javadoc </a> </li> <li class=md-nav__item> <a href=../Appendix-Low-Level-Concurrency/ title="Appendix Low Level Concurrency" class=md-nav__link> Appendix Low Level Concurrency </a> </li> <li class=md-nav__item> <a href=../Appendix-New-IO/ title="Appendix New IO" class=md-nav__link> Appendix New IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Object-Serialization/ title="Appendix Object Serialization" class=md-nav__link> Appendix Object Serialization </a> </li> <li class=md-nav__item> <a href=../Appendix-Passing-and-Returning-Objects/ title="Appendix Passing and Returning Objects" class=md-nav__link> Appendix Passing and Returning Objects </a> </li> <li class=md-nav__item> <a href=../Appendix-Programming-Guidelines/ title="Appendix Programming Guidelines" class=md-nav__link> Appendix Programming Guidelines </a> </li> <li class=md-nav__item> <a href=../Appendix-Standard-IO/ title="Appendix Standard IO" class=md-nav__link> Appendix Standard IO </a> </li> <li class=md-nav__item> <a href=../Appendix-Supplements/ title="Appendix Supplements" class=md-nav__link> Appendix Supplements </a> </li> <li class=md-nav__item> <a href=../Appendix-The-Positive-Legacy-of-C-plus-plus-and-Java/ title="Appendix The Positive Legacy of C plus plus and Java" class=md-nav__link> Appendix The Positive Legacy of C plus plus and Java </a> </li> <li class=md-nav__item> <a href=../Appendix-Understanding-equals-and-hashCode/ title="Appendix Understanding equals and hashCode" class=md-nav__link> Appendix Understanding equals and hashCode </a> </li> <li class=md-nav__item> <a href=../GLOSSARY/ title=GLOSSARY class=md-nav__link> GLOSSARY </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Doc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Doc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/ title=About class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> English </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> English </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1 type=checkbox id=nav-5-2-1> <label class=md-nav__link for=nav-5-2-1> A Programmers Guide to English </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-1> A Programmers Guide to English </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/ title="A Programmer's Guide to English" class=md-nav__link> A Programmer's Guide to English </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-3 type=checkbox id=nav-5-2-1-3> <label class=md-nav__link for=nav-5-2-1-3> Essence </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-3> Essence </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/essence/ title=语言学习的本质浅析 class=md-nav__link> 语言学习的本质浅析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-4 type=checkbox id=nav-5-2-1-4> <label class=md-nav__link for=nav-5-2-1-4> Make a program </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-4> Make a program </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/make-a-program/ title=如何构建一个识别英语的程序 class=md-nav__link> 如何构建一个识别英语的程序 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-5 type=checkbox id=nav-5-2-1-5> <label class=md-nav__link for=nav-5-2-1-5> Qa </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-5> Qa </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/ title="常见问题 QA" class=md-nav__link> 常见问题 QA </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/qa/WhyPTE/ title="为什么我选择 PTE 考试" class=md-nav__link> 为什么我选择 PTE 考试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-6 type=checkbox id=nav-5-2-1-6> <label class=md-nav__link for=nav-5-2-1-6> Resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-6> Resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/resources/ title=资料、工具推荐和扩展阅读 class=md-nav__link> 资料、工具推荐和扩展阅读 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-1-7 type=checkbox id=nav-5-2-1-7> <label class=md-nav__link for=nav-5-2-1-7> Training </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-1-7> Training </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ title=我的训练方法 class=md-nav__link> 我的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/KnowledgeBase/ title=扩充语料库的训练方法 class=md-nav__link> 扩充语料库的训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/ListeningandSpeaking/ title=发音和听力训练方法 class=md-nav__link> 发音和听力训练方法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/A-Programmers-Guide-to-English/training/Thinking/ title=英语思维训练 class=md-nav__link> 英语思维训练 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2 type=checkbox id=nav-5-2-2> <label class=md-nav__link for=nav-5-2-2> English level up tips for Chinese </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-2> English level up tips for Chinese </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/ title=English-level-up-tips-for-Chinese class=md-nav__link> English-level-up-tips-for-Chinese </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/SUMMARY/ title=Summary class=md-nav__link> Summary </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-3 type=checkbox id=nav-5-2-2-3> <label class=md-nav__link for=nav-5-2-2-3> Part 1 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-3> Part 1 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/1-understanding/ title=认知篇 class=md-nav__link> 认知篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/2-vocabulary/ title=单词篇 class=md-nav__link> 单词篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/3-listening/ title=听力篇 class=md-nav__link> 听力篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/4-reading/ title=阅读篇 class=md-nav__link> 阅读篇 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-1/5-speaking/ title="5 speaking" class=md-nav__link> 5 speaking </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-4 type=checkbox id=nav-5-2-2-4> <label class=md-nav__link for=nav-5-2-2-4> Part 2 </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-4> Part 2 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/part-2/x-misc/ title=扯淡篇 class=md-nav__link> 扯淡篇 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-2-5 type=checkbox id=nav-5-2-2-5> <label class=md-nav__link for=nav-5-2-2-5> Word list </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-2-2-5> Word list </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Go/ title=Go class=md-nav__link> Go </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Java/ title=Java class=md-nav__link> Java </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/JavaScript/ title=JavaScript class=md-nav__link> JavaScript </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/PHP/ title=PHP class=md-nav__link> PHP </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Python/ title=Python class=md-nav__link> Python </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/English-level-up-tips-for-Chinese/word-list/Swift/ title=Swift class=md-nav__link> Swift </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2-3 type=checkbox id=nav-5-2-3> <label class=md-nav__link for=nav-5-2-3> Everyone can use english </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-2-3> Everyone can use english </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/ title=人人都能用英语 class=md-nav__link> 人人都能用英语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter1/ title="第一章 起点" class=md-nav__link> 第一章 起点 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter2/ title="第二章 口语" class=md-nav__link> 第二章 口语 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter3/ title="第三章 语音" class=md-nav__link> 第三章 语音 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter4/ title="第四章 朗读" class=md-nav__link> 第四章 朗读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter5/ title="第五章 词典" class=md-nav__link> 第五章 词典 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter6/ title="第六章 语法" class=md-nav__link> 第六章 语法 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter7/ title="第七章 精读" class=md-nav__link> 第七章 精读 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/chapter8/ title="第八章 叮嘱" class=md-nav__link> 第八章 叮嘱 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/english/everyone-can-use-english/end/ title=后记 class=md-nav__link> 后记 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> Writing </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> Writing </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-1 type=checkbox id=nav-5-3-1> <label class=md-nav__link for=nav-5-3-1> Chinese copywriting guidelines </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-1> Chinese copywriting guidelines </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/CHANGELOG/ title=CHANGELOG class=md-nav__link> CHANGELOG </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.en-US/ title="Chinese Copywriting Guidelines" class=md-nav__link> Chinese Copywriting Guidelines </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-CN/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/chinese-copywriting-guidelines/README.zh-HK/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2 type=checkbox id=nav-5-3-2> <label class=md-nav__link for=nav-5-3-2> Document style guide </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-5-3-2> Document style guide </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/ title=Index class=md-nav__link> Index </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3-2-2 type=checkbox id=nav-5-3-2-2> <label class=md-nav__link for=nav-5-3-2-2> Docs </label> <nav class=md-nav data-md-component=collapsible data-md-level=4> <label class=md-nav__title for=nav-5-3-2-2> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/marks/ title=标点符号 class=md-nav__link> 标点符号 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/number/ title=数值 class=md-nav__link> 数值 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/paragraph/ title=段落 class=md-nav__link> 段落 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/reference/ title=参考链接 class=md-nav__link> 参考链接 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/structure/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/text/ title=文本 class=md-nav__link> 文本 </a> </li> <li class=md-nav__item> <a href=../../../../../doc/writing/document-style-guide/docs/title/ title=标题 class=md-nav__link> 标题 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> Life </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-6> Life </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1 type=checkbox id=nav-6-1> <label class=md-nav__link for=nav-6-1> Reading </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-1> Reading </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/ title=阅读 class=md-nav__link> 阅读 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-2 type=checkbox id=nav-6-1-2> <label class=md-nav__link for=nav-6-1-2> Mark </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-2> Mark </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back-up/ title="2019 暑假备份" class=md-nav__link> 2019 暑假备份 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/back/ title=例行收集 class=md-nav__link> 例行收集 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/efficiency-time/ title=效率、时间、鸡汤 class=md-nav__link> 效率、时间、鸡汤 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fiction/ title=小说 class=md-nav__link> 小说 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/films-remark/ title=影评、电影 class=md-nav__link> 影评、电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/fo/ title=佛 class=md-nav__link> 佛 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hackers-others/ title=互联网、思维方式 class=md-nav__link> 互联网、思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/hooked-media/ title=媒介反思 class=md-nav__link> 媒介反思 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/isaka-kotaro/ title=伊坂幸太郎 class=md-nav__link> 伊坂幸太郎 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/knote/ title=整理 class=md-nav__link> 整理 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/mark-knote/ title=浪费时间 class=md-nav__link> 浪费时间 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/meaning/ title=思维方式 class=md-nav__link> 思维方式 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/morimi-tomihiko/ title=森见登美彦的文字好有趣啊! class=md-nav__link> 森见登美彦的文字好有趣啊! </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/murakamo-haruki/ title=村上春树 class=md-nav__link> 村上春树 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/no-fiction/ title=非虚构类 class=md-nav__link> 非虚构类 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/paper/ title=论文式总结 class=md-nav__link> 论文式总结 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/poem/ title=诗歌 class=md-nav__link> 诗歌 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/sence/ title=哲学相关通俗读物 class=md-nav__link> 哲学相关通俗读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/the-little-prince/ title="The Little Prince" class=md-nav__link> The Little Prince </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/universe/ title=物理科普读物 class=md-nav__link> 物理科普读物 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/utopia/ title=乌托邦小说世界关于书籍的冷幽默 class=md-nav__link> 乌托邦小说世界关于书籍的冷幽默 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/western-politics/ title=政哲 class=md-nav__link> 政哲 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/what-we-talk-about/ title=日本文学 class=md-nav__link> 日本文学 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/wuxia/ title=武侠 class=md-nav__link> 武侠 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/mark/xiao-bo/ title=王小波 class=md-nav__link> 王小波 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-3 type=checkbox id=nav-6-1-3> <label class=md-nav__link for=nav-6-1-3> Note </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-3> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-02-book-JavaScript-DOM/ title="《JavaScript DOM 编程艺术》" class=md-nav__link> 《JavaScript DOM 编程艺术》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2017-09-09-coding-javascript-down/ title="尽量把 JavaScript 代码放到 HTML 网页底部" class=md-nav__link> 尽量把 JavaScript 代码放到 HTML 网页底部 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-05-23-HTTP/ title="《HTTP 图解》" class=md-nav__link> 《HTTP 图解》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-06-07-computer/ title=计算机系统基础 class=md-nav__link> 计算机系统基础 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-10-09-JVM/ title="JVM 笔记" class=md-nav__link> JVM 笔记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/note/2018-11-25-computer/ title=计算机系统概论 class=md-nav__link> 计算机系统概论 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-1-4 type=checkbox id=nav-6-1-4> <label class=md-nav__link for=nav-6-1-4> Review </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-6-1-4> Review </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-28-say-something/ title=听你吹牛的闲暇时光 class=md-nav__link> 听你吹牛的闲暇时光 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-09-29-wuxia/ title="《流星 蝴蝶 剑》简记" class=md-nav__link> 《流星 蝴蝶 剑》简记 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2017-12-30-xiao-bo/ title=波波老师 class=md-nav__link> 波波老师 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-01-17-lai-zi-xin-shi-jie/ title=《来自新世界》 class=md-nav__link> 《来自新世界》 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2018-10-06-October/ title=科普谈起 class=md-nav__link> 科普谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../life/reading/review/2019-09-07-story/ title=从网络小说谈起。 class=md-nav__link> 从网络小说谈起。 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> Watching </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-6-2> Watching </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../life/watching/2017-08-29-watch-movies-rencently/ title=最近看的几部电影 class=md-nav__link> 最近看的几部电影 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-10-13-september-movies-record/ title=九月观影记录 class=md-nav__link> 九月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-11-01-October-summary/ title=十月看片与非专业类阅读 class=md-nav__link> 十月看片与非专业类阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2017-12-01-1112/ title=观影与阅读记录 class=md-nav__link> 观影与阅读记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-01-10-12/ title=最近看片与阅读 class=md-nav__link> 最近看片与阅读 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-02-06-january/ title=一月观影记录 class=md-nav__link> 一月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-08-February/ title=二月至今观影记录 class=md-nav__link> 二月至今观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-03-31-March/ title=三月观影记录 class=md-nav__link> 三月观影记录 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2018-12-26-Smultronst%C3%A4llet/ title=野草莓 class=md-nav__link> 野草莓 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-10-10-October/ title=克服本能就是善良吗？（从十月新番胡扯……） class=md-nav__link> 克服本能就是善良吗？（从十月新番胡扯……） </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-04-bgm/ title=无人声环 class=md-nav__link> 无人声环 </a> </li> <li class=md-nav__item> <a href=../../../../../life/watching/2019-11-13-the-end-of-the-world/ title="The End of the Fucking World" class=md-nav__link> The End of the Fucking World </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> Study </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-7> Study </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-1 type=checkbox id=nav-7-1> <label class=md-nav__link for=nav-7-1> Draft </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-1> Draft </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/draft/try-wiki/ title="一些 Wiki 工具的尝试" class=md-nav__link> 一些 Wiki 工具的尝试 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-7-2 type=checkbox id=nav-7-2> <label class=md-nav__link for=nav-7-2> Language </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-7-2> Language </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../study/language/%E6%97%A5%E8%AF%AD%E5%85%A5%E9%97%A8/ title=日语入门 class=md-nav__link> 日语入门 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Tech </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-8> Tech </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Code </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-1> Code </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-1 type=checkbox id=nav-8-1-1> <label class=md-nav__link for=nav-8-1-1> Frontend </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-1> Frontend </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-14-easy-web-test/ title=大表哥的电商网页实战体验 class=md-nav__link> 大表哥的电商网页实战体验 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2017-09-23-know-nothing/ title=知其然不知其所以然 class=md-nav__link> 知其然不知其所以然 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/2018-06-08-responsive/ title=大表哥的响应式设计 class=md-nav__link> 大表哥的响应式设计 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/frontend/zh-javascript-info/ title="现代 JavaScript 教程摘录" class=md-nav__link> 现代 JavaScript 教程摘录 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-2 type=checkbox id=nav-8-1-2> <label class=md-nav__link for=nav-8-1-2> Go </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-2> Go </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/go/01/ title=01 class=md-nav__link> 01 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-3 type=checkbox id=nav-8-1-3> <label class=md-nav__link for=nav-8-1-3> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-3> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/java/2017-12-30-Java%20Web/ title="从 url 访问服务器资源讨论 Java Web 中的 Servlet" class=md-nav__link> 从 url 访问服务器资源讨论 Java Web 中的 Servlet </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2018-11-23-ArrayList/ title=ArrayList class=md-nav__link> ArrayList </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-01-31-HashMap/ title=HashMap class=md-nav__link> HashMap </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-01-String/ title="String 分析(栈,堆,字符串常量池)" class=md-nav__link> String 分析(栈,堆,字符串常量池) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-03-String/ title=String、StringBuffer、StingBuilder class=md-nav__link> String、StringBuffer、StingBuilder </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-02-06-Hashtable/ title=Hashtable class=md-nav__link> Hashtable </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-22-string-pool/ title=字符串常量池到底保存的是字符串对象还是字符串对象的引用? class=md-nav__link> 字符串常量池到底保存的是字符串对象还是字符串对象的引用? </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-23-Java-Thread-pool/ title="Java 线程池" class=md-nav__link> Java 线程池 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-03-29-Java%20Web/ title="Java Web 启动流程" class=md-nav__link> Java Web 启动流程 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/java/2019-04-05-AQS-lock/ title="AQS 与 Java 锁的具体实现" class=md-nav__link> AQS 与 Java 锁的具体实现 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-4 type=checkbox id=nav-8-1-4> <label class=md-nav__link for=nav-8-1-4> Projects </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-4> Projects </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/projects/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-1-5 type=checkbox id=nav-8-1-5> <label class=md-nav__link for=nav-8-1-5> Spring </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-1-5> Spring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2018-09-01-Spring%20Security/ title="Spring Boot 与 Spring Security" class=md-nav__link> Spring Boot 与 Spring Security </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-03-29-Spring-init/ title="Spring 启动流程与简单源码分析" class=md-nav__link> Spring 启动流程与简单源码分析 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/code/spring/2019-04-06-Spring-MVC/ title="Spring MVC 简单源码分析" class=md-nav__link> Spring MVC 简单源码分析 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Config </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-2> Config </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-1 type=checkbox id=nav-8-2-1> <label class=md-nav__link for=nav-8-2-1> Git </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-1> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/git/2018-02-01-git/ title="Git 的简单使用" class=md-nav__link> Git 的简单使用 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/2019-08-10-git-merge/ title="Git 协作管理项目时不可避免的 merge 操作" class=md-nav__link> Git 协作管理项目时不可避免的 merge 操作 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/git/submodule/ title=submodule class=md-nav__link> submodule </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-2 type=checkbox id=nav-8-2-2> <label class=md-nav__link for=nav-8-2-2> Linux </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-2> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2019-12-18-manjaro/ title="Manjaro 个人新装配置" class=md-nav__link> Manjaro 个人新装配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/fontconfig/ title="Arch Emoji fontconfig" class=md-nav__link> Arch Emoji fontconfig </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/linux/softwares/ title=各种工具 class=md-nav__link> 各种工具 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Tools </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-3> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/tools/cz-conventional-changelog/ title=cz-conventional-changelog class=md-nav__link> cz-conventional-changelog </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-8-2-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-03-31-Generator-SpringBoot-Gradle/ title="MyBatis Generator + Spring Boot + Gradle 配置" class=md-nav__link> MyBatis Generator + Spring Boot + Gradle 配置 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-25-VS-Code-Python/ title="VS Code 写 Python" class=md-nav__link> VS Code 写 Python </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-06-26-linux-kawa/ title="在 Linux 上使用 kawa" class=md-nav__link> 在 Linux 上使用 kawa </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2018-11-25-mysql/ title="【转】在 CentOS 上部署 MySQL 解压版" class=md-nav__link> 【转】在 CentOS 上部署 MySQL 解压版 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-04-03-Redis-lock/ title="Redis 的分布式锁实现" class=md-nav__link> Redis 的分布式锁实现 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-07-28-picGo/ title="Github + picGo ——有图床了" class=md-nav__link> Github + picGo ——有图床了 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2019-11-18-linux-mount/ title="Linux 挂载分区/磁盘" class=md-nav__link> Linux 挂载分区/磁盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-03-terminal-wifi/ title=把显卡驱动删了后在终端连热点 class=md-nav__link> 把显卡驱动删了后在终端连热点 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-12-css/ title=一个引号引发的惨案 class=md-nav__link> 一个引号引发的惨案 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-02-23-archer-s-arch/ title="Archer`s Arch" class=md-nav__link> Archer`s Arch </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-electron-vue/ title="用 Vue 写 Electron 的一次问题解决" class=md-nav__link> 用 Vue 写 Electron 的一次问题解决 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-03-12-ttrss/ title="部署 TTRSS 遇到的一些有趣的东西" class=md-nav__link> 部署 TTRSS 遇到的一些有趣的东西 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/config/undefined/2020-04-02-hexo-asset-image/ title="hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了" class=md-nav__link> hexo-next-theme 开启 lazyload 使用 hexo-asset-image 出问题了 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Project </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-3> Project </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/project/2017-12-21-xiao-zong-jie/ title=做个小小的总结 class=md-nav__link> 做个小小的总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-05-07-big-data/ title="大数据 Demo （采集、处理、应用）复盘" class=md-nav__link> 大数据 Demo （采集、处理、应用）复盘 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-06-25-tencent-news-spider-py/ title=腾讯新闻爬虫 class=md-nav__link> 腾讯新闻爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2018-09-13-lite-terminal-home-page/ title=简单的仿终端主页 class=md-nav__link> 简单的仿终端主页 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-01-11-tank/ title=花里胡哨的坦克大战 class=md-nav__link> 花里胡哨的坦克大战 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-02-05-new-year/ title=大年初一（爬取豆瓣条目及吐槽） class=md-nav__link> 大年初一（爬取豆瓣条目及吐槽） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-04-03-blog-project/ title=写博客 class=md-nav__link> 写博客 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-06-17-nodejs/ title="MarkAll 导入豆瓣数据 —— NodeJS 写爬虫" class=md-nav__link> MarkAll 导入豆瓣数据 —— NodeJS 写爬虫 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-Autumn-Json/ title="Autumn-From-Spring 自定义 BeanDefinitionReader" class=md-nav__link> Autumn-From-Spring 自定义 BeanDefinitionReader </a> </li> <li class=md-nav__item> <a href=../../../../../tech/project/2019-11-15-bookmarkdown/ title="Chrome 插件——书签转 MarkDown" class=md-nav__link> Chrome 插件——书签转 MarkDown </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Undefined </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-8-4> Undefined </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-10-then-start/ title=那就开始吧 class=md-nav__link> 那就开始吧 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-08-16-Writing-is%20the-reward-of-writing-itself/ title=写就是写本身的报酬 class=md-nav__link> 写就是写本身的报酬 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-11-19-change-my-blog/ title=【过时内容】嘿，我转移博客啦！ class=md-nav__link> 【过时内容】嘿，我转移博客啦！ </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2017-12-08-yao-guai-ji-yu-you-ren-bo/ title=妖怪唧唧与友人波波 class=md-nav__link> 妖怪唧唧与友人波波 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-01-01-ubuntu/ title="折腾 ubuntu 与 win10 共存" class=md-nav__link> 折腾 ubuntu 与 win10 共存 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-02-09-pc-system/ title="黑苹果与 Ubuntu 及 PC 折腾系统" class=md-nav__link> 黑苹果与 Ubuntu 及 PC 折腾系统 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-12-install-Vmware-on-linux/ title="deepin 安装 VMware" class=md-nav__link> deepin 安装 VMware </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-03-31-SQL/ title="Spring Boot 开发遇到一些 SQL 问题" class=md-nav__link> Spring Boot 开发遇到一些 SQL 问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-jquery-confrim/ title="JQuery-Confrim 的一点问题" class=md-nav__link> JQuery-Confrim 的一点问题 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-06-some-plugins/ title="ECharts + PageHelper + Bootstrap Table" class=md-nav__link> ECharts + PageHelper + Bootstrap Table </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-js-in-thymeleaf/ title="Thymeleaf 里使用 JavaScript 时的注意事项" class=md-nav__link> Thymeleaf 里使用 JavaScript 时的注意事项 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-04-09-spring-boot-gradle-yml-log4j2/ title="Spring Boot + Gradle + yml 配置 log4j2" class=md-nav__link> Spring Boot + Gradle + yml 配置 log4j2 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-09-softwares/ title="Linux 常用软件" class=md-nav__link> Linux 常用软件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-hexo-image/ title="【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径）" class=md-nav__link> 【可能过时】Hexo 一点问题（生成博文插入本地图片,修改文章路径） </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-05-30-show/ title=如果给文章提供多种渲染方式 class=md-nav__link> 如果给文章提供多种渲染方式 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-08-30-vue-music/ title="简单的单页应用(Vue CLI2 的简单使用)" class=md-nav__link> 简单的单页应用(Vue CLI2 的简单使用) </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2018-09-23-word-count/ title="WordCount 项目总结" class=md-nav__link> WordCount 项目总结 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-06-markall-douban-backup/ title=豆瓣标记数据备份插件 class=md-nav__link> 豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-07-markall-douban-backup-yes/ title=【过时】又一个——豆瓣标记数据备份插件 class=md-nav__link> 【过时】又一个——豆瓣标记数据备份插件 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/2020-02-13-blog/ title=从分析本网站的网络请求谈起 class=md-nav__link> 从分析本网站的网络请求谈起 </a> </li> <li class=md-nav__item> <a href=../../../../../tech/undefined/draft/ title=Draft class=md-nav__link> Draft </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 基本语法 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 定义注解 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 元注解 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 编写注解处理器 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 注解元素 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 默认值限制 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 生成外部文件 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 替代方案 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 注解不支持继承 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 实现处理器 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#javac class=md-nav__link> 使用javac处理注解 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 最简单的处理器 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 更复杂的处理器 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 基于注解的单元测试 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unit class=md-nav__link> 在 @Unit 中使用泛型 </a> </li> <li class=md-nav__item> <a href=#unit_1 class=md-nav__link> 实现 @Unit </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 本章小结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/hqweay/my-mkdocs/edit/master/docs/book/OnJava8/docs/book/23-Annotations.md title=编辑此页 class="md-icon md-content__icon">&#xE3C9;</a> <div class=toc> <ul> <li><a href=#_1>第二十三章 注解</a><ul> <li><a href=#_2>基本语法</a><ul> <li><a href=#_3>定义注解</a></li> <li><a href=#_4>元注解</a></li> </ul> </li> <li><a href=#_5>编写注解处理器</a><ul> <li><a href=#_6>注解元素</a></li> <li><a href=#_7>默认值限制</a></li> <li><a href=#_8>生成外部文件</a></li> <li><a href=#_9>替代方案</a></li> <li><a href=#_10>注解不支持继承</a></li> <li><a href=#_11>实现处理器</a></li> </ul> </li> <li><a href=#javac>使用javac处理注解</a><ul> <li><a href=#_12>最简单的处理器</a></li> <li><a href=#_13>更复杂的处理器</a></li> </ul> </li> <li><a href=#_14>基于注解的单元测试</a><ul> <li><a href=#unit>在 @Unit 中使用泛型</a></li> <li><a href=#unit_1>实现 @Unit</a></li> </ul> </li> <li><a href=#_15>本章小结</a></li> </ul> </li> </ul> </div> <!-- Annotations --> <h1 id=_1>第二十三章 注解<a class=headerlink href=#_1 title="Permanent link">#</a></h1> <p>注解（也被称为元数据）为我们在代码中添加信息提供了一种形式化的方式，使我们可以在稍后的某个时刻更容易的使用这些数据。</p> <p>注解在一定程度上是把元数据和源代码文件结合在一起的趋势所激发的，而不是保存在外部文档。这同样是对像 C# 语言对于 Java 语言特性压力的一种回应。</p> <p>注解是 Java 5 所引入的众多语言变化之一。它们提供了 Java 无法表达的但是你需要完整表述程序所需的信息。因此，注解使得我们可以以编译器验证的格式存储程序的额外信息。注解可以生成描述符文件，甚至是新的类定义，并且有助于减轻编写“样板”代码的负担。通过使用注解，你可以将元数据保存在 Java 源代码中。并拥有如下优势：简单易读的代码，编译器类型检查，使用 annotation API 为自己的注解构造处理工具。即使 Java 定义了一些类型的元数据，但是一般来说注解类型的添加和如何使用完全取决于你。</p> <p>注解的语法十分简单，主要是在现有语法中添加 @ 符号。Java 5 引入了前三种定义在 <strong>java.lang</strong> 包中的注解：</p> <ul> <li><strong>@Override</strong>：表示当前的方法定义将覆盖基类的方法。如果你不小心拼写错误，或者方法签名被错误拼写的时候，编译器就会发出错误提示。</li> <li><strong>@Deprecated</strong>：如果使用该注解的元素被调用，编译器就会发出警告信息。</li> <li><strong>@SuppressWarnings</strong>：关闭不当的编译器警告信息。</li> <li><strong>@SafeVarargs</strong>：在 Java 7 中加入用于禁止对具有泛型varargs参数的方法或构造函数的调用方发出警告。</li> <li><strong>@FunctionalInterface</strong>：Java 8 中加入用于表示类型声明为函数式接口</li> </ul> <p>还有 5 种额外的注解类型用于创造新的注解。你将会在这一章学习它们。</p> <p>每当创建涉及重复工作的类或接口时，你通常可以使用注解来自动化和简化流程。例如在 Enterprise JavaBean（EJB）中的许多额外工作就是通过注解来消除的。</p> <p>注解的出现可以替代一些现有的系统，例如 XDoclet，它是一种独立的文档化工具，专门设计用来生成注解风格的文档。与之相比，注解是真正语言层级的概念，以前构造出来就享有编译器的类型检查保护。注解在源代码级别保存所有信息而不是通过注释文字，这使得代码更加整洁和便于维护。通过使用拓展的 annotation API 或稍后在本章节可以看到的外部的字节码工具类库，你会拥有对源代码及字节码强大的检查与操作能力。</p> <!-- Basic Syntax --> <h2 id=_2>基本语法<a class=headerlink href=#_2 title="Permanent link">#</a></h2> <!-- Writing Annotation Processors --> <p>在下面的例子中，使用 <code>@Test</code> 对 <code>testExecute()</code> 进行注解。该注解本身不做任何事情，但是编译器要保证其类路径上有 <code>@Test</code> 注解的定义。你将在本章看到，我们通过注解创建了一个工具用于运行这个方法：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/Testable.java</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Testable</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>execute</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Executing..&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>testExecute</span><span class=p>()</span> <span class=p>{</span> <span class=n>execute</span><span class=p>();</span> <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>被注解标注的方法和其他的方法没有任何区别。在这个例子中，注解 <code>@Test</code> 可以和任何修饰符共同用于方法，诸如 <strong>public</strong>、<strong>static</strong> 或 <strong>void</strong>。从语法的角度上看，注解的使用方式和修饰符的使用方式一致。</p> <h3 id=_3>定义注解<a class=headerlink href=#_3 title="Permanent link">#</a></h3> <p>如下是一个注解的定义。注解的定义看起来很像接口的定义。事实上，它们和其他 Java 接口一样，也会被编译成 class 文件。</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/Test.java</span>
<span class=c1>// The @Test tag</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>Test</span> <span class=p>{}</span>
</code></pre></div> <p>除了 @ 符号之外， <code>@Test</code> 的定义看起来更像一个空接口。注解的定义也需要一些元注解（meta-annoation），比如 <code>@Target</code> 和 <code>@Retention</code>。<code>@Target</code> 定义你的注解可以应用在哪里（例如是方法还是字段）。<code>@Retention</code> 定义了注解在哪里可用，在源代码中（SOURCE），class文件（CLASS）中或者是在运行时（RUNTIME）。</p> <p>注解通常会包含一些表示特定值的元素。当分析处理注解的时候，程序或工具可以利用这些值。注解的元素看起来就像接口的方法，但是可以为其指定默认值。</p> <p>不包含任何元素的注解称为标记注解（marker annotation），例如上例中的 <code>@Test</code> 就是标记注解。</p> <p>下面是一个简单的注解，我们可以用它来追踪项目中的用例。程序员可以使用该注解来标注满足特定用例的一个方法或者一组方法。于是，项目经理可以通过统计已经实现的用例来掌控项目的进展，而开发者在维护项目时可以轻松的找到用例用于更新，或者他们可以调试系统中业务逻辑。</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/UseCase.java</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>UseCase</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=nf>id</span><span class=p>();</span>
    <span class=n>String</span> <span class=nf>description</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;no description&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>注意 <strong>id</strong> 和 <strong>description</strong> 与方法定义类似。由于编译器会对 <strong>id</strong> 进行类型检查，因此将跟踪数据库与用例文档和源代码相关联是可靠的方式。<strong>description</strong> 元素拥有一个 <strong>default</strong> 值，如果在注解某个方法时没有给出 <strong>description</strong> 的值。则该注解的处理器会使用此元素的默认值。</p> <p>在下面的类中，有三个方法被注解为用例：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/PasswordUtils.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PasswordUtils</span> <span class=p>{</span>
    <span class=nd>@UseCase</span><span class=p>(</span><span class=n>id</span> <span class=o>=</span> <span class=mi>47</span><span class=p>,</span> <span class=n>description</span> <span class=o>=</span>
            <span class=s>&quot;Passwords must contain at least one numeric&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>validatePassword</span><span class=p>(</span><span class=n>String</span> <span class=n>passwd</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>passwd</span><span class=p>.</span><span class=na>matches</span><span class=p>(</span><span class=s>&quot;\\w*\\d\\w*&quot;</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=nd>@UseCase</span><span class=p>(</span><span class=n>id</span> <span class=o>=</span> <span class=mi>48</span><span class=p>)</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>encryptPassword</span><span class=p>(</span><span class=n>String</span> <span class=n>passwd</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=n>passwd</span><span class=p>)</span>
                <span class=p>.</span><span class=na>reverse</span><span class=p>().</span><span class=na>toString</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@UseCase</span><span class=p>(</span><span class=n>id</span> <span class=o>=</span> <span class=mi>49</span><span class=p>,</span> <span class=n>description</span> <span class=o>=</span>
            <span class=s>&quot;New passwords can&#39;t equal previously used ones&quot;</span><span class=p>)</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>checkForNewPassword</span><span class=p>(</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>prevPasswords</span><span class=p>,</span> <span class=n>String</span> <span class=n>passwd</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=o>!</span><span class=n>prevPasswords</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>passwd</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>注解的元素在使用时表现为 名-值 对的形式，并且需要放置在 <code>@UseCase</code> 声明之后的括号内。在 <code>encryptPassword()</code> 方法的注解中，并没有给出 <strong>description</strong> 的值，所以在 <strong>@interface UseCase</strong> 的注解处理器分析处理这个类的时候会使用该元素的默认值。</p> <p>你应该能够想象到如何使用这套工具来“勾勒”出将要建造的系统，然后在建造的过程中逐渐实现系统的各项功能。</p> <h3 id=_4>元注解<a class=headerlink href=#_4 title="Permanent link">#</a></h3> <p>Java 语言中目前有 5 种标准注解（前面介绍过），以及 5 种元注解。元注解用于注解其他的注解</p> <table> <thead> <tr> <th>注解</th> <th>解释</th> </tr> </thead> <tbody> <tr> <td>@Target</td> <td>表示注解可以用于哪些地方。可能的 <strong>ElementType</strong> 参数包括：<br><strong>CONSTRUCTOR</strong>：构造器的声明<br><strong>FIELD</strong>：字段声明（包括 enum 实例）<br><strong>LOCAL_VARIABLE</strong>：局部变量声明<br><strong>METHOD</strong>：方法声明<br><strong>PACKAGE</strong>：包声明<br><strong>PARAMETER</strong>：参数声明<br><strong>TYPE</strong>：类、接口（包括注解类型）或者 enum 声明</td> </tr> <tr> <td>@Retention</td> <td>表示注解信息保存的时长。可选的 <strong>RetentionPolicy</strong> 参数包括：<br><strong>SOURCE</strong>：注解将被编译器丢弃<br><strong>CLASS</strong>：注解在 class 文件中可用，但是会被 VM 丢弃。<br><strong>RUNTIME</strong>：VM 将在运行期也保留注解，因此可以通过反射机制读取注解的信息。</td> </tr> <tr> <td>@Documented</td> <td>将此注解保存在 Javadoc 中</td> </tr> <tr> <td>@Inherited</td> <td>允许子类继承父类的注解</td> </tr> <tr> <td>@Repeatable</td> <td>允许一个注解可以被使用一次或者多次（Java 8）。</td> </tr> </tbody> </table> <p>大多数时候，程序员定义自己的注解，并编写自己的处理器来处理他们。</p> <h2 id=_5>编写注解处理器<a class=headerlink href=#_5 title="Permanent link">#</a></h2> <p>如果没有用于读取注解的工具，那么注解不会比注释更有用。使用注解中一个很重要的部分就是，创建与使用注解处理器。Java 拓展了反射机制的 API 用于帮助你创造这类工具。同时他还提供了 javac 编译器钩子在编译时使用注解。</p> <p>下面是一个非常简单的注解处理器，我们用它来读取被注解的 <strong>PasswordUtils</strong> 类，并且使用反射机制来寻找 <strong>@UseCase</strong> 标记。给定一组 <strong>id</strong> 值，然后列出在 <strong>PasswordUtils</strong> 中找到的用例，以及缺失的用例。</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/UseCaseTracker.java</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UseCaseTracker</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>trackUseCases</span><span class=p>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>useCases</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>cl</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>cl</span><span class=p>.</span><span class=na>getDeclaredMethods</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>UseCase</span> <span class=n>uc</span> <span class=o>=</span> <span class=n>m</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>UseCase</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>uc</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Found Use Case &quot;</span> <span class=o>+</span>
                        <span class=n>uc</span><span class=p>.</span><span class=na>id</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;\n &quot;</span> <span class=o>+</span> <span class=n>uc</span><span class=p>.</span><span class=na>description</span><span class=p>());</span>
                <span class=n>useCases</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>Integer</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>uc</span><span class=p>.</span><span class=na>id</span><span class=p>()));</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=n>useCases</span><span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>i</span> <span class=o>-&gt;</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Missing use case &quot;</span> <span class=o>+</span> <span class=n>i</span><span class=p>));</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>useCases</span> <span class=o>=</span> <span class=n>IntStream</span><span class=p>.</span><span class=na>range</span><span class=p>(</span><span class=mi>47</span><span class=p>,</span> <span class=mi>51</span><span class=p>)</span>
                <span class=p>.</span><span class=na>boxed</span><span class=p>().</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>toList</span><span class=p>());</span>
        <span class=n>trackUseCases</span><span class=p>(</span><span class=n>useCases</span><span class=p>,</span> <span class=n>PasswordUtils</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>Found</span> <span class=n>Use</span> <span class=n>Case</span> <span class=mi>48</span>
<span class=n>no</span> <span class=n>description</span>
<span class=n>Found</span> <span class=n>Use</span> <span class=n>Case</span> <span class=mi>47</span>
<span class=n>Passwords</span> <span class=n>must</span> <span class=n>contain</span> <span class=n>at</span> <span class=n>least</span> <span class=n>one</span> <span class=n>numeric</span>
<span class=n>Found</span> <span class=n>Use</span> <span class=n>Case</span> <span class=mi>49</span>
<span class=n>New</span> <span class=n>passwords</span> <span class=n>can</span><span class=err>&#39;</span><span class=n>t</span> <span class=n>equal</span> <span class=n>previously</span> <span class=n>used</span> <span class=n>ones</span>
<span class=n>Missing</span> <span class=n>use</span> <span class=k>case</span> <span class=mi>50</span>
</code></pre></div> <p>这个程序用了两个反射的方法：<code>getDeclaredMethods()</code> 和 <code>getAnnotation()</code>，它们都属于 <strong>AnnotatedElement</strong> 接口（<strong>Class</strong>，<strong>Method</strong> 与 <strong>Field</strong> 类都实现了该接口）。<code>getAnnotation()</code> 方法返回指定类型的注解对象，在本例中就是 “<strong>UseCase</strong>”。如果被注解的方法上没有该类型的注解，返回值就为 <strong>null</strong>。我们通过调用 <code>id()</code> 和 <code>description()</code> 方法来提取元素值。注意 <code>encryptPassword()</code> 方法在注解的时候没有指定 <strong>description</strong> 的值，因此处理器在处理它对应的注解时，通过 <code>description()</code> 取得的是默认值 “no description”。</p> <h3 id=_6>注解元素<a class=headerlink href=#_6 title="Permanent link">#</a></h3> <p>在 <strong>UseCase.java</strong> 中定义的 <strong>@UseCase</strong> 的标签包含 int 元素 <strong>id</strong> 和 String 元素 <strong>description</strong>。注解元素可用的类型如下所示：</p> <ul> <li>所有基本类型（int、float、boolean等）</li> <li>String</li> <li>Class</li> <li>enum</li> <li>Annotation</li> <li>以上类型的数组</li> </ul> <p>如果你使用了其他类型，编译器就会报错。注意，也不允许使用任何包装类型，但是由于自动装箱的存在，这不算是什么限制。注解也可以作为元素的类型。稍后你会看到，注解嵌套是一个非常有用的技巧。</p> <h3 id=_7>默认值限制<a class=headerlink href=#_7 title="Permanent link">#</a></h3> <p>编译器对于元素的默认值有些过于挑剔。首先，元素不能有不确定的值。也就是说，元素要么有默认值，要么就在使用注解时提供元素的值。</p> <p>这里有另外一个限制：任何非基本类型的元素， 无论是在源代码声明时还是在注解接口中定义默认值时，都不能使用 null 作为其值。这个限制使得处理器很难表现一个元素的存在或者缺失的状态，因为在每个注解的声明中，所有的元素都存在，并且具有相应的值。为了绕开这个约束，可以自定义一些特殊的值，比如空字符串或者负数用于表达某个元素不存在。</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/SimulatingNull.java</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>SimulatingNull</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=nf>id</span><span class=p>()</span> <span class=k>default</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
    <span class=n>String</span> <span class=nf>description</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>这是一个在定义注解的习惯用法。</p> <h3 id=_8>生成外部文件<a class=headerlink href=#_8 title="Permanent link">#</a></h3> <p>当有些框架需要一些额外的信息才能与你的源代码协同工作，这种情况下注解就会变得十分有用。像 Enterprise JavaBeans (EJB3 之前)这样的技术，每一个 Bean 都需要需要大量的接口和部署描述文件，而这些就是“样板”文件。Web Service，自定义标签库以及对象/关系映射工具（例如 Toplink 和 Hibernate）通常都需要 XML 描述文件，而这些文件脱离于代码之外。除了定义 Java 类，程序员还必须忍受沉闷，重复的提供某些信息，例如类名和包名等已经在原始类中已经提供的信息。每当你使用外部描述文件时，他就拥有了一个类的两个独立信息源，这经常导致代码的同步问题。同时这也要求了为项目工作的程序员在知道如何编写 Java 程序的同时，也必须知道如何编辑描述文件。</p> <p>假设你想提供一些基本的对象/关系映射功能，能够自动生成数据库表。你可以使用 XML 描述文件来指明类的名字、每个成员以及数据库映射的相关信息。但是，通过使用注解，你可以把所有信息都保存在 <strong>JavaBean</strong> 源文件中。为此你需要一些用于定义数据库表名称、数据库列以及将 SQL 类型映射到属性的注解。</p> <p>以下是一个注解的定义，它告诉注解处理器应该创建一个数据库表：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/DBTable.java</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>)</span> <span class=c1>// Applies to classes only</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>DBTable</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>name</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>在 <code>@Target</code> 注解中指定的每一个 <strong>ElementType</strong> 就是一个约束，它告诉编译器，这个自定义的注解只能用于指定的类型。你可以指定 <strong>enum ElementType</strong> 中的一个值，或者以逗号分割的形式指定多个值。如果想要将注解应用于所有的 <strong>ElementType</strong>，那么可以省去 <code>@Target</code> 注解，但是这并不常见。</p> <p>注意 <strong>@DBTable</strong> 中有一个 <code>name()</code> 元素，该注解通过这个元素为处理器创建数据库时提供表的名字。</p> <p>如下是修饰字段的注解：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/Constraints.java</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>Constraints</span> <span class=p>{</span>
    <span class=kt>boolean</span> <span class=nf>primaryKey</span><span class=p>()</span> <span class=k>default</span> <span class=kc>false</span><span class=p>;</span>
    <span class=kt>boolean</span> <span class=nf>allowNull</span><span class=p>()</span> <span class=k>default</span> <span class=kc>true</span><span class=p>;</span>
    <span class=kt>boolean</span> <span class=nf>unique</span><span class=p>()</span> <span class=k>default</span> <span class=kc>false</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/SQLString.java</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>SQLString</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=nf>value</span><span class=p>()</span> <span class=k>default</span> <span class=mi>0</span><span class=p>;</span>
    <span class=n>String</span> <span class=nf>name</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
    <span class=n>Constraints</span> <span class=nf>constraints</span><span class=p>()</span> <span class=k>default</span> <span class=nd>@Constraints</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/SQLInteger.java</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>SQLInteger</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>name</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
    <span class=n>Constraints</span> <span class=nf>constraints</span><span class=p>()</span> <span class=k>default</span> <span class=nd>@Constraints</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p><strong>@Constraints</strong> 注解允许处理器提供数据库表的元数据。<strong>@Constraints</strong> 代表了数据库通常提供的约束的一小部分，但是它所要表达的思想已经很清楚了。<code>primaryKey()</code>，<code>allowNull()</code> 和 <code>unique()</code> 元素明显的提供了默认值，从而使得在大多数情况下，该注解的使用者不需要输入太多东西。</p> <p>另外两个 <strong>@interface</strong> 定义的是 SQL 类型。如果希望这个框架更有价值的话，我们应该为每个 SQL 类型都定义相应的注解。不过为为示例，两个元素足够了。</p> <p>这些 SQL 类型具有 <code>name()</code> 元素和 <code>constraints()</code> 元素。后者利用了嵌套注解的功能，将数据库列的类型约束信息嵌入其中。注意 <code>constraints()</code> 元素的默认值是 <strong>@Constraints</strong>。由于在 <strong>@Constraints</strong> 注解类型之后，没有在括号中指明 <strong>@Constraints</strong> 元素的值，因此，<strong>constraints()</strong> 的默认值为所有元素都为默认值的 <strong>@Constraints</strong> 注解。如果要使得嵌入的 <strong>@Constraints</strong> 注解中的 <code>unique()</code> 元素为 true，并作为 <code>constraints()</code> 元素的默认值，你可以像如下定义：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/Uniqueness.java</span>
<span class=c1>// Sample of nested annotations</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>Uniqueness</span> <span class=p>{</span>
    <span class=n>Constraints</span> <span class=nf>constraints</span><span class=p>()</span>
            <span class=k>default</span> <span class=nd>@Constraints</span><span class=p>(</span><span class=n>unique</span> <span class=o>=</span> <span class=kc>true</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>下面是一个简单的，使用了如上注解的类：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/Member.java</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>
<span class=nd>@DBTable</span><span class=p>(</span><span class=n>name</span> <span class=o>=</span> <span class=s>&quot;MEMBER&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Member</span> <span class=p>{</span>
    <span class=nd>@SQLString</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span> <span class=n>String</span> <span class=n>firstName</span><span class=p>;</span>
    <span class=nd>@SQLString</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span> <span class=n>String</span> <span class=n>lastName</span><span class=p>;</span>
    <span class=nd>@SQLInteger</span> <span class=n>Integer</span> <span class=n>age</span><span class=p>;</span>
    <span class=nd>@SQLString</span><span class=p>(</span><span class=n>value</span> <span class=o>=</span> <span class=mi>30</span><span class=p>,</span>
            <span class=n>constraints</span> <span class=o>=</span> <span class=nd>@Constraints</span><span class=p>(</span><span class=n>primaryKey</span> <span class=o>=</span> <span class=kc>true</span><span class=p>))</span>
    <span class=n>String</span> <span class=n>reference</span><span class=p>;</span>
    <span class=kd>static</span> <span class=kt>int</span> <span class=n>memberCount</span><span class=p>;</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getReference</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>reference</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getFirstName</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>firstName</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getLastName</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>lastName</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>reference</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>Integer</span> <span class=nf>getAge</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>age</span><span class=p>;</span> <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>类注解 <strong>@DBTable</strong> 注解给定了元素值 MEMBER，它将会作为标的名字。类的属性 <strong>firstName</strong> 和 <strong>lastName</strong> 都被注解为 <strong>@SQLString</strong> 类型并且给了默认元素值分别为 30 和 50。这些注解都有两个有趣的地方：首先，他们都使用了嵌入的 <strong>@Constraints</strong> 注解的默认值；其次，它们都是用了快捷方式特性。如果你在注解中定义了名为 <strong>value</strong> 的元素，并且在使用该注解时，<strong>value</strong> 为唯一一个需要赋值的元素，你就不需要使用名—值对的语法，你只需要在括号中给出 <strong>value</strong> 元素的值即可。这可以应用于任何合法类型的元素。这也限制了你必须将元素命名为 <strong>value</strong>，不过在上面的例子中，这样的注解语句也更易于理解：</p> <div class=highlight><pre><span></span><code><span class=nd>@SQLString</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</code></pre></div> <p>处理器将在创建表的时候使用该值设置 SQL 列的大小。</p> <p>默认值的语法虽然很灵巧，但是它很快就变的复杂起来。以 <strong>reference</strong> 字段的注解为例，上面拥有 <strong>@SQLString</strong> 注解，但是这个字段也将成为表的主键，因此在嵌入的 <strong>@Constraint</strong> 注解中设定 <strong>primaryKey</strong> 元素的值。这时事情就变的复杂了。你不得不为这个嵌入的注解使用很长的键—值对的形式，来指定元素名称和 <strong>@interface</strong> 的名称。同时，由于有特殊命名的 <strong>value</strong> 也不是唯一需要赋值的元素，因此不能再使用快捷方式特性。如你所见，最终结果不算清晰易懂。</p> <h3 id=_9>替代方案<a class=headerlink href=#_9 title="Permanent link">#</a></h3> <p>可以使用多种不同的方式来定义自己的注解用于上述任务。例如，你可以使用一个单一的注解类 <strong>@TableColumn</strong>，它拥有一个 <strong>enum</strong> 元素，元素值定义了 <strong>STRING</strong>，<strong>INTEGER</strong>，<strong>FLOAT</strong> 等类型。这消除了每个 SQL 类型都需要定义一个 <strong>@interface</strong> 的负担，不过也使得用额外信息修饰 SQL 类型变的不可能，这些额外的信息例如长度或精度等，都可能是非常有用的。</p> <p>你也可以使用一个 <strong>String</strong> 类型的元素来描述实际的 SQL 类型，比如 “VARCHAR(30)” 或者 “INTEGER”。这使得你可以修饰 SQL 类型，但是这也将 Java 类型到 SQL 类型的映射绑在了一起，这不是一个好的设计。你并不想在数据库更改之后重新编译你的代码；如果我们只需要告诉注解处理器，我们正在使用的是什么“口味（favor）”的 SQL，然后注解助力器来为我们处理 SQL 类型的细节，那将是一个优雅的设计。</p> <p>第三种可行的方案是一起使用两个注解，<strong>@Constraints</strong> 和相应的 SQL 类型（例如，<strong>@SQLInteger</strong>）去注解同一个字段。这可能会让代码有些混乱，但是编译器允许你对同一个目标使用多个注解。在 Java 8，在使用多个注解的时候，你可以重复使用同一个注解。</p> <h3 id=_10>注解不支持继承<a class=headerlink href=#_10 title="Permanent link">#</a></h3> <p>你不能使用 <strong>extends</strong> 关键字来继承 <strong>@interfaces</strong>。这真是一个遗憾，如果可以定义 <strong>@TableColumn</strong> 注解（参考前面的建议），同时嵌套一个 <strong>@SQLType</strong> 类型的注解，将成为一个优雅的设计。按照这种方式，你可以通过继承 <strong>@SQLType</strong> 来创造各种 SQL 类型。例如 <strong>@SQLInteger</strong> 和 <strong>@SQLString</strong>。如果支持继承，就会大大减少打字的工作量并且使得语法更整洁。在 Java 的未来版本中，似乎没有任何关于让注解支持继承的提案，所以在当前情况下，上例中的解决方案可能已经是最佳方案了。</p> <h3 id=_11>实现处理器<a class=headerlink href=#_11 title="Permanent link">#</a></h3> <p>下面是一个注解处理器的例子，他将读取一个类文件，检查上面的数据库注解，并生成用于创建数据库的 SQL 命令：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/database/TableCreator.java</span>
<span class=c1>// Reflection-based annotation processor</span>
<span class=c1>// {java annotations.database.TableCreator</span>
<span class=c1>// annotations.database.Member}</span>
<span class=kn>package</span> <span class=nn>annotations.database</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.lang.annotation.Annotation</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.Field</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.ArrayList</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.List</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>TableCreator</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=na>length</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=s>&quot;arguments: annotated classes&quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>className</span> <span class=p>:</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>cl</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>className</span><span class=p>);</span>
            <span class=n>DBTable</span> <span class=n>dbTable</span> <span class=o>=</span> <span class=n>cl</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>DBTable</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>dbTable</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                        <span class=s>&quot;No DBTable annotations in class &quot;</span> <span class=o>+</span>
                                <span class=n>className</span><span class=p>);</span>
                <span class=k>continue</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=n>String</span> <span class=n>tableName</span> <span class=o>=</span> <span class=n>dbTable</span><span class=p>.</span><span class=na>name</span><span class=p>();</span>
            <span class=c1>// If the name is empty, use the Class name:</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>tableName</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
                <span class=n>tableName</span> <span class=o>=</span> <span class=n>cl</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>toUpperCase</span><span class=p>();</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>columnDefs</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>Field</span> <span class=n>field</span> <span class=p>:</span> <span class=n>cl</span><span class=p>.</span><span class=na>getDeclaredFields</span><span class=p>())</span> <span class=p>{</span>
                <span class=n>String</span> <span class=n>columnName</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
                <span class=n>Annotation</span><span class=o>[]</span> <span class=n>anns</span> <span class=o>=</span>
                        <span class=n>field</span><span class=p>.</span><span class=na>getDeclaredAnnotations</span><span class=p>();</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>anns</span><span class=p>.</span><span class=na>length</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
                    <span class=k>continue</span><span class=p>;</span> <span class=c1>// Not a db table column</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>anns</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=k>instanceof</span> <span class=n>SQLInteger</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>SQLInteger</span> <span class=n>sInt</span> <span class=o>=</span> <span class=p>(</span><span class=n>SQLInteger</span><span class=p>)</span> <span class=n>anns</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>;</span>
                    <span class=c1>// Use field name if name not specified</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>sInt</span><span class=p>.</span><span class=na>name</span><span class=p>().</span><span class=na>length</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
                        <span class=n>columnName</span> <span class=o>=</span> <span class=n>field</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>toUpperCase</span><span class=p>();</span>
                    <span class=k>else</span>
                        <span class=n>columnName</span> <span class=o>=</span> <span class=n>sInt</span><span class=p>.</span><span class=na>name</span><span class=p>();</span>
                    <span class=n>columnDefs</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>columnName</span> <span class=o>+</span> <span class=s>&quot; INT&quot;</span> <span class=o>+</span>
                            <span class=n>getConstraints</span><span class=p>(</span><span class=n>sInt</span><span class=p>.</span><span class=na>constraints</span><span class=p>()));</span>
                <span class=p>}</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>anns</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=k>instanceof</span> <span class=n>SQLString</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>SQLString</span> <span class=n>sString</span> <span class=o>=</span> <span class=p>(</span><span class=n>SQLString</span><span class=p>)</span> <span class=n>anns</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>;</span>
                    <span class=c1>// Use field name if name not specified.</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>sString</span><span class=p>.</span><span class=na>name</span><span class=p>().</span><span class=na>length</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
                        <span class=n>columnName</span> <span class=o>=</span> <span class=n>field</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>toUpperCase</span><span class=p>();</span>
                    <span class=k>else</span>
                        <span class=n>columnName</span> <span class=o>=</span> <span class=n>sString</span><span class=p>.</span><span class=na>name</span><span class=p>();</span>
                    <span class=n>columnDefs</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>columnName</span> <span class=o>+</span> <span class=s>&quot; VARCHAR(&quot;</span> <span class=o>+</span>
                            <span class=n>sString</span><span class=p>.</span><span class=na>value</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span> <span class=o>+</span>
                            <span class=n>getConstraints</span><span class=p>(</span><span class=n>sString</span><span class=p>.</span><span class=na>constraints</span><span class=p>()));</span>
                <span class=p>}</span>
                <span class=n>StringBuilder</span> <span class=n>createCommand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span>
                        <span class=s>&quot;CREATE TABLE &quot;</span> <span class=o>+</span> <span class=n>tableName</span> <span class=o>+</span> <span class=s>&quot;(&quot;</span><span class=p>);</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>columnDef</span> <span class=p>:</span> <span class=n>columnDefs</span><span class=p>)</span>
                    <span class=n>createCommand</span><span class=p>.</span><span class=na>append</span><span class=p>(</span>
                            <span class=s>&quot;\n &quot;</span> <span class=o>+</span> <span class=n>columnDef</span> <span class=o>+</span> <span class=s>&quot;,&quot;</span><span class=p>);</span>
                <span class=c1>// Remove trailing comma</span>
                <span class=n>String</span> <span class=n>tableCreate</span> <span class=o>=</span> <span class=n>createCommand</span><span class=p>.</span><span class=na>substring</span><span class=p>(</span>
                        <span class=mi>0</span><span class=p>,</span> <span class=n>createCommand</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot;);&quot;</span><span class=p>;</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Table Creation SQL for &quot;</span> <span class=o>+</span>
                        <span class=n>className</span> <span class=o>+</span> <span class=s>&quot; is:\n&quot;</span> <span class=o>+</span> <span class=n>tableCreate</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=kd>private</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>getConstraints</span><span class=p>(</span><span class=n>Constraints</span> <span class=n>con</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>constraints</span> <span class=o>=</span> <span class=s>&quot;&quot;</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>con</span><span class=p>.</span><span class=na>allowNull</span><span class=p>())</span>
            <span class=n>constraints</span> <span class=o>+=</span> <span class=s>&quot; NOT NULL&quot;</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>con</span><span class=p>.</span><span class=na>primaryKey</span><span class=p>())</span>
            <span class=n>constraints</span> <span class=o>+=</span> <span class=s>&quot; PRIMARY KEY&quot;</span><span class=p>;</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>con</span><span class=p>.</span><span class=na>unique</span><span class=p>())</span>
            <span class=n>constraints</span> <span class=o>+=</span> <span class=s>&quot; UNIQUE&quot;</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>constraints</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=k>Table</span> <span class=n>Creation</span> <span class=k>SQL</span> <span class=k>for</span> <span class=n>annotations</span><span class=p>.</span><span class=k>database</span><span class=p>.</span><span class=n>Member</span> <span class=k>is</span><span class=p>:</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>MEMBER</span><span class=p>(</span>
    <span class=n>FIRSTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>));</span>
<span class=k>Table</span> <span class=n>Creation</span> <span class=k>SQL</span> <span class=k>for</span> <span class=n>annotations</span><span class=p>.</span><span class=k>database</span><span class=p>.</span><span class=n>Member</span> <span class=k>is</span><span class=p>:</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>MEMBER</span><span class=p>(</span>
    <span class=n>FIRSTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span>
    <span class=n>LASTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>));</span>
<span class=k>Table</span> <span class=n>Creation</span> <span class=k>SQL</span> <span class=k>for</span> <span class=n>annotations</span><span class=p>.</span><span class=k>database</span><span class=p>.</span><span class=n>Member</span> <span class=k>is</span><span class=p>:</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>MEMBER</span><span class=p>(</span>
    <span class=n>FIRSTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span>
    <span class=n>LASTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span>
    <span class=n>AGE</span> <span class=nb>INT</span><span class=p>);</span>
<span class=k>Table</span> <span class=n>Creation</span> <span class=k>SQL</span> <span class=k>for</span> <span class=n>annotations</span><span class=p>.</span><span class=k>database</span><span class=p>.</span><span class=n>Member</span> <span class=k>is</span><span class=p>:</span>
<span class=k>CREATE</span> <span class=k>TABLE</span> <span class=n>MEMBER</span><span class=p>(</span>
    <span class=n>FIRSTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>),</span>
    <span class=n>LASTNAME</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span>
    <span class=n>AGE</span> <span class=nb>INT</span><span class=p>,</span>
    <span class=n>REFERENCE</span> <span class=nb>VARCHAR</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span> <span class=k>PRIMARY</span> <span class=k>KEY</span><span class=p>);</span>
</code></pre></div> <p>主方法会循环处理命令行传入的每一个类名。每一个类都是用 <code>forName()</code> 方法进行加载，并使用 <code>getAnnotation(DBTable.class)</code> 来检查该类是否带有 <strong>@DBTable</strong> 注解。如果存在，将表名存储起来。然后读取这个类的所有字段，并使用 <code>getDeclaredAnnotations()</code> 进行检查。这个方法返回一个包含特定字段上所有注解的数组。然后使用 <strong>instanceof</strong> 操作符判断这些注解是否是 <strong>@SQLInteger</strong> 或者 <strong>@SQLString</strong> 类型。如果是的话，在对应的处理块中将构造出相应的数据库列的字符串片段。注意，由于注解没有继承机制，如果要获取近似多态的行为，使用 <code>getDeclaredAnnotations()</code> 似乎是唯一的方式。</p> <p>嵌套的 <strong>@Constraint</strong> 注解被传递给 <code>getConstraints()</code>方法，并用它来构造一个包含 SQL 约束的 String 对象。</p> <p>需要提醒的是，上面演示的技巧对于真实的对象/映射关系而言，是十分幼稚的。使用 <strong>@DBTable</strong> 的注解来获取表的名称，这使得如果要修改表的名字，则迫使你重新编译 Java 代码。这种效果并不理想。现在已经有了很多可用的框架，用于将对象映射到数据库中，并且越来越多的框架开始使用注解了。</p> <!-- Using javac to Process Annotations --> <h2 id=javac>使用javac处理注解<a class=headerlink href=#javac title="Permanent link">#</a></h2> <p>通过 <strong>javac</strong>，你可以通过创建编译时（compile-time）注解处理器在 Java 源文件上使用注解，而不是编译之后的 class 文件。但是这里有一个重大限制：你不能通过处理器来改变源代码。唯一影响输出的方式就是创建新的文件。</p> <p>如果你的注解处理器创建了新的源文件，在新一轮处理中注解会检查源文件本身。工具在检测一轮之后持续循环，直到不再有新的源文件产生。然后它编译所有的源文件。</p> <p>每一个你编写的注解都需要处理器，但是 <strong>javac</strong> 可以非常容易的将多个注解处理器合并在一起。你可以指定多个需要处理的类，并且你可以添加监听器用于监听注解处理完成后接到通知。</p> <p>本节中的示例将帮助你开始学习，但如果你必须深入学习，请做好反复学习，大量访问 Google 和StackOverflow 的准备。</p> <h3 id=_12>最简单的处理器<a class=headerlink href=#_12 title="Permanent link">#</a></h3> <p>让我们开始定义我们能想到的最简单的处理器，只是为了编译和测试。如下是注解的定义：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/simplest/Simple.java</span>
<span class=c1>// A bare-bones annotation</span>
<span class=kn>package</span> <span class=nn>annotations.simplest</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.Retention</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.RetentionPolicy</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.Target</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.ElementType</span><span class=p>;</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>SOURCE</span><span class=p>)</span>
<span class=nd>@Target</span><span class=p>({</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>,</span> <span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>,</span>
        <span class=n>ElementType</span><span class=p>.</span><span class=na>CONSTRUCTOR</span><span class=p>,</span>
        <span class=n>ElementType</span><span class=p>.</span><span class=na>ANNOTATION_TYPE</span><span class=p>,</span>
        <span class=n>ElementType</span><span class=p>.</span><span class=na>PACKAGE</span><span class=p>,</span> <span class=n>ElementType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>,</span>
        <span class=n>ElementType</span><span class=p>.</span><span class=na>LOCAL_VARIABLE</span><span class=p>})</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>Simple</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>value</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;-default-&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p><strong>@Retention</strong> 的参数现在为 <strong>SOURCE</strong>，这意味着注解不会再存留在编译后的代码。这在编译时处理注解是没有必要的，它只是指出，在这里，<strong>javac</strong> 是唯一有机会处理注解的代理。</p> <p><strong>@Target</strong> 声明了几乎所有的目标类型（除了 <strong>PACKAGE</strong>） ，同样是为了演示。下面是一个测试示例。</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/simplest/SimpleTest.java</span>
<span class=c1>// Test the &quot;Simple&quot; annotation</span>
<span class=c1>// {java annotations.simplest.SimpleTest}</span>
<span class=kn>package</span> <span class=nn>annotations.simplest</span><span class=p>;</span>
<span class=nd>@Simple</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SimpleTest</span> <span class=p>{</span>
    <span class=nd>@Simple</span>
    <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
    <span class=nd>@Simple</span>
    <span class=kd>public</span> <span class=nf>SimpleTest</span><span class=p>()</span> <span class=p>{}</span>
    <span class=nd>@Simple</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>foo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;SimpleTest.foo()&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Simple</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>bar</span><span class=p>(</span><span class=n>String</span> <span class=n>s</span><span class=p>,</span> <span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>float</span> <span class=n>f</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;SimpleTest.bar()&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Simple</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=nd>@Simple</span>
        <span class=n>SimpleTest</span> <span class=n>st</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SimpleTest</span><span class=p>();</span>
        <span class=n>st</span><span class=p>.</span><span class=na>foo</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>SimpleTest</span><span class=p>.</span><span class=na>foo</span><span class=p>()</span>
</code></pre></div> <p>在这里我们使用 <strong>@Simple</strong> 注解了所有 <strong>@Target</strong> 声明允许的地方。</p> <p><strong>SimpleTest.java</strong> 只需要 <strong>Simple.java</strong> 就可以编译成功。当我们编译的时候什么都没有发生。</p> <p><strong>javac</strong> 允许 <strong>@Simple</strong> 注解（只要它存在）在我们创建处理器并将其 hook 到编译器之前，不做任何事情。</p> <p>如下是一个十分简单的处理器，其所作的事情就是把注解相关的信息打印出来：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/simplest/SimpleProcessor.java</span>
<span class=c1>// A bare-bones annotation processor</span>
<span class=kn>package</span> <span class=nn>annotations.simplest</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.annotation.processing.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.lang.model.SourceVersion</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.lang.model.element.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=nd>@SupportedAnnotationTypes</span><span class=p>(</span>
        <span class=s>&quot;annotations.simplest.Simple&quot;</span><span class=p>)</span>
<span class=nd>@SupportedSourceVersion</span><span class=p>(</span><span class=n>SourceVersion</span><span class=p>.</span><span class=na>RELEASE_8</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SimpleProcessor</span>
        <span class=kd>extends</span> <span class=n>AbstractProcessor</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>process</span><span class=p>(</span>
            <span class=n>Set</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>TypeElement</span><span class=o>&gt;</span> <span class=n>annotations</span><span class=p>,</span>
            <span class=n>RoundEnvironment</span> <span class=n>env</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>TypeElement</span> <span class=n>t</span> <span class=p>:</span> <span class=n>annotations</span><span class=p>)</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Element</span> <span class=n>el</span> <span class=p>:</span>
                <span class=n>env</span><span class=p>.</span><span class=na>getElementsAnnotatedWith</span><span class=p>(</span><span class=n>Simple</span><span class=p>.</span><span class=na>class</span><span class=p>))</span>
            <span class=n>display</span><span class=p>(</span><span class=n>el</span><span class=p>);</span>
        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>display</span><span class=p>(</span><span class=n>Element</span> <span class=n>el</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;==== &quot;</span> <span class=o>+</span> <span class=n>el</span> <span class=o>+</span> <span class=s>&quot; ====&quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>el</span><span class=p>.</span><span class=na>getKind</span><span class=p>()</span> <span class=o>+</span>
                <span class=s>&quot; : &quot;</span> <span class=o>+</span> <span class=n>el</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()</span> <span class=o>+</span>
                <span class=s>&quot; : &quot;</span> <span class=o>+</span> <span class=n>el</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>()</span> <span class=o>+</span>
                <span class=s>&quot; : &quot;</span> <span class=o>+</span> <span class=n>el</span><span class=p>.</span><span class=na>asType</span><span class=p>());</span>
        <span class=k>if</span><span class=p>(</span><span class=n>el</span><span class=p>.</span><span class=na>getKind</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>ElementKind</span><span class=p>.</span><span class=na>CLASS</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>TypeElement</span> <span class=n>te</span> <span class=o>=</span> <span class=p>(</span><span class=n>TypeElement</span><span class=p>)</span><span class=n>el</span><span class=p>;</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>te</span><span class=p>.</span><span class=na>getQualifiedName</span><span class=p>());</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>te</span><span class=p>.</span><span class=na>getSuperclass</span><span class=p>());</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>te</span><span class=p>.</span><span class=na>getEnclosedElements</span><span class=p>());</span>
        <span class=p>}</span>
        <span class=k>if</span><span class=p>(</span><span class=n>el</span><span class=p>.</span><span class=na>getKind</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>ElementKind</span><span class=p>.</span><span class=na>METHOD</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>ExecutableElement</span> <span class=n>ex</span> <span class=o>=</span> <span class=p>(</span><span class=n>ExecutableElement</span><span class=p>)</span><span class=n>el</span><span class=p>;</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;(&quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>ex</span><span class=p>.</span><span class=na>getParameters</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>（旧的，失效的）<strong>apt</strong> 版本的处理器需要额外的方法来确定支持哪些注解以及支持的 Java 版本。不过，你现在可以简单的使用 <strong>@SupportedAnnotationTypes</strong> 和 <strong>@SupportedSourceVersion</strong> 注解（这是一个很好的示例关于注解如何简化你的代码）。</p> <p>你唯一需要实现的方法就是 <code>process()</code>，这里是所有行为发生的地方。第一个参数告诉你哪个注解是存在的，第二个参数保留了剩余信息。我们所做的事情只是打印了注解（这里只存在一个），可以看 <strong>TypeElement</strong> 文档中的其他行为。通过使用 <code>process()</code> 的第二个操作，我们循环所有被 <strong>@Simple</strong> 注解的元素，并且针对每一个元素调用我们的 <code>display()</code> 方法。所有 <strong>Element</strong> 展示了本身的基本信息；例如，<code>getModifiers()</code> 告诉你它是否为 <strong>public</strong> 和 <strong>static</strong> 的。</p> <p><strong>Element</strong> 只能执行那些编译器解析的所有基本对象共有的操作，而类和方法之类的东西有额外的信息需要提取。所以（如果你阅读了正确的文档，但是我没有在任何文档中找到——我不得不通过 StackOverflow 寻找线索）你检查它是哪种 <strong>ElementKind</strong>，然后将其向下转换为更具体的元素类型，注入针对 CLASS 的 TypeElement 和 针对 METHOD 的ExecutableElement。此时，可以为这些元素调用其他方法。</p> <p>动态向下转型（在编译期不进行检查）并不像是 Java 的做事方式，这非常不直观这也是为什么我从未想过要这样做事。相反，我花了好几天的时间，试图发现你应该如何访问这些信息，而这些信息至少在某种程度上是用不起作用的恰当方法简单明了的。我还没有遇到任何东西说上面是规范的形式，但在我看来是。</p> <p>如果只是通过平常的方式来编译 <strong>SimpleTest.java</strong>，你不会得到任何结果。为了得到注解输出，你必须增加一个 <strong>processor</strong> 标志并且连接注解处理器类</p> <div class=highlight><pre><span></span><code>javac -processor annotations.simplest.SimpleProcessor SimpleTest.java
</code></pre></div> <p>现在编译器有了输出</p> <div class=highlight><pre><span></span><code>annotations.simplest.Simple
<span class=o>====</span> annotations.simplest.SimpleTest <span class=o>====</span>
CLASS : <span class=o>[</span>public<span class=o>]</span> : SimpleTest : annotations.simplest.SimpleTest
annotations.simplest.SimpleTest
java.lang.Object
i,SimpleTest<span class=o>()</span>,foo<span class=o>()</span>,bar<span class=o>(</span>java.lang.String,int,float<span class=o>)</span>,main<span class=o>(</span>java.lang.String<span class=o>[])</span>
<span class=o>====</span> <span class=nv>i</span> <span class=o>====</span>
FIELD : <span class=o>[]</span> : i : <span class=nv>int</span>
<span class=o>====</span> SimpleTest<span class=o>()</span> <span class=o>====</span>
CONSTRUCTOR : <span class=o>[</span>public<span class=o>]</span> : &lt;init&gt; : <span class=o>()</span><span class=nv>void</span>
<span class=o>====</span> foo<span class=o>()</span> <span class=o>====</span>
METHOD : <span class=o>[</span>public<span class=o>]</span> : foo : <span class=o>()</span>void
void foo<span class=o>()</span>
<span class=o>====</span> bar<span class=o>(</span>java.lang.String,int,float<span class=o>)</span> <span class=o>====</span>
METHOD : <span class=o>[</span>public<span class=o>]</span> : bar : <span class=o>(</span>java.lang.String,int,float<span class=o>)</span>void
void bar<span class=o>(</span>s,i,f<span class=o>)</span>
<span class=o>====</span> main<span class=o>(</span>java.lang.String<span class=o>[])</span> <span class=o>====</span>
METHOD : <span class=o>[</span>public, static<span class=o>]</span> : main : <span class=o>(</span>java.lang.String<span class=o>[])</span>void
void main<span class=o>(</span>args<span class=o>)</span>
</code></pre></div> <p>这给了你一些可以发现的东西，包括参数名和类型、返回值等。</p> <h3 id=_13>更复杂的处理器<a class=headerlink href=#_13 title="Permanent link">#</a></h3> <p>当你创建用于 javac 注解处理器时，你不能使用 Java 的反射特性，因为你处理的是源代码，而并非是编译后的 class 文件。各种 mirror<sup id="fnref:3 "><a class=footnote-ref href="#fn:3 ">1</a></sup> 解决这个问题的方法是，通过允许你在未编译的源代码中查看方法、字段和类型。</p> <p>如下是一个用于提取类中方法的注解，所以它可以被抽取成为一个接口：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/ifx/ExtractInterface.java</span>
<span class=c1>// javac-based annotation processing</span>
<span class=kn>package</span> <span class=nn>annotations.ifx</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>SOURCE</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>ExtractInterface</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>interfaceName</span><span class=p>()</span> <span class=k>default</span> <span class=s>&quot;-!!-&quot;</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p><strong>RetentionPolicy</strong> 的值为 <strong>SOURCE</strong>，这是为了在提取类中的接口之后不再将注解信息保留在 class 文件中。接下来的测试类提供了一些公用方法，这些方法可以成为接口的一部分：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/ifx/Multiplier.java</span>
<span class=c1>// javac-based annotation processing</span>
<span class=c1>// {java annotations.ifx.Multiplier}</span>
<span class=kn>package</span> <span class=nn>annotations.ifx</span><span class=p>;</span>
<span class=nd>@ExtractInterface</span><span class=p>(</span><span class=n>interfaceName</span><span class=o>=</span><span class=s>&quot;IMultiplier&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Multiplier</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=n>flag</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>multiply</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=n>y</span><span class=p>)</span> <span class=p>{</span>
        <span class=kt>int</span> <span class=n>total</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>x</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
            <span class=n>total</span> <span class=o>=</span> <span class=n>add</span><span class=p>(</span><span class=n>total</span><span class=p>,</span> <span class=n>y</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>total</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>fortySeven</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=mi>47</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=nf>add</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=n>y</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=n>y</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>double</span> <span class=nf>timesTen</span><span class=p>(</span><span class=kt>double</span> <span class=n>arg</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>arg</span> <span class=o>*</span> <span class=mi>10</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Multiplier</span> <span class=n>m</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Multiplier</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                <span class=s>&quot;11 * 16 = &quot;</span> <span class=o>+</span> <span class=n>m</span><span class=p>.</span><span class=na>multiply</span><span class=p>(</span><span class=mi>11</span><span class=p>,</span> <span class=mi>16</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=mi>11</span> <span class=o>*</span> <span class=mi>16</span> <span class=o>=</span> <span class=mi>176</span>
</code></pre></div> <p><strong>Multiplier</strong> 类（只能处理正整数）拥有一个 <code>multiply()</code> 方法，这个方法会多次调用私有方法 <code>add()</code> 来模拟乘法操作。<code>add()</code> 是私有方法，因此不能成为接口的一部分。其他的方法提供了语法多样性。注解被赋予 <strong>IMultiplier</strong> 的 <strong>InterfaceName</strong> 作为要创建的接口的名称。</p> <p>这里有一个编译时处理器用于提取有趣的方法，并创建一个新的 interface 源代码文件（这个源文件将会在下一轮中被自动编译）：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/ifx/IfaceExtractorProcessor.java</span>
<span class=c1>// javac-based annotation processing</span>
<span class=kn>package</span> <span class=nn>annotations.ifx</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.annotation.processing.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.lang.model.SourceVersion</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.lang.model.element.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>javax.lang.model.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=nd>@SupportedAnnotationTypes</span><span class=p>(</span>
        <span class=s>&quot;annotations.ifx.ExtractInterface&quot;</span><span class=p>)</span>
<span class=nd>@SupportedSourceVersion</span><span class=p>(</span><span class=n>SourceVersion</span><span class=p>.</span><span class=na>RELEASE_8</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>IfaceExtractorProcessor</span>
        <span class=kd>extends</span> <span class=n>AbstractProcessor</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Element</span><span class=o>&gt;</span>
            <span class=n>interfaceMethods</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=n>Elements</span> <span class=n>elementUtils</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>ProcessingEnvironment</span> <span class=n>processingEnv</span><span class=p>;</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>init</span><span class=p>(</span>
            <span class=n>ProcessingEnvironment</span> <span class=n>processingEnv</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>processingEnv</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>;</span>
        <span class=n>elementUtils</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>getElementUtils</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>process</span><span class=p>(</span>
            <span class=n>Set</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>TypeElement</span><span class=o>&gt;</span> <span class=n>annotations</span><span class=p>,</span>
            <span class=n>RoundEnvironment</span> <span class=n>env</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Element</span> <span class=n>elem</span><span class=p>:</span><span class=n>env</span><span class=p>.</span><span class=na>getElementsAnnotatedWith</span><span class=p>(</span>
                <span class=n>ExtractInterface</span><span class=p>.</span><span class=na>class</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>interfaceName</span> <span class=o>=</span> <span class=n>elem</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span>
                    <span class=n>ExtractInterface</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>interfaceName</span><span class=p>();</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Element</span> <span class=n>enclosed</span> <span class=p>:</span>
                    <span class=n>elem</span><span class=p>.</span><span class=na>getEnclosedElements</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>if</span><span class=p>(</span><span class=n>enclosed</span><span class=p>.</span><span class=na>getKind</span><span class=p>()</span>
                        <span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>ElementKind</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
                        <span class=n>enclosed</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()</span>
                                <span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>Modifier</span><span class=p>.</span><span class=na>PUBLIC</span><span class=p>)</span> <span class=o>&amp;&amp;</span>
                        <span class=o>!</span><span class=n>enclosed</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()</span>
                                <span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>Modifier</span><span class=p>.</span><span class=na>STATIC</span><span class=p>))</span> <span class=p>{</span>
                    <span class=n>interfaceMethods</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>enclosed</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=k>if</span><span class=p>(</span><span class=n>interfaceMethods</span><span class=p>.</span><span class=na>size</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
                <span class=n>writeInterfaceFile</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=kt>void</span>
    <span class=nf>writeInterfaceFile</span><span class=p>(</span><span class=n>String</span> <span class=n>interfaceName</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span>
                <span class=n>Writer</span> <span class=n>writer</span> <span class=o>=</span> <span class=n>processingEnv</span><span class=p>.</span><span class=na>getFiler</span><span class=p>()</span>
                        <span class=p>.</span><span class=na>createSourceFile</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>)</span>
                        <span class=p>.</span><span class=na>openWriter</span><span class=p>()</span>
        <span class=p>)</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>packageName</span> <span class=o>=</span> <span class=n>elementUtils</span>
                    <span class=p>.</span><span class=na>getPackageOf</span><span class=p>(</span><span class=n>interfaceMethods</span>
                            <span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=mi>0</span><span class=p>)).</span><span class=na>toString</span><span class=p>();</span>
            <span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span>
                    <span class=s>&quot;package &quot;</span> <span class=o>+</span> <span class=n>packageName</span> <span class=o>+</span> <span class=s>&quot;;\n&quot;</span><span class=p>);</span>
            <span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=s>&quot;public interface &quot;</span> <span class=o>+</span>
                    <span class=n>interfaceName</span> <span class=o>+</span> <span class=s>&quot; {\n&quot;</span><span class=p>);</span>
            <span class=k>for</span><span class=p>(</span><span class=n>Element</span> <span class=n>elem</span> <span class=p>:</span> <span class=n>interfaceMethods</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>ExecutableElement</span> <span class=n>method</span> <span class=o>=</span>
                        <span class=p>(</span><span class=n>ExecutableElement</span><span class=p>)</span><span class=n>elem</span><span class=p>;</span>
                <span class=n>String</span> <span class=n>signature</span> <span class=o>=</span> <span class=s>&quot; public &quot;</span><span class=p>;</span>
                <span class=n>signature</span> <span class=o>+=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>;</span>
                <span class=n>signature</span> <span class=o>+=</span> <span class=n>method</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>();</span>
                <span class=n>signature</span> <span class=o>+=</span> <span class=n>createArgList</span><span class=p>(</span>
                        <span class=n>method</span><span class=p>.</span><span class=na>getParameters</span><span class=p>());</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>signature</span><span class=p>);</span>
                <span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=n>signature</span> <span class=o>+</span> <span class=s>&quot;;\n&quot;</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>writer</span><span class=p>.</span><span class=na>write</span><span class=p>(</span><span class=s>&quot;}&quot;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=nf>createArgList</span><span class=p>(</span>
            <span class=n>List</span><span class=o>&lt;?</span> <span class=kd>extends</span> <span class=n>VariableElement</span><span class=o>&gt;</span> <span class=n>parameters</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>args</span> <span class=o>=</span> <span class=n>parameters</span><span class=p>.</span><span class=na>stream</span><span class=p>()</span>
                <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=n>p</span><span class=p>.</span><span class=na>asType</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; &quot;</span> <span class=o>+</span> <span class=n>p</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>())</span>
                <span class=p>.</span><span class=na>collect</span><span class=p>(</span><span class=n>Collectors</span><span class=p>.</span><span class=na>joining</span><span class=p>(</span><span class=s>&quot;, &quot;</span><span class=p>));</span>
        <span class=k>return</span> <span class=s>&quot;(&quot;</span> <span class=o>+</span> <span class=n>args</span> <span class=o>+</span> <span class=s>&quot;)&quot;</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><strong>Elements</strong> 对象实例 <strong>elementUtils</strong> 是一组静态方法的工具；我们用它来寻找 <strong>writeInterfaceFile()</strong> 中含有的包名。</p> <p><code>getEnclosedElements()</code>方法会通过指定的元素生成所有的“闭包”元素。在这里，这个类闭包了它的所有元素。通过使用 <code>getKind()</code> 我们会找到所有的 <strong>public</strong> 和 <strong>static</strong> 方法，并将其添加到 <strong>interfaceMethods</strong> 列表中。接下来 <code>writeInterfaceFile()</code> 使用 <strong>interfaceMethods</strong> 列表里面的值生成新的接口定义。注意，在 <code>writeInterfaceFile()</code> 使用了向下转型到 <strong>ExecutableElement</strong>，这使得我们可以获取所有的方法信息。<strong>createArgList()</strong> 是一个帮助方法，用于生成参数列表。</p> <p><strong>Filer</strong>是 <code>getFiler()</code> 生成的，并且是 <strong>PrintWriter</strong> 的一种实例，可以用于创建新文件。我们使用 <strong>Filer</strong> 对象，而不是原生的 <strong>PrintWriter</strong> 原因是，这个对象可以运行 <strong>javac</strong> 追踪你创建的新文件，这使得它可以在新一轮中检查新文件中的注解并编译文件。</p> <p>如下是一个命令行，可以在编译的时候使用处理器：</p> <div class=highlight><pre><span></span><code>javac -processor annotations.ifx.IfaceExtractorProcessor Multiplier.java
</code></pre></div> <p>新生成的 <strong>IMultiplier.java</strong> 的文件，正如你通过查看上面处理器的 <code>println()</code> 语句所猜测的那样，如下所示：</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>annotations.ifx</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>IMultiplier</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>multiply</span><span class=p>(</span><span class=kt>int</span> <span class=n>x</span><span class=p>,</span> <span class=kt>int</span> <span class=n>y</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>fortySeven</span><span class=p>();</span>
    <span class=kd>public</span> <span class=kt>double</span> <span class=nf>timesTen</span><span class=p>(</span><span class=kt>double</span> <span class=n>arg</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>这个类同样会被 <strong>javac</strong> 编译（在某一轮中），所以你会在同一个目录中看到 <strong>IMultiplier.class</strong> 文件。</p> <!-- Annotation-Based Unit Testing --> <h2 id=_14>基于注解的单元测试<a class=headerlink href=#_14 title="Permanent link">#</a></h2> <p>单元测试是对类中每个方法提供一个或者多个测试的一种事件，其目的是为了有规律的测试一个类中每个部分是否具备正确的行为。在 Java 中，最著名的单元测试工具就是 <strong>JUnit</strong>。<strong>JUnit</strong> 4 版本已经包含了注解。在注解版本之前的 JUnit 一个最主要的问题是，为了启动和运行 <strong>JUnit</strong> 测试，有大量的“仪式”需要标注。这种负担已经减轻了一些，<strong>但是</strong>注解使得测试更接近“可以工作的最简单的测试系统”。</p> <p>在注解版本之前的 JUnit，你必须创建一个单独的文件来保存单元测试。通过注解，我们可以将单元测试集成在需要被测试的类中，从而将单元测试的时间和麻烦降到了最低。这种方式有额外的好处，就是使得测试私有方法和公有方法变的一样容易。</p> <p>这个基于注解的测试框架叫做 <strong>@Unit</strong>。其最基本的测试形式，可能也是你使用的最多的一个注解是 <strong>@Test</strong>，我们使用 <strong>@Test</strong> 来标记测试方法。测试方法不带参数，并返回 <strong>boolean</strong> 结果来说明测试方法成功或者失败。你可以任意命名它的测试方法。同时 <strong>@Unit</strong> 测试方法可以是任意你喜欢的访问修饰方法，包括 <strong>private</strong>。</p> <p>要使用 <strong>@Unit</strong>，你必须导入 <strong>onjava.atunit</strong> 包，并且使用 <strong>@Unit</strong> 的测试标记为合适的方法和字段打上标签（在接下来的例子中你会学到），然后让你的构建系统对编译后的类运行 <strong>@Unit</strong>，下面是一个简单的例子：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AtUnitExample1.java</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AtUnitExample1.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnitExample1</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>methodOne</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;This is methodOne&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>methodTwo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;This is methodTwo&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>methodOneTest</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>methodOne</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>m2</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>methodTwo</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kd>private</span> <span class=kt>boolean</span> <span class=nf>m3</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=kc>true</span><span class=p>;</span> <span class=p>}</span>
    <span class=c1>// Shows output for failure:</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>failureTest</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=kc>false</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>anotherDisappointment</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample1</span>
<span class=p>.</span> <span class=n>m3</span>
<span class=p>.</span> <span class=n>methodOneTest</span>
<span class=p>.</span> <span class=n>m2</span> <span class=n>This</span> <span class=n>is</span> <span class=n>methodTwo</span>
<span class=p>.</span> <span class=n>failureTest</span> <span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>.</span> <span class=n>anotherDisappointment</span> <span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>(</span><span class=mi>5</span> <span class=n>tests</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=mi>2</span> <span class=n>FAILURES</span> <span class=o>&lt;&lt;&lt;</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample1</span><span class=p>:</span> <span class=n>failureTest</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample1</span><span class=p>:</span> <span class=n>anotherDisappointment</span>
</code></pre></div> <p>使用 <strong>@Unit</strong> 进行测试的类必须定义在某个包中（即必须包括 <strong>package</strong> 声明）。</p> <p><strong>@Test</strong> 注解被置于 <code>methodOneTest()</code>、 <code>m2()</code>、<code>m3()</code>、<code>failureTest()</code> 以及 a<code>notherDisappointment()</code> 方法之前，它们告诉 <strong>@Unit</strong> 方法作为单元测试来运行。同时 <strong>@Test</strong> 确保这些方法没有任何参数并且返回值为 <strong>boolean</strong> 或者 <strong>void</strong>。当你填写单元测试时，唯一需要做的就是决定测试是成功还是失败，（对于返回值为 <strong>boolean</strong> 的方法）应该返回 <strong>ture</strong> 还是 <strong>false</strong>。</p> <p>如果你熟悉 <strong>JUnit</strong>，你还将注意到 <strong>@Unit</strong> 输出的信息更多。你会看到现在正在运行的测试的输出更有用，最后它会告诉你导致失败的类和测试。</p> <p>你并非必须将测试方法嵌入到原来的类中，有时候这种事情根本做不到。要生产一个非嵌入式的测试，最简单的方式就是继承：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AUExternalTest.java</span>
<span class=c1>// Creating non-embedded tests</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AUExternalTest.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AUExternalTest</span> <span class=kd>extends</span> <span class=n>AtUnitExample1</span> <span class=p>{</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>_MethodOne</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>methodOne</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>_MethodTwo</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>methodTwo</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AUExternalTest</span>
<span class=p>.</span> <span class=n>tMethodOne</span>
<span class=p>.</span> <span class=n>tMethodTwo</span> <span class=n>This</span> <span class=n>is</span> <span class=n>methodTwo</span>
<span class=nf>OK</span> <span class=p>(</span><span class=mi>2</span> <span class=n>tests</span><span class=p>)</span>
</code></pre></div> <p>这个示例还表现出灵活命名的价值。在这里，<strong>@Test</strong> 方法被命名为下划线前缀加上要测试的方法名称（我并不认为这是一种理想的命名形式，这只是表现一种可能性罢了）。</p> <p>你也可以使用组合来创建非嵌入式的测试：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AUComposition.java</span>
<span class=c1>// Creating non-embedded tests</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AUComposition.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AUComposition</span> <span class=p>{</span>
    <span class=n>AtUnitExample1</span> <span class=n>testObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtUnitExample1</span><span class=p>();</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>tMethodOne</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>testObject</span><span class=p>.</span><span class=na>methodOne</span><span class=p>()</span>
                <span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>tMethodTwo</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>testObject</span><span class=p>.</span><span class=na>methodTwo</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AUComposition</span>
<span class=p>.</span> <span class=n>tMethodTwo</span> <span class=n>This</span> <span class=n>is</span> <span class=n>methodTwo</span>
<span class=p>.</span> <span class=n>tMethodOne</span>
<span class=nf>OK</span> <span class=p>(</span><span class=mi>2</span> <span class=n>tests</span><span class=p>)</span>
</code></pre></div> <p>因为在每一个测试里面都会创建 <strong>AUComposition</strong> 对象，所以创建新的成员变量 <strong>testObject</strong> 用于以后的每一个测试方法。</p> <p>因为 <strong>@Unit</strong> 中没有 <strong>JUnit</strong> 中特殊的 <strong>assert</strong> 方法，不过另一种形式的 <strong>@Test</strong> 方法仍然允许返回值为 <strong>void</strong>（如果你还想使用 <strong>true</strong> 或者 <strong>false</strong> 的话，也可以使用 <strong>boolean</strong> 作为方法返回值类型）。为了表示测试成功，可以使用 Java 的 <strong>assert</strong> 语句。Java 断言机制需要你在 java 命令行行加上 <strong>-ea</strong> 标志来开启，但是 <strong>@Unit</strong> 已经自动开启了该功能。要表示测试失败的话，你甚至可以使用异常。<strong>@Unit</strong> 的设计目标之一就是尽可能减少添加额外的语法，而 Java 的 <strong>assert</strong> 和异常对于报告错误而言，即已经足够了。一个失败的 <strong>assert</strong> 或者从方法从抛出的异常都被视为测试失败，但是 <strong>@Unit</strong> 不会在这个失败的测试上卡住，它会继续运行，直到所有测试完毕，下面是一个示例程序：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AtUnitExample2.java</span>
<span class=c1>// Assertions and exceptions can be used in @Tests</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AtUnitExample2.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnitExample2</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>methodOne</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;This is methodOne&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>methodTwo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;This is methodTwo&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>assertExample</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>assert</span> <span class=n>methodOne</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>assertFailureExample</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>assert</span> <span class=mi>1</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span> <span class=s>&quot;What a surprise!&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>exceptionExample</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=k>try</span><span class=p>(</span><span class=n>FileInputStream</span> <span class=n>fis</span> <span class=o>=</span>
                    <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span><span class=s>&quot;nofile.txt&quot;</span><span class=p>))</span> <span class=p>{}</span> <span class=c1>// Throws</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>assertAndReturn</span><span class=p>()</span> <span class=p>{</span>
        <span class=c1>// Assertion with message:</span>
        <span class=k>assert</span> <span class=n>methodTwo</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span> <span class=s>&quot;methodTwo must equal 2&quot;</span><span class=p>;</span>
        <span class=k>return</span> <span class=n>methodOne</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample2</span>
<span class=p>.</span> <span class=n>exceptionExample</span> <span class=n>java</span><span class=p>.</span><span class=na>io</span><span class=p>.</span><span class=na>FileNotFoundException</span><span class=p>:</span>
<span class=n>nofile</span><span class=p>.</span><span class=na>txt</span> <span class=p>(</span><span class=n>The</span> <span class=n>system</span> <span class=n>cannot</span> <span class=n>find</span> <span class=n>the</span> <span class=n>file</span> <span class=n>specified</span><span class=p>)</span>
<span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>.</span> <span class=n>assertExample</span>
<span class=p>.</span> <span class=n>assertAndReturn</span> <span class=n>This</span> <span class=n>is</span> <span class=n>methodTwo</span>
<span class=p>.</span> <span class=n>assertFailureExample</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>AssertionError</span><span class=p>:</span> <span class=n>What</span>
<span class=n>a</span> <span class=n>surprise</span><span class=o>!</span>
<span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>(</span><span class=mi>4</span> <span class=n>tests</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=mi>2</span> <span class=n>FAILURES</span> <span class=o>&lt;&lt;&lt;</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample2</span><span class=p>:</span> <span class=n>exceptionExample</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample2</span><span class=p>:</span> <span class=n>assertFailureExample</span>
</code></pre></div> <p>如下是一个使用非嵌入式测试的例子，并且使用了断言，它将会对 <strong>java.util.HashSet</strong> 进行一些简单的测试：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/HashSetTest.java</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/HashSetTest.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HashSetTest</span> <span class=p>{</span>
    <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>testObject</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>initialization</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>assert</span> <span class=n>testObject</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>_Contains</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>testObject</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>testObject</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>_Remove</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>testObject</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=n>testObject</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>testObject</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>采用继承的方式可能会更简单，也没有一些其他的约束。</p> <p>对每一个单元测试而言，<strong>@Unit</strong> 都会使用默认的无参构造器，为该测试类所属的类创建出一个新的实例。并在此新创建的对象上运行测试，然后丢弃该对象，以免对其他测试产生副作用。如此创建对象导致我们依赖于类的默认构造器。如果你的类没有默认构造器，或者对象需要复杂的构造过程，那么你可以创建一个 <strong>static</strong> 方法专门负责构造对象，然后使用 <strong>@TestObjectCreate</strong> 注解标记该方法，例子如下：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AtUnitExample3.java</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AtUnitExample3.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnitExample3</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kt>int</span> <span class=n>n</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>AtUnitExample3</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span> <span class=k>this</span><span class=p>.</span><span class=na>n</span> <span class=o>=</span> <span class=n>n</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>getN</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>methodOne</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=s>&quot;This is methodOne&quot;</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>methodTwo</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;This is methodTwo&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@TestObjectCreate</span>
    <span class=kd>static</span> <span class=n>AtUnitExample3</span> <span class=nf>create</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>AtUnitExample3</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>initialization</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>n</span> <span class=o>==</span> <span class=mi>47</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>methodOneTest</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>methodOne</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;This is methodOne&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>m2</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>methodTwo</span><span class=p>()</span> <span class=o>==</span> <span class=mi>2</span><span class=p>;</span> <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample3</span>
<span class=p>.</span> <span class=n>initialization</span>
<span class=p>.</span> <span class=n>m2</span> <span class=n>This</span> <span class=n>is</span> <span class=n>methodTwo</span>
<span class=p>.</span> <span class=n>methodOneTest</span>
<span class=nf>OK</span> <span class=p>(</span><span class=mi>3</span> <span class=n>tests</span><span class=p>)</span>
</code></pre></div> <p><strong>@TestObjectCreate</strong> 修饰的方法必须声明为 <strong>static</strong> ，且必须返回一个你正在测试的类型对象，这一切都由 <strong>@Unit</strong> 负责确保成立。</p> <p>有的时候，你需要向单元测试中增加一些字段。这时候可以使用 <strong>@TestProperty</strong> 注解，由它注解的字段表示只在单元测试中使用（因此，在你将产品发布给客户之前，他们应该被删除）。在下面的例子中，一个 <strong>String</strong> 通过 <code>String.split()</code> 方法进行分割，从其中读取一个值，这个值将会被生成测试对象：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AtUnitExample4.java</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AtUnitExample4.class}</span>
<span class=c1>// {VisuallyInspectOutput}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnitExample4</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>String</span> <span class=n>theory</span> <span class=o>=</span> <span class=s>&quot;All brontosauruses &quot;</span> <span class=o>+</span>
            <span class=s>&quot;are thin at one end, much MUCH thicker in the &quot;</span> <span class=o>+</span>
            <span class=s>&quot;middle, and then thin again at the far end.&quot;</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>word</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>Random</span> <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>();</span> <span class=c1>// Time-based seed</span>
    <span class=kd>public</span> <span class=nf>AtUnitExample4</span><span class=p>(</span><span class=n>String</span> <span class=n>word</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>word</span> <span class=o>=</span> <span class=n>word</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getWord</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>word</span><span class=p>;</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>scrambleWord</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Character</span><span class=o>&gt;</span> <span class=n>chars</span> <span class=o>=</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span>
                <span class=n>ConvertTo</span><span class=p>.</span><span class=na>boxed</span><span class=p>(</span><span class=n>word</span><span class=p>.</span><span class=na>toCharArray</span><span class=p>()));</span>
        <span class=n>Collections</span><span class=p>.</span><span class=na>shuffle</span><span class=p>(</span><span class=n>chars</span><span class=p>,</span> <span class=n>rand</span><span class=p>);</span>
        <span class=n>StringBuilder</span> <span class=n>result</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
        <span class=k>for</span><span class=p>(</span><span class=kt>char</span> <span class=n>ch</span> <span class=p>:</span> <span class=n>chars</span><span class=p>)</span>
            <span class=n>result</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>ch</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>result</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@TestProperty</span>
    <span class=kd>static</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>input</span> <span class=o>=</span>
            <span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>theory</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>));</span>
    <span class=nd>@TestProperty</span>
    <span class=kd>static</span> <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>words</span> <span class=o>=</span> <span class=n>input</span><span class=p>.</span><span class=na>iterator</span><span class=p>();</span>
    <span class=nd>@TestObjectCreate</span>
    <span class=kd>static</span> <span class=n>AtUnitExample4</span> <span class=nf>create</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>words</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span>
            <span class=k>return</span> <span class=k>new</span> <span class=n>AtUnitExample4</span><span class=p>(</span><span class=n>words</span><span class=p>.</span><span class=na>next</span><span class=p>());</span>
        <span class=k>else</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>words</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;&#39;&quot;</span> <span class=o>+</span> <span class=n>getWord</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;&#39;&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>getWord</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;are&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>scramble1</span><span class=p>()</span> <span class=p>{</span>
<span class=c1>// Use specific seed to get verifiable results:</span>
        <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>47</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;&#39;&quot;</span> <span class=o>+</span> <span class=n>getWord</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;&#39;&quot;</span><span class=p>);</span>
        <span class=n>String</span> <span class=n>scrambled</span> <span class=o>=</span> <span class=n>scrambleWord</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>scrambled</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>scrambled</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;lAl&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>scramble2</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>rand</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=mi>74</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;&#39;&quot;</span> <span class=o>+</span> <span class=n>getWord</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;&#39;&quot;</span><span class=p>);</span>
        <span class=n>String</span> <span class=n>scrambled</span> <span class=o>=</span> <span class=n>scrambleWord</span><span class=p>();</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>scrambled</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>scrambled</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;tsaeborornussu&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample4</span>
<span class=p>.</span> <span class=n>words</span> <span class=err>&#39;</span><span class=n>All</span><span class=err>&#39;</span>
<span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>.</span> <span class=n>scramble1</span> <span class=err>&#39;</span><span class=n>brontosauruses</span><span class=err>&#39;</span>
<span class=n>ntsaueorosurbs</span>
<span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>.</span> <span class=n>scramble2</span> <span class=err>&#39;</span><span class=n>are</span><span class=err>&#39;</span>
<span class=n>are</span>
<span class=p>(</span><span class=n>failed</span><span class=p>)</span>
<span class=p>(</span><span class=mi>3</span> <span class=n>tests</span><span class=p>)</span>
<span class=o>&gt;&gt;&gt;</span> <span class=mi>3</span> <span class=n>FAILURES</span> <span class=o>&lt;&lt;&lt;</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample4</span><span class=p>:</span> <span class=n>words</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample4</span><span class=p>:</span> <span class=n>scramble1</span>
<span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample4</span><span class=p>:</span> <span class=n>scramble2</span>
</code></pre></div> <p><strong>@TestProperty</strong> 也可以用来标记那些只在测试中使用的方法，但是它们本身不是测试方法。</p> <p>如果你的测试对象需要执行某些初始化工作，并且使用完成之后还需要执行清理工作，那么可以选择使用 <strong>static</strong> 的 <strong>@TestObjectCleanup</strong> 方法，当测试对象使用结束之后，该方法会为你执行清理工作。在下面的示例中，<strong>@TestObjectCleanup</strong> 为每一个测试对象都打开了一个文件，因此必须在丢弃测试的时候关闭该文件：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/AtUnitExample5.java</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/AtUnitExample5.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnitExample5</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>text</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>AtUnitExample5</span><span class=p>(</span><span class=n>String</span> <span class=n>text</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>text</span> <span class=o>=</span> <span class=n>text</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>toString</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>text</span><span class=p>;</span> <span class=p>}</span>
    <span class=nd>@TestProperty</span>
    <span class=kd>static</span> <span class=n>PrintWriter</span> <span class=n>output</span><span class=p>;</span>
    <span class=nd>@TestProperty</span>
    <span class=kd>static</span> <span class=kt>int</span> <span class=n>counter</span><span class=p>;</span>
    <span class=nd>@TestObjectCreate</span>
    <span class=kd>static</span> <span class=n>AtUnitExample5</span> <span class=nf>create</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>id</span> <span class=o>=</span> <span class=n>Integer</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>counter</span><span class=o>++</span><span class=p>);</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>output</span> <span class=o>=</span> <span class=k>new</span> <span class=n>PrintWriter</span><span class=p>(</span><span class=s>&quot;Test&quot;</span> <span class=o>+</span> <span class=n>id</span> <span class=o>+</span> <span class=s>&quot;.txt&quot;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>AtUnitExample5</span><span class=p>(</span><span class=n>id</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@TestObjectCleanup</span>
    <span class=kd>static</span> <span class=kt>void</span> <span class=nf>cleanup</span><span class=p>(</span><span class=n>AtUnitExample5</span> <span class=n>tobj</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Running cleanup&quot;</span><span class=p>);</span>
        <span class=n>output</span><span class=p>.</span><span class=na>close</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>test1</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>output</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;test1&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>test2</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>output</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;test2&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>boolean</span> <span class=nf>test3</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>output</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;test3&quot;</span><span class=p>);</span>
        <span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>AtUnitExample5</span>
<span class=p>.</span> <span class=n>test1</span>
<span class=n>Running</span> <span class=n>cleanup</span>
<span class=p>.</span> <span class=n>test3</span>
<span class=n>Running</span> <span class=n>cleanup</span>
<span class=p>.</span> <span class=n>test2</span>
<span class=n>Running</span> <span class=n>cleanup</span>
<span class=nf>OK</span> <span class=p>(</span><span class=mi>3</span> <span class=n>tests</span><span class=p>)</span>
</code></pre></div> <p>在输出中我们可以看到，清理方法会在每个测试方法结束之后自动运行。</p> <h3 id=unit>在 @Unit 中使用泛型<a class=headerlink href=#unit title="Permanent link">#</a></h3> <p>泛型为 <strong>@Unit</strong> 出了一个难题，因为我们不可能“通用测试”。我们必须针对某个特定类型的参数或者参数集才能进行测试。解决方法十分简单，让测试类继承自泛型类的一个特定版本即可：</p> <p>下面是一个 <strong>stack</strong> 的简单实现：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/StackL.java</span>
<span class=c1>// A stack built on a LinkedList</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>StackL</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=n>LinkedList</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LinkedList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>push</span><span class=p>(</span><span class=n>T</span> <span class=n>v</span><span class=p>)</span> <span class=p>{</span> <span class=n>list</span><span class=p>.</span><span class=na>addFirst</span><span class=p>(</span><span class=n>v</span><span class=p>);</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>T</span> <span class=nf>top</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>list</span><span class=p>.</span><span class=na>getFirst</span><span class=p>();</span> <span class=p>}</span>
    <span class=kd>public</span> <span class=n>T</span> <span class=nf>pop</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=n>list</span><span class=p>.</span><span class=na>removeFirst</span><span class=p>();</span> <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>为了测试 String 版本，我们直接让测试类继承一个 Stack\&lt;String> ：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/StackLStringTst.java</span>
<span class=c1>// Applying @Unit to generics</span>
<span class=c1>// {java onjava.atunit.AtUnit</span>
<span class=c1>// build/classes/main/annotations/StackLStringTst.class}</span>
<span class=kn>package</span> <span class=nn>annotations</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.atunit.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span>
<span class=nc>StackLStringTst</span> <span class=kd>extends</span> <span class=n>StackL</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>tPush</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>top</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;two&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>top</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;two&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>tPop</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;two&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>pop</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;two&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>pop</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;one&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=nd>@Test</span>
    <span class=kt>void</span> <span class=nf>tTop</span><span class=p>()</span> <span class=p>{</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;A&quot;</span><span class=p>);</span>
        <span class=n>push</span><span class=p>(</span><span class=s>&quot;B&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>top</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;B&quot;</span><span class=p>);</span>
        <span class=k>assert</span> <span class=n>top</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;B&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>annotations</span><span class=p>.</span><span class=na>StackLStringTst</span>
<span class=p>.</span> <span class=n>tTop</span>
<span class=p>.</span> <span class=n>tPush</span>
<span class=p>.</span> <span class=n>tPop</span>
<span class=nf>OK</span> <span class=p>(</span><span class=mi>3</span> <span class=n>tests</span><span class=p>)</span>
</code></pre></div> <p>这种方法存在的唯一缺点是，继承使我们失去了访问被测试的类中 <strong>private</strong> 方法的能力。这对你非常重要，那你要么把 private 方法变为 <strong>protected</strong>，要么添加一个非 <strong>private</strong> 的 <strong>@TestProperty</strong> 方法，由它来调用 <strong>private</strong> 方法（稍后我们会看到，<strong>AtUnitRemover</strong> 会删除产品中的 <strong>@TestProperty</strong> 方法）。</p> <p><strong>@Unit</strong> 搜索那些包含合适注解的类文件，然后运行 <strong>@Test</strong> 方法。我的主要目标就是让 <strong>@Unit</strong> 测试系统尽可能的透明，使得人们使用它的时候只需要添加 <strong>@Test</strong> 注解，而不需要特殊的编码和知识（现在版本的 <strong>JUnit</strong> 符合这个实践）。不过，如果说编写测试不会遇到任何困难，也不太可能，因此 <strong>@Unit</strong> 会尽量让这些困难变的微不足道，希望通过这种方式，你们会更乐意编写测试。</p> <h3 id=unit_1>实现 @Unit<a class=headerlink href=#unit_1 title="Permanent link">#</a></h3> <p>首先我们需要定义所有的注解类型。这些都是简单的标签，并且没有任何字段。@Test 标签在本章开头已经定义过了，这里是其他所需要的注解：</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/TestObjectCreate.java</span>
<span class=c1>// The @Unit @TestObjectCreate tag</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>TestObjectCreate</span> <span class=p>{}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/TestObjectCleanup.java</span>
<span class=c1>// The @Unit @TestObjectCleanup tag</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=nd>@Target</span><span class=p>(</span><span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>)</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>TestObjectCleanup</span> <span class=p>{}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/TestProperty.java</span>
<span class=c1>// The @Unit @TestProperty tag</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.annotation.*</span><span class=p>;</span>
<span class=c1>// Both fields and methods can be tagged as properties:</span>
<span class=nd>@Target</span><span class=p>({</span><span class=n>ElementType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>,</span> <span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>})</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>TestProperty</span> <span class=p>{}</span>
</code></pre></div> <p>所有测试的保留属性都为 <strong>RUNTIME</strong>，这是因为 <strong>@Unit</strong> 必须在编译后的代码中发现这些注解。</p> <p>要实现系统并运行测试，我们还需要反射机制来提取注解。下面这个程序通过注解中的信息，决定如何构造测试对象，并在测试对象上运行测试。正是由于注解帮助，这个程序才会如此短小而直接：</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/AtUnit.java</span>
<span class=c1>// An annotation-based unit-test framework</span>
<span class=c1>// {java onjava.atunit.AtUnit}</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.stream.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>AtUnit</span> <span class=kd>implements</span> <span class=n>ProcessFiles</span><span class=p>.</span><span class=na>Strategy</span> <span class=p>{</span>
    <span class=kd>static</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>testClass</span><span class=p>;</span>
    <span class=kd>static</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>failedTests</span><span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;&gt;</span><span class=p>();</span>
    <span class=kd>static</span> <span class=kt>long</span> <span class=n>testsRun</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>static</span> <span class=kt>long</span> <span class=n>failures</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span>
    <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>ClassLoader</span><span class=p>.</span><span class=na>getSystemClassLoader</span><span class=p>()</span>
                <span class=p>.</span><span class=na>setDefaultAssertionStatus</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span> <span class=c1>// Enable assert</span>
        <span class=k>new</span> <span class=n>ProcessFiles</span><span class=p>(</span><span class=k>new</span> <span class=n>AtUnit</span><span class=p>(),</span> <span class=s>&quot;class&quot;</span><span class=p>).</span><span class=na>start</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
        <span class=k>if</span><span class=p>(</span><span class=n>failures</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;OK (&quot;</span> <span class=o>+</span> <span class=n>testsRun</span> <span class=o>+</span> <span class=s>&quot; tests)&quot;</span><span class=p>);</span>
        <span class=k>else</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;(&quot;</span> <span class=o>+</span> <span class=n>testsRun</span> <span class=o>+</span> <span class=s>&quot; tests)&quot;</span><span class=p>);</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span>
                    <span class=s>&quot;\n&gt;&gt;&gt; &quot;</span> <span class=o>+</span> <span class=n>failures</span> <span class=o>+</span> <span class=s>&quot; FAILURE&quot;</span> <span class=o>+</span>
                            <span class=p>(</span><span class=n>failures</span> <span class=o>&gt;</span> <span class=mi>1</span> <span class=o>?</span> <span class=s>&quot;S&quot;</span> <span class=p>:</span> <span class=s>&quot;&quot;</span><span class=p>)</span> <span class=o>+</span> <span class=s>&quot; &lt;&lt;&lt;&quot;</span><span class=p>);</span>
            <span class=k>for</span><span class=p>(</span><span class=n>String</span> <span class=n>failed</span> <span class=p>:</span> <span class=n>failedTests</span><span class=p>)</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot; &quot;</span> <span class=o>+</span> <span class=n>failed</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>process</span><span class=p>(</span><span class=n>File</span> <span class=n>cFile</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>cName</span> <span class=o>=</span> <span class=n>ClassNameFinder</span><span class=p>.</span><span class=na>thisClass</span><span class=p>(</span>
                    <span class=n>Files</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>(</span><span class=n>cFile</span><span class=p>.</span><span class=na>toPath</span><span class=p>()));</span>
            <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>cName</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&quot;public:&quot;</span><span class=p>))</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=n>cName</span> <span class=o>=</span> <span class=n>cName</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;:&quot;</span><span class=p>)</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>;</span>
            <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>cName</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;.&quot;</span><span class=p>))</span>
                <span class=k>return</span><span class=p>;</span> <span class=c1>// Ignore unpackaged classes</span>
            <span class=n>testClass</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>cName</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=o>|</span> <span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>TestMethods</span> <span class=n>testMethods</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TestMethods</span><span class=p>();</span>
        <span class=n>Method</span> <span class=n>creator</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=n>Method</span> <span class=n>cleanup</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>testClass</span><span class=p>.</span><span class=na>getDeclaredMethods</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>testMethods</span><span class=p>.</span><span class=na>addIfTestMethod</span><span class=p>(</span><span class=n>m</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>creator</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=n>creator</span> <span class=o>=</span> <span class=n>checkForCreatorMethod</span><span class=p>(</span><span class=n>m</span><span class=p>);</span>
            <span class=k>if</span><span class=p>(</span><span class=n>cleanup</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=n>cleanup</span> <span class=o>=</span> <span class=n>checkForCleanupMethod</span><span class=p>(</span><span class=n>m</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=k>if</span><span class=p>(</span><span class=n>testMethods</span><span class=p>.</span><span class=na>size</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=n>creator</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>Modifier</span><span class=p>.</span><span class=na>isPublic</span><span class=p>(</span><span class=n>testClass</span>
                            <span class=p>.</span><span class=na>getDeclaredConstructor</span><span class=p>()</span>
                            <span class=p>.</span><span class=na>getModifiers</span><span class=p>()))</span> <span class=p>{</span>
                        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Error: &quot;</span> <span class=o>+</span> <span class=n>testClass</span> <span class=o>+</span>
                                <span class=s>&quot; no-arg constructor must be public&quot;</span><span class=p>);</span>
                        <span class=n>System</span><span class=p>.</span><span class=na>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>NoSuchMethodException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
<span class=c1>// Synthesized no-arg constructor; OK</span>
                <span class=p>}</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>testClass</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
        <span class=p>}</span>
        <span class=k>for</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>testMethods</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot; . &quot;</span> <span class=o>+</span> <span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; &quot;</span><span class=p>);</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=n>Object</span> <span class=n>testObject</span> <span class=o>=</span> <span class=n>createTestObject</span><span class=p>(</span><span class=n>creator</span><span class=p>);</span>
                <span class=kt>boolean</span> <span class=n>success</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=kt>boolean</span><span class=p>.</span><span class=na>class</span><span class=p>))</span>
                        <span class=n>success</span> <span class=o>=</span> <span class=p>(</span><span class=n>Boolean</span><span class=p>)</span><span class=n>m</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>testObject</span><span class=p>);</span>
                    <span class=k>else</span> <span class=p>{</span>
                        <span class=n>m</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>testObject</span><span class=p>);</span>
                        <span class=n>success</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span> <span class=c1>// If no assert fails</span>
                    <span class=p>}</span>
                <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>InvocationTargetException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
<span class=c1>// Actual exception is inside e:</span>
                    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getCause</span><span class=p>());</span>
                <span class=p>}</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>success</span> <span class=o>?</span> <span class=s>&quot;&quot;</span> <span class=p>:</span> <span class=s>&quot;(failed)&quot;</span><span class=p>);</span>
                <span class=n>testsRun</span><span class=o>++</span><span class=p>;</span>
                <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>success</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>failures</span><span class=o>++</span><span class=p>;</span>
                    <span class=n>failedTests</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>testClass</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span>
                            <span class=s>&quot;: &quot;</span> <span class=o>+</span> <span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
                <span class=p>}</span>
                <span class=k>if</span><span class=p>(</span><span class=n>cleanup</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span>
                    <span class=n>cleanup</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>testObject</span><span class=p>,</span> <span class=n>testObject</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IllegalAccessException</span> <span class=o>|</span>
                    <span class=n>IllegalArgumentException</span> <span class=o>|</span>
                    <span class=n>InvocationTargetException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kd>static</span>
    <span class=kd>class</span> <span class=nc>TestMethods</span> <span class=kd>extends</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Method</span><span class=o>&gt;</span> <span class=p>{</span>
        <span class=kt>void</span> <span class=nf>addIfTestMethod</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Test</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=k>return</span><span class=p>;</span>
            <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=kt>boolean</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>||</span>
                    <span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=kt>void</span><span class=p>.</span><span class=na>class</span><span class=p>)))</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@Test method&quot;</span> <span class=o>+</span>
                        <span class=s>&quot; must return boolean or void&quot;</span><span class=p>);</span>
            <span class=n>m</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span> <span class=c1>// If it&#39;s private, etc.</span>
            <span class=n>add</span><span class=p>(</span><span class=n>m</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=kd>static</span>
    <span class=n>Method</span> <span class=nf>checkForCreatorMethod</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>TestObjectCreate</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>testClass</span><span class=p>))</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@TestObjectCreate &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;must return instance of Class to be tested&quot;</span><span class=p>);</span>
        <span class=k>if</span><span class=p>((</span><span class=n>m</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()</span> <span class=o>&amp;</span>
                <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Modifier</span><span class=p>.</span><span class=na>STATIC</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@TestObjectCreate &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;must be static.&quot;</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>m</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=kd>static</span>
    <span class=n>Method</span> <span class=nf>checkForCleanupMethod</span><span class=p>(</span><span class=n>Method</span> <span class=n>m</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>TestObjectCleanup</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=kt>void</span><span class=p>.</span><span class=na>class</span><span class=p>))</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@TestObjectCleanup &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;must return void&quot;</span><span class=p>);</span>
        <span class=k>if</span><span class=p>((</span><span class=n>m</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()</span> <span class=o>&amp;</span>
                <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Modifier</span><span class=p>.</span><span class=na>STATIC</span><span class=p>)</span> <span class=o>&lt;</span> <span class=mi>1</span><span class=p>)</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@TestObjectCleanup &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;must be static.&quot;</span><span class=p>);</span>
        <span class=k>if</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>().</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>||</span>
                <span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>()</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>!=</span> <span class=n>testClass</span><span class=p>)</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;@TestObjectCleanup &quot;</span> <span class=o>+</span>
                    <span class=s>&quot;must take an argument of the tested type.&quot;</span><span class=p>);</span>
        <span class=n>m</span><span class=p>.</span><span class=na>setAccessible</span><span class=p>(</span><span class=kc>true</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>m</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=n>Object</span>
    <span class=nf>createTestObject</span><span class=p>(</span><span class=n>Method</span> <span class=n>creator</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span><span class=p>(</span><span class=n>creator</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>creator</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=n>testClass</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IllegalAccessException</span> <span class=o>|</span>
                    <span class=n>IllegalArgumentException</span> <span class=o>|</span>
                    <span class=n>InvocationTargetException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;Couldn&#39;t run &quot;</span> <span class=o>+</span>
                        <span class=s>&quot;@TestObject (creator) method.&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span> <span class=c1>// Use the no-arg constructor:</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>testClass</span><span class=p>.</span><span class=na>newInstance</span><span class=p>();</span>
            <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>InstantiationException</span> <span class=o>|</span>
                    <span class=n>IllegalAccessException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span>
                        <span class=s>&quot;Couldn&#39;t create a test object. &quot;</span> <span class=o>+</span>
                                <span class=s>&quot;Try using a @TestObject method.&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>虽然它可能是“过早的重构”（因为它只在书中使用过一次），<strong>AtUnit.java</strong> 使用了 <strong>ProcessFiles</strong> 工具逐步判断命令行中的参数，决定它是一个目录还是文件，并采取相应的行为。这可以应用于不同的解决方法，是因为它包含了一个 可用于自定义的 <strong>Strategy</strong> 接口：</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/ProcessFiles.java</span>
<span class=kn>package</span> <span class=nn>onjava</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ProcessFiles</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Strategy</span> <span class=p>{</span>
        <span class=kt>void</span> <span class=nf>process</span><span class=p>(</span><span class=n>File</span> <span class=n>file</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=kd>private</span> <span class=n>Strategy</span> <span class=n>strategy</span><span class=p>;</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>ext</span><span class=p>;</span>
    <span class=kd>public</span> <span class=nf>ProcessFiles</span><span class=p>(</span><span class=n>Strategy</span> <span class=n>strategy</span><span class=p>,</span> <span class=n>String</span> <span class=n>ext</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>strategy</span> <span class=o>=</span> <span class=n>strategy</span><span class=p>;</span>
        <span class=k>this</span><span class=p>.</span><span class=na>ext</span> <span class=o>=</span> <span class=n>ext</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>start</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=k>if</span><span class=p>(</span><span class=n>args</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span>
                <span class=n>processDirectoryTree</span><span class=p>(</span><span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=s>&quot;.&quot;</span><span class=p>));</span>
            <span class=k>else</span>
                <span class=k>for</span><span class=p>(</span><span class=n>String</span> <span class=n>arg</span> <span class=p>:</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>File</span> <span class=n>fileArg</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>arg</span><span class=p>);</span>
                    <span class=k>if</span><span class=p>(</span><span class=n>fileArg</span><span class=p>.</span><span class=na>isDirectory</span><span class=p>())</span>
                        <span class=n>processDirectoryTree</span><span class=p>(</span><span class=n>fileArg</span><span class=p>);</span>
                    <span class=k>else</span> <span class=p>{</span>
<span class=c1>// Allow user to leave off extension:</span>
                        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=n>arg</span><span class=p>.</span><span class=na>endsWith</span><span class=p>(</span><span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>ext</span><span class=p>))</span>
                            <span class=n>arg</span> <span class=o>+=</span> <span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>ext</span><span class=p>;</span>
                        <span class=n>strategy</span><span class=p>.</span><span class=na>process</span><span class=p>(</span>
                                <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>arg</span><span class=p>).</span><span class=na>getCanonicalFile</span><span class=p>());</span>
                    <span class=p>}</span>
                <span class=p>}</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>processDirectoryTree</span><span class=p>(</span><span class=n>File</span> <span class=n>root</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>PathMatcher</span> <span class=n>matcher</span> <span class=o>=</span> <span class=n>FileSystems</span><span class=p>.</span><span class=na>getDefault</span><span class=p>()</span>
                <span class=p>.</span><span class=na>getPathMatcher</span><span class=p>(</span><span class=s>&quot;glob:**/*.{&quot;</span> <span class=o>+</span> <span class=n>ext</span> <span class=o>+</span> <span class=s>&quot;}&quot;</span><span class=p>);</span>
        <span class=n>Files</span><span class=p>.</span><span class=na>walk</span><span class=p>(</span><span class=n>root</span><span class=p>.</span><span class=na>toPath</span><span class=p>())</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>matcher</span><span class=p>::</span><span class=n>matches</span><span class=p>)</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=n>strategy</span><span class=p>.</span><span class=na>process</span><span class=p>(</span><span class=n>p</span><span class=p>.</span><span class=na>toFile</span><span class=p>()));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><strong>AtUnit</strong> 类实现了 <strong>ProcessFiles.Strategy</strong>，其包含了一个 <code>process()</code> 方法。在这种方式下，<strong>AtUnit</strong> 实例可以作为参数传递给 <strong>ProcessFiles</strong> 构造器。第二个构造器的参数告诉 <strong>ProcessFiles</strong> 如寻找所有包含 “class” 拓展名的文件。</p> <p>如下是一个简单的使用示例：</p> <div class=highlight><pre><span></span><code><span class=c1>// annotations/DemoProcessFiles.java</span>
<span class=kn>import</span> <span class=nn>onjava.ProcessFiles</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DemoProcessFiles</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>new</span> <span class=n>ProcessFiles</span><span class=p>(</span><span class=n>file</span> <span class=o>-&gt;</span> <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>file</span><span class=p>),</span>
                <span class=s>&quot;java&quot;</span><span class=p>).</span><span class=na>start</span><span class=p>(</span><span class=n>args</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=p>.</span><span class=err>\</span><span class=n>AtUnitExample1</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AtUnitExample2</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AtUnitExample3</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AtUnitExample4</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AtUnitExample5</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AUComposition</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>AUExternalTest</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>Constraints</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>DBTable</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>Member</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>SQLInteger</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>SQLString</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>TableCreator</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>database</span><span class=err>\</span><span class=n>Uniqueness</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>DemoProcessFiles</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>HashSetTest</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>ifx</span><span class=err>\</span><span class=n>ExtractInterface</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>ifx</span><span class=err>\</span><span class=n>IfaceExtractorProcessor</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>ifx</span><span class=err>\</span><span class=n>Multiplier</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>PasswordUtils</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>simplest</span><span class=err>\</span><span class=n>Simple</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>simplest</span><span class=err>\</span><span class=n>SimpleProcessor</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>simplest</span><span class=err>\</span><span class=n>SimpleTest</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>SimulatingNull</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>StackL</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>StackLStringTst</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>Testable</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>UseCase</span><span class=p>.</span><span class=na>java</span>
<span class=p>.</span><span class=err>\</span><span class=n>UseCaseTracker</span><span class=p>.</span><span class=na>java</span>
</code></pre></div> <p>如果没有命令行参数，这个程序会遍历当前的目录树。你还可以提供多个参数，这些参数可以是类文件（带或不带.class扩展名）或目录。</p> <p>回到我们对 <strong>AtUnit.java</strong> 的讨论，因为 <strong>@Unit</strong> 会自动找到可测试的类和方法，所以不需要“套件”机制。</p> <p><strong>AtUnit.java</strong> 中存在的一个我们必须要解决的问题是，当它发现类文件时，类文件名中的限定类名（包括包）不明显。为了发现这个信息，必须解析类文件 - 这不是微不足道的，但也不是不可能的。 找到 .class 文件时，会打开它并读取其二进制数据并将其传递给 <code>ClassNameFinder.thisClass()</code>。 在这里，我们正在进入“字节码工程”领域，因为我们实际上正在分析类文件的内容：</p> <div class=highlight><pre><span></span><code><span class=c1>// onjava/atunit/ClassNameFinder.java</span>
<span class=c1>// {java onjava.atunit.ClassNameFinder}</span>
<span class=kn>package</span> <span class=nn>onjava.atunit</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.io.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.nio.file.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>java.util.*</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>onjava.*</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>ClassNameFinder</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>thisClass</span><span class=p>(</span><span class=kt>byte</span><span class=o>[]</span> <span class=n>classBytes</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=n>Integer</span><span class=o>&gt;</span> <span class=n>offsetTable</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=n>Map</span><span class=o>&lt;</span><span class=n>Integer</span><span class=p>,</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>classNameTable</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;&gt;</span><span class=p>();</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=n>DataInputStream</span> <span class=n>data</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DataInputStream</span><span class=p>(</span>
                    <span class=k>new</span> <span class=n>ByteArrayInputStream</span><span class=p>(</span><span class=n>classBytes</span><span class=p>));</span>
            <span class=kt>int</span> <span class=n>magic</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readInt</span><span class=p>();</span> <span class=c1>// 0xcafebabe</span>
            <span class=kt>int</span> <span class=n>minorVersion</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=kt>int</span> <span class=n>majorVersion</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=kt>int</span> <span class=n>constantPoolCount</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=kt>int</span><span class=o>[]</span> <span class=n>constantPool</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>int</span><span class=o>[</span><span class=n>constantPoolCount</span><span class=o>]</span><span class=p>;</span>
            <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>constantPoolCount</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=kt>int</span> <span class=n>tag</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
                <span class=c1>// int tableSize;</span>
                <span class=k>switch</span><span class=p>(</span><span class=n>tag</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>case</span> <span class=mi>1</span><span class=p>:</span> <span class=c1>// UTF</span>
                        <span class=kt>int</span> <span class=n>length</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
                        <span class=kt>char</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=k>new</span> <span class=kt>char</span><span class=o>[</span><span class=n>length</span><span class=o>]</span><span class=p>;</span>
                        <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>bytes</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span>
                            <span class=n>bytes</span><span class=o>[</span><span class=n>k</span><span class=o>]</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>data</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
                        <span class=n>String</span> <span class=n>className</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=p>(</span><span class=n>bytes</span><span class=p>);</span>
                        <span class=n>classNameTable</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>className</span><span class=p>);</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>5</span><span class=p>:</span> <span class=c1>// LONG</span>
                    <span class=k>case</span> <span class=mi>6</span><span class=p>:</span> <span class=c1>// DOUBLE</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readLong</span><span class=p>();</span> <span class=c1>// discard 8 bytes</span>
                        <span class=n>i</span><span class=o>++</span><span class=p>;</span> <span class=c1>// Special skip necessary</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>7</span><span class=p>:</span> <span class=c1>// CLASS</span>
                        <span class=kt>int</span> <span class=n>offset</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
                        <span class=n>offsetTable</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>offset</span><span class=p>);</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>8</span><span class=p>:</span> <span class=c1>// STRING</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span> <span class=c1>// discard 2 bytes</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>3</span><span class=p>:</span> <span class=c1>// INTEGER</span>
                    <span class=k>case</span> <span class=mi>4</span><span class=p>:</span> <span class=c1>// FLOAT</span>
                    <span class=k>case</span> <span class=mi>9</span><span class=p>:</span> <span class=c1>// FIELD_REF</span>
                    <span class=k>case</span> <span class=mi>10</span><span class=p>:</span> <span class=c1>// METHOD_REF</span>
                    <span class=k>case</span> <span class=mi>11</span><span class=p>:</span> <span class=c1>// INTERFACE_METHOD_REF</span>
                    <span class=k>case</span> <span class=mi>12</span><span class=p>:</span> <span class=c1>// NAME_AND_TYPE</span>
                    <span class=k>case</span> <span class=mi>18</span><span class=p>:</span> <span class=c1>// Invoke Dynamic</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readInt</span><span class=p>();</span> <span class=c1>// discard 4 bytes</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>15</span><span class=p>:</span> <span class=c1>// Method Handle</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readByte</span><span class=p>();</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>case</span> <span class=mi>16</span><span class=p>:</span> <span class=c1>// Method Type</span>
                        <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
                        <span class=k>break</span><span class=p>;</span>
                    <span class=k>default</span><span class=p>:</span>
                        <span class=k>throw</span>
                                <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;Bad tag &quot;</span> <span class=o>+</span> <span class=n>tag</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=kt>short</span> <span class=n>accessFlags</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=n>String</span> <span class=n>access</span> <span class=o>=</span> <span class=p>(</span><span class=n>accessFlags</span> <span class=o>&amp;</span> <span class=mh>0x0001</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>?</span>
                    <span class=s>&quot;nonpublic:&quot;</span> <span class=p>:</span> <span class=s>&quot;public:&quot;</span><span class=p>;</span>
            <span class=kt>int</span> <span class=n>thisClass</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=kt>int</span> <span class=n>superClass</span> <span class=o>=</span> <span class=n>data</span><span class=p>.</span><span class=na>readShort</span><span class=p>();</span>
            <span class=k>return</span> <span class=n>access</span> <span class=o>+</span> <span class=n>classNameTable</span><span class=p>.</span><span class=na>get</span><span class=p>(</span>
                    <span class=n>offsetTable</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>thisClass</span><span class=p>)).</span><span class=na>replace</span><span class=p>(</span><span class=sc>&#39;/&#39;</span><span class=p>,</span> <span class=sc>&#39;.&#39;</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>IOException</span> <span class=o>|</span> <span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=c1>// Demonstration:</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
        <span class=n>PathMatcher</span> <span class=n>matcher</span> <span class=o>=</span> <span class=n>FileSystems</span><span class=p>.</span><span class=na>getDefault</span><span class=p>()</span>
                <span class=p>.</span><span class=na>getPathMatcher</span><span class=p>(</span><span class=s>&quot;glob:**/*.class&quot;</span><span class=p>);</span>
<span class=c1>// Walk the entire tree:</span>
        <span class=n>Files</span><span class=p>.</span><span class=na>walk</span><span class=p>(</span><span class=n>Paths</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=s>&quot;.&quot;</span><span class=p>))</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>matcher</span><span class=p>::</span><span class=n>matches</span><span class=p>)</span>
                <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>p</span> <span class=o>-&gt;</span> <span class=p>{</span>
                    <span class=k>try</span> <span class=p>{</span>
                        <span class=k>return</span> <span class=n>thisClass</span><span class=p>(</span><span class=n>Files</span><span class=p>.</span><span class=na>readAllBytes</span><span class=p>(</span><span class=n>p</span><span class=p>));</span>
                    <span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>})</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&quot;public:&quot;</span><span class=p>))</span>
<span class=c1>// .filter(s -&gt; s.indexOf(&#39;$&#39;) &gt;= 0)</span>
                <span class=p>.</span><span class=na>map</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=s>&quot;:&quot;</span><span class=p>)</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>)</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=o>!</span><span class=n>s</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&quot;enums.&quot;</span><span class=p>))</span>
                <span class=p>.</span><span class=na>filter</span><span class=p>(</span><span class=n>s</span> <span class=o>-&gt;</span> <span class=n>s</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=s>&quot;.&quot;</span><span class=p>))</span>
                <span class=p>.</span><span class=na>forEach</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>::</span><span class=n>println</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>输出为：</p> <div class=highlight><pre><span></span><code><span class=n>onjava</span><span class=p>.</span><span class=na>ArrayShow</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>AtUnit$TestMethods</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>AtUnit</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>ClassNameFinder</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>Test</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>TestObjectCleanup</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>TestObjectCreate</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>atunit</span><span class=p>.</span><span class=na>TestProperty</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>BasicSupplier</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>CollectionMethodDifferences</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>ConvertTo</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Boolean</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Byte</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Character</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Double</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Float</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Integer</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Long</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pboolean</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pbyte</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pchar</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pdouble</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pfloat</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pint</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Plong</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Pshort</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count$Short</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Count</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>CountingIntegerList</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>CountMap</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Countries</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Enums</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>FillMap</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>HTMLColors</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>MouseClick</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Nap</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Null</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Operations</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>OSExecute</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>OSExecuteException</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Pair</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>ProcessFiles$Strategy</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>ProcessFiles</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Boolean</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Byte</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Character</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Double</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Float</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Integer</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Long</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pboolean</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pbyte</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pchar</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pdouble</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pfloat</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pint</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Plong</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Pshort</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$Short</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand$String</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Rand</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Range</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Repeat</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>RmDir</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Sets</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Stack</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Suppliers</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>TimedAbort</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Timer</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Tuple</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Tuple2</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Tuple3</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Tuple4</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>Tuple5</span>
<span class=n>onjava</span><span class=p>.</span><span class=na>TypeCounter</span>
</code></pre></div> <p>虽然无法在这里介绍其中所有的细节，但是每个类文件都必须遵循一定的格式，而我已经尽力用有意义的字段来表示这些从 <strong>ByteArrayInputStream</strong> 中提取出来的数据片段。通过施加在输入流上的读操作，你能看出每个信息片的大小。例如每一个类的头 32 个 bit 总是一个 “神秘数字” <strong>0xcafebabe</strong>，而接下来的两个 <strong>short</strong> 值是版本信息。常量池包含了程序的常量，所以这是一个可变的值。接下来的 <strong>short</strong> 告诉我们这个常量池有多大，然后我们为其创建一个尺寸合适的数组。常量池中的每一个元素，其长度可能是固定式，也可能是可变的值，因此我们必须检查每一个常量的起始标记，然后才能知道该怎么做，这就是 switch 语句的工作。我们并不打算精确的分析类中所有的数据，仅仅是从文件的起始一步一步的走，直到取得我们所需的信息，因此你会发现，在这个过程中我们丢弃了大量的数据。关于类的信息都保存在 <strong>classNameTable</strong> 和 <strong>offsetTable</strong> 中。在读取常量池之后，就找到了 <strong>this_class</strong> 信息，这是 <strong>offsetTable</strong> 的一个坐标，通过它可以找到进入 <strong>classNameTable</strong> 的坐标，然后就可以得到我们所需的类的名字了。</p> <p>现在让我们回到 <strong>AtUtil.java</strong> 中，process() 方法中拥有了类的名字，然后检查它是否包含“.”，如果有就表示该类定义于一个包中。没有包的类会被忽略。如果一个类在包中，那么我们就可以使用标准的类加载器通过 <code>Class.forName()</code> 将其加载进来。现在我们可以对这个类进行 <strong>@Unit</strong> 注解的分析工作了。</p> <p>我们只需要关注三件事：首先是 <strong>@Test** 方法，它们被保存在 <strong>TestMehtods</strong> 列表中，然后检查其是否具有 @TestObjectCreate 和 *<em>@TestObjectCleanup</em></strong><em>*</em> 方法。从代码中可以看到，我们通过调用相应的方法来查询注解从而找到这些方法。</p> <p>每找到一个 @Test 方法，就打印出来当前类的名字，于是观察者立刻就可以知道发生了什么。接下来开始执行测试，也就是打印出方法名，然后调用 createTestObject() （如果存在一个加了 @TestObjectCreate 注解的方法），或者调用默认构造器。一旦创建出来测试对象，如果调用其上的测试方法。如果测试的返回值为 boolean，就捕获该结果。如果测试方法没有返回值，那么就没有异常发生，我们就假设测试成功，反之，如果当 assert 失败或者有任何异常抛出的时候，就说明测试失败，这时将异常信息打印出来以显示错误的原因。如果有失败的测试发生，那么还要统计失败的次数，并将失败所属的类和方法加入到 failedTests 中，以便最后报告给用户。</p> <!-- Summary --> <h2 id=_15>本章小结<a class=headerlink href=#_15 title="Permanent link">#</a></h2> <p>注解是 Java 引入的一项非常受欢迎的补充，它提供了一种结构化，并且具有类型检查能力的新途径，从而使得你能够为代码中加入元数据，而且不会导致代码杂乱并难以阅读。使用注解能够帮助我们避免编写累赘的部署描述性文件，以及其他的生成文件。而 Javadoc 中的 @deprecated 被 @Deprecated 注解所替代的事实也说明，与注释性文字相比，注解绝对更适用于描述类相关的信息。</p> <p>Java 提供了很少的内置注解。这意味着如果你在别处找不到可用的类库，那么就只能自己创建新的注解以及相应的处理器。通过将注解处理器链接到 javac，你可以一步完成编译新生成的文件，简化了构造过程。</p> <p>API 的提供方和框架将会将注解作为他们工具的一部分。通过 @Unit 系统，我们可以想象，注解会极大的改变我们的 Java 编程体验。</p> <!-- 分页 --> <div style="page-break-after: always;"></div> <div class=footnote> <hr> <ol> <li id="fn:3 "> <p>The Java designers coyly suggest that a mirror is where you find a reflection.&#160;<a class=footnote-backref href="#fnref:3 " title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> </ol> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../22-Enumerations/ title="22 Enumerations" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> 22 Enumerations </span> </div> </a> <a href=../24-Concurrent-Programming/ title="24 Concurrent Programming" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> 24 Concurrent Programming </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../../../assets/fonts/font-awesome.css> <a href=https://leay.net target=_blank rel=noopener title=home class="md-footer-social__link fa fa-home"></a> <a href=https://github.com/hqweay target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../../../../../assets/javascripts/application.c33a9706.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.ja.js></script> <script src=../../../../../assets/javascripts/lunr/lunr.multi.js></script> <script>app.initialize({version:"1.1",url:{base:"../../../../.."}})</script> </body> </html>